{"version":3,"file":"mh091rc1a.js","sources":["../src/filesystem/FileSystemAdapter.ts","../node_modules/fflate/esm/browser.js","../src/filesystem/HTTPFSAdapter.ts","../node_modules/gl-matrix/esm/common.js","../node_modules/gl-matrix/esm/mat4.js","../node_modules/gl-matrix/esm/vec3.js","../src/animorph/DirectoryList.ts","../src/animorph/PoseRotation.ts","../src/animorph/Face.ts","../src/lib/StringToLineIterator.ts","../src/lib/StringToLine.ts","../src/animorph/FaceVector.ts","../src/animorph/Vertex.ts","../src/animorph/VertexVector.ts","../src/animorph/UnsortedUsedVertex.ts","../src/animorph/Target.ts","../src/animorph/TargetEntry.ts","../src/lib/MultiSet.ts","../src/animorph/PoseTranslation.ts","../src/animorph/PoseTarget.ts","../src/animorph/PoseEntry.ts","../src/animorph/FaceGroup.ts","../node_modules/toad.js/node_modules/toad.jsx/lib/jsx-runtime.js","../node_modules/toad.js/lib/src/util/lsx.js","../node_modules/toad.js/lib/src/Signal.js","../node_modules/toad.js/lib/src/model/Model.js","../node_modules/toad.js/lib/src/model/ValueModel.js","../node_modules/toad.js/lib/src/model/NumberModel.js","../node_modules/toad.js/lib/src/model/BooleanModel.js","../node_modules/toad.js/lib/src/util/BigDecimal.js","../node_modules/toad.js/lib/src/util/expressions/ExpressionNode.js","../node_modules/toad.js/lib/src/util/expressions/Lexer.js","../node_modules/toad.js/lib/src/util/expressions/expression.js","../node_modules/toad.js/lib/src/model/TextModel.js","../node_modules/toad.js/lib/src/model/HtmlModel.js","../node_modules/toad.js/lib/src/model/Action.js","../node_modules/toad.js/lib/src/util/dom.js","../node_modules/toad.js/lib/src/controller/globalController.js","../node_modules/toad.js/lib/src/controller/Controller.js","../node_modules/toad.js/lib/src/util/animation.js","../node_modules/toad.js/lib/src/view/View.js","../node_modules/toad.js/lib/src/view/ModelView.js","../node_modules/toad.js/lib/src/view/ActionView.js","../node_modules/toad.js/lib/src/style/tx-text.js","../node_modules/toad.js/lib/src/view/TextField.js","../node_modules/toad.js/lib/src/view/textAreaStyle.js","../node_modules/toad.js/lib/src/view/TextTool.js","../node_modules/toad.js/lib/src/view/TextArea.js","../node_modules/toad.js/lib/src/view/Display.js","../node_modules/toad.js/lib/src/style/tx-button.js","../node_modules/toad.js/lib/src/view/Button.js","../node_modules/toad.js/lib/src/view/BooleanView.js","../node_modules/toad.js/lib/src/style/tx-checkbox.js","../node_modules/toad.js/lib/src/view/Checkbox.js","../node_modules/toad.js/lib/src/style/tx-search.js","../node_modules/toad.js/lib/src/view/Search.js","../node_modules/toad.js/lib/src/style/tx-switch.js","../node_modules/toad.js/lib/src/view/Switch.js","../node_modules/toad.js/lib/src/style/tx-radio.js","../node_modules/toad.js/lib/src/view/RadioButton.js","../node_modules/toad.js/lib/src/menu/MenuState.js","../node_modules/toad.js/lib/src/menu/MenuHelper.js","../node_modules/toad.js/lib/src/menu/PopupMenu.js","../node_modules/toad.js/lib/src/style/tx-combobox.js","../node_modules/toad.js/lib/src/style/tx-menu.js","../node_modules/toad.js/lib/src/view/Select.js","../node_modules/toad.js/lib/src/style/tx-slider.js","../node_modules/toad.js/lib/src/util/color.js","../node_modules/toad.js/lib/src/view/Slider.js","../node_modules/toad.js/lib/src/view/GenericTool.js","../node_modules/toad.js/lib/src/view/ToolButton.js","../node_modules/toad.js/lib/src/view/SlotView.js","../node_modules/toad.js/lib/src/view/ToadIf.js","../node_modules/toad.js/lib/src/style/tx-tabs.js","../node_modules/toad.js/lib/src/style/tx-scrollbar.js","../node_modules/toad.js/lib/src/view/Tab.js","../node_modules/toad.js/lib/src/menu/menuStyle.js","../node_modules/toad.js/lib/src/menu/MenuButton.js","../node_modules/toad.js/lib/src/menu/MenuNode.js","../node_modules/toad.js/lib/src/menu/Menu.js","../node_modules/toad.js/lib/src/menu/MenuSpacer.js","../node_modules/toad.js/lib/src/table/model/TableModel.js","../node_modules/toad.js/lib/src/table/TableEditMode.js","../node_modules/toad.js/lib/src/table/adapter/TableAdapter.js","../node_modules/toad.js/lib/src/table/TableEventType.js","../node_modules/toad.js/lib/src/table/TablePos.js","../node_modules/toad.js/lib/src/table/model/SelectionModel.js","../node_modules/toad.js/lib/src/table/model/TypedTableModel.js","../node_modules/toad.js/lib/src/table/TableEvent.js","../node_modules/toad.js/lib/src/table/private/TableFriend.js","../node_modules/toad.js/lib/src/table/private/TableAnimation.js","../node_modules/toad.js/lib/src/table/private/InsertAnimation.js","../node_modules/toad.js/lib/src/table/private/InsertRowAnimation.js","../node_modules/toad.js/lib/src/table/private/RemoveRowAnimation.js","../node_modules/toad.js/lib/src/table/private/InsertColumnAnimation.js","../node_modules/toad.js/lib/src/table/private/RemoveColumnAnimation.js","../node_modules/toad.js/lib/src/util/scrollIntoView.js","../node_modules/toad.js/lib/src/table/style/tx-table.js","../node_modules/toad.js/lib/src/table/Table.js","../node_modules/toad.js/lib/src/table/TableTool.js","../src/animorph/Selector.ts","../src/animorph/SelectorManager.ts","../src/animorph/VectorArray.ts","../src/animorph/Mesh.ts","../src/gl/calculateNormals.ts","../src/gl/RenderMesh.ts","../src/gl/shader/AbstractShader.ts","../src/gl/shader/RGBAShader.ts","../src/renderMesh.ts","../src/gl/util.ts","../node_modules/toad.jsx/lib/jsx-runtime.js","../src/ui/PosePanel.tsx","../src/ui/DetailPanel.tsx","../src/ui/CharacterPanel.tsx","../src/ui/screen.tsx","../src/main.ts"],"sourcesContent":["import { AbstractFileSystemAdapter } from \"./AbstractFileSystemAdapter\"\n\nexport class FileSystemAdapter {\n    private static instance?: AbstractFileSystemAdapter\n\n    static setInstance(instance: AbstractFileSystemAdapter) {\n        FileSystemAdapter.instance = instance\n    }\n    static readFile(pathname: string): string {\n        return FileSystemAdapter.instance!.readFile(pathname)\n    }\n    static exists(pathname: string): boolean {\n        return FileSystemAdapter.instance!.exists(pathname)\n    }\n    static isFile(pathname: string): boolean {\n        return FileSystemAdapter.instance!.isFile(pathname)\n    }\n    static isDir(pathname: string): boolean {\n        return FileSystemAdapter.instance!.isDir(pathname)\n    }\n    static listDir(pathname: string): string[] {\n        return FileSystemAdapter.instance!.listDir(pathname)\n    }\n    static realPath(pathname: string): string {\n        return FileSystemAdapter.instance!.realPath(pathname)\n    }\n    static joinPath(pathname1: string, pathname2: string): string {\n        return FileSystemAdapter.instance!.joinPath(pathname1, pathname2)\n    }\n}\n","// DEFLATE is a complex format; to read this code, you should probably check the RFC first:\n// https://tools.ietf.org/html/rfc1951\n// You may also wish to take a look at the guide I made about this program:\n// https://gist.github.com/101arrowz/253f31eb5abc3d9275ab943003ffecad\n// Some of the following code is similar to that of UZIP.js:\n// https://github.com/photopea/UZIP.js\n// However, the vast majority of the codebase has diverged from UZIP.js to increase performance and reduce bundle size.\n// Sometimes 0 will appear where -1 would be more appropriate. This is because using a uint\n// is better for memory in most engines (I *think*).\nvar ch2 = {};\nvar wk = (function (c, id, msg, transfer, cb) {\n    var w = new Worker(ch2[id] || (ch2[id] = URL.createObjectURL(new Blob([\n        c + ';addEventListener(\"error\",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'\n    ], { type: 'text/javascript' }))));\n    w.onmessage = function (e) {\n        var d = e.data, ed = d.$e$;\n        if (ed) {\n            var err = new Error(ed[0]);\n            err['code'] = ed[1];\n            err.stack = ed[2];\n            cb(err, null);\n        }\n        else\n            cb(null, d);\n    };\n    w.postMessage(msg, transfer);\n    return w;\n});\n\n// aliases for shorter compressed code (most minifers don't do this)\nvar u8 = Uint8Array, u16 = Uint16Array, i32 = Int32Array;\n// fixed length extra bits\nvar fleb = new u8([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, /* unused */ 0, 0, /* impossible */ 0]);\n// fixed distance extra bits\nvar fdeb = new u8([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, /* unused */ 0, 0]);\n// code length index map\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\n// get base, reverse index map from extra bits\nvar freb = function (eb, start) {\n    var b = new u16(31);\n    for (var i = 0; i < 31; ++i) {\n        b[i] = start += 1 << eb[i - 1];\n    }\n    // numbers here are at max 18 bits\n    var r = new i32(b[30]);\n    for (var i = 1; i < 30; ++i) {\n        for (var j = b[i]; j < b[i + 1]; ++j) {\n            r[j] = ((j - b[i]) << 5) | i;\n        }\n    }\n    return { b: b, r: r };\n};\nvar _a = freb(fleb, 2), fl = _a.b, revfl = _a.r;\n// we can ignore the fact that the other numbers are wrong; they never happen anyway\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0), fd = _b.b, revfd = _b.r;\n// map of value to reverse (assuming 16 bits)\nvar rev = new u16(32768);\nfor (var i = 0; i < 32768; ++i) {\n    // reverse table algorithm from SO\n    var x = ((i & 0xAAAA) >> 1) | ((i & 0x5555) << 1);\n    x = ((x & 0xCCCC) >> 2) | ((x & 0x3333) << 2);\n    x = ((x & 0xF0F0) >> 4) | ((x & 0x0F0F) << 4);\n    rev[i] = (((x & 0xFF00) >> 8) | ((x & 0x00FF) << 8)) >> 1;\n}\n// create huffman tree from u8 \"map\": index -> code length for code index\n// mb (max bits) must be at most 15\n// TODO: optimize/split up?\nvar hMap = (function (cd, mb, r) {\n    var s = cd.length;\n    // index\n    var i = 0;\n    // u16 \"map\": index -> # of codes with bit length = index\n    var l = new u16(mb);\n    // length of cd must be 288 (total # of codes)\n    for (; i < s; ++i) {\n        if (cd[i])\n            ++l[cd[i] - 1];\n    }\n    // u16 \"map\": index -> minimum code for bit length = index\n    var le = new u16(mb);\n    for (i = 1; i < mb; ++i) {\n        le[i] = (le[i - 1] + l[i - 1]) << 1;\n    }\n    var co;\n    if (r) {\n        // u16 \"map\": index -> number of actual bits, symbol for code\n        co = new u16(1 << mb);\n        // bits to remove for reverser\n        var rvb = 15 - mb;\n        for (i = 0; i < s; ++i) {\n            // ignore 0 lengths\n            if (cd[i]) {\n                // num encoding both symbol and bits read\n                var sv = (i << 4) | cd[i];\n                // free bits\n                var r_1 = mb - cd[i];\n                // start value\n                var v = le[cd[i] - 1]++ << r_1;\n                // m is end value\n                for (var m = v | ((1 << r_1) - 1); v <= m; ++v) {\n                    // every 16 bit value starting with the code yields the same result\n                    co[rev[v] >> rvb] = sv;\n                }\n            }\n        }\n    }\n    else {\n        co = new u16(s);\n        for (i = 0; i < s; ++i) {\n            if (cd[i]) {\n                co[i] = rev[le[cd[i] - 1]++] >> (15 - cd[i]);\n            }\n        }\n    }\n    return co;\n});\n// fixed length tree\nvar flt = new u8(288);\nfor (var i = 0; i < 144; ++i)\n    flt[i] = 8;\nfor (var i = 144; i < 256; ++i)\n    flt[i] = 9;\nfor (var i = 256; i < 280; ++i)\n    flt[i] = 7;\nfor (var i = 280; i < 288; ++i)\n    flt[i] = 8;\n// fixed distance tree\nvar fdt = new u8(32);\nfor (var i = 0; i < 32; ++i)\n    fdt[i] = 5;\n// fixed length map\nvar flm = /*#__PURE__*/ hMap(flt, 9, 0), flrm = /*#__PURE__*/ hMap(flt, 9, 1);\n// fixed distance map\nvar fdm = /*#__PURE__*/ hMap(fdt, 5, 0), fdrm = /*#__PURE__*/ hMap(fdt, 5, 1);\n// find max of array\nvar max = function (a) {\n    var m = a[0];\n    for (var i = 1; i < a.length; ++i) {\n        if (a[i] > m)\n            m = a[i];\n    }\n    return m;\n};\n// read d, starting at bit p and mask with m\nvar bits = function (d, p, m) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8)) >> (p & 7)) & m;\n};\n// read d, starting at bit p continuing for at least 16 bits\nvar bits16 = function (d, p) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8) | (d[o + 2] << 16)) >> (p & 7));\n};\n// get end of byte\nvar shft = function (p) { return ((p + 7) / 8) | 0; };\n// typed array slice - allows garbage collector to free original reference,\n// while being more compatible than .slice\nvar slc = function (v, s, e) {\n    if (s == null || s < 0)\n        s = 0;\n    if (e == null || e > v.length)\n        e = v.length;\n    // can't use .constructor in case user-supplied\n    return new u8(v.subarray(s, e));\n};\n/**\n * Codes for errors generated within this library\n */\nexport var FlateErrorCode = {\n    UnexpectedEOF: 0,\n    InvalidBlockType: 1,\n    InvalidLengthLiteral: 2,\n    InvalidDistance: 3,\n    StreamFinished: 4,\n    NoStreamHandler: 5,\n    InvalidHeader: 6,\n    NoCallback: 7,\n    InvalidUTF8: 8,\n    ExtraFieldTooLong: 9,\n    InvalidDate: 10,\n    FilenameTooLong: 11,\n    StreamFinishing: 12,\n    InvalidZipData: 13,\n    UnknownCompressionMethod: 14\n};\n// error codes\nvar ec = [\n    'unexpected EOF',\n    'invalid block type',\n    'invalid length/literal',\n    'invalid distance',\n    'stream finished',\n    'no stream handler',\n    ,\n    'no callback',\n    'invalid UTF-8 data',\n    'extra field too long',\n    'date not in range 1980-2099',\n    'filename too long',\n    'stream finishing',\n    'invalid zip data'\n    // determined by unknown compression method\n];\n;\nvar err = function (ind, msg, nt) {\n    var e = new Error(msg || ec[ind]);\n    e.code = ind;\n    if (Error.captureStackTrace)\n        Error.captureStackTrace(e, err);\n    if (!nt)\n        throw e;\n    return e;\n};\n// expands raw DEFLATE data\nvar inflt = function (dat, st, buf, dict) {\n    // source length       dict length\n    var sl = dat.length, dl = dict ? dict.length : 0;\n    if (!sl || st.f && !st.l)\n        return buf || new u8(0);\n    var noBuf = !buf;\n    // have to estimate size\n    var resize = noBuf || st.i != 2;\n    // no state\n    var noSt = st.i;\n    // Assumes roughly 33% compression ratio average\n    if (noBuf)\n        buf = new u8(sl * 3);\n    // ensure buffer can fit at least l elements\n    var cbuf = function (l) {\n        var bl = buf.length;\n        // need to increase size to fit\n        if (l > bl) {\n            // Double or set to necessary, whichever is greater\n            var nbuf = new u8(Math.max(bl * 2, l));\n            nbuf.set(buf);\n            buf = nbuf;\n        }\n    };\n    //  last chunk         bitpos           bytes\n    var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n    // total bits\n    var tbts = sl * 8;\n    do {\n        if (!lm) {\n            // BFINAL - this is only 1 when last chunk is next\n            final = bits(dat, pos, 1);\n            // type: 0 = no compression, 1 = fixed huffman, 2 = dynamic huffman\n            var type = bits(dat, pos + 1, 3);\n            pos += 3;\n            if (!type) {\n                // go to end of byte boundary\n                var s = shft(pos) + 4, l = dat[s - 4] | (dat[s - 3] << 8), t = s + l;\n                if (t > sl) {\n                    if (noSt)\n                        err(0);\n                    break;\n                }\n                // ensure size\n                if (resize)\n                    cbuf(bt + l);\n                // Copy over uncompressed data\n                buf.set(dat.subarray(s, t), bt);\n                // Get new bitpos, update byte count\n                st.b = bt += l, st.p = pos = t * 8, st.f = final;\n                continue;\n            }\n            else if (type == 1)\n                lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n            else if (type == 2) {\n                //  literal                            lengths\n                var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n                var tl = hLit + bits(dat, pos + 5, 31) + 1;\n                pos += 14;\n                // length+distance tree\n                var ldt = new u8(tl);\n                // code length tree\n                var clt = new u8(19);\n                for (var i = 0; i < hcLen; ++i) {\n                    // use index map to get real code\n                    clt[clim[i]] = bits(dat, pos + i * 3, 7);\n                }\n                pos += hcLen * 3;\n                // code lengths bits\n                var clb = max(clt), clbmsk = (1 << clb) - 1;\n                // code lengths map\n                var clm = hMap(clt, clb, 1);\n                for (var i = 0; i < tl;) {\n                    var r = clm[bits(dat, pos, clbmsk)];\n                    // bits read\n                    pos += r & 15;\n                    // symbol\n                    var s = r >> 4;\n                    // code length to copy\n                    if (s < 16) {\n                        ldt[i++] = s;\n                    }\n                    else {\n                        //  copy   count\n                        var c = 0, n = 0;\n                        if (s == 16)\n                            n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n                        else if (s == 17)\n                            n = 3 + bits(dat, pos, 7), pos += 3;\n                        else if (s == 18)\n                            n = 11 + bits(dat, pos, 127), pos += 7;\n                        while (n--)\n                            ldt[i++] = c;\n                    }\n                }\n                //    length tree                 distance tree\n                var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n                // max length bits\n                lbt = max(lt);\n                // max dist bits\n                dbt = max(dt);\n                lm = hMap(lt, lbt, 1);\n                dm = hMap(dt, dbt, 1);\n            }\n            else\n                err(1);\n            if (pos > tbts) {\n                if (noSt)\n                    err(0);\n                break;\n            }\n        }\n        // Make sure the buffer can hold this + the largest possible addition\n        // Maximum chunk size (practically, theoretically infinite) is 2^17\n        if (resize)\n            cbuf(bt + 131072);\n        var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n        var lpos = pos;\n        for (;; lpos = pos) {\n            // bits read, code\n            var c = lm[bits16(dat, pos) & lms], sym = c >> 4;\n            pos += c & 15;\n            if (pos > tbts) {\n                if (noSt)\n                    err(0);\n                break;\n            }\n            if (!c)\n                err(2);\n            if (sym < 256)\n                buf[bt++] = sym;\n            else if (sym == 256) {\n                lpos = pos, lm = null;\n                break;\n            }\n            else {\n                var add = sym - 254;\n                // no extra bits needed if less\n                if (sym > 264) {\n                    // index\n                    var i = sym - 257, b = fleb[i];\n                    add = bits(dat, pos, (1 << b) - 1) + fl[i];\n                    pos += b;\n                }\n                // dist\n                var d = dm[bits16(dat, pos) & dms], dsym = d >> 4;\n                if (!d)\n                    err(3);\n                pos += d & 15;\n                var dt = fd[dsym];\n                if (dsym > 3) {\n                    var b = fdeb[dsym];\n                    dt += bits16(dat, pos) & (1 << b) - 1, pos += b;\n                }\n                if (pos > tbts) {\n                    if (noSt)\n                        err(0);\n                    break;\n                }\n                if (resize)\n                    cbuf(bt + 131072);\n                var end = bt + add;\n                if (bt < dt) {\n                    var shift = dl - dt, dend = Math.min(dt, end);\n                    if (shift + bt < 0)\n                        err(3);\n                    for (; bt < dend; ++bt)\n                        buf[bt] = dict[shift + bt];\n                }\n                for (; bt < end; ++bt)\n                    buf[bt] = buf[bt - dt];\n            }\n        }\n        st.l = lm, st.p = lpos, st.b = bt, st.f = final;\n        if (lm)\n            final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n    } while (!final);\n    // don't reallocate for streams or user buffers\n    return bt != buf.length && noBuf ? slc(buf, 0, bt) : buf.subarray(0, bt);\n};\n// starting at p, write the minimum number of bits that can hold v to d\nvar wbits = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >> 8;\n};\n// starting at p, write the minimum number of bits (>8) that can hold v to d\nvar wbits16 = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >> 8;\n    d[o + 2] |= v >> 16;\n};\n// creates code lengths from a frequency table\nvar hTree = function (d, mb) {\n    // Need extra info to make a tree\n    var t = [];\n    for (var i = 0; i < d.length; ++i) {\n        if (d[i])\n            t.push({ s: i, f: d[i] });\n    }\n    var s = t.length;\n    var t2 = t.slice();\n    if (!s)\n        return { t: et, l: 0 };\n    if (s == 1) {\n        var v = new u8(t[0].s + 1);\n        v[t[0].s] = 1;\n        return { t: v, l: 1 };\n    }\n    t.sort(function (a, b) { return a.f - b.f; });\n    // after i2 reaches last ind, will be stopped\n    // freq must be greater than largest possible number of symbols\n    t.push({ s: -1, f: 25001 });\n    var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\n    t[0] = { s: -1, f: l.f + r.f, l: l, r: r };\n    // efficient algorithm from UZIP.js\n    // i0 is lookbehind, i2 is lookahead - after processing two low-freq\n    // symbols that combined have high freq, will start processing i2 (high-freq,\n    // non-composite) symbols instead\n    // see https://reddit.com/r/photopea/comments/ikekht/uzipjs_questions/\n    while (i1 != s - 1) {\n        l = t[t[i0].f < t[i2].f ? i0++ : i2++];\n        r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\n        t[i1++] = { s: -1, f: l.f + r.f, l: l, r: r };\n    }\n    var maxSym = t2[0].s;\n    for (var i = 1; i < s; ++i) {\n        if (t2[i].s > maxSym)\n            maxSym = t2[i].s;\n    }\n    // code lengths\n    var tr = new u16(maxSym + 1);\n    // max bits in tree\n    var mbt = ln(t[i1 - 1], tr, 0);\n    if (mbt > mb) {\n        // more algorithms from UZIP.js\n        // TODO: find out how this code works (debt)\n        //  ind    debt\n        var i = 0, dt = 0;\n        //    left            cost\n        var lft = mbt - mb, cst = 1 << lft;\n        t2.sort(function (a, b) { return tr[b.s] - tr[a.s] || a.f - b.f; });\n        for (; i < s; ++i) {\n            var i2_1 = t2[i].s;\n            if (tr[i2_1] > mb) {\n                dt += cst - (1 << (mbt - tr[i2_1]));\n                tr[i2_1] = mb;\n            }\n            else\n                break;\n        }\n        dt >>= lft;\n        while (dt > 0) {\n            var i2_2 = t2[i].s;\n            if (tr[i2_2] < mb)\n                dt -= 1 << (mb - tr[i2_2]++ - 1);\n            else\n                ++i;\n        }\n        for (; i >= 0 && dt; --i) {\n            var i2_3 = t2[i].s;\n            if (tr[i2_3] == mb) {\n                --tr[i2_3];\n                ++dt;\n            }\n        }\n        mbt = mb;\n    }\n    return { t: new u8(tr), l: mbt };\n};\n// get the max length and assign length codes\nvar ln = function (n, l, d) {\n    return n.s == -1\n        ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1))\n        : (l[n.s] = d);\n};\n// length codes generation\nvar lc = function (c) {\n    var s = c.length;\n    // Note that the semicolon was intentional\n    while (s && !c[--s])\n        ;\n    var cl = new u16(++s);\n    //  ind      num         streak\n    var cli = 0, cln = c[0], cls = 1;\n    var w = function (v) { cl[cli++] = v; };\n    for (var i = 1; i <= s; ++i) {\n        if (c[i] == cln && i != s)\n            ++cls;\n        else {\n            if (!cln && cls > 2) {\n                for (; cls > 138; cls -= 138)\n                    w(32754);\n                if (cls > 2) {\n                    w(cls > 10 ? ((cls - 11) << 5) | 28690 : ((cls - 3) << 5) | 12305);\n                    cls = 0;\n                }\n            }\n            else if (cls > 3) {\n                w(cln), --cls;\n                for (; cls > 6; cls -= 6)\n                    w(8304);\n                if (cls > 2)\n                    w(((cls - 3) << 5) | 8208), cls = 0;\n            }\n            while (cls--)\n                w(cln);\n            cls = 1;\n            cln = c[i];\n        }\n    }\n    return { c: cl.subarray(0, cli), n: s };\n};\n// calculate the length of output from tree, code lengths\nvar clen = function (cf, cl) {\n    var l = 0;\n    for (var i = 0; i < cl.length; ++i)\n        l += cf[i] * cl[i];\n    return l;\n};\n// writes a fixed block\n// returns the new bit pos\nvar wfblk = function (out, pos, dat) {\n    // no need to write 00 as type: TypedArray defaults to 0\n    var s = dat.length;\n    var o = shft(pos + 2);\n    out[o] = s & 255;\n    out[o + 1] = s >> 8;\n    out[o + 2] = out[o] ^ 255;\n    out[o + 3] = out[o + 1] ^ 255;\n    for (var i = 0; i < s; ++i)\n        out[o + i + 4] = dat[i];\n    return (o + 4 + s) * 8;\n};\n// writes a block\nvar wblk = function (dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\n    wbits(out, p++, final);\n    ++lf[256];\n    var _a = hTree(lf, 15), dlt = _a.t, mlb = _a.l;\n    var _b = hTree(df, 15), ddt = _b.t, mdb = _b.l;\n    var _c = lc(dlt), lclt = _c.c, nlc = _c.n;\n    var _d = lc(ddt), lcdt = _d.c, ndc = _d.n;\n    var lcfreq = new u16(19);\n    for (var i = 0; i < lclt.length; ++i)\n        ++lcfreq[lclt[i] & 31];\n    for (var i = 0; i < lcdt.length; ++i)\n        ++lcfreq[lcdt[i] & 31];\n    var _e = hTree(lcfreq, 7), lct = _e.t, mlcb = _e.l;\n    var nlcc = 19;\n    for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\n        ;\n    var flen = (bl + 5) << 3;\n    var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\n    var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + 2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18];\n    if (bs >= 0 && flen <= ftlen && flen <= dtlen)\n        return wfblk(out, p, dat.subarray(bs, bs + bl));\n    var lm, ll, dm, dl;\n    wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\n    if (dtlen < ftlen) {\n        lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\n        var llm = hMap(lct, mlcb, 0);\n        wbits(out, p, nlc - 257);\n        wbits(out, p + 5, ndc - 1);\n        wbits(out, p + 10, nlcc - 4);\n        p += 14;\n        for (var i = 0; i < nlcc; ++i)\n            wbits(out, p + 3 * i, lct[clim[i]]);\n        p += 3 * nlcc;\n        var lcts = [lclt, lcdt];\n        for (var it = 0; it < 2; ++it) {\n            var clct = lcts[it];\n            for (var i = 0; i < clct.length; ++i) {\n                var len = clct[i] & 31;\n                wbits(out, p, llm[len]), p += lct[len];\n                if (len > 15)\n                    wbits(out, p, (clct[i] >> 5) & 127), p += clct[i] >> 12;\n            }\n        }\n    }\n    else {\n        lm = flm, ll = flt, dm = fdm, dl = fdt;\n    }\n    for (var i = 0; i < li; ++i) {\n        var sym = syms[i];\n        if (sym > 255) {\n            var len = (sym >> 18) & 31;\n            wbits16(out, p, lm[len + 257]), p += ll[len + 257];\n            if (len > 7)\n                wbits(out, p, (sym >> 23) & 31), p += fleb[len];\n            var dst = sym & 31;\n            wbits16(out, p, dm[dst]), p += dl[dst];\n            if (dst > 3)\n                wbits16(out, p, (sym >> 5) & 8191), p += fdeb[dst];\n        }\n        else {\n            wbits16(out, p, lm[sym]), p += ll[sym];\n        }\n    }\n    wbits16(out, p, lm[256]);\n    return p + ll[256];\n};\n// deflate options (nice << 13) | chain\nvar deo = /*#__PURE__*/ new i32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\n// empty\nvar et = /*#__PURE__*/ new u8(0);\n// compresses data into a raw DEFLATE buffer\nvar dflt = function (dat, lvl, plvl, pre, post, st) {\n    var s = st.z || dat.length;\n    var o = new u8(pre + s + 5 * (1 + Math.ceil(s / 7000)) + post);\n    // writing to this writes to the output buffer\n    var w = o.subarray(pre, o.length - post);\n    var lst = st.l;\n    var pos = (st.r || 0) & 7;\n    if (lvl) {\n        if (pos)\n            w[0] = st.r >> 3;\n        var opt = deo[lvl - 1];\n        var n = opt >> 13, c = opt & 8191;\n        var msk_1 = (1 << plvl) - 1;\n        //    prev 2-byte val map    curr 2-byte val map\n        var prev = st.p || new u16(32768), head = st.h || new u16(msk_1 + 1);\n        var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\n        var hsh = function (i) { return (dat[i] ^ (dat[i + 1] << bs1_1) ^ (dat[i + 2] << bs2_1)) & msk_1; };\n        // 24576 is an arbitrary number of maximum symbols per block\n        // 424 buffer for last block\n        var syms = new i32(25000);\n        // length/literal freq   distance freq\n        var lf = new u16(288), df = new u16(32);\n        //  l/lcnt  exbits  index          l/lind  waitdx          blkpos\n        var lc_1 = 0, eb = 0, i = st.i || 0, li = 0, wi = st.w || 0, bs = 0;\n        for (; i + 2 < s; ++i) {\n            // hash value\n            var hv = hsh(i);\n            // index mod 32768    previous index mod\n            var imod = i & 32767, pimod = head[hv];\n            prev[imod] = pimod;\n            head[hv] = imod;\n            // We always should modify head and prev, but only add symbols if\n            // this data is not yet processed (\"wait\" for wait index)\n            if (wi <= i) {\n                // bytes remaining\n                var rem = s - i;\n                if ((lc_1 > 7000 || li > 24576) && (rem > 423 || !lst)) {\n                    pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\n                    li = lc_1 = eb = 0, bs = i;\n                    for (var j = 0; j < 286; ++j)\n                        lf[j] = 0;\n                    for (var j = 0; j < 30; ++j)\n                        df[j] = 0;\n                }\n                //  len    dist   chain\n                var l = 2, d = 0, ch_1 = c, dif = imod - pimod & 32767;\n                if (rem > 2 && hv == hsh(i - dif)) {\n                    var maxn = Math.min(n, rem) - 1;\n                    var maxd = Math.min(32767, i);\n                    // max possible length\n                    // not capped at dif because decompressors implement \"rolling\" index population\n                    var ml = Math.min(258, rem);\n                    while (dif <= maxd && --ch_1 && imod != pimod) {\n                        if (dat[i + l] == dat[i + l - dif]) {\n                            var nl = 0;\n                            for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\n                                ;\n                            if (nl > l) {\n                                l = nl, d = dif;\n                                // break out early when we reach \"nice\" (we are satisfied enough)\n                                if (nl > maxn)\n                                    break;\n                                // now, find the rarest 2-byte sequence within this\n                                // length of literals and search for that instead.\n                                // Much faster than just using the start\n                                var mmd = Math.min(dif, nl - 2);\n                                var md = 0;\n                                for (var j = 0; j < mmd; ++j) {\n                                    var ti = i - dif + j & 32767;\n                                    var pti = prev[ti];\n                                    var cd = ti - pti & 32767;\n                                    if (cd > md)\n                                        md = cd, pimod = ti;\n                                }\n                            }\n                        }\n                        // check the previous match\n                        imod = pimod, pimod = prev[imod];\n                        dif += imod - pimod & 32767;\n                    }\n                }\n                // d will be nonzero only when a match was found\n                if (d) {\n                    // store both dist and len data in one int32\n                    // Make sure this is recognized as a len/dist with 28th bit (2^28)\n                    syms[li++] = 268435456 | (revfl[l] << 18) | revfd[d];\n                    var lin = revfl[l] & 31, din = revfd[d] & 31;\n                    eb += fleb[lin] + fdeb[din];\n                    ++lf[257 + lin];\n                    ++df[din];\n                    wi = i + l;\n                    ++lc_1;\n                }\n                else {\n                    syms[li++] = dat[i];\n                    ++lf[dat[i]];\n                }\n            }\n        }\n        for (i = Math.max(i, wi); i < s; ++i) {\n            syms[li++] = dat[i];\n            ++lf[dat[i]];\n        }\n        pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\n        if (!lst) {\n            st.r = (pos & 7) | w[(pos / 8) | 0] << 3;\n            // shft(pos) now 1 less if pos & 7 != 0\n            pos -= 7;\n            st.h = head, st.p = prev, st.i = i, st.w = wi;\n        }\n    }\n    else {\n        for (var i = st.w || 0; i < s + lst; i += 65535) {\n            // end\n            var e = i + 65535;\n            if (e >= s) {\n                // write final block\n                w[(pos / 8) | 0] = lst;\n                e = s;\n            }\n            pos = wfblk(w, pos + 1, dat.subarray(i, e));\n        }\n        st.i = s;\n    }\n    return slc(o, 0, pre + shft(pos) + post);\n};\n// CRC32 table\nvar crct = /*#__PURE__*/ (function () {\n    var t = new Int32Array(256);\n    for (var i = 0; i < 256; ++i) {\n        var c = i, k = 9;\n        while (--k)\n            c = ((c & 1) && -306674912) ^ (c >>> 1);\n        t[i] = c;\n    }\n    return t;\n})();\n// CRC32\nvar crc = function () {\n    var c = -1;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var cr = c;\n            for (var i = 0; i < d.length; ++i)\n                cr = crct[(cr & 255) ^ d[i]] ^ (cr >>> 8);\n            c = cr;\n        },\n        d: function () { return ~c; }\n    };\n};\n// Adler32\nvar adler = function () {\n    var a = 1, b = 0;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var n = a, m = b;\n            var l = d.length | 0;\n            for (var i = 0; i != l;) {\n                var e = Math.min(i + 2655, l);\n                for (; i < e; ++i)\n                    m += n += d[i];\n                n = (n & 65535) + 15 * (n >> 16), m = (m & 65535) + 15 * (m >> 16);\n            }\n            a = n, b = m;\n        },\n        d: function () {\n            a %= 65521, b %= 65521;\n            return (a & 255) << 24 | (a & 0xFF00) << 8 | (b & 255) << 8 | (b >> 8);\n        }\n    };\n};\n;\n// deflate with opts\nvar dopt = function (dat, opt, pre, post, st) {\n    if (!st) {\n        st = { l: 1 };\n        if (opt.dictionary) {\n            var dict = opt.dictionary.subarray(-32768);\n            var newDat = new u8(dict.length + dat.length);\n            newDat.set(dict);\n            newDat.set(dat, dict.length);\n            dat = newDat;\n            st.w = dict.length;\n        }\n    }\n    return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : (12 + opt.mem), pre, post, st);\n};\n// Walmart object spread\nvar mrg = function (a, b) {\n    var o = {};\n    for (var k in a)\n        o[k] = a[k];\n    for (var k in b)\n        o[k] = b[k];\n    return o;\n};\n// worker clone\n// This is possibly the craziest part of the entire codebase, despite how simple it may seem.\n// The only parameter to this function is a closure that returns an array of variables outside of the function scope.\n// We're going to try to figure out the variable names used in the closure as strings because that is crucial for workerization.\n// We will return an object mapping of true variable name to value (basically, the current scope as a JS object).\n// The reason we can't just use the original variable names is minifiers mangling the toplevel scope.\n// This took me three weeks to figure out how to do.\nvar wcln = function (fn, fnStr, td) {\n    var dt = fn();\n    var st = fn.toString();\n    var ks = st.slice(st.indexOf('[') + 1, st.lastIndexOf(']')).replace(/\\s+/g, '').split(',');\n    for (var i = 0; i < dt.length; ++i) {\n        var v = dt[i], k = ks[i];\n        if (typeof v == 'function') {\n            fnStr += ';' + k + '=';\n            var st_1 = v.toString();\n            if (v.prototype) {\n                // for global objects\n                if (st_1.indexOf('[native code]') != -1) {\n                    var spInd = st_1.indexOf(' ', 8) + 1;\n                    fnStr += st_1.slice(spInd, st_1.indexOf('(', spInd));\n                }\n                else {\n                    fnStr += st_1;\n                    for (var t in v.prototype)\n                        fnStr += ';' + k + '.prototype.' + t + '=' + v.prototype[t].toString();\n                }\n            }\n            else\n                fnStr += st_1;\n        }\n        else\n            td[k] = v;\n    }\n    return fnStr;\n};\nvar ch = [];\n// clone bufs\nvar cbfs = function (v) {\n    var tl = [];\n    for (var k in v) {\n        if (v[k].buffer) {\n            tl.push((v[k] = new v[k].constructor(v[k])).buffer);\n        }\n    }\n    return tl;\n};\n// use a worker to execute code\nvar wrkr = function (fns, init, id, cb) {\n    if (!ch[id]) {\n        var fnStr = '', td_1 = {}, m = fns.length - 1;\n        for (var i = 0; i < m; ++i)\n            fnStr = wcln(fns[i], fnStr, td_1);\n        ch[id] = { c: wcln(fns[m], fnStr, td_1), e: td_1 };\n    }\n    var td = mrg({}, ch[id].e);\n    return wk(ch[id].c + ';onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage=' + init.toString() + '}', id, td, cbfs(td), cb);\n};\n// base async inflate fn\nvar bInflt = function () { return [u8, u16, i32, fleb, fdeb, clim, fl, fd, flrm, fdrm, rev, ec, hMap, max, bits, bits16, shft, slc, err, inflt, inflateSync, pbf, gopt]; };\nvar bDflt = function () { return [u8, u16, i32, fleb, fdeb, clim, revfl, revfd, flm, flt, fdm, fdt, rev, deo, et, hMap, wbits, wbits16, hTree, ln, lc, clen, wfblk, wblk, shft, slc, dflt, dopt, deflateSync, pbf]; };\n// gzip extra\nvar gze = function () { return [gzh, gzhl, wbytes, crc, crct]; };\n// gunzip extra\nvar guze = function () { return [gzs, gzl]; };\n// zlib extra\nvar zle = function () { return [zlh, wbytes, adler]; };\n// unzlib extra\nvar zule = function () { return [zls]; };\n// post buf\nvar pbf = function (msg) { return postMessage(msg, [msg.buffer]); };\n// get opts\nvar gopt = function (o) { return o && {\n    out: o.size && new u8(o.size),\n    dictionary: o.dictionary\n}; };\n// async helper\nvar cbify = function (dat, opts, fns, init, id, cb) {\n    var w = wrkr(fns, init, id, function (err, dat) {\n        w.terminate();\n        cb(err, dat);\n    });\n    w.postMessage([dat, opts], opts.consume ? [dat.buffer] : []);\n    return function () { w.terminate(); };\n};\n// auto stream\nvar astrm = function (strm) {\n    strm.ondata = function (dat, final) { return postMessage([dat, final], [dat.buffer]); };\n    return function (ev) { return strm.push(ev.data[0], ev.data[1]); };\n};\n// async stream attach\nvar astrmify = function (fns, strm, opts, init, id, ext) {\n    var t;\n    var w = wrkr(fns, init, id, function (err, dat) {\n        if (err)\n            w.terminate(), strm.ondata.call(strm, err);\n        else if (!Array.isArray(dat))\n            ext(dat);\n        else {\n            if (dat[1])\n                w.terminate();\n            strm.ondata.call(strm, err, dat[0], dat[1]);\n        }\n    });\n    w.postMessage(opts);\n    strm.push = function (d, f) {\n        if (!strm.ondata)\n            err(5);\n        if (t)\n            strm.ondata(err(4, 0, 1), null, !!f);\n        w.postMessage([d, t = f], [d.buffer]);\n    };\n    strm.terminate = function () { w.terminate(); };\n};\n// read 2 bytes\nvar b2 = function (d, b) { return d[b] | (d[b + 1] << 8); };\n// read 4 bytes\nvar b4 = function (d, b) { return (d[b] | (d[b + 1] << 8) | (d[b + 2] << 16) | (d[b + 3] << 24)) >>> 0; };\nvar b8 = function (d, b) { return b4(d, b) + (b4(d, b + 4) * 4294967296); };\n// write bytes\nvar wbytes = function (d, b, v) {\n    for (; v; ++b)\n        d[b] = v, v >>>= 8;\n};\n// gzip header\nvar gzh = function (c, o) {\n    var fn = o.filename;\n    c[0] = 31, c[1] = 139, c[2] = 8, c[8] = o.level < 2 ? 4 : o.level == 9 ? 2 : 0, c[9] = 3; // assume Unix\n    if (o.mtime != 0)\n        wbytes(c, 4, Math.floor(new Date(o.mtime || Date.now()) / 1000));\n    if (fn) {\n        c[3] = 8;\n        for (var i = 0; i <= fn.length; ++i)\n            c[i + 10] = fn.charCodeAt(i);\n    }\n};\n// gzip footer: -8 to -4 = CRC, -4 to -0 is length\n// gzip start\nvar gzs = function (d) {\n    if (d[0] != 31 || d[1] != 139 || d[2] != 8)\n        err(6, 'invalid gzip data');\n    var flg = d[3];\n    var st = 10;\n    if (flg & 4)\n        st += (d[10] | d[11] << 8) + 2;\n    for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\n        ;\n    return st + (flg & 2);\n};\n// gzip length\nvar gzl = function (d) {\n    var l = d.length;\n    return (d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16 | d[l - 1] << 24) >>> 0;\n};\n// gzip header length\nvar gzhl = function (o) { return 10 + (o.filename ? o.filename.length + 1 : 0); };\n// zlib header\nvar zlh = function (c, o) {\n    var lv = o.level, fl = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\n    c[0] = 120, c[1] = (fl << 6) | (o.dictionary && 32);\n    c[1] |= 31 - ((c[0] << 8) | c[1]) % 31;\n    if (o.dictionary) {\n        var h = adler();\n        h.p(o.dictionary);\n        wbytes(c, 2, h.d());\n    }\n};\n// zlib start\nvar zls = function (d, dict) {\n    if ((d[0] & 15) != 8 || (d[0] >> 4) > 7 || ((d[0] << 8 | d[1]) % 31))\n        err(6, 'invalid zlib data');\n    if ((d[1] >> 5 & 1) == +!dict)\n        err(6, 'invalid zlib data: ' + (d[1] & 32 ? 'need' : 'unexpected') + ' dictionary');\n    return (d[1] >> 3 & 4) + 2;\n};\nfunction StrmOpt(opts, cb) {\n    if (typeof opts == 'function')\n        cb = opts, opts = {};\n    this.ondata = cb;\n    return opts;\n}\n/**\n * Streaming DEFLATE compression\n */\nvar Deflate = /*#__PURE__*/ (function () {\n    function Deflate(opts, cb) {\n        if (typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        this.o = opts || {};\n        this.s = { l: 0, i: 32768, w: 32768, z: 32768 };\n        // Buffer length must always be 0 mod 32768 for index calculations to be correct when modifying head and prev\n        // 98304 = 32768 (lookback) + 65536 (common chunk size)\n        this.b = new u8(98304);\n        if (this.o.dictionary) {\n            var dict = this.o.dictionary.subarray(-32768);\n            this.b.set(dict, 32768 - dict.length);\n            this.s.i = 32768 - dict.length;\n        }\n    }\n    Deflate.prototype.p = function (c, f) {\n        this.ondata(dopt(c, this.o, 0, 0, this.s), f);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Deflate.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (this.s.l)\n            err(4);\n        var endLen = chunk.length + this.s.z;\n        if (endLen > this.b.length) {\n            if (endLen > 2 * this.b.length - 32768) {\n                var newBuf = new u8(endLen & -32768);\n                newBuf.set(this.b.subarray(0, this.s.z));\n                this.b = newBuf;\n            }\n            var split = this.b.length - this.s.z;\n            if (split) {\n                this.b.set(chunk.subarray(0, split), this.s.z);\n                this.s.z = this.b.length;\n                this.p(this.b, false);\n            }\n            this.b.set(this.b.subarray(-32768));\n            this.b.set(chunk.subarray(split), 32768);\n            this.s.z = chunk.length - split + 32768;\n            this.s.i = 32766, this.s.w = 32768;\n        }\n        else {\n            this.b.set(chunk, this.s.z);\n            this.s.z += chunk.length;\n        }\n        this.s.l = final & 1;\n        if (this.s.z > this.s.w + 8191 || final) {\n            this.p(this.b, final || false);\n            this.s.w = this.s.i, this.s.i -= 2;\n        }\n    };\n    return Deflate;\n}());\nexport { Deflate };\n/**\n * Asynchronous streaming DEFLATE compression\n */\nvar AsyncDeflate = /*#__PURE__*/ (function () {\n    function AsyncDeflate(opts, cb) {\n        astrmify([\n            bDflt,\n            function () { return [astrm, Deflate]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Deflate(ev.data);\n            onmessage = astrm(strm);\n        }, 6);\n    }\n    return AsyncDeflate;\n}());\nexport { AsyncDeflate };\nexport function deflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n    ], function (ev) { return pbf(deflateSync(ev.data[0], ev.data[1])); }, 0, cb);\n}\n/**\n * Compresses data with DEFLATE without any wrapper\n * @param data The data to compress\n * @param opts The compression options\n * @returns The deflated version of the data\n */\nexport function deflateSync(data, opts) {\n    return dopt(data, opts || {}, 0, 0);\n}\n/**\n * Streaming DEFLATE decompression\n */\nvar Inflate = /*#__PURE__*/ (function () {\n    function Inflate(opts, cb) {\n        // no StrmOpt here to avoid adding to workerizer\n        if (typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        var dict = opts && opts.dictionary && opts.dictionary.subarray(-32768);\n        this.s = { i: 0, b: dict ? dict.length : 0 };\n        this.o = new u8(32768);\n        this.p = new u8(0);\n        if (dict)\n            this.o.set(dict);\n    }\n    Inflate.prototype.e = function (c) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        if (!this.p.length)\n            this.p = c;\n        else if (c.length) {\n            var n = new u8(this.p.length + c.length);\n            n.set(this.p), n.set(c, this.p.length), this.p = n;\n        }\n    };\n    Inflate.prototype.c = function (final) {\n        this.s.i = +(this.d = final || false);\n        var bts = this.s.b;\n        var dt = inflt(this.p, this.s, this.o);\n        this.ondata(slc(dt, bts, this.s.b), this.d);\n        this.o = slc(dt, this.s.b - 32768), this.s.b = this.o.length;\n        this.p = slc(this.p, (this.s.p / 8) | 0), this.s.p &= 7;\n    };\n    /**\n     * Pushes a chunk to be inflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the final chunk\n     */\n    Inflate.prototype.push = function (chunk, final) {\n        this.e(chunk), this.c(final);\n    };\n    return Inflate;\n}());\nexport { Inflate };\n/**\n * Asynchronous streaming DEFLATE decompression\n */\nvar AsyncInflate = /*#__PURE__*/ (function () {\n    function AsyncInflate(opts, cb) {\n        astrmify([\n            bInflt,\n            function () { return [astrm, Inflate]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Inflate(ev.data);\n            onmessage = astrm(strm);\n        }, 7);\n    }\n    return AsyncInflate;\n}());\nexport { AsyncInflate };\nexport function inflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt\n    ], function (ev) { return pbf(inflateSync(ev.data[0], gopt(ev.data[1]))); }, 1, cb);\n}\n/**\n * Expands DEFLATE data with no wrapper\n * @param data The data to decompress\n * @param opts The decompression options\n * @returns The decompressed version of the data\n */\nexport function inflateSync(data, opts) {\n    return inflt(data, { i: 2 }, opts && opts.out, opts && opts.dictionary);\n}\n// before you yell at me for not just using extends, my reason is that TS inheritance is hard to workerize.\n/**\n * Streaming GZIP compression\n */\nvar Gzip = /*#__PURE__*/ (function () {\n    function Gzip(opts, cb) {\n        this.c = crc();\n        this.l = 0;\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gzip.prototype.push = function (chunk, final) {\n        this.c.p(chunk);\n        this.l += chunk.length;\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Gzip.prototype.p = function (c, f) {\n        var raw = dopt(c, this.o, this.v && gzhl(this.o), f && 8, this.s);\n        if (this.v)\n            gzh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 8, this.c.d()), wbytes(raw, raw.length - 4, this.l);\n        this.ondata(raw, f);\n    };\n    return Gzip;\n}());\nexport { Gzip };\n/**\n * Asynchronous streaming GZIP compression\n */\nvar AsyncGzip = /*#__PURE__*/ (function () {\n    function AsyncGzip(opts, cb) {\n        astrmify([\n            bDflt,\n            gze,\n            function () { return [astrm, Deflate, Gzip]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Gzip(ev.data);\n            onmessage = astrm(strm);\n        }, 8);\n    }\n    return AsyncGzip;\n}());\nexport { AsyncGzip };\nexport function gzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n        gze,\n        function () { return [gzipSync]; }\n    ], function (ev) { return pbf(gzipSync(ev.data[0], ev.data[1])); }, 2, cb);\n}\n/**\n * Compresses data with GZIP\n * @param data The data to compress\n * @param opts The compression options\n * @returns The gzipped version of the data\n */\nexport function gzipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var c = crc(), l = data.length;\n    c.p(data);\n    var d = dopt(data, opts, gzhl(opts), 8), s = d.length;\n    return gzh(d, opts), wbytes(d, s - 8, c.d()), wbytes(d, s - 4, l), d;\n}\n/**\n * Streaming single or multi-member GZIP decompression\n */\nvar Gunzip = /*#__PURE__*/ (function () {\n    function Gunzip(opts, cb) {\n        this.v = 1;\n        this.r = 0;\n        Inflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GUNZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gunzip.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        this.r += chunk.length;\n        if (this.v) {\n            var p = this.p.subarray(this.v - 1);\n            var s = p.length > 3 ? gzs(p) : 4;\n            if (s > p.length) {\n                if (!final)\n                    return;\n            }\n            else if (this.v > 1 && this.onmember) {\n                this.onmember(this.r - p.length);\n            }\n            this.p = p.subarray(s), this.v = 0;\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n        // process concatenated GZIP\n        if (this.s.f && !this.s.l) {\n            this.v = shft(this.s.p) + 9;\n            this.s = { i: 0 };\n            this.o = new u8(0);\n            if (this.p.length)\n                this.push(new u8(0), final);\n        }\n    };\n    return Gunzip;\n}());\nexport { Gunzip };\n/**\n * Asynchronous streaming single or multi-member GZIP decompression\n */\nvar AsyncGunzip = /*#__PURE__*/ (function () {\n    function AsyncGunzip(opts, cb) {\n        var _this_1 = this;\n        astrmify([\n            bInflt,\n            guze,\n            function () { return [astrm, Inflate, Gunzip]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Gunzip(ev.data);\n            strm.onmember = function (offset) { return postMessage(offset); };\n            onmessage = astrm(strm);\n        }, 9, function (offset) { return _this_1.onmember && _this_1.onmember(offset); });\n    }\n    return AsyncGunzip;\n}());\nexport { AsyncGunzip };\nexport function gunzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt,\n        guze,\n        function () { return [gunzipSync]; }\n    ], function (ev) { return pbf(gunzipSync(ev.data[0], ev.data[1])); }, 3, cb);\n}\n/**\n * Expands GZIP data\n * @param data The data to decompress\n * @param opts The decompression options\n * @returns The decompressed version of the data\n */\nexport function gunzipSync(data, opts) {\n    var st = gzs(data);\n    if (st + 8 > data.length)\n        err(6, 'invalid gzip data');\n    return inflt(data.subarray(st, -8), { i: 2 }, opts && opts.out || new u8(gzl(data)), opts && opts.dictionary);\n}\n/**\n * Streaming Zlib compression\n */\nvar Zlib = /*#__PURE__*/ (function () {\n    function Zlib(opts, cb) {\n        this.c = adler();\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be zlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Zlib.prototype.push = function (chunk, final) {\n        this.c.p(chunk);\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Zlib.prototype.p = function (c, f) {\n        var raw = dopt(c, this.o, this.v && (this.o.dictionary ? 6 : 2), f && 4, this.s);\n        if (this.v)\n            zlh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 4, this.c.d());\n        this.ondata(raw, f);\n    };\n    return Zlib;\n}());\nexport { Zlib };\n/**\n * Asynchronous streaming Zlib compression\n */\nvar AsyncZlib = /*#__PURE__*/ (function () {\n    function AsyncZlib(opts, cb) {\n        astrmify([\n            bDflt,\n            zle,\n            function () { return [astrm, Deflate, Zlib]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Zlib(ev.data);\n            onmessage = astrm(strm);\n        }, 10);\n    }\n    return AsyncZlib;\n}());\nexport { AsyncZlib };\nexport function zlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n        zle,\n        function () { return [zlibSync]; }\n    ], function (ev) { return pbf(zlibSync(ev.data[0], ev.data[1])); }, 4, cb);\n}\n/**\n * Compress data with Zlib\n * @param data The data to compress\n * @param opts The compression options\n * @returns The zlib-compressed version of the data\n */\nexport function zlibSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var a = adler();\n    a.p(data);\n    var d = dopt(data, opts, opts.dictionary ? 6 : 2, 4);\n    return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\n}\n/**\n * Streaming Zlib decompression\n */\nvar Unzlib = /*#__PURE__*/ (function () {\n    function Unzlib(opts, cb) {\n        Inflate.call(this, opts, cb);\n        this.v = opts && opts.dictionary ? 2 : 1;\n    }\n    /**\n     * Pushes a chunk to be unzlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzlib.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            if (this.p.length < 6 && !final)\n                return;\n            this.p = this.p.subarray(zls(this.p, this.v - 1)), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 4)\n                err(6, 'invalid zlib data');\n            this.p = this.p.subarray(0, -4);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Unzlib;\n}());\nexport { Unzlib };\n/**\n * Asynchronous streaming Zlib decompression\n */\nvar AsyncUnzlib = /*#__PURE__*/ (function () {\n    function AsyncUnzlib(opts, cb) {\n        astrmify([\n            bInflt,\n            zule,\n            function () { return [astrm, Inflate, Unzlib]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Unzlib(ev.data);\n            onmessage = astrm(strm);\n        }, 11);\n    }\n    return AsyncUnzlib;\n}());\nexport { AsyncUnzlib };\nexport function unzlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt,\n        zule,\n        function () { return [unzlibSync]; }\n    ], function (ev) { return pbf(unzlibSync(ev.data[0], gopt(ev.data[1]))); }, 5, cb);\n}\n/**\n * Expands Zlib data\n * @param data The data to decompress\n * @param opts The decompression options\n * @returns The decompressed version of the data\n */\nexport function unzlibSync(data, opts) {\n    return inflt(data.subarray(zls(data, opts && opts.dictionary), -4), { i: 2 }, opts && opts.out, opts && opts.dictionary);\n}\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzip as compress, AsyncGzip as AsyncCompress };\nexport { gzipSync as compressSync, Gzip as Compress };\n/**\n * Streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar Decompress = /*#__PURE__*/ (function () {\n    function Decompress(opts, cb) {\n        this.G = Gunzip;\n        this.I = Inflate;\n        this.Z = Unzlib;\n        this.o = StrmOpt.call(this, opts, cb) || {};\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Decompress.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (!this.s) {\n            if (this.p && this.p.length) {\n                var n = new u8(this.p.length + chunk.length);\n                n.set(this.p), n.set(chunk, this.p.length);\n            }\n            else\n                this.p = chunk;\n            if (this.p.length > 2) {\n                var _this_2 = this;\n                // enables reuse of this method by AsyncDecompress\n                var cb = function () { _this_2.ondata.apply(_this_2, arguments); };\n                this.s = (this.p[0] == 31 && this.p[1] == 139 && this.p[2] == 8)\n                    ? new this.G(this.o, cb)\n                    : ((this.p[0] & 15) != 8 || (this.p[0] >> 4) > 7 || ((this.p[0] << 8 | this.p[1]) % 31))\n                        ? new this.I(this.o, cb)\n                        : new this.Z(this.o, cb);\n                this.s.push(this.p, final);\n                this.p = null;\n            }\n        }\n        else\n            this.s.push(chunk, final);\n    };\n    return Decompress;\n}());\nexport { Decompress };\n/**\n * Asynchronous streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar AsyncDecompress = /*#__PURE__*/ (function () {\n    function AsyncDecompress(opts, cb) {\n        this.G = AsyncGunzip;\n        this.I = AsyncInflate;\n        this.Z = AsyncUnzlib;\n        Decompress.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncDecompress.prototype.push = function (chunk, final) {\n        Decompress.prototype.push.call(this, chunk, final);\n    };\n    return AsyncDecompress;\n}());\nexport { AsyncDecompress };\nexport function decompress(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzip(data, opts, cb)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflate(data, opts, cb)\n            : unzlib(data, opts, cb);\n}\n/**\n * Expands compressed GZIP, Zlib, or raw DEFLATE data, automatically detecting the format\n * @param data The data to decompress\n * @param opts The decompression options\n * @returns The decompressed version of the data\n */\nexport function decompressSync(data, opts) {\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzipSync(data, opts)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflateSync(data, opts)\n            : unzlibSync(data, opts);\n}\n// flatten a directory structure\nvar fltn = function (d, p, t, o) {\n    for (var k in d) {\n        var val = d[k], n = p + k, op = o;\n        if (Array.isArray(val))\n            op = mrg(o, val[1]), val = val[0];\n        if (val instanceof u8)\n            t[n] = [val, op];\n        else {\n            t[n += '/'] = [new u8(0), op];\n            fltn(val, n, t, o);\n        }\n    }\n};\n// text encoder\nvar te = typeof TextEncoder != 'undefined' && /*#__PURE__*/ new TextEncoder();\n// text decoder\nvar td = typeof TextDecoder != 'undefined' && /*#__PURE__*/ new TextDecoder();\n// text decoder stream\nvar tds = 0;\ntry {\n    td.decode(et, { stream: true });\n    tds = 1;\n}\ncatch (e) { }\n// decode UTF8\nvar dutf8 = function (d) {\n    for (var r = '', i = 0;;) {\n        var c = d[i++];\n        var eb = (c > 127) + (c > 223) + (c > 239);\n        if (i + eb > d.length)\n            return { s: r, r: slc(d, i - 1) };\n        if (!eb)\n            r += String.fromCharCode(c);\n        else if (eb == 3) {\n            c = ((c & 15) << 18 | (d[i++] & 63) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63)) - 65536,\n                r += String.fromCharCode(55296 | (c >> 10), 56320 | (c & 1023));\n        }\n        else if (eb & 1)\n            r += String.fromCharCode((c & 31) << 6 | (d[i++] & 63));\n        else\n            r += String.fromCharCode((c & 15) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63));\n    }\n};\n/**\n * Streaming UTF-8 decoding\n */\nvar DecodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is decoded\n     */\n    function DecodeUTF8(cb) {\n        this.ondata = cb;\n        if (tds)\n            this.t = new TextDecoder();\n        else\n            this.p = et;\n    }\n    /**\n     * Pushes a chunk to be decoded from UTF-8 binary\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    DecodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        final = !!final;\n        if (this.t) {\n            this.ondata(this.t.decode(chunk, { stream: true }), final);\n            if (final) {\n                if (this.t.decode().length)\n                    err(8);\n                this.t = null;\n            }\n            return;\n        }\n        if (!this.p)\n            err(4);\n        var dat = new u8(this.p.length + chunk.length);\n        dat.set(this.p);\n        dat.set(chunk, this.p.length);\n        var _a = dutf8(dat), s = _a.s, r = _a.r;\n        if (final) {\n            if (r.length)\n                err(8);\n            this.p = null;\n        }\n        else\n            this.p = r;\n        this.ondata(s, final);\n    };\n    return DecodeUTF8;\n}());\nexport { DecodeUTF8 };\n/**\n * Streaming UTF-8 encoding\n */\nvar EncodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is encoded\n     */\n    function EncodeUTF8(cb) {\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be encoded to UTF-8\n     * @param chunk The string data to push\n     * @param final Whether this is the last chunk\n     */\n    EncodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        this.ondata(strToU8(chunk), this.d = final || false);\n    };\n    return EncodeUTF8;\n}());\nexport { EncodeUTF8 };\n/**\n * Converts a string into a Uint8Array for use with compression/decompression methods\n * @param str The string to encode\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless decoding a binary string.\n * @returns The string encoded in UTF-8/Latin-1 binary\n */\nexport function strToU8(str, latin1) {\n    if (latin1) {\n        var ar_1 = new u8(str.length);\n        for (var i = 0; i < str.length; ++i)\n            ar_1[i] = str.charCodeAt(i);\n        return ar_1;\n    }\n    if (te)\n        return te.encode(str);\n    var l = str.length;\n    var ar = new u8(str.length + (str.length >> 1));\n    var ai = 0;\n    var w = function (v) { ar[ai++] = v; };\n    for (var i = 0; i < l; ++i) {\n        if (ai + 5 > ar.length) {\n            var n = new u8(ai + 8 + ((l - i) << 1));\n            n.set(ar);\n            ar = n;\n        }\n        var c = str.charCodeAt(i);\n        if (c < 128 || latin1)\n            w(c);\n        else if (c < 2048)\n            w(192 | (c >> 6)), w(128 | (c & 63));\n        else if (c > 55295 && c < 57344)\n            c = 65536 + (c & 1023 << 10) | (str.charCodeAt(++i) & 1023),\n                w(240 | (c >> 18)), w(128 | ((c >> 12) & 63)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n        else\n            w(224 | (c >> 12)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n    }\n    return slc(ar, 0, ai);\n}\n/**\n * Converts a Uint8Array to a string\n * @param dat The data to decode to string\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless encoding to binary string.\n * @returns The original UTF-8/Latin-1 string\n */\nexport function strFromU8(dat, latin1) {\n    if (latin1) {\n        var r = '';\n        for (var i = 0; i < dat.length; i += 16384)\n            r += String.fromCharCode.apply(null, dat.subarray(i, i + 16384));\n        return r;\n    }\n    else if (td) {\n        return td.decode(dat);\n    }\n    else {\n        var _a = dutf8(dat), s = _a.s, r = _a.r;\n        if (r.length)\n            err(8);\n        return s;\n    }\n}\n;\n// deflate bit flag\nvar dbf = function (l) { return l == 1 ? 3 : l < 6 ? 2 : l == 9 ? 1 : 0; };\n// skip local zip header\nvar slzh = function (d, b) { return b + 30 + b2(d, b + 26) + b2(d, b + 28); };\n// read zip header\nvar zh = function (d, b, z) {\n    var fnl = b2(d, b + 28), fn = strFromU8(d.subarray(b + 46, b + 46 + fnl), !(b2(d, b + 8) & 2048)), es = b + 46 + fnl, bs = b4(d, b + 20);\n    var _a = z && bs == 4294967295 ? z64e(d, es) : [bs, b4(d, b + 24), b4(d, b + 42)], sc = _a[0], su = _a[1], off = _a[2];\n    return [b2(d, b + 10), sc, su, fn, es + b2(d, b + 30) + b2(d, b + 32), off];\n};\n// read zip64 extra field\nvar z64e = function (d, b) {\n    for (; b2(d, b) != 1; b += 4 + b2(d, b + 2))\n        ;\n    return [b8(d, b + 12), b8(d, b + 4), b8(d, b + 20)];\n};\n// extra field length\nvar exfl = function (ex) {\n    var le = 0;\n    if (ex) {\n        for (var k in ex) {\n            var l = ex[k].length;\n            if (l > 65535)\n                err(9);\n            le += l + 4;\n        }\n    }\n    return le;\n};\n// write zip header\nvar wzh = function (d, b, f, fn, u, c, ce, co) {\n    var fl = fn.length, ex = f.extra, col = co && co.length;\n    var exl = exfl(ex);\n    wbytes(d, b, ce != null ? 0x2014B50 : 0x4034B50), b += 4;\n    if (ce != null)\n        d[b++] = 20, d[b++] = f.os;\n    d[b] = 20, b += 2; // spec compliance? what's that?\n    d[b++] = (f.flag << 1) | (c < 0 && 8), d[b++] = u && 8;\n    d[b++] = f.compression & 255, d[b++] = f.compression >> 8;\n    var dt = new Date(f.mtime == null ? Date.now() : f.mtime), y = dt.getFullYear() - 1980;\n    if (y < 0 || y > 119)\n        err(10);\n    wbytes(d, b, (y << 25) | ((dt.getMonth() + 1) << 21) | (dt.getDate() << 16) | (dt.getHours() << 11) | (dt.getMinutes() << 5) | (dt.getSeconds() >> 1)), b += 4;\n    if (c != -1) {\n        wbytes(d, b, f.crc);\n        wbytes(d, b + 4, c < 0 ? -c - 2 : c);\n        wbytes(d, b + 8, f.size);\n    }\n    wbytes(d, b + 12, fl);\n    wbytes(d, b + 14, exl), b += 16;\n    if (ce != null) {\n        wbytes(d, b, col);\n        wbytes(d, b + 6, f.attrs);\n        wbytes(d, b + 10, ce), b += 14;\n    }\n    d.set(fn, b);\n    b += fl;\n    if (exl) {\n        for (var k in ex) {\n            var exf = ex[k], l = exf.length;\n            wbytes(d, b, +k);\n            wbytes(d, b + 2, l);\n            d.set(exf, b + 4), b += 4 + l;\n        }\n    }\n    if (col)\n        d.set(co, b), b += col;\n    return b;\n};\n// write zip footer (end of central directory)\nvar wzf = function (o, b, c, d, e) {\n    wbytes(o, b, 0x6054B50); // skip disk\n    wbytes(o, b + 8, c);\n    wbytes(o, b + 10, c);\n    wbytes(o, b + 12, d);\n    wbytes(o, b + 16, e);\n};\n/**\n * A pass-through stream to keep data uncompressed in a ZIP archive.\n */\nvar ZipPassThrough = /*#__PURE__*/ (function () {\n    /**\n     * Creates a pass-through stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     */\n    function ZipPassThrough(filename) {\n        this.filename = filename;\n        this.c = crc();\n        this.size = 0;\n        this.compression = 0;\n    }\n    /**\n     * Processes a chunk and pushes to the output stream. You can override this\n     * method in a subclass for custom behavior, but by default this passes\n     * the data through. You must call this.ondata(err, chunk, final) at some\n     * point in this method.\n     * @param chunk The chunk to process\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.process = function (chunk, final) {\n        this.ondata(null, chunk, final);\n    };\n    /**\n     * Pushes a chunk to be added. If you are subclassing this with a custom\n     * compression algorithm, note that you must push data from the source\n     * file only, pre-compression.\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        this.c.p(chunk);\n        this.size += chunk.length;\n        if (final)\n            this.crc = this.c.d();\n        this.process(chunk, final || false);\n    };\n    return ZipPassThrough;\n}());\nexport { ZipPassThrough };\n// I don't extend because TypeScript extension adds 1kB of runtime bloat\n/**\n * Streaming DEFLATE compression for ZIP archives. Prefer using AsyncZipDeflate\n * for better performance\n */\nvar ZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function ZipDeflate(filename, opts) {\n        var _this_1 = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new Deflate(opts, function (dat, final) {\n            _this_1.ondata(null, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n    }\n    ZipDeflate.prototype.process = function (chunk, final) {\n        try {\n            this.d.push(chunk, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return ZipDeflate;\n}());\nexport { ZipDeflate };\n/**\n * Asynchronous streaming DEFLATE compression for ZIP archives\n */\nvar AsyncZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function AsyncZipDeflate(filename, opts) {\n        var _this_1 = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new AsyncDeflate(opts, function (err, dat, final) {\n            _this_1.ondata(err, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n        this.terminate = this.d.terminate;\n    }\n    AsyncZipDeflate.prototype.process = function (chunk, final) {\n        this.d.push(chunk, final);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return AsyncZipDeflate;\n}());\nexport { AsyncZipDeflate };\n// TODO: Better tree shaking\n/**\n * A zippable archive to which files can incrementally be added\n */\nvar Zip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an empty ZIP archive to which files can be added\n     * @param cb The callback to call whenever data for the generated ZIP archive\n     *           is available\n     */\n    function Zip(cb) {\n        this.ondata = cb;\n        this.u = [];\n        this.d = 1;\n    }\n    /**\n     * Adds a file to the ZIP archive\n     * @param file The file stream to add\n     */\n    Zip.prototype.add = function (file) {\n        var _this_1 = this;\n        if (!this.ondata)\n            err(5);\n        // finishing or finished\n        if (this.d & 2)\n            this.ondata(err(4 + (this.d & 1) * 8, 0, 1), null, false);\n        else {\n            var f = strToU8(file.filename), fl_1 = f.length;\n            var com = file.comment, o = com && strToU8(com);\n            var u = fl_1 != file.filename.length || (o && (com.length != o.length));\n            var hl_1 = fl_1 + exfl(file.extra) + 30;\n            if (fl_1 > 65535)\n                this.ondata(err(11, 0, 1), null, false);\n            var header = new u8(hl_1);\n            wzh(header, 0, file, f, u, -1);\n            var chks_1 = [header];\n            var pAll_1 = function () {\n                for (var _i = 0, chks_2 = chks_1; _i < chks_2.length; _i++) {\n                    var chk = chks_2[_i];\n                    _this_1.ondata(null, chk, false);\n                }\n                chks_1 = [];\n            };\n            var tr_1 = this.d;\n            this.d = 0;\n            var ind_1 = this.u.length;\n            var uf_1 = mrg(file, {\n                f: f,\n                u: u,\n                o: o,\n                t: function () {\n                    if (file.terminate)\n                        file.terminate();\n                },\n                r: function () {\n                    pAll_1();\n                    if (tr_1) {\n                        var nxt = _this_1.u[ind_1 + 1];\n                        if (nxt)\n                            nxt.r();\n                        else\n                            _this_1.d = 1;\n                    }\n                    tr_1 = 1;\n                }\n            });\n            var cl_1 = 0;\n            file.ondata = function (err, dat, final) {\n                if (err) {\n                    _this_1.ondata(err, dat, final);\n                    _this_1.terminate();\n                }\n                else {\n                    cl_1 += dat.length;\n                    chks_1.push(dat);\n                    if (final) {\n                        var dd = new u8(16);\n                        wbytes(dd, 0, 0x8074B50);\n                        wbytes(dd, 4, file.crc);\n                        wbytes(dd, 8, cl_1);\n                        wbytes(dd, 12, file.size);\n                        chks_1.push(dd);\n                        uf_1.c = cl_1, uf_1.b = hl_1 + cl_1 + 16, uf_1.crc = file.crc, uf_1.size = file.size;\n                        if (tr_1)\n                            uf_1.r();\n                        tr_1 = 1;\n                    }\n                    else if (tr_1)\n                        pAll_1();\n                }\n            };\n            this.u.push(uf_1);\n        }\n    };\n    /**\n     * Ends the process of adding files and prepares to emit the final chunks.\n     * This *must* be called after adding all desired files for the resulting\n     * ZIP file to work properly.\n     */\n    Zip.prototype.end = function () {\n        var _this_1 = this;\n        if (this.d & 2) {\n            this.ondata(err(4 + (this.d & 1) * 8, 0, 1), null, true);\n            return;\n        }\n        if (this.d)\n            this.e();\n        else\n            this.u.push({\n                r: function () {\n                    if (!(_this_1.d & 1))\n                        return;\n                    _this_1.u.splice(-1, 1);\n                    _this_1.e();\n                },\n                t: function () { }\n            });\n        this.d = 3;\n    };\n    Zip.prototype.e = function () {\n        var bt = 0, l = 0, tl = 0;\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            tl += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0);\n        }\n        var out = new u8(tl + 22);\n        for (var _b = 0, _c = this.u; _b < _c.length; _b++) {\n            var f = _c[_b];\n            wzh(out, bt, f, f.f, f.u, -f.c - 2, l, f.o);\n            bt += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0), l += f.b;\n        }\n        wzf(out, bt, this.u.length, tl, l);\n        this.ondata(null, out, true);\n        this.d = 2;\n    };\n    /**\n     * A method to terminate any internal workers used by the stream. Subsequent\n     * calls to add() will fail.\n     */\n    Zip.prototype.terminate = function () {\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            f.t();\n        }\n        this.d = 2;\n    };\n    return Zip;\n}());\nexport { Zip };\nexport function zip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    var r = {};\n    fltn(data, '', r, opts);\n    var k = Object.keys(r);\n    var lft = k.length, o = 0, tot = 0;\n    var slft = lft, files = new Array(lft);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var cbd = function (a, b) {\n        mt(function () { cb(a, b); });\n    };\n    mt(function () { cbd = cb; });\n    var cbf = function () {\n        var out = new u8(tot + 22), oe = o, cdl = tot - o;\n        tot = 0;\n        for (var i = 0; i < slft; ++i) {\n            var f = files[i];\n            try {\n                var l = f.c.length;\n                wzh(out, tot, f, f.f, f.u, l);\n                var badd = 30 + f.f.length + exfl(f.extra);\n                var loc = tot + badd;\n                out.set(f.c, loc);\n                wzh(out, o, f, f.f, f.u, l, tot, f.m), o += 16 + badd + (f.m ? f.m.length : 0), tot = loc + l;\n            }\n            catch (e) {\n                return cbd(e, null);\n            }\n        }\n        wzf(out, o, files.length, cdl, oe);\n        cbd(null, out);\n    };\n    if (!lft)\n        cbf();\n    var _loop_1 = function (i) {\n        var fn = k[i];\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var c = crc(), size = file.length;\n        c.p(file);\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        var compression = p.level == 0 ? 0 : 8;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cbd(e, null);\n            }\n            else {\n                var l = d.length;\n                files[i] = mrg(p, {\n                    size: size,\n                    crc: c.d(),\n                    c: d,\n                    f: f,\n                    m: m,\n                    u: s != fn.length || (m && (com.length != ms)),\n                    compression: compression\n                });\n                o += 30 + s + exl + l;\n                tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n                if (!--lft)\n                    cbf();\n            }\n        };\n        if (s > 65535)\n            cbl(err(11, 0, 1), null);\n        if (!compression)\n            cbl(null, file);\n        else if (size < 160000) {\n            try {\n                cbl(null, deflateSync(file, p));\n            }\n            catch (e) {\n                cbl(e, null);\n            }\n        }\n        else\n            term.push(deflate(file, p, cbl));\n    };\n    // Cannot use lft because it can decrease\n    for (var i = 0; i < slft; ++i) {\n        _loop_1(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously creates a ZIP file. Prefer using `zip` for better performance\n * with more than one file.\n * @param data The directory structure for the ZIP archive\n * @param opts The main options, merged with per-file options\n * @returns The generated ZIP archive\n */\nexport function zipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var r = {};\n    var files = [];\n    fltn(data, '', r, opts);\n    var o = 0;\n    var tot = 0;\n    for (var fn in r) {\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var compression = p.level == 0 ? 0 : 8;\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        if (s > 65535)\n            err(11);\n        var d = compression ? deflateSync(file, p) : file, l = d.length;\n        var c = crc();\n        c.p(file);\n        files.push(mrg(p, {\n            size: file.length,\n            crc: c.d(),\n            c: d,\n            f: f,\n            m: m,\n            u: s != fn.length || (m && (com.length != ms)),\n            o: o,\n            compression: compression\n        }));\n        o += 30 + s + exl + l;\n        tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n    }\n    var out = new u8(tot + 22), oe = o, cdl = tot - o;\n    for (var i = 0; i < files.length; ++i) {\n        var f = files[i];\n        wzh(out, f.o, f, f.f, f.u, f.c.length);\n        var badd = 30 + f.f.length + exfl(f.extra);\n        out.set(f.c, f.o + badd);\n        wzh(out, o, f, f.f, f.u, f.c.length, f.o, f.m), o += 16 + badd + (f.m ? f.m.length : 0);\n    }\n    wzf(out, o, files.length, cdl, oe);\n    return out;\n}\n/**\n * Streaming pass-through decompression for ZIP archives\n */\nvar UnzipPassThrough = /*#__PURE__*/ (function () {\n    function UnzipPassThrough() {\n    }\n    UnzipPassThrough.prototype.push = function (data, final) {\n        this.ondata(null, data, final);\n    };\n    UnzipPassThrough.compression = 0;\n    return UnzipPassThrough;\n}());\nexport { UnzipPassThrough };\n/**\n * Streaming DEFLATE decompression for ZIP archives. Prefer AsyncZipInflate for\n * better performance.\n */\nvar UnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function UnzipInflate() {\n        var _this_1 = this;\n        this.i = new Inflate(function (dat, final) {\n            _this_1.ondata(null, dat, final);\n        });\n    }\n    UnzipInflate.prototype.push = function (data, final) {\n        try {\n            this.i.push(data, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    UnzipInflate.compression = 8;\n    return UnzipInflate;\n}());\nexport { UnzipInflate };\n/**\n * Asynchronous streaming DEFLATE decompression for ZIP archives\n */\nvar AsyncUnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function AsyncUnzipInflate(_, sz) {\n        var _this_1 = this;\n        if (sz < 320000) {\n            this.i = new Inflate(function (dat, final) {\n                _this_1.ondata(null, dat, final);\n            });\n        }\n        else {\n            this.i = new AsyncInflate(function (err, dat, final) {\n                _this_1.ondata(err, dat, final);\n            });\n            this.terminate = this.i.terminate;\n        }\n    }\n    AsyncUnzipInflate.prototype.push = function (data, final) {\n        if (this.i.terminate)\n            data = slc(data, 0);\n        this.i.push(data, final);\n    };\n    AsyncUnzipInflate.compression = 8;\n    return AsyncUnzipInflate;\n}());\nexport { AsyncUnzipInflate };\n/**\n * A ZIP archive decompression stream that emits files as they are discovered\n */\nvar Unzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a ZIP decompression stream\n     * @param cb The callback to call whenever a file in the ZIP archive is found\n     */\n    function Unzip(cb) {\n        this.onfile = cb;\n        this.k = [];\n        this.o = {\n            0: UnzipPassThrough\n        };\n        this.p = et;\n    }\n    /**\n     * Pushes a chunk to be unzipped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzip.prototype.push = function (chunk, final) {\n        var _this_1 = this;\n        if (!this.onfile)\n            err(5);\n        if (!this.p)\n            err(4);\n        if (this.c > 0) {\n            var len = Math.min(this.c, chunk.length);\n            var toAdd = chunk.subarray(0, len);\n            this.c -= len;\n            if (this.d)\n                this.d.push(toAdd, !this.c);\n            else\n                this.k[0].push(toAdd);\n            chunk = chunk.subarray(len);\n            if (chunk.length)\n                return this.push(chunk, final);\n        }\n        else {\n            var f = 0, i = 0, is = void 0, buf = void 0;\n            if (!this.p.length)\n                buf = chunk;\n            else if (!chunk.length)\n                buf = this.p;\n            else {\n                buf = new u8(this.p.length + chunk.length);\n                buf.set(this.p), buf.set(chunk, this.p.length);\n            }\n            var l = buf.length, oc = this.c, add = oc && this.d;\n            var _loop_2 = function () {\n                var _a;\n                var sig = b4(buf, i);\n                if (sig == 0x4034B50) {\n                    f = 1, is = i;\n                    this_1.d = null;\n                    this_1.c = 0;\n                    var bf = b2(buf, i + 6), cmp_1 = b2(buf, i + 8), u = bf & 2048, dd = bf & 8, fnl = b2(buf, i + 26), es = b2(buf, i + 28);\n                    if (l > i + 30 + fnl + es) {\n                        var chks_3 = [];\n                        this_1.k.unshift(chks_3);\n                        f = 2;\n                        var sc_1 = b4(buf, i + 18), su_1 = b4(buf, i + 22);\n                        var fn_1 = strFromU8(buf.subarray(i + 30, i += 30 + fnl), !u);\n                        if (sc_1 == 4294967295) {\n                            _a = dd ? [-2] : z64e(buf, i), sc_1 = _a[0], su_1 = _a[1];\n                        }\n                        else if (dd)\n                            sc_1 = -1;\n                        i += es;\n                        this_1.c = sc_1;\n                        var d_1;\n                        var file_1 = {\n                            name: fn_1,\n                            compression: cmp_1,\n                            start: function () {\n                                if (!file_1.ondata)\n                                    err(5);\n                                if (!sc_1)\n                                    file_1.ondata(null, et, true);\n                                else {\n                                    var ctr = _this_1.o[cmp_1];\n                                    if (!ctr)\n                                        file_1.ondata(err(14, 'unknown compression type ' + cmp_1, 1), null, false);\n                                    d_1 = sc_1 < 0 ? new ctr(fn_1) : new ctr(fn_1, sc_1, su_1);\n                                    d_1.ondata = function (err, dat, final) { file_1.ondata(err, dat, final); };\n                                    for (var _i = 0, chks_4 = chks_3; _i < chks_4.length; _i++) {\n                                        var dat = chks_4[_i];\n                                        d_1.push(dat, false);\n                                    }\n                                    if (_this_1.k[0] == chks_3 && _this_1.c)\n                                        _this_1.d = d_1;\n                                    else\n                                        d_1.push(et, true);\n                                }\n                            },\n                            terminate: function () {\n                                if (d_1 && d_1.terminate)\n                                    d_1.terminate();\n                            }\n                        };\n                        if (sc_1 >= 0)\n                            file_1.size = sc_1, file_1.originalSize = su_1;\n                        this_1.onfile(file_1);\n                    }\n                    return \"break\";\n                }\n                else if (oc) {\n                    if (sig == 0x8074B50) {\n                        is = i += 12 + (oc == -2 && 8), f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                    else if (sig == 0x2014B50) {\n                        is = i -= 4, f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                }\n            };\n            var this_1 = this;\n            for (; i < l - 4; ++i) {\n                var state_1 = _loop_2();\n                if (state_1 === \"break\")\n                    break;\n            }\n            this.p = et;\n            if (oc < 0) {\n                var dat = f ? buf.subarray(0, is - 12 - (oc == -2 && 8) - (b4(buf, is - 16) == 0x8074B50 && 4)) : buf.subarray(0, i);\n                if (add)\n                    add.push(dat, !!f);\n                else\n                    this.k[+(f == 2)].push(dat);\n            }\n            if (f & 2)\n                return this.push(buf.subarray(i), final);\n            this.p = buf.subarray(i);\n        }\n        if (final) {\n            if (this.c)\n                err(13);\n            this.p = null;\n        }\n    };\n    /**\n     * Registers a decoder with the stream, allowing for files compressed with\n     * the compression type provided to be expanded correctly\n     * @param decoder The decoder constructor\n     */\n    Unzip.prototype.register = function (decoder) {\n        this.o[decoder.compression] = decoder;\n    };\n    return Unzip;\n}());\nexport { Unzip };\nvar mt = typeof queueMicrotask == 'function' ? queueMicrotask : typeof setTimeout == 'function' ? setTimeout : function (fn) { fn(); };\nexport function unzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var files = {};\n    var cbd = function (a, b) {\n        mt(function () { cb(a, b); });\n    };\n    mt(function () { cbd = cb; });\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558) {\n            cbd(err(13, 0, 1), null);\n            return tAll;\n        }\n    }\n    ;\n    var lft = b2(data, e + 8);\n    if (lft) {\n        var c = lft;\n        var o = b4(data, e + 16);\n        var z = o == 4294967295 || c == 65535;\n        if (z) {\n            var ze = b4(data, e - 12);\n            z = b4(data, ze) == 0x6064B50;\n            if (z) {\n                c = lft = b4(data, ze + 32);\n                o = b4(data, ze + 48);\n            }\n        }\n        var fltr = opts && opts.filter;\n        var _loop_3 = function (i) {\n            var _a = zh(data, o, z), c_1 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n            o = no;\n            var cbl = function (e, d) {\n                if (e) {\n                    tAll();\n                    cbd(e, null);\n                }\n                else {\n                    if (d)\n                        files[fn] = d;\n                    if (!--lft)\n                        cbd(null, files);\n                }\n            };\n            if (!fltr || fltr({\n                name: fn,\n                size: sc,\n                originalSize: su,\n                compression: c_1\n            })) {\n                if (!c_1)\n                    cbl(null, slc(data, b, b + sc));\n                else if (c_1 == 8) {\n                    var infl = data.subarray(b, b + sc);\n                    if (sc < 320000) {\n                        try {\n                            cbl(null, inflateSync(infl, { out: new u8(su) }));\n                        }\n                        catch (e) {\n                            cbl(e, null);\n                        }\n                    }\n                    else\n                        term.push(inflate(infl, { size: su }, cbl));\n                }\n                else\n                    cbl(err(14, 'unknown compression type ' + c_1, 1), null);\n            }\n            else\n                cbl(null, null);\n        };\n        for (var i = 0; i < c; ++i) {\n            _loop_3(i);\n        }\n    }\n    else\n        cbd(null, {});\n    return tAll;\n}\n/**\n * Synchronously decompresses a ZIP archive. Prefer using `unzip` for better\n * performance with more than one file.\n * @param data The raw compressed ZIP file\n * @param opts The ZIP extraction options\n * @returns The decompressed files\n */\nexport function unzipSync(data, opts) {\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558)\n            err(13);\n    }\n    ;\n    var c = b2(data, e + 8);\n    if (!c)\n        return {};\n    var o = b4(data, e + 16);\n    var z = o == 4294967295 || c == 65535;\n    if (z) {\n        var ze = b4(data, e - 12);\n        z = b4(data, ze) == 0x6064B50;\n        if (z) {\n            c = b4(data, ze + 32);\n            o = b4(data, ze + 48);\n        }\n    }\n    var fltr = opts && opts.filter;\n    for (var i = 0; i < c; ++i) {\n        var _a = zh(data, o, z), c_2 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        if (!fltr || fltr({\n            name: fn,\n            size: sc,\n            originalSize: su,\n            compression: c_2\n        })) {\n            if (!c_2)\n                files[fn] = slc(data, b, b + sc);\n            else if (c_2 == 8)\n                files[fn] = inflateSync(data.subarray(b, b + sc), { out: new u8(su) });\n            else\n                err(14, 'unknown compression type ' + c_2);\n        }\n    }\n    return files;\n}\n","import { AbstractFileSystemAdapter } from \"./AbstractFileSystemAdapter\"\nimport { unzlibSync } from \"fflate\"\n\ninterface FileInfo {\n    file: string\n    isDir: boolean\n    dir?: string[]\n}\n\nexport class HTTPFSAdapter implements AbstractFileSystemAdapter {\n    static debug = false\n    static directoryCache = new Map<string, FileInfo>()\n\n    readFile(pathname: string): string {\n        if (HTTPFSAdapter.debug) {\n            console.log(`HTTPJSFSAdapter.isFile('${pathname}')`)\n        }\n        if (pathname.endsWith(\".z\")) {\n            if (HTTPFSAdapter.debug) {\n                console.log(`load compressed file ${pathname}`)\n            }\n            const req = new XMLHttpRequest()\n            req.overrideMimeType(\"text/plain; charset=x-user-defined\")\n            req.open(\"GET\", `data/${pathname}`, false)\n            req.send(null)\n            if (req.status > 400) {\n                throw new Error(`Request failed for '${pathname}': ${req.statusText}`)\n            }\n            const ab = new ArrayBuffer(req.responseText.length)\n            const ua = new Uint8Array(ab)\n            for (let i = 0; i < req.responseText.length; ++i) {\n                ua[i] = req.responseText.charCodeAt(i)\n            }\n            const dec = new TextDecoder(\"utf-8\")\n            return dec.decode(unzlibSync(ua))\n        }\n        if (pathname.endsWith(\"/directory.json\")) {\n            if (HTTPFSAdapter.debug) {\n                console.log(`load uncompressed file ${pathname}`)\n            }\n            const req = new XMLHttpRequest()\n            req.open(\"GET\", `data/${pathname}`, false)\n            req.send(null)\n            if (req.status < 400) {\n                return req.responseText\n            }\n            throw new Error(`Request failed for '${pathname}': ${req.statusText}`)\n        }\n        return this.readFile(`${pathname}.z`)\n    }\n    exists(pathname: string): boolean {\n        if (HTTPFSAdapter.debug) {\n            console.log(`HTTPJSFSAdapter.exits('${pathname}')`)\n        }\n        let info = HTTPFSAdapter.directoryCache.get(pathname)\n        if (info === undefined) {\n            try {\n                this.listDir(pathname)\n            } catch (e) {\n                return false\n            }\n            info = HTTPFSAdapter.directoryCache.get(pathname)\n        }\n        if (info === undefined) {\n            return false\n        }\n        return true\n    }\n    isFile(pathname: string): boolean {\n        if (HTTPFSAdapter.debug) {\n            console.log(`HTTPJSFSAdapter.isFile('${pathname}')`)\n        }\n        let info = HTTPFSAdapter.directoryCache.get(pathname)\n        if (info === undefined) {\n            try {\n                this.listDir(pathname)\n            } catch (e) {\n                throw Error(`HTTPFSAdapter.isFile('${pathname}')\": failed to load directory ${pathname}`)\n            }\n            info = HTTPFSAdapter.directoryCache.get(pathname)\n        }\n        if (info === undefined) {\n            throw Error(`HTTPFSAdapter.isFile('${pathname}'): info === undefined`)\n        }\n        return !info.isDir\n    }\n    isDir(pathname: string): boolean {\n        if (HTTPFSAdapter.debug) {\n            console.log(`HTTPFSAdapter.isDir('${pathname}')`)\n        }\n        const info = HTTPFSAdapter.directoryCache.get(pathname)\n        if (info === undefined) {\n            const slash = pathname.lastIndexOf(\"/\")\n            if (slash >= 0) {\n                const i = HTTPFSAdapter.directoryCache.get(pathname.substring(0, slash))\n                if (i !== undefined) {\n                    if (i.dir?.includes(pathname.substring(slash + 1))) {\n                        return true\n                    }\n                }\n            }\n            throw Error(`HTTPFSAdapter.isFile('${pathname}')`)\n        }\n        return info.isDir\n    }\n    listDir(pathname: string): string[] {\n        if (HTTPFSAdapter.debug) {\n            console.log(`HTTPFSAdapter.listDir('${pathname}')`)\n        }\n\n        let info = HTTPFSAdapter.directoryCache.get(pathname)\n        if (info !== undefined && info.dir !== undefined) {\n            return info.dir\n        }\n\n        if (info === undefined) {\n            info = { file: \"\", isDir: true, dir: undefined }\n        }\n\n        const d = this.readFile(`${pathname}/directory.json`)\n        const j = JSON.parse(d)\n        info.dir = []\n        for (const x of j) {\n            const fullfile = `${pathname}/${x.file}`\n            // console.log(`${pathname}/${x.file}`)\n            info.dir.push(x.file)\n            if (!x.isDir) {\n                HTTPFSAdapter.directoryCache.set(fullfile, { file: x.file, isDir: false })\n            }\n        }\n        HTTPFSAdapter.directoryCache.set(pathname, info)\n        return info.dir\n    }\n    realPath(pathname: string): string {\n        if (HTTPFSAdapter.debug) {\n            console.log(`HTTPFSAdapter.realPath('${pathname}')`)\n        }\n        // throw Error()\n        return pathname\n    }\n    joinPath(pathname1: string, pathname2: string): string {\n        if (HTTPFSAdapter.debug) {\n            console.log(`HTTPFSAdapter.joinPath('${pathname1}', '${pathname2}')`)\n        }\n        return `${pathname1}/${pathname2}`\n    }\n}\n","/**\n * Common utilities\n * @module glMatrix\n */\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== 'undefined' ? Float32Array : Array;\nexport var RANDOM = Math.random;\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\n */\n\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\n\nexport function toRadian(a) {\n  return a * degree;\n}\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a The first number to test.\n * @param {Number} b The second number to test.\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\nif (!Math.hypot) Math.hypot = function () {\n  var y = 0,\n      i = arguments.length;\n\n  while (i--) {\n    y += arguments[i] * arguments[i];\n  }\n\n  return Math.sqrt(y);\n};","import * as glMatrix from \"./common.js\";\n/**\n * 4x4 Matrix<br>Format: column-major, when typed out it looks like row-major<br>The matrices are being post multiplied.\n * @module mat4\n */\n\n/**\n * Creates a new identity mat4\n *\n * @returns {mat4} a new 4x4 matrix\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(16);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n  }\n\n  out[0] = 1;\n  out[5] = 1;\n  out[10] = 1;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a new mat4 initialized with values from an existing matrix\n *\n * @param {ReadonlyMat4} a matrix to clone\n * @returns {mat4} a new 4x4 matrix\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Copy the values from one mat4 to another\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Create a new mat4 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} A new mat4\n */\n\nexport function fromValues(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\n * Set the components of a mat4 to the given values\n *\n * @param {mat4} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} out\n */\n\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\n * Set a mat4 to the identity matrix\n *\n * @param {mat4} out the receiving matrix\n * @returns {mat4} out\n */\n\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Transpose the values of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n        a02 = a[2],\n        a03 = a[3];\n    var a12 = a[6],\n        a13 = a[7];\n    var a23 = a[11];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a01;\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a02;\n    out[9] = a12;\n    out[11] = a[14];\n    out[12] = a03;\n    out[13] = a13;\n    out[14] = a23;\n  } else {\n    out[0] = a[0];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a[1];\n    out[5] = a[5];\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a[2];\n    out[9] = a[6];\n    out[10] = a[10];\n    out[11] = a[14];\n    out[12] = a[3];\n    out[13] = a[7];\n    out[14] = a[11];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\n * Inverts a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function invert(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  if (!det) {\n    return null;\n  }\n\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n  return out;\n}\n/**\n * Calculates the adjugate of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function adjoint(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  out[0] = a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22);\n  out[1] = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));\n  out[2] = a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12);\n  out[3] = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));\n  out[4] = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));\n  out[5] = a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22);\n  out[6] = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));\n  out[7] = a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12);\n  out[8] = a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21);\n  out[9] = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));\n  out[10] = a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11);\n  out[11] = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));\n  out[12] = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));\n  out[13] = a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21);\n  out[14] = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));\n  out[15] = a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11);\n  return out;\n}\n/**\n * Calculates the determinant of a mat4\n *\n * @param {ReadonlyMat4} a the source matrix\n * @returns {Number} determinant of a\n */\n\nexport function determinant(a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n}\n/**\n * Multiplies two mat4s\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15]; // Cache only the current line of the second matrix\n\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[4];\n  b1 = b[5];\n  b2 = b[6];\n  b3 = b[7];\n  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[8];\n  b1 = b[9];\n  b2 = b[10];\n  b3 = b[11];\n  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[12];\n  b1 = b[13];\n  b2 = b[14];\n  b3 = b[15];\n  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  return out;\n}\n/**\n * Translate a mat4 by the given vector\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to translate\n * @param {ReadonlyVec3} v vector to translate by\n * @returns {mat4} out\n */\n\nexport function translate(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n\n  if (a === out) {\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n  } else {\n    a00 = a[0];\n    a01 = a[1];\n    a02 = a[2];\n    a03 = a[3];\n    a10 = a[4];\n    a11 = a[5];\n    a12 = a[6];\n    a13 = a[7];\n    a20 = a[8];\n    a21 = a[9];\n    a22 = a[10];\n    a23 = a[11];\n    out[0] = a00;\n    out[1] = a01;\n    out[2] = a02;\n    out[3] = a03;\n    out[4] = a10;\n    out[5] = a11;\n    out[6] = a12;\n    out[7] = a13;\n    out[8] = a20;\n    out[9] = a21;\n    out[10] = a22;\n    out[11] = a23;\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\n  }\n\n  return out;\n}\n/**\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {ReadonlyVec3} v the vec3 to scale the matrix by\n * @returns {mat4} out\n **/\n\nexport function scale(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  out[0] = a[0] * x;\n  out[1] = a[1] * x;\n  out[2] = a[2] * x;\n  out[3] = a[3] * x;\n  out[4] = a[4] * y;\n  out[5] = a[5] * y;\n  out[6] = a[6] * y;\n  out[7] = a[7] * y;\n  out[8] = a[8] * z;\n  out[9] = a[9] * z;\n  out[10] = a[10] * z;\n  out[11] = a[11] * z;\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Rotates a mat4 by the given angle around the given axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\n\nexport function rotate(out, a, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n  var b00, b01, b02;\n  var b10, b11, b12;\n  var b20, b21, b22;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n  a00 = a[0];\n  a01 = a[1];\n  a02 = a[2];\n  a03 = a[3];\n  a10 = a[4];\n  a11 = a[5];\n  a12 = a[6];\n  a13 = a[7];\n  a20 = a[8];\n  a21 = a[9];\n  a22 = a[10];\n  a23 = a[11]; // Construct the elements of the rotation matrix\n\n  b00 = x * x * t + c;\n  b01 = y * x * t + z * s;\n  b02 = z * x * t - y * s;\n  b10 = x * y * t - z * s;\n  b11 = y * y * t + c;\n  b12 = z * y * t + x * s;\n  b20 = x * z * t + y * s;\n  b21 = y * z * t - x * s;\n  b22 = z * z * t + c; // Perform rotation-specific matrix multiplication\n\n  out[0] = a00 * b00 + a10 * b01 + a20 * b02;\n  out[1] = a01 * b00 + a11 * b01 + a21 * b02;\n  out[2] = a02 * b00 + a12 * b01 + a22 * b02;\n  out[3] = a03 * b00 + a13 * b01 + a23 * b02;\n  out[4] = a00 * b10 + a10 * b11 + a20 * b12;\n  out[5] = a01 * b10 + a11 * b11 + a21 * b12;\n  out[6] = a02 * b10 + a12 * b11 + a22 * b12;\n  out[7] = a03 * b10 + a13 * b11 + a23 * b12;\n  out[8] = a00 * b20 + a10 * b21 + a20 * b22;\n  out[9] = a01 * b20 + a11 * b21 + a21 * b22;\n  out[10] = a02 * b20 + a12 * b21 + a22 * b22;\n  out[11] = a03 * b20 + a13 * b21 + a23 * b22;\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the X axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateX(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[4] = a10 * c + a20 * s;\n  out[5] = a11 * c + a21 * s;\n  out[6] = a12 * c + a22 * s;\n  out[7] = a13 * c + a23 * s;\n  out[8] = a20 * c - a10 * s;\n  out[9] = a21 * c - a11 * s;\n  out[10] = a22 * c - a12 * s;\n  out[11] = a23 * c - a13 * s;\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the Y axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateY(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c - a20 * s;\n  out[1] = a01 * c - a21 * s;\n  out[2] = a02 * c - a22 * s;\n  out[3] = a03 * c - a23 * s;\n  out[8] = a00 * s + a20 * c;\n  out[9] = a01 * s + a21 * c;\n  out[10] = a02 * s + a22 * c;\n  out[11] = a03 * s + a23 * c;\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the Z axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateZ(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[8] = a[8];\n    out[9] = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c + a10 * s;\n  out[1] = a01 * c + a11 * s;\n  out[2] = a02 * c + a12 * s;\n  out[3] = a03 * c + a13 * s;\n  out[4] = a10 * c - a00 * s;\n  out[5] = a11 * c - a01 * s;\n  out[6] = a12 * c - a02 * s;\n  out[7] = a13 * c - a03 * s;\n  return out;\n}\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\n\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.scale(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Scaling vector\n * @returns {mat4} out\n */\n\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = v[1];\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = v[2];\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a given angle around a given axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotate(dest, dest, rad, axis);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\n\nexport function fromRotation(out, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c; // Perform rotation-specific matrix multiplication\n\n  out[0] = x * x * t + c;\n  out[1] = y * x * t + z * s;\n  out[2] = z * x * t - y * s;\n  out[3] = 0;\n  out[4] = x * y * t - z * s;\n  out[5] = y * y * t + c;\n  out[6] = z * y * t + x * s;\n  out[7] = 0;\n  out[8] = x * z * t + y * s;\n  out[9] = y * z * t - x * s;\n  out[10] = z * z * t + c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the X axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateX(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromXRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = c;\n  out[6] = s;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = -s;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the Y axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateY(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromYRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = 0;\n  out[2] = -s;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = s;\n  out[9] = 0;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the Z axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateZ(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromZRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -s;\n  out[5] = c;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation and vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslation(out, q, v) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - (yy + zz);\n  out[1] = xy + wz;\n  out[2] = xz - wy;\n  out[3] = 0;\n  out[4] = xy - wz;\n  out[5] = 1 - (xx + zz);\n  out[6] = yz + wx;\n  out[7] = 0;\n  out[8] = xz + wy;\n  out[9] = yz - wx;\n  out[10] = 1 - (xx + yy);\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a new mat4 from a dual quat.\n *\n * @param {mat4} out Matrix\n * @param {ReadonlyQuat2} a Dual Quaternion\n * @returns {mat4} mat4 receiving operation result\n */\n\nexport function fromQuat2(out, a) {\n  var translation = new glMatrix.ARRAY_TYPE(3);\n  var bx = -a[0],\n      by = -a[1],\n      bz = -a[2],\n      bw = a[3],\n      ax = a[4],\n      ay = a[5],\n      az = a[6],\n      aw = a[7];\n  var magnitude = bx * bx + by * by + bz * bz + bw * bw; //Only scale if it makes sense\n\n  if (magnitude > 0) {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\n  } else {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\n  }\n\n  fromRotationTranslation(out, a, translation);\n  return out;\n}\n/**\n * Returns the translation vector component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslation,\n *  the returned vector will be the same as the translation vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive translation component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\n\nexport function getTranslation(out, mat) {\n  out[0] = mat[12];\n  out[1] = mat[13];\n  out[2] = mat[14];\n  return out;\n}\n/**\n * Returns the scaling factor component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslationScale\n *  with a normalized Quaternion paramter, the returned vector will be\n *  the same as the scaling vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive scaling factor component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\n\nexport function getScaling(out, mat) {\n  var m11 = mat[0];\n  var m12 = mat[1];\n  var m13 = mat[2];\n  var m21 = mat[4];\n  var m22 = mat[5];\n  var m23 = mat[6];\n  var m31 = mat[8];\n  var m32 = mat[9];\n  var m33 = mat[10];\n  out[0] = Math.hypot(m11, m12, m13);\n  out[1] = Math.hypot(m21, m22, m23);\n  out[2] = Math.hypot(m31, m32, m33);\n  return out;\n}\n/**\n * Returns a quaternion representing the rotational component\n *  of a transformation matrix. If a matrix is built with\n *  fromRotationTranslation, the returned quaternion will be the\n *  same as the quaternion originally supplied.\n * @param {quat} out Quaternion to receive the rotation component\n * @param {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {quat} out\n */\n\nexport function getRotation(out, mat) {\n  var scaling = new glMatrix.ARRAY_TYPE(3);\n  getScaling(scaling, mat);\n  var is1 = 1 / scaling[0];\n  var is2 = 1 / scaling[1];\n  var is3 = 1 / scaling[2];\n  var sm11 = mat[0] * is1;\n  var sm12 = mat[1] * is2;\n  var sm13 = mat[2] * is3;\n  var sm21 = mat[4] * is1;\n  var sm22 = mat[5] * is2;\n  var sm23 = mat[6] * is3;\n  var sm31 = mat[8] * is1;\n  var sm32 = mat[9] * is2;\n  var sm33 = mat[10] * is3;\n  var trace = sm11 + sm22 + sm33;\n  var S = 0;\n\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out[3] = 0.25 * S;\n    out[0] = (sm23 - sm32) / S;\n    out[1] = (sm31 - sm13) / S;\n    out[2] = (sm12 - sm21) / S;\n  } else if (sm11 > sm22 && sm11 > sm33) {\n    S = Math.sqrt(1.0 + sm11 - sm22 - sm33) * 2;\n    out[3] = (sm23 - sm32) / S;\n    out[0] = 0.25 * S;\n    out[1] = (sm12 + sm21) / S;\n    out[2] = (sm31 + sm13) / S;\n  } else if (sm22 > sm33) {\n    S = Math.sqrt(1.0 + sm22 - sm11 - sm33) * 2;\n    out[3] = (sm31 - sm13) / S;\n    out[0] = (sm12 + sm21) / S;\n    out[1] = 0.25 * S;\n    out[2] = (sm23 + sm32) / S;\n  } else {\n    S = Math.sqrt(1.0 + sm33 - sm11 - sm22) * 2;\n    out[3] = (sm12 - sm21) / S;\n    out[0] = (sm31 + sm13) / S;\n    out[1] = (sm23 + sm32) / S;\n    out[2] = 0.25 * S;\n  }\n\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *     mat4.scale(dest, scale)\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslationScale(out, q, v, s) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  out[0] = (1 - (yy + zz)) * sx;\n  out[1] = (xy + wz) * sx;\n  out[2] = (xz - wy) * sx;\n  out[3] = 0;\n  out[4] = (xy - wz) * sy;\n  out[5] = (1 - (xx + zz)) * sy;\n  out[6] = (yz + wx) * sy;\n  out[7] = 0;\n  out[8] = (xz + wy) * sz;\n  out[9] = (yz - wx) * sz;\n  out[10] = (1 - (xx + yy)) * sz;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     mat4.translate(dest, origin);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *     mat4.scale(dest, scale)\n *     mat4.translate(dest, negativeOrigin);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @param {ReadonlyVec3} o The origin vector around which to scale and rotate\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslationScaleOrigin(out, q, v, s, o) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  var ox = o[0];\n  var oy = o[1];\n  var oz = o[2];\n  var out0 = (1 - (yy + zz)) * sx;\n  var out1 = (xy + wz) * sx;\n  var out2 = (xz - wy) * sx;\n  var out4 = (xy - wz) * sy;\n  var out5 = (1 - (xx + zz)) * sy;\n  var out6 = (yz + wx) * sy;\n  var out8 = (xz + wy) * sz;\n  var out9 = (yz - wx) * sz;\n  var out10 = (1 - (xx + yy)) * sz;\n  out[0] = out0;\n  out[1] = out1;\n  out[2] = out2;\n  out[3] = 0;\n  out[4] = out4;\n  out[5] = out5;\n  out[6] = out6;\n  out[7] = 0;\n  out[8] = out8;\n  out[9] = out9;\n  out[10] = out10;\n  out[11] = 0;\n  out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\n  out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\n  out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\n  out[15] = 1;\n  return out;\n}\n/**\n * Calculates a 4x4 matrix from the given quaternion\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyQuat} q Quaternion to create matrix from\n *\n * @returns {mat4} out\n */\n\nexport function fromQuat(out, q) {\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[1] = yx + wz;\n  out[2] = zx - wy;\n  out[3] = 0;\n  out[4] = yx - wz;\n  out[5] = 1 - xx - zz;\n  out[6] = zy + wx;\n  out[7] = 0;\n  out[8] = zx + wy;\n  out[9] = zy - wx;\n  out[10] = 1 - xx - yy;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a frustum matrix with the given bounds\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Number} left Left bound of the frustum\n * @param {Number} right Right bound of the frustum\n * @param {Number} bottom Bottom bound of the frustum\n * @param {Number} top Top bound of the frustum\n * @param {Number} near Near bound of the frustum\n * @param {Number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function frustum(out, left, right, bottom, top, near, far) {\n  var rl = 1 / (right - left);\n  var tb = 1 / (top - bottom);\n  var nf = 1 / (near - far);\n  out[0] = near * 2 * rl;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = near * 2 * tb;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = (right + left) * rl;\n  out[9] = (top + bottom) * tb;\n  out[10] = (far + near) * nf;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = far * near * 2 * nf;\n  out[15] = 0;\n  return out;\n}\n/**\n * Generates a perspective projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\n\nexport function perspectiveNO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n      nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = (far + near) * nf;\n    out[14] = 2 * far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -2 * near;\n  }\n\n  return out;\n}\n/**\n * Alias for {@link mat4.perspectiveNO}\n * @function\n */\n\nexport var perspective = perspectiveNO;\n/**\n * Generates a perspective projection matrix suitable for WebGPU with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\n\nexport function perspectiveZO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n      nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = far * nf;\n    out[14] = far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -near;\n  }\n\n  return out;\n}\n/**\n * Generates a perspective projection matrix with the given field of view.\n * This is primarily useful for generating projection matrices to be used\n * with the still experiemental WebVR API.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function perspectiveFromFieldOfView(out, fov, near, far) {\n  var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0);\n  var downTan = Math.tan(fov.downDegrees * Math.PI / 180.0);\n  var leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0);\n  var rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0);\n  var xScale = 2.0 / (leftTan + rightTan);\n  var yScale = 2.0 / (upTan + downTan);\n  out[0] = xScale;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  out[4] = 0.0;\n  out[5] = yScale;\n  out[6] = 0.0;\n  out[7] = 0.0;\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\n  out[9] = (upTan - downTan) * yScale * 0.5;\n  out[10] = far / (near - far);\n  out[11] = -1.0;\n  out[12] = 0.0;\n  out[13] = 0.0;\n  out[14] = far * near / (near - far);\n  out[15] = 0.0;\n  return out;\n}\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function orthoNO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n}\n/**\n * Alias for {@link mat4.orthoNO}\n * @function\n */\n\nexport var ortho = orthoNO;\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function orthoZO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = near * nf;\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a look-at matrix with the given eye position, focal point, and up axis.\n * If you want a matrix that actually makes an object look at another object, you should use targetTo instead.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\n\nexport function lookAt(out, eye, center, up) {\n  var x0, x1, x2, y0, y1, y2, z0, z1, z2, len;\n  var eyex = eye[0];\n  var eyey = eye[1];\n  var eyez = eye[2];\n  var upx = up[0];\n  var upy = up[1];\n  var upz = up[2];\n  var centerx = center[0];\n  var centery = center[1];\n  var centerz = center[2];\n\n  if (Math.abs(eyex - centerx) < glMatrix.EPSILON && Math.abs(eyey - centery) < glMatrix.EPSILON && Math.abs(eyez - centerz) < glMatrix.EPSILON) {\n    return identity(out);\n  }\n\n  z0 = eyex - centerx;\n  z1 = eyey - centery;\n  z2 = eyez - centerz;\n  len = 1 / Math.hypot(z0, z1, z2);\n  z0 *= len;\n  z1 *= len;\n  z2 *= len;\n  x0 = upy * z2 - upz * z1;\n  x1 = upz * z0 - upx * z2;\n  x2 = upx * z1 - upy * z0;\n  len = Math.hypot(x0, x1, x2);\n\n  if (!len) {\n    x0 = 0;\n    x1 = 0;\n    x2 = 0;\n  } else {\n    len = 1 / len;\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  y0 = z1 * x2 - z2 * x1;\n  y1 = z2 * x0 - z0 * x2;\n  y2 = z0 * x1 - z1 * x0;\n  len = Math.hypot(y0, y1, y2);\n\n  if (!len) {\n    y0 = 0;\n    y1 = 0;\n    y2 = 0;\n  } else {\n    len = 1 / len;\n    y0 *= len;\n    y1 *= len;\n    y2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = y0;\n  out[2] = z0;\n  out[3] = 0;\n  out[4] = x1;\n  out[5] = y1;\n  out[6] = z1;\n  out[7] = 0;\n  out[8] = x2;\n  out[9] = y2;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a matrix that makes something look at something else.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\n\nexport function targetTo(out, eye, target, up) {\n  var eyex = eye[0],\n      eyey = eye[1],\n      eyez = eye[2],\n      upx = up[0],\n      upy = up[1],\n      upz = up[2];\n  var z0 = eyex - target[0],\n      z1 = eyey - target[1],\n      z2 = eyez - target[2];\n  var len = z0 * z0 + z1 * z1 + z2 * z2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    z0 *= len;\n    z1 *= len;\n    z2 *= len;\n  }\n\n  var x0 = upy * z2 - upz * z1,\n      x1 = upz * z0 - upx * z2,\n      x2 = upx * z1 - upy * z0;\n  len = x0 * x0 + x1 * x1 + x2 * x2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = x1;\n  out[2] = x2;\n  out[3] = 0;\n  out[4] = z1 * x2 - z2 * x1;\n  out[5] = z2 * x0 - z0 * x2;\n  out[6] = z0 * x1 - z1 * x0;\n  out[7] = 0;\n  out[8] = z0;\n  out[9] = z1;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = eyex;\n  out[13] = eyey;\n  out[14] = eyez;\n  out[15] = 1;\n  return out;\n}\n/**\n * Returns a string representation of a mat4\n *\n * @param {ReadonlyMat4} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\n\nexport function str(a) {\n  return \"mat4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \", \" + a[9] + \", \" + a[10] + \", \" + a[11] + \", \" + a[12] + \", \" + a[13] + \", \" + a[14] + \", \" + a[15] + \")\";\n}\n/**\n * Returns Frobenius norm of a mat4\n *\n * @param {ReadonlyMat4} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\n\nexport function frob(a) {\n  return Math.hypot(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8], a[9], a[10], a[11], a[12], a[13], a[14], a[15]);\n}\n/**\n * Adds two mat4's\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  out[9] = a[9] + b[9];\n  out[10] = a[10] + b[10];\n  out[11] = a[11] + b[11];\n  out[12] = a[12] + b[12];\n  out[13] = a[13] + b[13];\n  out[14] = a[14] + b[14];\n  out[15] = a[15] + b[15];\n  return out;\n}\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  out[9] = a[9] - b[9];\n  out[10] = a[10] - b[10];\n  out[11] = a[11] - b[11];\n  out[12] = a[12] - b[12];\n  out[13] = a[13] - b[13];\n  out[14] = a[14] - b[14];\n  out[15] = a[15] - b[15];\n  return out;\n}\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat4} out\n */\n\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  out[9] = a[9] * b;\n  out[10] = a[10] * b;\n  out[11] = a[11] * b;\n  out[12] = a[12] * b;\n  out[13] = a[13] * b;\n  out[14] = a[14] * b;\n  out[15] = a[15] * b;\n  return out;\n}\n/**\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat4} out the receiving vector\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat4} out\n */\n\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  out[9] = a[9] + b[9] * scale;\n  out[10] = a[10] + b[10] * scale;\n  out[11] = a[11] + b[11] * scale;\n  out[12] = a[12] + b[12] * scale;\n  out[13] = a[13] + b[13] * scale;\n  out[14] = a[14] + b[14] * scale;\n  out[15] = a[15] + b[15] * scale;\n  return out;\n}\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] && a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\n}\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var a4 = a[4],\n      a5 = a[5],\n      a6 = a[6],\n      a7 = a[7];\n  var a8 = a[8],\n      a9 = a[9],\n      a10 = a[10],\n      a11 = a[11];\n  var a12 = a[12],\n      a13 = a[13],\n      a14 = a[14],\n      a15 = a[15];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  var b4 = b[4],\n      b5 = b[5],\n      b6 = b[6],\n      b7 = b[7];\n  var b8 = b[8],\n      b9 = b[9],\n      b10 = b[10],\n      b11 = b[11];\n  var b12 = b[12],\n      b13 = b[13],\n      b14 = b[14],\n      b15 = b[15];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8)) && Math.abs(a9 - b9) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a9), Math.abs(b9)) && Math.abs(a10 - b10) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a10), Math.abs(b10)) && Math.abs(a11 - b11) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a11), Math.abs(b11)) && Math.abs(a12 - b12) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a12), Math.abs(b12)) && Math.abs(a13 - b13) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a13), Math.abs(b13)) && Math.abs(a14 - b14) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a14), Math.abs(b14)) && Math.abs(a15 - b15) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a15), Math.abs(b15));\n}\n/**\n * Alias for {@link mat4.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link mat4.subtract}\n * @function\n */\n\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\n/**\n * 3 Dimensional Vector\n * @module vec3\n */\n\n/**\n * Creates a new, empty vec3\n *\n * @returns {vec3} a new 3D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(3);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec3 initialized with values from an existing vector\n *\n * @param {ReadonlyVec3} a vector to clone\n * @returns {vec3} a new 3D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Calculates the length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Creates a new vec3 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} a new 3D vector\n */\n\nexport function fromValues(x, y, z) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Copy the values from one vec3 to another\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the source vector\n * @returns {vec3} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Set the components of a vec3 to the given values\n *\n * @param {vec3} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} out\n */\n\nexport function set(out, x, y, z) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Adds two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  return out;\n}\n/**\n * Multiplies two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  return out;\n}\n/**\n * Divides two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  return out;\n}\n/**\n * Math.ceil the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to ceil\n * @returns {vec3} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  return out;\n}\n/**\n * Math.floor the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to floor\n * @returns {vec3} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  return out;\n}\n/**\n * Returns the minimum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  return out;\n}\n/**\n * Returns the maximum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  return out;\n}\n/**\n * Math.round the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to round\n * @returns {vec3} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  return out;\n}\n/**\n * Scales a vec3 by a scalar number\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec3} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  return out;\n}\n/**\n * Adds two vec3's after scaling the second operand by a scalar value\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec3} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Calculates the squared euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Calculates the squared length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Negates the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to negate\n * @returns {vec3} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to invert\n * @returns {vec3} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  return out;\n}\n/**\n * Normalize a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to normalize\n * @returns {vec3} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var len = x * x + y * y + z * z;\n\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  out[2] = a[2] * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n/**\n * Computes the cross product of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function cross(out, a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2];\n  var bx = b[0],\n      by = b[1],\n      bz = b[2];\n  out[0] = ay * bz - az * by;\n  out[1] = az * bx - ax * bz;\n  out[2] = ax * by - ay * bx;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  return out;\n}\n/**\n * Performs a hermite interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function hermite(out, a, b, c, d, t) {\n  var factorTimes2 = t * t;\n  var factor1 = factorTimes2 * (2 * t - 3) + 1;\n  var factor2 = factorTimes2 * (t - 2) + t;\n  var factor3 = factorTimes2 * (t - 1);\n  var factor4 = factorTimes2 * (3 - 2 * t);\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Performs a bezier interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function bezier(out, a, b, c, d, t) {\n  var inverseFactor = 1 - t;\n  var inverseFactorTimesTwo = inverseFactor * inverseFactor;\n  var factorTimes2 = t * t;\n  var factor1 = inverseFactorTimesTwo * inverseFactor;\n  var factor2 = 3 * t * inverseFactorTimesTwo;\n  var factor3 = 3 * factorTimes2 * inverseFactor;\n  var factor4 = factorTimes2 * t;\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec3} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\n * @returns {vec3} out\n */\n\nexport function random(out, scale) {\n  scale = scale || 1.0;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  var z = glMatrix.RANDOM() * 2.0 - 1.0;\n  var zScale = Math.sqrt(1.0 - z * z) * scale;\n  out[0] = Math.cos(r) * zScale;\n  out[1] = Math.sin(r) * zScale;\n  out[2] = z * scale;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat4.\n * 4th vector component is implicitly '1'\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  var w = m[3] * x + m[7] * y + m[11] * z + m[15];\n  w = w || 1.0;\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat3.\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat3} m the 3x3 matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  out[0] = x * m[0] + y * m[3] + z * m[6];\n  out[1] = x * m[1] + y * m[4] + z * m[7];\n  out[2] = x * m[2] + y * m[5] + z * m[8];\n  return out;\n}\n/**\n * Transforms the vec3 with a quat\n * Can also be used for dual quaternions. (Multiply it with the real part)\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyQuat} q quaternion to transform with\n * @returns {vec3} out\n */\n\nexport function transformQuat(out, a, q) {\n  // benchmarks: https://jsperf.com/quaternion-transform-vec3-implementations-fixed\n  var qx = q[0],\n      qy = q[1],\n      qz = q[2],\n      qw = q[3];\n  var x = a[0],\n      y = a[1],\n      z = a[2]; // var qvec = [qx, qy, qz];\n  // var uv = vec3.cross([], qvec, a);\n\n  var uvx = qy * z - qz * y,\n      uvy = qz * x - qx * z,\n      uvz = qx * y - qy * x; // var uuv = vec3.cross([], qvec, uv);\n\n  var uuvx = qy * uvz - qz * uvy,\n      uuvy = qz * uvx - qx * uvz,\n      uuvz = qx * uvy - qy * uvx; // vec3.scale(uv, uv, 2 * w);\n\n  var w2 = qw * 2;\n  uvx *= w2;\n  uvy *= w2;\n  uvz *= w2; // vec3.scale(uuv, uuv, 2);\n\n  uuvx *= 2;\n  uuvy *= 2;\n  uuvz *= 2; // return vec3.add(out, a, vec3.add(out, uv, uuv));\n\n  out[0] = x + uvx + uuvx;\n  out[1] = y + uvy + uuvy;\n  out[2] = z + uvz + uuvz;\n  return out;\n}\n/**\n * Rotate a 3D vector around the x-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateX(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0];\n  r[1] = p[1] * Math.cos(rad) - p[2] * Math.sin(rad);\n  r[2] = p[1] * Math.sin(rad) + p[2] * Math.cos(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the y-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateY(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[2] * Math.sin(rad) + p[0] * Math.cos(rad);\n  r[1] = p[1];\n  r[2] = p[2] * Math.cos(rad) - p[0] * Math.sin(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the z-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateZ(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0] * Math.cos(rad) - p[1] * Math.sin(rad);\n  r[1] = p[0] * Math.sin(rad) + p[1] * Math.cos(rad);\n  r[2] = p[2]; //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Get the angle between two 3D vectors\n * @param {ReadonlyVec3} a The first operand\n * @param {ReadonlyVec3} b The second operand\n * @returns {Number} The angle in radians\n */\n\nexport function angle(a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      bx = b[0],\n      by = b[1],\n      bz = b[2],\n      mag1 = Math.sqrt(ax * ax + ay * ay + az * az),\n      mag2 = Math.sqrt(bx * bx + by * by + bz * bz),\n      mag = mag1 * mag2,\n      cosine = mag && dot(a, b) / mag;\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n/**\n * Set the components of a vec3 to zero\n *\n * @param {vec3} out the receiving vector\n * @returns {vec3} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec3} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \")\";\n}\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2));\n}\n/**\n * Alias for {@link vec3.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec3.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec3.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec3.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec3.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec3.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec3.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec3s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 3;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n    }\n\n    return a;\n  };\n}();","import { FileSystemAdapter } from \"../filesystem/FileSystemAdapter\"\n\nenum RecursiveLevel {\n    NO_LIMIT = -1, // read directories recursive without limit\n    NO_RECURSIVE = 0, // read only the base directory without recursion\n}\n\nexport enum FileType {\n    REGULAR_FILE, // only regular files\n    DIRECTORY, // only directories\n}\n\nexport class DirectoryList {\n    private file_list: string[] = []\n    private file_filter: string = \"\"\n    private path: string = \"\"\n    private recursive_level: number = -1\n    private recursive_counter: number = 0\n    private file_type: FileType = FileType.REGULAR_FILE\n\n    setFileFilter(file_filter: string) {\n        this.file_filter = file_filter\n    }\n    setRecursive(recursive_level: number): void {\n        this.recursive_level = recursive_level\n    }\n    setRootPath(path: string): void {\n        this.path = path\n    }\n    setFileType(file_type: FileType) {\n        this.file_type = file_type\n    }\n    getDirectoryList(): string[] {\n        this.readDirRecursive(this.path)\n        this.recursive_counter = 0\n        return this.file_list\n    }\n    private readDirRecursive(dir_str: string) {\n        for (const dname of FileSystemAdapter.listDir(dir_str)) {\n            if (dir_str.charAt(0) === \".\") {\n                continue\n            }\n            const dir_file = `${dir_str}/${dname}`\n            if (FileSystemAdapter.isDir(dir_file)) {\n                if (this.file_type === FileType.DIRECTORY) {\n                    this.file_list.push(dir_file)\n                }\n                if (this.recursive_counter < this.recursive_level || this.recursive_level == RecursiveLevel.NO_LIMIT) {\n                    ++this.recursive_counter\n                    this.readDirRecursive(dir_file)\n                    --this.recursive_counter\n                }\n            } else {\n                if (this.hasFileFilterEnding(dir_file)) {\n                    this.file_list.push(dir_file)\n                }\n            }\n        }\n    }\n    private hasFileFilterEnding(file: string): boolean {\n        if (this.file_filter.length > file.length) {\n            return false\n        }\n        return file.endsWith(this.file_filter)\n    }\n}\n","import { vec3 } from \"gl-matrix\"\nimport { FileSystemAdapter } from \"../filesystem/FileSystemAdapter\"\nimport { StringToLine } from \"../lib/StringToLine\"\nimport { UnsortedUsedVertex } from \"./PoseTarget\"\n\nexport interface PoseTargetData {\n    vertex_number: number\n    rotation: number\n}\n\nexport enum RotateAxis {\n    X_AXIS,\n    Y_AXIS,\n    Z_AXIS,\n}\n\nexport class PoseRotation extends Array<PoseTargetData> {\n    /// Used to calculate center\n    private centerVertexNumbers!: number[]\n    /// Will be used as parameter for Matrix::setRoation()\n    private axis!: RotateAxis\n    /// Set of all indices in the \".rot\" file\n    private modVertex: UnsortedUsedVertex = [];\n    /// Currently unused\n    private hasCenter: boolean = false\n    /// Minimum angle in radians\n    private minAngle: number = 0\n    /// Maximum angle in radians\n    private maxAngle: number = 0\n    /// will be set to true by PoseTarget::calcNormalizations() if our (min|max)Angle != PoseTarget::(min|max)Angle\n    private normalize: boolean = false\n    //string inFilename;\n    /* \\brief \"Category\"? Currently always \"00\"\n     * First two characters of the filename, eg . \"00\" for \"00_Z_LIMB_SPINE1.rot\"\n     */\n    private cat: string = \"\"\n\n    /* \\brief Centroid of centerVertexNumbers\n     * Is initialized by PoseTarget::calcRotationsCenteroids()\n     */\n    private center!: vec3\n    ///Limb rotation Type\n    private mbLimb!: boolean\n\n    clear() {\n        this.length = 0\n    }\n\n    load(filename: string): boolean {\n        this.clear()\n\n        const info = FileSystemAdapter.readFile(`${filename}.info`)\n            .split(\"\\n\")\n            .map((it) => it.trim())\n        if (info.length < 3) {\n            return false\n        }\n        const str = info[0]\n        const ax = info[1].charAt(0) // axis X,Y,Z\n        const minMax = info[2].split(\",\")\n        this.minAngle = parseFloat(minMax[0])\n        this.maxAngle = parseFloat(minMax[1])\n\n        const data = FileSystemAdapter.readFile(filename)\n        const reader = new StringToLine(data)\n        let lineNumber = 0\n        for (let line of reader) {\n            ++lineNumber\n            line = line.trim()\n            const tokens = line.split(/,+/)\n            if (tokens.length === 2) {\n                const td: PoseTargetData = {\n                    vertex_number: parseInt(tokens[0]),\n                    rotation: parseFloat(tokens[1]),\n                }\n                this.modVertex.push(td.vertex_number)\n                this.push(td)\n            }\n        }\n\n        switch (ax) {\n            case \"X\":\n                this.axis = RotateAxis.X_AXIS\n                break\n            case \"Y\":\n                this.axis = RotateAxis.Y_AXIS\n                break\n            case \"Z\":\n                this.axis = RotateAxis.Z_AXIS\n                break\n            default:\n                throw Error(`unknown axis ${ax}`)\n        }\n        this.centerVertexNumbers = str.split(\",\").map((it) => parseInt(it))\n        return true\n    }\n    getCenterVertexNumbers() {\n        return this.centerVertexNumbers\n    }\n    getModVertex() {\n        return this.modVertex\n    }\n    getCenter() {\n        return this.center\n    }\n    setCenter(c: vec3) {\n        this.center = c\n    }\n\n    getAxis() {\n        return this.axis\n    }\n    getHasCenter() {\n        return this.hasCenter\n    }\n    setHasCenter(c: boolean) {\n        this.hasCenter = c\n    }\n\n    getMinAngle() {\n        return this.minAngle\n    }\n    getMaxAngle() {\n        return this.maxAngle\n    }\n    getNormalize() {\n        return this.normalize\n    }\n    setNormalize(inNormalize: boolean) {\n        this.normalize = inNormalize\n    }\n\n    //const string &getFilename() const {return inFilename;}\n    getCat() {\n        return this.cat\n    }\n    setCat(inCat: string) {\n        this.cat = inCat\n    }\n\n    setLimb(limb: boolean) {\n        this.mbLimb = limb\n    }\n    getLimb() {\n        return this.mbLimb\n    }\n}\n","import { vec3 } from \"gl-matrix\"\n\nexport class Face {\n    vertices: number[]\n    get size() {\n        return this.vertices.length\n    }\n    material_index: number\n    no: vec3\n\n    constructor(v0: number, v1: number, v2: number, v3?: number) {\n        if (v3 !== undefined) {\n            this.vertices = [v0, v1, v2, v3]\n        } else {\n            this.vertices = [v0, v1, v2]\n        }\n        this.material_index = -1\n        this.no = vec3.create()\n    }\n}\n","export class StringToLineIterator implements Iterator<string> {\n    private data: string\n    private index: number\n\n    constructor(data: string) {\n        this.data = data\n        this.index = 0\n    }\n\n    next(): IteratorResult<string> {\n        if (this.data.length === 0 || this.index === -1)\n            return { value: undefined, done: true }\n        const nextIndex = this.data.indexOf('\\n', this.index)\n        let length: number | undefined\n        if (nextIndex === -1) {\n            length = undefined\n        } else {\n            length = nextIndex - this.index\n        }\n        const result = this.data.substr(this.index, length)\n        if (nextIndex === -1) {\n            this.index = -1\n        } else {\n            this.index = nextIndex + 1\n        }\n        return { value: result, done: false }\n    }\n\n}\n","import { StringToLineIterator } from './StringToLineIterator'\n\nexport class StringToLine implements Iterable<string> {\n    data: string;\n    constructor(data: string) {\n        this.data = data\n    }\n\n    [Symbol.iterator](): Iterator<string> {\n        return new StringToLineIterator(this.data)\n    }\n}\n","import { Face } from \"./Face\"\nimport { FileSystemAdapter } from \"../filesystem/FileSystemAdapter\"\nimport { StringToLine } from \"../lib/StringToLine\"\n\nexport class FaceVector extends Array<Face> {\n    loadGeometry(filename: string) {\n        const data = FileSystemAdapter.readFile(filename)\n        const reader = new StringToLine(data)\n        let lineNumber = 0, triangles = 0, quads = 0\n        for (let line of reader) {\n            ++lineNumber\n            line = line.trim()\n            const tokens = line.split(/,+/)\n            switch (tokens.length) {\n                case 3:\n                    ++triangles\n                    this.push(new Face(parseFloat(tokens[0]), parseFloat(tokens[1]), parseFloat(tokens[2])))\n                    break\n                case 4:\n                    ++quads\n                    this.push(new Face(parseFloat(tokens[0]), parseFloat(tokens[1]), parseFloat(tokens[2]), parseFloat(tokens[3])))\n                    break\n            }\n        }\n        console.log(`loaded ${triangles} triangles and ${quads} quads from ${filename}`)\n    }\n}\n","import { vec3 } from \"gl-matrix\"\n\nexport class Vertex {\n    co: vec3\n    constructor(x: number, y: number, z: number)\n    constructor(vertex: Vertex)\n    constructor(xOrVertex: number | Vertex, y?: number, z?: number) {\n        if (xOrVertex instanceof Vertex) {\n            this.co = vec3.clone(xOrVertex.co)\n        } else {\n            this.co = vec3.fromValues(xOrVertex, y!, z!)\n        }\n    }\n}\n","import { Vertex } from \"./Vertex\"\nimport { FileSystemAdapter } from \"../filesystem/FileSystemAdapter\"\nimport { StringToLine } from \"../lib/StringToLine\"\nimport { vec3 } from \"gl-matrix\"\n\nexport class VertexVector extends Array<Vertex> {\n    load(filename: string) {\n        const data = FileSystemAdapter.readFile(filename)\n        const reader = new StringToLine(data)\n        let lineNumber = 0\n        for (let line of reader) {\n            ++lineNumber\n            line = line.trim()\n            const tokens = line.split(/,+/)\n            if (tokens.length === 3) {\n                this.push(new Vertex(parseFloat(tokens[0]), parseFloat(tokens[1]), parseFloat(tokens[2])))\n            }\n        }\n        console.log(`loaded ${this.length} vertices from ${filename}`)\n    }\n    clone() {\n        const clone = new VertexVector(this.length)\n        for (let i = 0; i < this.length; ++i) {\n            const v = this[i]\n            clone[i] = new Vertex(v)\n        }\n        return clone\n    }\n    setFrom(src: VertexVector) {\n        if (this.length !== src.length) {\n            throw Error(`length must be the same`)\n        }\n        for (let i = 0; i < this.length; ++i) {\n            vec3.copy(this[i].co, src[i].co)\n        }\n    }\n}\n","export class UnsortedUsedVertex extends Array<number> { }\n","import { vec3 } from \"gl-matrix\"\nimport { FileSystemAdapter } from \"../filesystem/FileSystemAdapter\"\nimport { StringToLine } from \"../lib/StringToLine\"\nimport { TargetData } from \"./TargetData\"\nimport { UnsortedUsedVertex } from \"./UnsortedUsedVertex\"\n\nexport class Target extends Array<TargetData> {\n    private modVertex = new UnsortedUsedVertex()\n    load(filename: string): boolean {\n        const data = FileSystemAdapter.readFile(`${filename}`)\n        const reader = new StringToLine(data)\n        let lineNumber = 0\n        for (let line of reader) {\n            ++lineNumber\n            line = line.trim()\n            const tokens = line.split(/,+/)\n            if (tokens.length === 4) {\n                const td: TargetData = {\n                    vertex_number: parseInt(tokens[0]),\n                    morph_vector: vec3.fromValues(parseFloat(tokens[1]), parseFloat(tokens[2]), parseFloat(tokens[3])),\n                }\n                this.push(td)\n                this.modVertex.push(td.vertex_number)\n            }\n        }\n        // console.log(`loaded ${this.length} vectors for morph target ${filename}`)\n        return true\n    }\n    getModVertex() {\n        return this.modVertex\n    }\n}\n","import { Target } from \"./Target\"\n\nexport class TargetEntry {\n    private mFilename: string\n    private mTarget?: Target = undefined;\n    private mTargetLoadTry: boolean = false;\n\n    constructor(filename: string, preload = false) {\n        this.mFilename = filename\n        if (preload) {\n            this.loadFromFile()\n        }\n    }\n\n    loadFromFile(): boolean {\n        if (this.mTargetLoadTry === false) {\n            this.mTargetLoadTry = true\n            this.mTarget = new Target()\n            if (!this.mTarget.load(this.mFilename)) {\n                this.mTarget = undefined\n            }\n        }\n        return this.mTarget !== undefined\n    }\n\n    getTarget(): Target | undefined {\n        if (!this.mTargetLoadTry) {\n            this.loadFromFile()\n        }\n        return this.mTarget\n    }\n}\n","export class MultiSet<T> {\n    private array: T[] = []\n    private order: (a: T, b: T) => boolean\n    constructor(order: (a: T, b: T) => boolean = (a: T, b: T) => a < b) {\n        this.order = order\n    }\n    get size() {\n        return this.array.length\n    }\n    entries() {\n        return this.array\n    }\n    [Symbol.iterator](): IterableIterator<T> {\n        return this.array[Symbol.iterator]()\n    }\n    last() {\n        return this.array[this.array.length-1]\n    }\n    eraseLast() {\n        this.array.length = this.array.length - 1\n    }\n    first() {\n        return this.array[0]\n    }\n    eraseFirst() {\n        this.array.splice(0, 1)\n    }\n    insert(k: T) {\n        let firstIndex = 0,\n            lastIndex = this.array.length,\n            middleIndex = Math.floor((lastIndex + firstIndex) / 2)\n        while (firstIndex < lastIndex) {\n            if (this.order(k, this.array[middleIndex])) {\n                lastIndex = middleIndex - 1\n            } else {\n                if (this.order(this.array[middleIndex], k)) {\n                    firstIndex = middleIndex + 1\n                } else {\n                    break\n                }\n            }\n            middleIndex = Math.floor((lastIndex + firstIndex) / 2)\n        }\n\n        if (middleIndex >= this.array.length) {\n            this.array.push(k)\n        } else {\n            if (middleIndex < 0) {\n                this.array.splice(0, 0, k)\n            } else {\n                if (this.order(k, this.array[middleIndex])) {\n                    this.array.splice(middleIndex, 0, k)\n                } else {\n                    this.array.splice(middleIndex + 1, 0, k)\n                }\n            }\n        }\n    }\n}\n","import { vec3 } from \"gl-matrix\"\nimport { FileSystemAdapter } from \"../filesystem/FileSystemAdapter\"\nimport { Target } from \"./Target\"\nimport { VertexVector } from \"./VertexVector\"\nimport { MultiSet } from \"lib/MultiSet\"\nimport { VectorArray } from \"./VectorArray\"\n\nconst FF_VERTEX_N = 10\n\nexport class PoseTranslation {\n    private target = new Target()\n    private originalSize!: number[]\n    private formFactor = vec3.fromValues(1, 1, 1)\n    private minAngle: number = 0\n    private maxAngle: number = 0\n    /// flag\n    private normalize: boolean = false\n    inFilename?: string\n    /// Can be used to influence the order of application of rotations and translations\n    private cat: string = \"\"\n\n    private mbLimb: boolean = false\n\n    load(filename: string): boolean {\n        this.inFilename = filename\n        const info = FileSystemAdapter.readFile(`${filename}.info`)\n            .split(\"\\n\")\n            .map((it) => it.trim())\n        if (info.length < 3) {\n            return false\n        }\n        this.originalSize = info[0].split(\",\").map((it) => parseFloat(it))\n        const minMax = info[1].split(\",\")\n        this.minAngle = parseFloat(minMax[0])\n        this.maxAngle = parseFloat(minMax[1])\n        this.target.load(filename)\n        return true\n    }\n\n    getModVertex() {\n        return this.target.getModVertex()\n    }\n    calcFormFactor(vertexvector: VectorArray) {\n        // these are meant to be c++ multiset, meaning they can have duplicate values and are sorted\n        // prettier-ignore\n        let minXSet = new MultiSet<number>(), maxXSet = new MultiSet<number>(),\n            minYSet = new MultiSet<number>(), maxYSet = new MultiSet<number>(),\n            minZSet = new MultiSet<number>(), maxZSet = new MultiSet<number>()\n\n        let counter = 0\n        let n_vertex = FF_VERTEX_N\n        //         pair< set<float>::iterator, bool > pr;\n\n        const tmpTarget = this.getTarget()\n\n        if (tmpTarget.length < FF_VERTEX_N * 2) {\n            n_vertex = Math.floor(tmpTarget.length / 2)\n        }\n\n        for (const td of tmpTarget) {\n            const co = vertexvector.getVec3(td.vertex_number)\n            if (counter < n_vertex) {\n                minXSet.insert(co[0])\n                maxXSet.insert(co[0])\n                minYSet.insert(co[1])\n                maxYSet.insert(co[1])\n                minZSet.insert(co[2])\n                maxZSet.insert(co[2])\n                ++counter\n            } else {\n                if (co[0] < minXSet.last()) {\n                    minXSet.insert(co[0])\n                    minXSet.eraseLast()\n                }\n                if (co[0] > maxXSet.first()) {\n                    maxXSet.insert(co[0])\n                    maxXSet.eraseFirst()\n                }\n                if (co[1] < minYSet.last()) {\n                    minYSet.insert(co[1])\n                    minYSet.eraseLast()\n                }\n                if (co[1] > maxYSet.first()) {\n                    maxYSet.insert(co[1])\n                    maxYSet.eraseFirst()\n                }\n                if (co[2] < minZSet.last()) {\n                    minZSet.insert(co[2])\n                    minZSet.eraseLast()\n                }\n                if (co[2] > maxZSet.first()) {\n                    maxZSet.insert(co[2])\n                    maxZSet.eraseFirst()\n                }\n            }\n        }\n\n        // prettier-ignore\n        let minX = 0, maxX = 0, minY = 0, maxY = 0, minZ = 0, maxZ = 0\n        for (const it of minXSet) {\n            minX += it\n        }\n        for (const it of maxXSet) {\n            maxX += it\n        }\n        for (const it of minYSet) {\n            minY += it\n        }\n        for (const it of maxYSet) {\n            maxY += it\n        }\n        for (const it of minZSet) {\n            minZ += it\n        }\n        for (const it of maxZSet) {\n            maxZ += it\n        }\n\n        let xsize = maxXSet.size,\n            ysize = maxYSet.size,\n            zsize = maxZSet.size\n\n        this.formFactor = vec3.fromValues(\n            (maxX / xsize - minX / xsize) / this.originalSize[0],\n            (maxY / ysize - minY / ysize) / this.originalSize[1],\n            (maxZ / zsize - minZ / zsize) / this.originalSize[2]\n        )\n    }\n    getTarget() {\n        return this.target\n    }\n    getFormFactor() {\n        return this.formFactor\n    }\n    getMinAngle() {\n        return this.minAngle\n    }\n    getMaxAngle() {\n        return this.maxAngle\n    }\n    getNormalize() {\n        return this.normalize\n    }\n    setNormalize(inNormalize: boolean) {\n        this.normalize = inNormalize\n    }\n    getFilename() {\n        return this.inFilename\n    }\n    getCat() {\n        return this.cat\n    }\n    setCat(inCat: string) {\n        this.cat = inCat\n    }\n\n    setLimb(limb: boolean) {\n        this.mbLimb = limb\n    }\n    getLimb() {\n        return this.mbLimb\n    }\n}\n","import { DirectoryList } from \"./DirectoryList\"\nimport { PoseRotation } from \"./PoseRotation\"\nimport { PoseTranslation } from \"./PoseTranslation\"\nimport { vec3 } from \"gl-matrix\"\nimport { VertexVector } from \"./VertexVector\"\nimport { VectorArray } from \"./VectorArray\"\n\nexport class UnsortedUsedVertex extends Array<number> {}\n\nexport function calcCenteroid(vertexNumbers: number[], vertexvector: VectorArray): vec3 {\n    let center = vec3.create()\n    for (const vn of vertexNumbers) {\n        vec3.add(center, center, vertexvector.getVec3(vn))\n    }\n    vec3.scale(center, center, 1 / vertexNumbers.length)\n    return center\n}\n\nexport class PoseTarget {\n    // normally these vectors contain only one element\n    /// Translations to be applied on Mesh::doPose()\n    private positiveTranslations: PoseTranslation[] = []\n    /// Translations to be applied on Mesh::doPose() with morph_value < 0\n    private negativeTranslations: PoseTranslation[] = []\n    /// Rotations to be applied on Mesh::doPose()\n    private positiveRotations: PoseRotation[] = []\n    /// Rotations to be applied on Mesh::doPose() with morph_value < 0\n    private negativeRotations: PoseRotation[] = []\n\n    private targetName: string\n    /// flags whether wehave special transformations for Mesh::doPose() with morph_value < 0\n    private negative: boolean = false\n    private positive: boolean = false\n    /// flag for calcNormalizations()\n    private normalizationInited: boolean = false\n    private fullPath: string\n    private modVertex = new Set<number>()\n    private minAngle: number = 0.0\n    private maxAngle: number = 0.0\n\n    constructor(targetName: string, fullpath: string) {\n        this.targetName = targetName\n        this.fullPath = fullpath\n    }\n    load() {\n        const positive_rotation_type = \".rot\"\n        const negative_rotation_type = \"-.rot\"\n        const positive_translation_type = \".target\"\n        const negative_translation_type = \"-.target\"\n\n        const dir_list = new DirectoryList()\n        dir_list.setRootPath(this.fullPath)\n        dir_list.setRecursive(0)\n\n        const files = dir_list.getDirectoryList()\n        for (const file of files) {\n            const target_name = file.substring(this.fullPath.length + 1)\n            if (target_name.endsWith(negative_rotation_type)) {\n                const tmpRotation = new PoseRotation()\n                if (tmpRotation.load(file)) {\n                    tmpRotation.setCat(target_name.substring(0, 2))\n                    tmpRotation.setLimb(target_name.indexOf(\"LIMB\") !== -1)\n                    this.negativeRotations.push(tmpRotation)\n                    tmpRotation.getModVertex().forEach((idx) => this.modVertex.add(idx))\n                    this.negative = true\n                    this.minAngle = Math.min(this.minAngle, tmpRotation.getMinAngle())\n                }\n                continue\n            }\n            if (target_name.endsWith(positive_rotation_type)) {\n                const tmpRotation = new PoseRotation()\n                if (tmpRotation.load(file)) {\n                    tmpRotation.setCat(target_name.substring(0, 2))\n                    tmpRotation.setLimb(target_name.indexOf(\"LIMB\") !== -1)\n                    this.positiveRotations.push(tmpRotation)\n                    tmpRotation.getModVertex().forEach((idx) => this.modVertex.add(idx))\n                    this.positive = true\n                    this.maxAngle = Math.max(this.maxAngle, tmpRotation.getMaxAngle())\n                }\n                continue\n            }\n            if (target_name.endsWith(negative_translation_type)) {\n                const tmpTranslation = new PoseTranslation()\n                if (tmpTranslation.load(file)) {\n                    tmpTranslation.setCat(target_name.substring(0, 2))\n                    this.negativeTranslations.push(tmpTranslation)\n                    tmpTranslation.getModVertex().forEach((idx) => this.modVertex.add(idx))\n                    this.minAngle = Math.min(this.minAngle, tmpTranslation.getMinAngle())\n                }\n                continue\n            }\n            if (target_name.endsWith(positive_translation_type)) {\n                const tmpTranslation = new PoseTranslation()\n                if (tmpTranslation.load(file)) {\n                    tmpTranslation.setCat(target_name.substring(0, 2))\n                    this.positiveTranslations.push(tmpTranslation)\n                    tmpTranslation.getModVertex().forEach((idx) => this.modVertex.add(idx))\n                    this.maxAngle = Math.max(this.maxAngle, tmpTranslation.getMaxAngle())\n                }\n                continue\n            }\n        }\n    }\n    /// Initializes the center of all rotations with the controid of their centerVertexNumbers\n    calcRotationsCenteroids(vertexvector: VectorArray, rotations?: PoseRotation[]): void {\n        if (rotations === undefined) {\n            if (this.positive) {\n                this.calcRotationsCenteroids(vertexvector, this.positiveRotations)\n            }\n            if (this.negative) {\n                this.calcRotationsCenteroids(vertexvector, this.negativeRotations)\n            }\n        } else {\n            for (const rotations_it of rotations) {\n                rotations_it.setCenter(calcCenteroid(rotations_it.getCenterVertexNumbers(), vertexvector))\n            }\n        }\n    }\n\n    calcTranslationsFormFactors(vertexvector: VectorArray, translations?: PoseTranslation[]): void {\n        if (translations === undefined) {\n            if (this.positive) {\n                this.calcTranslationsFormFactors(vertexvector, this.positiveTranslations)\n            }\n            if (this.negative) {\n                this.calcTranslationsFormFactors(vertexvector, this.negativeTranslations)\n            }\n        } else {\n            for (const translations_it of translations) {\n                translations_it.calcFormFactor(vertexvector)\n            }\n        }\n    }\n    calcNormalizations() {\n        if (this.normalizationInited) {\n            return\n        }\n        for (const rotations_it of this.positiveRotations) {\n            if (rotations_it.getMinAngle() !== this.minAngle || rotations_it.getMaxAngle() !== this.maxAngle) {\n                rotations_it.setNormalize(true)\n            }\n        }\n        for (const rotations_it of this.negativeRotations) {\n            if (rotations_it.getMinAngle() !== this.minAngle || rotations_it.getMaxAngle() !== this.maxAngle) {\n                rotations_it.setNormalize(true)\n            }\n        }\n        for (const translations_it of this.positiveTranslations) {\n            if (translations_it.getMinAngle() !== this.minAngle || translations_it.getMaxAngle() !== this.maxAngle) {\n                translations_it.setNormalize(true)\n            }\n        }\n        for (const translations_it of this.negativeTranslations) {\n            if (translations_it.getMinAngle() !== this.minAngle || translations_it.getMaxAngle() !== this.maxAngle) {\n                translations_it.setNormalize(true)\n            }\n        }\n        this.normalizationInited = true\n    }\n    hasNegative() {\n        return this.negative\n    }\n    hasPositive() {\n        return this.positive\n    }\n    getPositiveTranslations() {\n        return this.positiveTranslations\n    }\n    getNegativeTranslations() {\n        return this.negativeTranslations\n    }\n    getPositiveRotations() {\n        return this.positiveRotations\n    }\n    getNegativeRotations() {\n        return this.negativeRotations\n    }\n    getModVertex() {\n        return this.modVertex\n    }\n    //void showCenters();\n    getMinAngle() {\n        return this.minAngle\n    }\n    getMaxAngle() {\n        return this.maxAngle\n    }\n}\n","import { PoseTarget } from \"./PoseTarget\"\n\nexport class PoseEntry {\n    private mFilename: string\n    private mFullPath: string\n    private mTarget?: PoseTarget\n    private mTargetLoadTry: boolean = false;\n    constructor(filename: string, fullPath: string, preload = false) {\n        this.mFilename = filename\n        this.mFullPath = fullPath\n        if (preload) {\n            this.loadFromFile()\n        }\n    }\n    loadFromFile(): boolean {\n        if (this.mTargetLoadTry === false) {\n            this.mTargetLoadTry = true\n            this.mTarget = new PoseTarget(this.mFilename, this.mFullPath)\n            this.mTarget.load()\n        }\n        return this.mTarget !== undefined\n    }\n    isLoaded() {\n        return this.mTargetLoadTry\n    }\n    getTarget() {\n        if (!this.mTargetLoadTry) {\n            this.loadFromFile()\n        }\n        return this.mTarget\n    }\n}\n","import { FileSystemAdapter } from \"../filesystem/FileSystemAdapter\"\nimport { StringToLine } from \"../lib/StringToLine\"\n\nclass FGroupData extends Array<number> {}\nexport class VertexData extends Map<number, number> {}\n\nexport class FGroup {\n    visible!: boolean\n    /// A vector of ints\n    facesIndexes!: FGroupData\n    facesIndexes_subd?: FGroupData ///subdivision\n}\n\nexport function isAlpha(ch: string){\n    return ch >= \"a\" && ch <= \"z\" || ch >= \"A\" && ch <= \"Z\"\n}\n\nexport class FaceGroup extends Map<string, FGroup> {\n    private loaded: boolean = false;\n    // Maps FaceGroup identifiers via vertex group numbers to vertex indices\n    private vertexes = new Map<string, VertexData>();\n    load(filename: string): boolean {\n        let fgroup_indent: string\n        const content = FileSystemAdapter.readFile(filename)\n        const reader = new StringToLine(content)\n        let lineNumber = 0\n        for (let line of reader) {\n            if (isAlpha(line.charAt(0))) {\n                fgroup_indent = line.split(\",\")[0].trim()\n            } else {\n                let data: FGroup = {\n                    visible: true,\n                    facesIndexes: line.split(\" \").map(it => parseInt(it))\n                }\n                this.set(fgroup_indent!, data)\n            }\n        }\n\n        console.log(`loaded ${this.size} face groups from ${filename}`)\n\n        // there's some code for 'visibilities' but there ain't no ones in base.parts\n        return true\n    }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2023 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\nexport class Reference {\n    constructor(object, attribute) {\n        this.object = object;\n        this.attribute = attribute.toString();\n    }\n    get() {\n        return this.object[this.attribute];\n    }\n    set(value) {\n        Object.defineProperty(this.object, this.attribute, { value: value });\n    }\n    toString() {\n        return `${this.object[this.attribute]}`;\n    }\n    fromString(value) {\n        const type = typeof this.object[this.attribute];\n        let outValue;\n        switch (type) {\n            case \"string\":\n                outValue = value;\n                break;\n            case \"number\":\n                outValue = Number.parseFloat(value);\n                break;\n            default:\n                throw Error(`Reference.fromString() isn't yet supported for type ${type}`);\n        }\n        Object.defineProperty(this.object, this.attribute, { value: outValue });\n    }\n}\nexport function ref(object, attribute) {\n    return new Reference(object, attribute);\n}\nexport function refs(object, ...attributes) {\n    return attributes.map((a) => new Reference(object, a));\n}\nexport class Fragment extends Array {\n    constructor(props) {\n        super(...props?.children);\n        for (let i = 0; i < this.length; ++i) {\n            const e = this[i];\n            if (typeof e === \"string\") {\n                this[i] = document.createTextNode(e);\n            }\n        }\n    }\n    replaceIn(element) {\n        element.replaceChildren(...this);\n    }\n    appendTo(element) {\n        for (let child of this) {\n            element.appendChild(child);\n        }\n    }\n}\n// https://reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html\nexport function jsx(nameOrConstructor, props, key) {\n    if (props !== undefined && props.children !== undefined) {\n        props.children = [props.children];\n    }\n    return jsxs(nameOrConstructor, props);\n}\nexport function jsxs(nameOrConstructor, props, key) {\n    let namespace;\n    if (typeof nameOrConstructor !== \"string\") {\n        return new nameOrConstructor(props);\n    }\n    const name = nameOrConstructor;\n    switch (name) {\n        case \"svg\":\n        case \"line\":\n        case \"rect\":\n        case \"circle\":\n        case \"path\":\n        case \"text\":\n            namespace = \"http://www.w3.org/2000/svg\";\n            break;\n        default:\n            namespace = \"http://www.w3.org/1999/xhtml\";\n    }\n    const tag = document.createElementNS(namespace, name);\n    setInitialProperties(tag, props, namespace);\n    return tag;\n}\nexport function setInitialProperties(element, props, namespace) {\n    if (props === null || props === undefined)\n        return;\n    for (let [key, value] of Object.entries(props)) {\n        switch (key) {\n            case \"children\":\n                break;\n            case \"action\":\n                ;\n                element.setAction(value);\n                break;\n            case \"model\":\n                ;\n                element.setModel(value);\n                break;\n            case \"class\":\n                element.classList.add(value); // FIXME: value is whitespace separated list\n                break;\n            case \"style\":\n                for (let [skey, svalue] of Object.entries(value)) {\n                    const regex = /[A-Z]/g;\n                    skey = skey.replace(regex, (upperCase) => \"-\" + upperCase.toLowerCase());\n                    if (typeof svalue === \"number\") {\n                        svalue = `${svalue}`;\n                    }\n                    element.style.setProperty(skey, svalue);\n                }\n                break;\n            case \"set\":\n                Object.defineProperty(props.set.object, props.set.attribute, { value: element });\n                break;\n            default:\n                if (key.substring(0, 2) === \"on\") {\n                    element.addEventListener(key.substring(2), value);\n                }\n                else {\n                    if (typeof value === \"string\" || typeof value === \"number\" || typeof value === \"boolean\") {\n                        if (namespace === \"http://www.w3.org/2000/svg\") {\n                            const regex = /[A-Z]/g;\n                            key = key.replace(regex, (upperCase) => \"-\" + upperCase.toLowerCase());\n                        }\n                        element.setAttributeNS(null, key, `${value}`);\n                    }\n                }\n        }\n    }\n    if (props.children !== undefined) {\n        appendChildren(element, props.children);\n    }\n}\nfunction appendChildren(element, children) {\n    for (const child of children) {\n        if (child instanceof Array) {\n            appendChildren(element, child);\n            continue;\n        }\n        if (typeof child === \"string\") {\n            element.appendChild(document.createTextNode(child));\n            continue;\n        }\n        element.appendChild(child);\n    }\n}\n// the FunctionConstructor is a hack for <></>\n// actually it would be nice if we could support value objects too, eg. <TableView> instead of <toad-table>\n// export function createElement(name: string, props: JSX.HTMLElementProps, ...children: any): Element\n// export function createElement(name: FunctionConstructor, props: JSX.HTMLElementProps, ...children: any): Fragment\n// export function createElement(name: string | FunctionConstructor, props: JSX.HTMLElementProps, ...children: any): Element | Fragment {\n// }\n// backward compability\nexport function createElement(nameOrConstructor, props, ...children) {\n    // console.log(`createElement(${nameOrConstructor}, ${JSON.stringify(props)}, ${children}`)\n    // props: remove 'key', add 'children'\n    let key;\n    if (props !== null) {\n        if (\"key\" in props) {\n            key = props.key;\n            delete props.key;\n        }\n        if (children !== undefined) {\n            props.children = children;\n        }\n    }\n    else {\n        if (children !== undefined)\n            props = { children };\n    }\n    return jsxs(nameOrConstructor, props, key);\n}\n//# sourceMappingURL=jsx-runtime.js.map","export function css(strings, ...values) {\n    let str = strings[0];\n    values.forEach((s, i) => {\n        str = str.concat(s).concat(strings[i + 1]);\n    });\n    return str;\n}\nexport function html(strings, ...values) {\n    let str = strings[0];\n    values.forEach((s, i) => {\n        str = str.concat(s).concat(strings[i + 1]);\n    });\n    return str;\n}\nexport function element(type, children) {\n    const element = document.createElement(type);\n    for (let i = 0; i < children.length; ++i) {\n        let child = children[i];\n        if (child instanceof Array) {\n            children.splice(i, 1, ...child);\n            child = children[i];\n        }\n        if (typeof child === \"string\") {\n            element.appendChild(document.createTextNode(child));\n            continue;\n        }\n        element.appendChild(child);\n    }\n    return element;\n}\nexport function array(times, create) {\n    let a = [];\n    for (let i = 0; i < times; ++i) {\n        const c = create(i);\n        if (c instanceof Array) {\n            a.push(...c);\n        }\n        else {\n            a.push(c);\n        }\n    }\n    return a;\n}\nexport function text(text) { return document.createTextNode(text); }\nexport const div = (...children) => element(\"div\", children);\nexport const span = (...children) => element(\"span\", children);\nexport const slot = (...children) => element(\"slot\", children);\nexport const form = (...children) => element(\"form\", children);\nexport const input = (...children) => element(\"input\", children);\nexport const button = (...children) => element(\"button\", children);\nexport const label = (...children) => element(\"label\", children);\nexport const ul = (...children) => element(\"ul\", children);\nexport const ol = (...children) => element(\"ol\", children);\nexport const li = (...children) => element(\"li\", children);\nexport const table = (...children) => element(\"table\", children);\nexport const thead = (...children) => element(\"thead\", children);\nexport const th = (...children) => element(\"th\", children);\nexport const tbody = (...children) => element(\"tbody\", children);\nexport const td = (...children) => element(\"td\", children);\nexport const tr = (...children) => element(\"tr\", children);\nconst ns = \"http://www.w3.org/2000/svg\";\nexport function svg(child) {\n    const s = document.createElementNS(ns, \"svg\");\n    if (child !== undefined) {\n        s.appendChild(child);\n    }\n    return s;\n}\nexport function path(d) {\n    const p = document.createElementNS(ns, \"path\");\n    if (d !== undefined) {\n        p.setAttributeNS(null, \"d\", d);\n    }\n    return p;\n}\nexport function rect(x, y, width, height, stroke, fill) {\n    const r = document.createElementNS(ns, \"rect\");\n    r.setAttributeNS(null, \"x\", `${x}`);\n    r.setAttributeNS(null, \"y\", `${y}`);\n    r.setAttributeNS(null, \"width\", `${width}`);\n    r.setAttributeNS(null, \"height\", `${height}`);\n    if (stroke !== undefined) {\n        r.setAttributeNS(null, \"stroke\", stroke);\n    }\n    if (fill !== undefined) {\n        r.setAttributeNS(null, \"fill\", fill);\n    }\n    return r;\n}\nexport function line(x1, y1, x2, y2, stroke, fill) {\n    const l = document.createElementNS(ns, \"line\");\n    l.setAttributeNS(null, \"x1\", `${x1}`);\n    l.setAttributeNS(null, \"y1\", `${y1}`);\n    l.setAttributeNS(null, \"x2\", `${x2}`);\n    l.setAttributeNS(null, \"y2\", `${y2}`);\n    if (stroke !== undefined) {\n        l.setAttributeNS(null, \"stroke\", stroke);\n    }\n    if (fill !== undefined) {\n        l.setAttributeNS(null, \"fill\", fill);\n    }\n    return l;\n}\nexport function svgAndUse(ref) {\n    const ns = \"http://www.w3.org/2000/svg\";\n    const s = document.createElementNS(ns, \"svg\");\n    const u = document.createElementNS(ns, \"use\");\n    u.setAttributeNS(ns, \"href\", ref);\n    u.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', ref);\n    s.appendChild(u);\n    return s;\n}\n//# sourceMappingURL=lsx.js.map","export class SignalLink {\n    constructor(callback, id) {\n        this.callback = callback;\n        this.id = id;\n    }\n}\nexport class Signal {\n    constructor() {\n        this.locked = false;\n        this.busy = false;\n    }\n    add(callback, id) {\n        if (!this.callbacks)\n            this.callbacks = new Array();\n        this.callbacks.push(new SignalLink(callback, id));\n    }\n    remove(id) {\n        if (!this.callbacks)\n            return;\n        for (let i = this.callbacks.length - 1; i >= 0; --i) {\n            if (this.callbacks[i].id === id)\n                this.callbacks.splice(i, 1);\n        }\n    }\n    count() {\n        if (!this.callbacks)\n            return 0;\n        return this.callbacks.length;\n    }\n    lock() {\n        this.locked = true;\n    }\n    unlock() {\n        this.locked = false;\n        if (this.triggered) {\n            let data = this.triggered.data;\n            this.triggered = undefined;\n            this.trigger(data);\n        }\n    }\n    withLock(closure) {\n        this.lock();\n        const r = closure();\n        this.unlock();\n        return r;\n    }\n    trigger(data) {\n        if (this.busy) {\n            return;\n        }\n        this.busy = true;\n        if (this.locked) {\n            this.triggered = { data: data };\n            this.busy = false;\n            return;\n        }\n        if (!this.callbacks) {\n            this.busy = false;\n            return;\n        }\n        let error;\n        for (let i = 0; i < this.callbacks.length; ++i) {\n            try {\n                this.callbacks[i].callback(data);\n            }\n            catch (e) {\n                error = e;\n            }\n        }\n        this.busy = false;\n        if (error !== undefined) {\n            throw error;\n        }\n    }\n}\n//# sourceMappingURL=Signal.js.map","import { Signal } from \"../Signal.js\";\nexport var ModelReason;\n(function (ModelReason) {\n    ModelReason[ModelReason[\"ALL\"] = 0] = \"ALL\";\n    ModelReason[ModelReason[\"VALUE\"] = 1] = \"VALUE\";\n    ModelReason[ModelReason[\"ENABLED\"] = 2] = \"ENABLED\";\n    ModelReason[ModelReason[\"COLOR\"] = 3] = \"COLOR\";\n    ModelReason[ModelReason[\"LABEL\"] = 4] = \"LABEL\";\n    ModelReason[ModelReason[\"DESCRIPTION\"] = 5] = \"DESCRIPTION\";\n    ModelReason[ModelReason[\"ERROR\"] = 6] = \"ERROR\";\n    ModelReason[ModelReason[\"MAX_REASON\"] = 7] = \"MAX_REASON\";\n})(ModelReason || (ModelReason = {}));\nexport class Model {\n    constructor(options) {\n        this.modified = new Signal();\n        this.options = options;\n    }\n    set enabled(enabled) {\n        if (this.options?.enabled === enabled)\n            return;\n        if (this.options === undefined) {\n            this.options = {};\n        }\n        this.options.enabled = enabled;\n        this.modified.trigger(ModelReason.ENABLED);\n    }\n    get enabled() { return this.options?.enabled !== false; }\n    set color(color) {\n        if (this.options?.color === color)\n            return;\n        if (this.options === undefined) {\n            this.options = {};\n        }\n        this.options.color = color;\n        this.modified.trigger(ModelReason.COLOR);\n    }\n    get color() { return this.options?.color; }\n    set label(label) {\n        if (this.options?.label === label)\n            return;\n        if (this.options === undefined) {\n            this.options = {};\n        }\n        this.options.label = label;\n        this.modified.trigger(ModelReason.LABEL);\n    }\n    get label() { return this.options?.label; }\n    set description(description) {\n        if (this.options?.description === description)\n            return;\n        if (this.options === undefined) {\n            this.options = {};\n        }\n        this.options.description = description;\n        this.modified.trigger(ModelReason.DESCRIPTION);\n    }\n    get description() { return this.options?.description; }\n    set error(error) {\n        if (this.options?.error === error)\n            return;\n        if (this.options === undefined) {\n            this.options = {};\n        }\n        this.options.error = error;\n        this.modified.trigger(ModelReason.ERROR);\n    }\n    get error() { return this.options?.error; }\n    applyStyle(element) {\n        if (this.enabled) {\n            element.removeAttribute(\"disabled\");\n        }\n        else {\n            element.setAttribute(\"disabled\", \"disabled\");\n        }\n        if (this.color !== undefined) {\n            element.style.fontStyle = \"\";\n            element.style.fontWeight = \"\";\n            element.style.color = \"\";\n            switch (this.color) {\n                case \"italic\":\n                    element.style.fontStyle = \"italic\";\n                    break;\n                case \"bold\":\n                    element.style.fontWeight = \"bold\";\n                    break;\n                default:\n                    element.style.color = this.color;\n            }\n        }\n        else {\n            element.style.color = \"\";\n            element.style.fontStyle = \"\";\n            element.style.fontWeight = \"\";\n        }\n        if (this.error !== undefined) {\n            element.classList.add(\"tx-error\");\n        }\n        else {\n            element.classList.remove(\"tx-error\");\n        }\n    }\n}\n//# sourceMappingURL=Model.js.map","import { Model, ModelReason } from \"./Model.js\";\nexport var ValueModelReason;\n(function (ValueModelReason) {\n    ValueModelReason[ValueModelReason[\"DEFAULT\"] = 7] = \"DEFAULT\";\n    ValueModelReason[ValueModelReason[\"MAX_REASON\"] = 8] = \"MAX_REASON\";\n})(ValueModelReason || (ValueModelReason = {}));\nexport class AbstractValueModel extends Model {\n    set default(aDefault) {\n        if (this.options?.default === aDefault)\n            return;\n        if (this.options === undefined) {\n            this.options = {};\n        }\n        this.options.default = aDefault;\n        this.modified.trigger(ValueModelReason.DEFAULT);\n    }\n    get default() {\n        return this.options?.default;\n    }\n    resetToDefault() {\n        const d = this.default;\n        if (d !== undefined) {\n            this.value = d;\n        }\n    }\n}\nexport class ValueModel extends AbstractValueModel {\n    constructor(value, options) {\n        super(options);\n        this._value = value;\n    }\n    set value(value) {\n        if (this._value === value)\n            return;\n        this._value = value;\n        this.modified.trigger(ModelReason.VALUE);\n    }\n    get value() {\n        return this._value;\n    }\n}\n//# sourceMappingURL=ValueModel.js.map","import { ValueModel } from \"./ValueModel.js\";\nimport { BigDecimal } from \"../util/BigDecimal.js\";\nimport { expression } from \"../util/expressions/expression.js\";\nexport var NumberModelReason;\n(function (NumberModelReason) {\n    NumberModelReason[NumberModelReason[\"MIN\"] = 8] = \"MIN\";\n    NumberModelReason[NumberModelReason[\"MAX\"] = 9] = \"MAX\";\n    NumberModelReason[NumberModelReason[\"STEP\"] = 10] = \"STEP\";\n    NumberModelReason[NumberModelReason[\"AUTOCORRECT\"] = 11] = \"AUTOCORRECT\";\n    NumberModelReason[NumberModelReason[\"MAX_REASON\"] = 12] = \"MAX_REASON\";\n})(NumberModelReason || (NumberModelReason = {}));\nexport class NumberModel extends ValueModel {\n    constructor(value, options) {\n        super(value, options);\n    }\n    increment() {\n        if (this.step !== undefined) {\n            const value = new BigDecimal(this.value);\n            const step = new BigDecimal(this.step);\n            this.value = this.clip(parseFloat(value.add(step).toString()));\n        }\n    }\n    decrement() {\n        if (this.step !== undefined) {\n            const value = new BigDecimal(this.value);\n            const step = new BigDecimal(this.step);\n            this.value = this.clip(parseFloat(value.sub(step).toString()));\n        }\n    }\n    set value(value) {\n        let number;\n        if (typeof value === \"string\") {\n            const ex = expression(value);\n            number = ex.eval();\n        }\n        else {\n            number = value;\n        }\n        this.modified.withLock(() => {\n            if (this.autocorrect) {\n                super.value = this.clip(number);\n            }\n            else {\n                super.value = number;\n                this.error = this.check(number);\n            }\n        });\n    }\n    get value() {\n        return super.value;\n    }\n    set min(min) {\n        if (this.options?.min === min)\n            return;\n        if (this.options === undefined) {\n            this.options = {};\n        }\n        this.options.min = min;\n        this.modified.trigger(NumberModelReason.MIN);\n    }\n    get min() {\n        return this.options?.min;\n    }\n    set max(max) {\n        if (this.options?.max === max)\n            return;\n        if (this.options === undefined) {\n            this.options = {};\n        }\n        this.options.max = max;\n        this.modified.trigger(NumberModelReason.MAX);\n    }\n    get max() {\n        return this.options?.max;\n    }\n    set step(step) {\n        if (this.options?.step === step)\n            return;\n        if (this.options === undefined) {\n            this.options = {};\n        }\n        this.options.step = step;\n        this.modified.trigger(NumberModelReason.STEP);\n    }\n    get step() {\n        return this.options?.step;\n    }\n    set autocorrect(autocorrect) {\n        if (this.options?.autocorrect === autocorrect)\n            return;\n        if (this.options === undefined) {\n            this.options = {};\n        }\n        this.options.autocorrect = autocorrect;\n        this.modified.trigger(NumberModelReason.AUTOCORRECT);\n    }\n    get autocorrect() {\n        return this.options?.autocorrect === true;\n    }\n    clip(value) {\n        if (this.min !== undefined && value < this.min) {\n            value = this.min;\n        }\n        if (this.max !== undefined && value > this.max) {\n            value = this.max;\n        }\n        return value;\n    }\n    check(value) {\n        if (this.min !== undefined && value < this.min) {\n            return `The value must not be below ${this.min}.`;\n        }\n        if (this.max !== undefined && value > this.max) {\n            if (this.autocorrect) {\n                value = this.max;\n            }\n            else {\n                return `The value must not be above ${this.max}.`;\n            }\n        }\n        return undefined;\n    }\n}\n//# sourceMappingURL=NumberModel.js.map","import { ValueModel } from \"./ValueModel.js\";\nexport class BooleanModel extends ValueModel {\n    constructor(value, options) {\n        super(value, options);\n    }\n}\n//# sourceMappingURL=BooleanModel.js.map","export class BigDecimal {\n    constructor(value) {\n        this._n = 0n;\n        if (value instanceof BigDecimal)\n            return value;\n        let [ints, decis] = String(value).split(\".\").concat(\"\");\n        this._n = BigInt(ints + decis.padEnd(BigDecimal.DECIMALS, \"0\")\n            .slice(0, BigDecimal.DECIMALS))\n            + BigInt(BigDecimal.ROUNDED && decis[BigDecimal.DECIMALS] >= \"5\");\n    }\n    static fromBigInt(bigint) {\n        return Object.assign(Object.create(BigDecimal.prototype), { _n: bigint });\n    }\n    add(num) {\n        return BigDecimal.fromBigInt(this._n + new BigDecimal(num)._n);\n    }\n    sub(num) {\n        return BigDecimal.fromBigInt(this._n - new BigDecimal(num)._n);\n    }\n    static _divRound(dividend, divisor) {\n        return BigDecimal.fromBigInt(dividend / divisor\n            + (BigDecimal.ROUNDED ? dividend * 2n / divisor % 2n : 0n));\n    }\n    mul(num) {\n        return BigDecimal._divRound(this._n * new BigDecimal(num)._n, BigDecimal.SHIFT);\n    }\n    div(num) {\n        return BigDecimal._divRound(this._n * BigDecimal.SHIFT, new BigDecimal(num)._n);\n    }\n    toString() {\n        const s = this._n.toString().padStart(BigDecimal.DECIMALS + 1, \"0\");\n        return s.slice(0, -BigDecimal.DECIMALS) + \".\" + s.slice(-BigDecimal.DECIMALS)\n            .replace(/\\.?0+$/, \"\");\n    }\n}\nBigDecimal.DECIMALS = 18;\nBigDecimal.ROUNDED = true;\nBigDecimal.SHIFT = BigInt(\"1\" + \"0\".repeat(BigDecimal.DECIMALS));\n//# sourceMappingURL=BigDecimal.js.map","export class ExpressionNode {\n    constructor(value) {\n        this.value = value;\n    }\n    eval(model) {\n        if (typeof this.value === \"number\") {\n            return this.value;\n        }\n        if (this.value instanceof Array) {\n            if (model === undefined) {\n                throw Error(`yikes: no model to get cell [${this.value[0]},${this.value[1]}]`);\n            }\n            return model.getCell(this.value[0], this.value[1])._calculatedValue;\n        }\n        switch (this.value) {\n            case '+':\n                return this.down.eval(model) + this.down.next.eval(model);\n            case '-':\n                if (this.down?.next) {\n                    return this.down.eval(model) - this.down.next.eval(model);\n                }\n                return -this.down.eval(model);\n            case '*':\n                return this.down.eval(model) * this.down.next.eval(model);\n            case '/':\n                return this.down.eval(model) / this.down.next.eval(model);\n            default:\n                throw Error(`unexpected token '${this.value}'`);\n        }\n    }\n    append(node) {\n        if (this.down === undefined) {\n            this.down = node;\n        }\n        else {\n            let n = this.down;\n            while (n.next) {\n                n = n.next;\n            }\n            n.next = node;\n        }\n    }\n    dependencies(deps = []) {\n        if (this.value instanceof Array) {\n            deps.push(this.value);\n        }\n        if (this.next) {\n            this.next.dependencies(deps);\n        }\n        if (this.down) {\n            this.down.dependencies(deps);\n        }\n        return deps;\n    }\n    toString() {\n        return this._toString();\n    }\n    _toString(out = \"\\n\", indent = 0) {\n        for (let i = 0; i < indent; ++i) {\n            out += \"    \";\n        }\n        out += this.value;\n        out += \"\\n\";\n        for (let n = this.down; n; n = n.next) {\n            out = n._toString(out, indent + 1);\n        }\n        return out;\n    }\n}\n//# sourceMappingURL=ExpressionNode.js.map","import { ExpressionNode } from \"./ExpressionNode.js\";\nexport class Lexer {\n    constructor(str) {\n        this.i = 0;\n        this.stack = [];\n        this.str = str;\n    }\n    isspace(c) {\n        return c == ' ' || c == '\\n' || c == '\\r' || c == '\\t' || c == '\\t';\n    }\n    isnumber(c) {\n        const code = c.charCodeAt(0);\n        return code >= 0x30 && code <= 0x39;\n    }\n    isalpha(c) {\n        const code = c.charCodeAt(0);\n        return code >= 0x41 && code <= 0x5a || code >= 0x91 && code <= 0x7a;\n    }\n    isalnum(c) {\n        return this.isnumber(c) || this.isalpha(c);\n    }\n    unlex(node) {\n        this.stack.push(node);\n    }\n    lex() {\n        if (this.stack.length > 0) {\n            return this.stack.pop();\n        }\n        let col = 0, row = 0;\n        let state = 0;\n        if (this.i >= this.str.length) {\n            return undefined;\n        }\n        const start = this.i;\n        while (true) {\n            let c = this.str.at(this.i);\n            switch (state) {\n                case 0:\n                    if (c === undefined) {\n                        return undefined;\n                    }\n                    if (this.isspace(c)) {\n                        ++this.i;\n                        break;\n                    }\n                    if (this.isnumber(c)) {\n                        ++this.i;\n                        state = 1;\n                        break;\n                    }\n                    if (this.isalpha(c)) {\n                        col = 0;\n                        state = 3;\n                        break;\n                    }\n                    switch (c) {\n                        case '+':\n                        case '-':\n                        case '*':\n                        case '/':\n                        case '(':\n                        case ')':\n                        case '=':\n                            ++this.i;\n                            return new ExpressionNode(c);\n                    }\n                    return undefined;\n                case 1:\n                    if (c !== undefined && this.isnumber(c)) {\n                        ++this.i;\n                        break;\n                    }\n                    if (c === '.' || c == 'e' || c == 'E') {\n                        ++this.i;\n                        state = 2;\n                        break;\n                    }\n                    return new ExpressionNode(parseFloat(this.str.substring(start, this.i)));\n                case 2:\n                    if (c !== undefined && this.isnumber(c)) {\n                        ++this.i;\n                        break;\n                    }\n                    return new ExpressionNode(parseFloat(this.str.substring(start, this.i)));\n                case 3:\n                    if (c !== undefined) {\n                        const code = c.charCodeAt(0);\n                        if (code >= 0x30 && code <= 0x39) {\n                            row = code - 0x30;\n                            state = 4;\n                            ++this.i;\n                            break;\n                        }\n                        if (code >= 0x41 && code <= 0x5a) {\n                            col *= 26;\n                            col += code - 0x40;\n                            ++this.i;\n                            break;\n                        }\n                        if (code >= 0x91 && code <= 0x7a) {\n                            col *= 26;\n                            col += code - 0x90;\n                            ++this.i;\n                            break;\n                        }\n                    }\n                    return new ExpressionNode(this.str.substring(start, this.i));\n                case 4:\n                    if (c !== undefined) {\n                        const code = c.charCodeAt(0);\n                        if (code >= 0x30 && code <= 0x39) {\n                            row *= 10;\n                            row += code - 0x30;\n                            ++this.i;\n                            break;\n                        }\n                    }\n                    return new ExpressionNode([col - 1, row - 1]);\n            }\n        }\n    }\n}\n//# sourceMappingURL=Lexer.js.map","import { Lexer } from \"./Lexer.js\";\nexport function assignmentExpression(expr) {\n    const lexer = new Lexer(expr);\n    const n0 = lexer.lex();\n    if (n0 === undefined || n0.value !== '=') {\n        return undefined;\n    }\n    return additive_expression(lexer);\n}\nexport function expression(expr) {\n    const lexer = new Lexer(expr);\n    return additive_expression(lexer);\n}\nfunction additive_expression(lexer) {\n    const n0 = multiplicative_expression(lexer);\n    if (n0 === undefined) {\n        return undefined;\n    }\n    const n1 = lexer.lex();\n    if (n1 === undefined) {\n        return n0;\n    }\n    if (n1.value === \"+\" || n1.value === \"-\") {\n        const n2 = additive_expression(lexer);\n        if (n2 === undefined) {\n            lexer.unlex(n1);\n            return n0;\n        }\n        n1.append(n0);\n        n1.append(n2);\n        return n1;\n    }\n    lexer.unlex(n1);\n    return n0;\n}\nfunction multiplicative_expression(lexer) {\n    const n0 = unary_expression(lexer);\n    if (n0 === undefined) {\n        return undefined;\n    }\n    const n1 = lexer.lex();\n    if (n1 === undefined) {\n        return n0;\n    }\n    if (n1.value === \"*\" || n1.value === \"/\") {\n        const n2 = multiplicative_expression(lexer);\n        if (n2 === undefined) {\n            throw Error(`expexted expression after ${n1.value}`);\n        }\n        n1.append(n0);\n        n1.append(n2);\n        return n1;\n    }\n    lexer.unlex(n1);\n    return n0;\n}\nfunction unary_expression(lexer) {\n    const n0 = lexer.lex();\n    if (n0 === undefined) {\n        return undefined;\n    }\n    if (typeof n0.value === \"number\") {\n        return n0;\n    }\n    if (n0.value instanceof Array) {\n        return n0;\n    }\n    if (n0.value === \"(\") {\n        const n1 = additive_expression(lexer);\n        if (n1 === undefined) {\n            throw Error(\"Unexpected end after '(\");\n        }\n        const n2 = lexer.lex();\n        if (n2?.value !== ')') {\n            throw Error(\"Excepted ')\");\n        }\n        return n1;\n    }\n    if (n0.value === \"-\") {\n        const n1 = unary_expression(lexer);\n        if (n1 !== undefined) {\n            n0.append(n1);\n            return n0;\n        }\n    }\n    lexer.unlex(n0);\n    return undefined;\n}\n//# sourceMappingURL=expression.js.map","import { ModelReason } from \"./Model.js\";\nimport { AbstractValueModel } from \"./ValueModel.js\";\nexport class TextModel extends AbstractValueModel {\n    constructor(value = \"\", options) {\n        super(options);\n        this.value = value;\n    }\n    set promise(promise) {\n        this._value = promise;\n        this.modified.trigger(ModelReason.VALUE);\n    }\n    get promise() {\n        if (typeof this._value === \"string\") {\n            const value = this._value;\n            return () => {\n                return value;\n            };\n        }\n        return this._value;\n    }\n    set value(value) {\n        if (this._value === value) {\n            return;\n        }\n        if (typeof value !== \"string\") {\n            console.trace(`TextModel.set value(value: string): ${typeof value} is not type string`);\n            return;\n        }\n        this.modified.withLock(() => {\n            this.error = undefined;\n            this._value = value;\n            this.modified.trigger(ModelReason.VALUE);\n        });\n    }\n    get value() {\n        switch (typeof this._value) {\n            case \"number\":\n            case \"string\":\n                this._value = `${this._value}`;\n                break;\n            case \"function\":\n                this._value = this._value();\n                break;\n        }\n        return this._value;\n    }\n}\n//# sourceMappingURL=TextModel.js.map","import { TextModel } from \"./TextModel.js\";\nexport class HtmlModel extends TextModel {\n    constructor(value, options) {\n        super(value, options);\n    }\n}\n//# sourceMappingURL=HtmlModel.js.map","import { Model } from \"./Model.js\";\nimport { Signal } from \"../Signal.js\";\nexport class Action extends Model {\n    constructor(callback) {\n        super();\n        this.signal = new Signal();\n        this.signal.add(callback);\n    }\n    set value(_) {\n        throw Error(\"Action.value can not be assigned a value\");\n    }\n    get value() {\n        throw Error(\"Action.value can not return a value\");\n    }\n    trigger(data) {\n        if (!this.enabled) {\n            return;\n        }\n        this.signal.trigger(data);\n    }\n}\n//# sourceMappingURL=Action.js.map","export function instantiateTemplate(name) {\n    return tmpl(name);\n}\nexport function tmpl(name) {\n    let t = document.querySelector('template[id=\"' + name + '\"]');\n    if (!t) {\n        throw new Error(\"failed to find template '\" + name + \"'\");\n    }\n    let x = t;\n    let z = x.content;\n    let y = document.importNode(z, true);\n    return y;\n}\nexport function find(node, selector) {\n    return node.querySelector(selector);\n}\nexport function tag(name) {\n    return document.createElement(name);\n}\nexport function txt(txt) {\n    return document.createTextNode(txt);\n}\nexport function img(src) {\n    let img = document.createElement(\"img\");\n    img.src = src;\n    return img;\n}\nexport function add(n0, n1) {\n    n0.appendChild(n1);\n}\nexport function remove(n) {\n    if (!n.parentNode)\n        throw Error(\"element has no parent\");\n    n.parentNode.removeChild(n);\n}\nexport function erase(n) {\n    n.replaceChildren();\n}\nexport function hasFocus(element) {\n    let active = document.activeElement;\n    while (active !== null) {\n        if (active === element) {\n            return true;\n        }\n        if (active.shadowRoot === null)\n            break;\n        active = active.shadowRoot.activeElement;\n    }\n    return false;\n}\nexport function grabMouse(event) {\n    let target = event.target;\n    let documentMouseMove = (event) => {\n        target.dispatchEvent(new MouseEvent(\"mousemove\", event));\n        event.stopPropagation();\n    };\n    let documentMouseUp = (event) => {\n        target.dispatchEvent(new MouseEvent(\"mouseup\", event));\n        document.removeEventListener(\"mousemove\", documentMouseMove, { capture: true });\n        document.removeEventListener(\"mouseup\", documentMouseUp, { capture: true });\n        document.body.style.pointerEvents = \"auto\";\n        event.stopPropagation();\n    };\n    document.addEventListener(\"mousemove\", documentMouseMove, { capture: true });\n    document.addEventListener(\"mouseup\", documentMouseUp, { capture: true });\n    document.body.style.pointerEvents = \"none\";\n    event.preventDefault();\n    event.stopPropagation();\n}\nexport function attribute(element, name) {\n    let attribute = element.getAttribute(name);\n    if (attribute === null) {\n        console.log(\"missing attribute '\" + name + \"' in \", element);\n        throw Error(\"missing attribute '\" + name + \"' in \" + element.nodeName);\n    }\n    return attribute;\n}\nexport function attributeOrUndefined(element, name) {\n    let attribute = element.getAttribute(name);\n    return attribute === null ? undefined : attribute;\n}\nexport function isNodeBeforeNode(first, second) {\n    let node;\n    let firstPrevious = first;\n    node = first;\n    let parentsOfFirstNode = new Map();\n    while (true) {\n        firstPrevious = node;\n        node = node.parentNode;\n        if (!node)\n            break;\n        parentsOfFirstNode.set(node, firstPrevious);\n    }\n    let secondPrevious = second;\n    node = second;\n    while (node) {\n        secondPrevious = node;\n        node = node.parentNode;\n        if (!node) {\n            throw Error(`isNodeBeforeNode(first, second): nodes have no common parent`);\n        }\n        let lookup = parentsOfFirstNode.get(node);\n        if (lookup) {\n            firstPrevious = lookup;\n            break;\n        }\n    }\n    for (let child of node.childNodes) {\n        if (child === firstPrevious)\n            return true;\n        if (child === secondPrevious)\n            return false;\n    }\n    throw Error(\"isNodeBeforeNode(first, second): couldn't determine order of nodes\");\n}\nexport function pixelToNumber(pixel) {\n    if (pixel === \"\")\n        return 0;\n    if (pixel.substr(pixel.length - 2) !== \"px\")\n        throw Error(`pixelToNumber('${pixel}') expected 'px' suffix`);\n    return Number.parseFloat(pixel.substr(0, pixel.length - 2));\n}\nexport function getPropertyValue(element, propertyName) {\n    let elementStyle = window.getComputedStyle(element, undefined);\n    let property = elementStyle.getPropertyValue(propertyName);\n    return pixelToNumber(property);\n}\nexport function horizontalPadding(element) {\n    return getPropertyValue(element, \"padding-left\") + getPropertyValue(element, \"padding-right\");\n}\nexport function verticalPadding(element) {\n    return getPropertyValue(element, \"padding-top\") + getPropertyValue(element, \"padding-bottom\");\n}\n//# sourceMappingURL=dom.js.map","import { Controller } from \"./Controller.js\";\nexport let globalController = new Controller();\nexport function bindModel(modelId, model) {\n    globalController.bind(modelId, model);\n}\nexport function action(actionId, action) {\n    return globalController.registerAction(actionId, action);\n}\nexport function unbind() {\n    globalController.clear();\n}\nexport function text(modelId, value) {\n    return globalController.text(modelId, value);\n}\nexport function boolean(modelId, value) {\n    return globalController.boolean(modelId, value);\n}\n//# sourceMappingURL=globalController.js.map","import { BooleanModel } from \"../model/BooleanModel.js\";\nimport { NumberModel } from \"../model/NumberModel.js\";\nimport { HtmlModel } from \"../model/HtmlModel.js\";\nimport { TextModel } from \"../model/TextModel.js\";\nimport { Action } from \"../model/Action.js\";\nimport { Signal } from \"../Signal.js\";\nexport class Controller {\n    constructor() {\n        this.modelId2Models = new Map();\n        this.modelId2Views = new Map();\n        this.view2ModelIds = new Map();\n        this.sigChanged = new Signal();\n    }\n    registerAction(actionId, callback) {\n        let action = new Action(callback);\n        action.signal.add(callback);\n        this._registerModel(\"A:\" + actionId, action);\n        return action;\n    }\n    registerModel(modelId, model) {\n        this._registerModel(\"M:\" + modelId, model);\n    }\n    _registerModel(modelId, model) {\n        let modelsForModelId = this.modelId2Models.get(modelId);\n        if (!modelsForModelId) {\n            modelsForModelId = new Set();\n            this.modelId2Models.set(modelId, modelsForModelId);\n        }\n        modelsForModelId.add(model);\n        let viewsForModelId = this.modelId2Views.get(modelId);\n        if (!viewsForModelId)\n            return;\n        for (let view of viewsForModelId) {\n            view.setModel(model);\n        }\n    }\n    registerView(modelId, view) {\n        if (view.controller && view.controller !== this) {\n            console.log(\"error: attempt to register view more than once at different controllers\");\n            return;\n        }\n        view.controller = this;\n        let modelIdsForView = this.view2ModelIds.get(view);\n        if (!modelIdsForView) {\n            modelIdsForView = new Set();\n            this.view2ModelIds.set(view, modelIdsForView);\n        }\n        modelIdsForView.add(modelId);\n        let viewsForModelId = this.modelId2Views.get(modelId);\n        if (!viewsForModelId) {\n            viewsForModelId = new Set();\n            this.modelId2Views.set(modelId, viewsForModelId);\n        }\n        viewsForModelId.add(view);\n        let modelsForView = this.modelId2Models.get(modelId);\n        if (!modelsForView)\n            return;\n        for (let model of modelsForView) {\n            view.setModel(model);\n        }\n    }\n    unregisterView(view) {\n        if (!view.controller)\n            return;\n        if (view.controller !== this)\n            throw Error(\"attempt to unregister view from wrong controller\");\n        let modelIds = this.view2ModelIds.get(view);\n        if (!modelIds)\n            return;\n        for (let modelId of modelIds) {\n            let views = this.modelId2Views.get(modelId);\n            if (!views)\n                continue;\n            views.delete(view);\n            if (views.size === 0) {\n                this.modelId2Views.delete(modelId);\n            }\n            view.setModel(undefined);\n        }\n    }\n    clear() {\n        for (let entry of this.view2ModelIds) {\n            entry[0].setModel(undefined);\n        }\n        this.modelId2Models.clear();\n        this.modelId2Views.clear();\n        this.view2ModelIds.clear();\n    }\n    bind(modelId, model) {\n        this.registerModel(modelId, model);\n    }\n    action(actionId, callback) {\n        return this.registerAction(actionId, callback);\n    }\n    text(modelId, value) {\n        let model = new TextModel(value);\n        this.bind(modelId, model);\n        return model;\n    }\n    html(modelId, value) {\n        let model = new HtmlModel(value);\n        this.bind(modelId, model);\n        return model;\n    }\n    boolean(modelId, value) {\n        let model = new BooleanModel(value);\n        this.bind(modelId, model);\n        return model;\n    }\n    number(modelId, value, options) {\n        let model = new NumberModel(value, options);\n        this.bind(modelId, model);\n        return model;\n    }\n}\n//# sourceMappingURL=Controller.js.map","export class AnimationBase {\n    constructor() {\n        this._stop = false;\n        this._firstFrame = this._firstFrame.bind(this);\n        this._animationFrame = this._animationFrame.bind(this);\n    }\n    start() {\n        this.prepare();\n        if (this._stop === true)\n            return;\n        this.requestAnimationFrame(this._firstFrame);\n    }\n    stop() {\n        this._stop = true;\n        if (this.animator?.current === this) {\n            this.animator.clearCurrent();\n        }\n    }\n    replace(animation) {\n        this.next = animation;\n        this.animationFrame(1);\n        this.lastFrame();\n        animation.prepare();\n    }\n    prepare() { }\n    firstFrame() { }\n    animationFrame(value) { }\n    lastFrame() { }\n    requestAnimationFrame(callback) {\n        window.requestAnimationFrame(callback);\n    }\n    _firstFrame(time) {\n        this.startTime = time;\n        this.firstFrame();\n        if (this._stop)\n            return;\n        this.animationFrame(0);\n        this.requestAnimationFrame(this._animationFrame);\n    }\n    _animationFrame(time) {\n        if (this.next) {\n            this.next._firstFrame(time);\n            return;\n        }\n        let elapsed = AnimationBase.animationFrameCount > 0 ? (time - this.startTime) / AnimationBase.animationFrameCount : 1;\n        elapsed = elapsed > 1 ? 1 : elapsed;\n        const value = this.ease(elapsed);\n        this.animationFrame(value);\n        if (this._stop) {\n            return;\n        }\n        if (value < 1.0) {\n            this.requestAnimationFrame(this._animationFrame.bind(this));\n        }\n        else {\n            this.lastFrame();\n            if (this.animator && this.animator._current === this) {\n                this.animator.clearCurrent();\n            }\n        }\n    }\n    ease(k) {\n        return 0.5 * (1 - Math.cos(Math.PI * k));\n    }\n}\nAnimationBase.animationFrameCount = 468;\nclass AnimationWrapper extends AnimationBase {\n    constructor(animation) {\n        super();\n        this.animation = animation;\n    }\n    prepare() {\n        this.animation.prepare();\n    }\n    firstFrame() {\n        this.animation.firstFrame();\n    }\n    animationFrame(value) {\n        this.animation.animationFrame(value);\n    }\n    lastFrame() {\n        this.animation.lastFrame();\n    }\n}\nexport class Animator {\n    get current() {\n        if (this._current === undefined) {\n            return undefined;\n        }\n        if (this._current instanceof AnimationWrapper) {\n            return this._current.animation;\n        }\n        return this._current;\n    }\n    clearCurrent() {\n        this._current = undefined;\n    }\n    run(animation) {\n        let animationBase;\n        if (!(animation instanceof AnimationBase)) {\n            animationBase = new AnimationWrapper(animation);\n        }\n        else {\n            animationBase = animation;\n        }\n        const previousAnimation = this._current;\n        this._current = animationBase;\n        animationBase.animator = this;\n        if (previousAnimation) {\n            previousAnimation.animator = undefined;\n            previousAnimation.replace(animationBase);\n        }\n        else {\n            if (Animator.halt) {\n                return;\n            }\n            animationBase.start();\n        }\n    }\n}\nAnimator.halt = false;\n//# sourceMappingURL=animation.js.map","import { globalController } from \"../controller/globalController.js\";\nimport { setInitialProperties } from \"toad.jsx\";\nexport class View extends HTMLElement {\n    static define(name, view, options) {\n        const element = window.customElements.get(name);\n        if (element === undefined) {\n            window.customElements.define(name, view, options);\n        }\n        else {\n            if (element !== view) {\n                for (let i = 0; i < 255; ++i) {\n                    const dname = `${name}-duplicate-${i}`;\n                    if (window.customElements.get(dname) === undefined) {\n                        console.log(`View::define(${name}, ...) with different constructor, using ${dname} instead (known issue on Safari and Edge)`);\n                        window.customElements.define(dname, view, options);\n                        return;\n                    }\n                }\n                console.error(`View::define(${name}, ...): attempt to redefine view with different constructor (known issue on Safari and Edge), giving up after 255 times`);\n            }\n        }\n    }\n    constructor(props) {\n        super();\n        setInitialProperties(this, props);\n    }\n    setModel(model) {\n        console.trace(`Please note that View.setModel(model) has no implementation.`);\n    }\n    getModelId() {\n        if (!this.hasAttribute(\"model\"))\n            throw Error(\"no 'model' attribute\");\n        let modelId = this.getAttribute(\"model\");\n        if (!modelId)\n            throw Error(\"no model id\");\n        return \"M:\" + modelId;\n    }\n    getActionId() {\n        if (!this.hasAttribute(\"action\"))\n            throw Error(\"no 'action' attribute\");\n        let actionId = this.getAttribute(\"action\");\n        if (!actionId)\n            throw Error(\"no action id\");\n        return \"A:\" + actionId;\n    }\n    connectedCallback() {\n        if (this.controller)\n            return;\n        let modelId = \"\";\n        try {\n            modelId = this.getModelId();\n        }\n        catch (error) {\n        }\n        if (modelId != \"\")\n            globalController.registerView(modelId, this);\n    }\n    disconnectedCallback() {\n        if (this.controller)\n            this.controller.unregisterView(this);\n    }\n}\n//# sourceMappingURL=View.js.map","import { ModelReason } from \"../model/Model.js\";\nimport { View } from \"./View.js\";\nexport class ModelView extends View {\n    constructor(init) {\n        super(init);\n        this.model = undefined;\n        if (init?.model !== undefined) {\n            this.setModel(init.model);\n        }\n    }\n    updateModel() { }\n    updateView(reason) { }\n    setModel(model) {\n        if (model === this.model)\n            return;\n        const view = this;\n        if (this.model) {\n            this.model.modified.remove(view);\n        }\n        if (model) {\n            model.modified.add((reason) => view.updateView(reason), view);\n        }\n        this.model = model;\n        if (this.isConnected) {\n            this.updateView(ModelReason.ALL);\n        }\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        if (this.model) {\n            this.updateView(ModelReason.ALL);\n        }\n    }\n}\n//# sourceMappingURL=ModelView.js.map","import { TextModel } from \"../model/TextModel.js\";\nimport { ModelReason } from \"../model/Model.js\";\nimport { globalController } from \"../controller/globalController.js\";\nimport { Action } from \"../model/Action.js\";\nimport { ModelView } from \"./ModelView.js\";\nexport class ActionView extends ModelView {\n    constructor(init) {\n        super(init);\n    }\n    connectedCallback() {\n        if (this.controller) {\n            this.updateView(ModelReason.ALL);\n            return;\n        }\n        try {\n            globalController.registerView(this.getActionId(), this);\n        }\n        catch (e) { }\n        try {\n            globalController.registerView(this.getModelId(), this);\n        }\n        catch (e) { }\n        this.updateView(ModelReason.ALL);\n    }\n    disconnectedCallback() {\n        super.disconnectedCallback();\n        if (this.controller)\n            this.controller.unregisterView(this);\n    }\n    setModel(model) {\n        if (model === undefined) {\n            if (this.model)\n                this.model.modified.remove(this);\n            if (this.action)\n                this.action.modified.remove(this);\n            this.model = undefined;\n            this.action = undefined;\n            this.updateView(ModelReason.ALL);\n            return;\n        }\n        if (model instanceof Action) {\n            this.action = model;\n            this.action.modified.add(() => {\n                this.updateView(ModelReason.ALL);\n            }, this);\n        }\n        else if (model instanceof TextModel) {\n            this.model = model;\n            this.model.modified.add(() => {\n                this.updateView(ModelReason.ALL);\n            }, this);\n        }\n        else {\n            if (typeof model === \"object\") {\n                throw Error(`unexpected model of type ${model.constructor.name}`);\n            }\n            else {\n                throw Error(`unexpected model of type ${typeof model}`);\n            }\n        }\n        this.updateView(ModelReason.ALL);\n    }\n    setAction(value) {\n        if (value instanceof Function) {\n            this.setModel(new Action(value));\n        }\n        else {\n            this.setModel(value);\n        }\n    }\n    isEnabled() {\n        return this.action !== undefined && this.action.enabled;\n    }\n}\n//# sourceMappingURL=ActionView.js.map","import { css } from \"../util/lsx.js\";\nexport const style = new CSSStyleSheet();\nstyle.replaceSync(css `\n:host {\n    display: inline-block;\n}\n\n.tx-text {\n    width: 100%;\n    box-shadow: none;\n    box-sizing: border-box;\n    color: var(--tx-edit-fg-color);\n    background-color: var(--tx-edit-bg-color);\n\n    /* we use the border instead of an outline to indicate the focus */\n    outline: none;\n    border-width: var(--tx-border-width);\n    border-style: solid;\n    border-color: var(--tx-border-color);\n    border-radius: var(--tx-border-radius);\n\n    font-weight: var(--tx-edit-font-weight);\n    font-size: var(--tx-edit-font-size);\n    line-height: 18px;\n\n    padding: 4px 8px 4px 8px;\n    text-indent: 0;\n    vertical-align: top;\n    margin: 0;\n    overflow: visible;\n    text-overflow: ellipsis;\n}\n.tx-text:hover {\n    border-color: var(--tx-border-color-hover);\n}\n.tx-text:disabled {\n    color: var(--tx-fg-color-disabled);\n    background-color: var(--tx-bg-color-disabled);\n    border-color: var(--tx-bg-color-disabled);\n}\n.tx-text::placeholder {\n    color: var(--tx-placeholder-fg-color);\n    font-style: italic;\n    font-weight: 300;\n}\n.tx-text:hover::placeholder {\n    color: var(--tx-placeholder-fg-color-hover);\n}\n.tx-text:focus {\n    border-color: var(--tx-outline-color);\n}\n.tx-text.tx-error {\n    border-color: var(--tx-warning-color)\n}\n`);\n//# sourceMappingURL=tx-text.js.map","import { NumberModel } from \"../model/NumberModel.js\";\nimport { ModelView } from \"./ModelView.js\";\nimport { style as txText } from \"../style/tx-text.js\";\nexport class TextField extends ModelView {\n    constructor(init) {\n        super(init);\n        this.input = document.createElement(\"input\");\n        this.input.classList.add(\"tx-text\");\n        this.input.onkeydown = (e) => {\n            if (e.key === \"Enter\" && this.model instanceof NumberModel) {\n                this.updateModel();\n            }\n        };\n        this.input.onblur = (e) => {\n            if (this.model instanceof NumberModel) {\n                this.updateModel();\n            }\n        };\n        this.input.oninput = (e) => {\n            if (!(this.model instanceof NumberModel)) {\n                this.updateModel();\n            }\n        };\n        this.wheel = this.wheel.bind(this);\n        this.input.onwheel = this.wheel;\n        this.input.ondblclick = () => {\n            this.model?.resetToDefault();\n        };\n        this.attachShadow({ mode: \"open\", delegatesFocus: true });\n        this.shadowRoot.adoptedStyleSheets = [txText];\n        this.shadowRoot.appendChild(this.input);\n        this.updateView();\n    }\n    wheel(e) {\n        if (this.model instanceof NumberModel) {\n            e.preventDefault();\n            if (e.deltaY > 0) {\n                this.model.decrement();\n            }\n            if (e.deltaY < 0) {\n                this.model.increment();\n            }\n        }\n    }\n    focus() {\n        this.input.focus();\n    }\n    blur() {\n        this.input.blur();\n    }\n    static get observedAttributes() { return ['value']; }\n    attributeChangedCallback(name, oldValue, newValue) {\n        switch (name) {\n            case \"value\":\n                if (this.model && newValue !== undefined) {\n                    this.model.value = newValue;\n                }\n                break;\n        }\n    }\n    updateModel() {\n        if (this.model) {\n            this.model.value = this.input.value;\n        }\n        this.setAttribute(\"value\", this.input.value);\n    }\n    updateView() {\n        if (!this.model) {\n            this.setAttribute(\"disabled\", \"disabled\");\n            this.input.setAttribute(\"disabled\", \"disabled\");\n            return;\n        }\n        if (this.model.enabled) {\n            this.removeAttribute(\"disabled\");\n        }\n        else {\n            this.setAttribute(\"disabled\", \"disabled\");\n        }\n        this.model.applyStyle(this.input);\n        const strValue = `${this.model.value}`;\n        if (this.input.value !== strValue) {\n            this.input.value = strValue;\n            this.setAttribute(\"value\", strValue);\n        }\n    }\n    get value() {\n        return this.input.value;\n    }\n    set value(value) {\n        this.input.value = value;\n        this.updateModel();\n    }\n}\nTextField.define(\"tx-text\", TextField);\n//# sourceMappingURL=TextField.js.map","import { css } from \"../util/lsx.js\";\nexport const textAreaStyle = new CSSStyleSheet();\ntextAreaStyle.replaceSync(css `\n\n/* try to follow material ui: when active render button labels in black, otherwise in gray */\nsvg .fill {\n  fill: var(--tx-gray-700);\n  stroke: var(--tx-gray-700);\n}\nsvg .stroke {\n  fill: none;\n  stroke: var(--tx-gray-700);\n}\nsvg .strokeFill {\n  fill: var(--tx-gray-200);\n  stroke: var(--tx-gray-700);\n}\n\n/*\nthese don't seem to be in use anymore\n.toolbar.active svg .fill {\n  fill: #000;\n  stroke: #000;\n}\n.toolbar.active svg .stroke {\n  fill: none;\n  stroke: #000;\n}\n.toolbar.active svg .strokeFill {\n  fill: #fff;\n  stroke: #000;\n}\n*/\n\n.toolbar button {\n    background: var(--tx-gray-75);\n    color: var(--tx-gray-800);\n    border: 1px var(--tx-gray-400);\n    border-style: solid solid solid none;\n    padding: 5;\n    margin: 0;\n    vertical-align: middle;\n    height: 22px;\n}\n\n.toolbar button:active:hover {\n    background: linear-gradient(to bottom, var(--tx-gray-600) 0%,var(--tx-gray-50) 100%,var(--tx-gray-500) 100%);\n}\n\n.toolbar button.left {\n    border-style: solid;\n    border-radius: 3px 0 0 3px;\n}\n\n.toolbar button.right {\n    border: 1px var(--tx-gray-400);\n    border-style: solid solid solid none;\n    border-radius: 0 3px 3px 0;\n}\n\n.toolbar button.active {\n    background: linear-gradient(to bottom, var(--tx-gray-600) 0%,var(--tx-gray-50) 100%,var(--tx-gray-500) 100%);\n    border: 1px var(--tx-global-blue-500) solid;\n    color: var(--tx-gray-900);\n}\n\ndiv.textarea {\n  font-family: var(--tx-font-family);\n  font-size: var(--tx-font-size);\n  border: 1px var(--tx-gray-400) solid;\n  border-radius: 3px;\n  margin: 2px;\n  padding: 4px 5px;\n  outline-offset: -2px;\n}\n\ndiv.textarea h1 {\n  font-size: 22px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h2 {\n  font-size: 18px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h3 {\n  font-size: 16px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h4 {\n  font-size: 14px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea div {\n  padding: 2px 0 2px 0;\n}\n`);\n//# sourceMappingURL=textAreaStyle.js.map","import { jsx as _jsx, jsxs as _jsxs } from \"toad.jsx/lib/jsx-runtime\";\nimport { ModelView } from \"./ModelView.js\";\nimport { textAreaStyle } from \"./textAreaStyle.js\";\nexport class TextTool extends ModelView {\n    constructor() {\n        super();\n        TextTool.texttool = this;\n        let toolbar = _jsx(\"div\", { class: \"toolbar\" });\n        this.buttonH1 = _jsx(\"button\", { class: \"left\", children: \"H1\" });\n        this.buttonH1.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h1>\");\n            this.update();\n        };\n        toolbar.appendChild(this.buttonH1);\n        this.buttonH2 = _jsx(\"button\", { children: \"H2\" });\n        this.buttonH2.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h2>\");\n            this.update();\n        };\n        toolbar.appendChild(this.buttonH2);\n        this.buttonH3 = _jsx(\"button\", { children: \"H3\" });\n        this.buttonH3.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h3>\");\n            this.update();\n        };\n        toolbar.appendChild(this.buttonH3);\n        this.buttonH4 = _jsx(\"button\", { class: \"right\", children: \"H4\" });\n        this.buttonH4.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h4>\");\n            this.update();\n        };\n        toolbar.appendChild(this.buttonH4);\n        toolbar.appendChild(document.createTextNode(\" \"));\n        this.buttonBold = _jsx(\"button\", { class: \"left\", children: _jsx(\"b\", { children: \"B\" }) });\n        this.buttonBold.onclick = () => {\n            document.execCommand(\"bold\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonBold);\n        this.buttonItalic = _jsx(\"button\", { children: _jsx(\"i\", { children: \"I\" }) });\n        this.buttonItalic.onclick = () => {\n            document.execCommand(\"italic\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonItalic);\n        this.buttonUnderline = _jsx(\"button\", { children: _jsx(\"u\", { children: \"U\" }) });\n        this.buttonUnderline.onclick = () => {\n            document.execCommand(\"underline\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonUnderline);\n        this.buttonStrikeThrough = _jsx(\"button\", { children: _jsx(\"strike\", { children: \"S\" }) });\n        this.buttonStrikeThrough.onclick = () => {\n            document.execCommand(\"strikeThrough\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonStrikeThrough);\n        this.buttonSubscript = _jsx(\"button\", { children: \"x\\u2082\" });\n        this.buttonSubscript.onclick = () => {\n            document.execCommand(\"subscript\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonSubscript);\n        this.buttonSuperscript = _jsx(\"button\", { class: \"right\", children: \"x\\u00B2\" });\n        this.buttonSuperscript.onclick = () => {\n            document.execCommand(\"superscript\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonSuperscript);\n        toolbar.appendChild(document.createTextNode(\" \"));\n        this.buttonJustifyLeft = _jsx(\"button\", { class: \"left\", children: _jsxs(\"svg\", { viewBox: \"0 0 10 9\", width: \"10\", height: \"9\", children: [_jsx(\"line\", { x1: \"0\", y1: \"0.5\", x2: \"10\", y2: \"0.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"2.5\", x2: \"6\", y2: \"2.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"4.5\", x2: \"10\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"6.5\", x2: \"6\", y2: \"6.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"8.5\", x2: \"10\", y2: \"8.5\", class: \"stroke\" })] }) });\n        this.buttonJustifyLeft.onclick = () => {\n            document.execCommand(\"justifyLeft\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonJustifyLeft);\n        this.buttonJustifyCenter = _jsx(\"button\", { children: _jsxs(\"svg\", { viewBox: \"0 0 10 9\", width: \"10\", height: \"9\", children: [_jsx(\"line\", { x1: \"0\", y1: \"0.5\", x2: \"10\", y2: \"0.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"2\", y1: \"2.5\", x2: \"8\", y2: \"2.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"4.5\", x2: \"10\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"2\", y1: \"6.5\", x2: \"8\", y2: \"6.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"8.5\", x2: \"10\", y2: \"8.5\", class: \"stroke\" })] }) });\n        this.buttonJustifyCenter.onclick = () => {\n            document.execCommand(\"justifyCenter\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonJustifyCenter);\n        this.buttonJustifyRight = _jsx(\"button\", { class: \"right\", children: _jsxs(\"svg\", { viewBox: \"0 0 10 9\", width: \"10\", height: \"9\", children: [_jsx(\"line\", { x1: \"0\", y1: \"0.5\", x2: \"10\", y2: \"0.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4\", y1: \"2.5\", x2: \"10\", y2: \"2.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"4.5\", x2: \"10\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4\", y1: \"6.5\", x2: \"10\", y2: \"6.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0\", y1: \"8.5\", x2: \"10\", y2: \"8.5\", class: \"stroke\" })] }) });\n        this.buttonJustifyRight.onclick = () => {\n            document.execCommand(\"justifyRight\", false);\n            this.update();\n        };\n        toolbar.appendChild(this.buttonJustifyRight);\n        this.attachShadow({ mode: 'open' });\n        this.shadowRoot.adoptedStyleSheets = [textAreaStyle];\n        this.shadowRoot.appendChild(toolbar);\n    }\n    update() {\n        this.buttonH1.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h1\");\n        this.buttonH2.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h2\");\n        this.buttonH3.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h3\");\n        this.buttonH4.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h4\");\n        this.buttonBold.classList.toggle(\"active\", document.queryCommandState(\"bold\"));\n        this.buttonItalic.classList.toggle(\"active\", document.queryCommandState(\"italic\"));\n        this.buttonUnderline.classList.toggle(\"active\", document.queryCommandState(\"underline\"));\n        this.buttonStrikeThrough.classList.toggle(\"active\", document.queryCommandState(\"strikeThrough\"));\n        this.buttonSubscript.classList.toggle(\"active\", document.queryCommandState(\"subscript\"));\n        this.buttonSuperscript.classList.toggle(\"active\", document.queryCommandState(\"superscript\"));\n        this.buttonJustifyLeft.classList.toggle(\"active\", document.queryCommandState(\"justifyLeft\"));\n        this.buttonJustifyCenter.classList.toggle(\"active\", document.queryCommandState(\"justifyCenter\"));\n        this.buttonJustifyRight.classList.toggle(\"active\", document.queryCommandState(\"justifyRight\"));\n    }\n}\nTextTool.define(\"tx-texttool\", TextTool);\n//# sourceMappingURL=TextTool.js.map","import { HtmlModel } from \"../model/HtmlModel.js\";\nimport { TextTool } from \"./TextTool.js\";\nimport { ModelView } from \"./ModelView.js\";\nimport { style as txText } from \"../style/tx-text.js\";\nexport class TextArea extends ModelView {\n    constructor(init) {\n        super(init);\n        let content = document.createElement(\"div\");\n        this.content = content;\n        content.classList.add(\"tx-text\");\n        content.contentEditable = \"true\";\n        content.oninput = (event) => {\n            if (this.model instanceof HtmlModel) {\n                let firstChild = event.target.firstChild;\n                if (firstChild && firstChild.nodeType === 3) {\n                    document.execCommand(\"formatBlock\", false, `<div>`);\n                }\n                else if (content.innerHTML === \"<br>\") {\n                    content.innerHTML = \"\";\n                }\n            }\n            this.updateModel();\n        };\n        content.onkeydown = (event) => {\n            if (!(this.model instanceof HtmlModel)) {\n                return;\n            }\n            if (event.metaKey === true && event.key === \"b\") {\n                event.preventDefault();\n                document.execCommand(\"bold\", false);\n                this.updateTextTool();\n            }\n            else if (event.metaKey === true && event.key === \"i\") {\n                event.preventDefault();\n                document.execCommand(\"italic\", false);\n                this.updateTextTool();\n            }\n            else if (event.metaKey === true && event.key === \"u\") {\n                event.preventDefault();\n                document.execCommand(\"underline\", false);\n                this.updateTextTool();\n            }\n            else if (event.key === \"Tab\") {\n                event.preventDefault();\n            }\n            else if (event.key === \"Enter\" &&\n                event.shiftKey !== true &&\n                document.queryCommandValue(\"formatBlock\") === \"blockquote\") {\n                document.execCommand(\"formatBlock\", false, \"<p>\");\n            }\n        };\n        content.onkeyup = () => {\n            this.updateTextTool();\n        };\n        content.onmouseup = () => {\n            this.updateTextTool();\n        };\n        this.attachShadow({ mode: 'open' });\n        this.shadowRoot.adoptedStyleSheets = [txText];\n        this.shadowRoot.appendChild(content);\n    }\n    updateTextTool() {\n        if (TextTool.texttool !== undefined)\n            TextTool.texttool.update();\n    }\n    updateModel() {\n        if (this.model) {\n            this.model.promise = () => {\n                if (this.model instanceof HtmlModel) {\n                    return this.content.innerHTML;\n                }\n                else {\n                    return this.content.innerText;\n                }\n            };\n        }\n    }\n    updateView() {\n        if (!this.model) {\n            return;\n        }\n        if (this.model instanceof HtmlModel) {\n            if (this.content.innerHTML !== this.model.value) {\n                this.content.innerHTML = this.model.value;\n            }\n        }\n        else {\n            if (this.content.innerText !== this.model.value) {\n                this.content.innerText = this.model.value;\n            }\n        }\n    }\n}\nTextArea.define(\"tx-textarea\", TextArea);\n//# sourceMappingURL=TextArea.js.map","import { TextModel } from \"../model/TextModel.js\";\nimport { HtmlModel } from \"../model/HtmlModel.js\";\nimport { NumberModel } from \"../model/NumberModel.js\";\nimport { ModelView } from \"../view/ModelView.js\";\nexport class Display extends ModelView {\n    constructor(init) {\n        super(init);\n    }\n    updateView() {\n        if (this.model === undefined) {\n            this.innerText = \"\";\n            return;\n        }\n        if (this.model instanceof TextModel) {\n            this.innerText = this.model.value;\n            return;\n        }\n        if (this.model instanceof HtmlModel) {\n            this.innerHTML = this.model.value;\n            return;\n        }\n        if (this.model instanceof NumberModel) {\n            this.innerText = `${this.model.value}`;\n            return;\n        }\n    }\n}\nDisplay.define(\"tx-display\", Display);\n//# sourceMappingURL=Display.js.map","import { css } from \"../util/lsx.js\";\nexport const style = new CSSStyleSheet();\nstyle.replaceSync(css `\n.tx-button {\n    padding: 2px 14px 2px 14px;\n    margin: 0;\n    color: var(--tx-gray-800);\n    transition: background-color 130ms ease-in-out;\n    background-color: var(--tx-gray-300);\n    border: 0 none;\n    height: 28px;\n    border-radius: 16px;\n    box-shadow: none;\n    font-family: inherit;\n}\n\n.tx-button:hover, .tx-button:active {\n    color: var(--tx-gray-900);\n    background-color: var(--tx-gray-400);\n}\n\n.tx-button:hover:active > span {\n    transition: transform 130ms ease-in-out;\n}\n:host > .tx-button:hover:active {\n    transform: translate(1px, 1px);\n}\n:host([disabled]) > .tx-button:hover:active {\n    transform: translate(0px, 0px);\n}\n\n/* accent */\n\n.tx-button.tx-accent {\n    color: var(--tx-static-white);\n    background-color: var(--tx-static-blue-600);\n}\n.tx-button.tx-accent:hover, .tx-button.tx-accent:active {\n    color: var(--tx-static-white);\n    background-color: var(--tx-static-blue-700);\n}\n.tx-button.tx-accent:hover:active {\n    color: var(--tx-static-white);\n    background-color: var(--tx-static-blue-500);\n}\n\n/* negative */\n\n.tx-button.tx-negative {\n    color: var(--tx-static-white);\n    background-color: var(--tx-static-red-600);\n}\n.tx-button.tx-negative:hover, .tx-button.tx-negative:active {\n    color: var(--tx-static-white);\n    background-color: var(--tx-static-red-700);\n}\n.tx-button.tx-negative:hover:active {\n    color: var(--tx-static-white);\n    background-color: var(--tx-static-red-500);\n}\n\n/* primary */\n\n.tx-button.tx-default {\n    color: var(--tx-gray-50);\n    background-color: var(--tx-gray-800);\n}\n\n.tx-button.tx-default:hover, .tx-button.tx-default:hover:active {\n    color: var(--tx-gray-50);\n    background-color: var(--tx-gray-900);\n}\n\n.tx-button.tx-default:active {\n    color: var(--tx-gray-50);\n    background-color: var(--tx-gray-900);\n}\n\n.tx-label {\n    font-weight: bold;\n    padding: 4px 0 6px 0;\n    /* override parent flex/grid's align-items property to align in the center */\n    align-self: center;\n    /* adjust sides in container to look centered...? */\n    justify-self: center;\n    /* align children in the center */\n    text-align: center;\n}\n\n:host([disabled]) > .tx-button, :host([disabled]) > .tx-button:active {\n    color: var(--tx-fg-color-disabled);\n    background-color: var(--tx-gray-200);\n}\n`);\n//# sourceMappingURL=tx-button.js.map","import { HtmlModel } from \"../model/HtmlModel.js\";\nimport { ActionView } from \"./ActionView.js\";\nimport { button, span } from \"../util/lsx.js\";\nimport { style as txButton } from \"../style/tx-button.js\";\nexport var ButtonVariant;\n(function (ButtonVariant) {\n    ButtonVariant[ButtonVariant[\"PRIMARY\"] = 0] = \"PRIMARY\";\n    ButtonVariant[ButtonVariant[\"SECONDARY\"] = 1] = \"SECONDARY\";\n    ButtonVariant[ButtonVariant[\"ACCENT\"] = 2] = \"ACCENT\";\n    ButtonVariant[ButtonVariant[\"NEGATIVE\"] = 3] = \"NEGATIVE\";\n})(ButtonVariant || (ButtonVariant = {}));\nexport class Button extends ActionView {\n    constructor(init) {\n        super(init);\n        this.button = button(this.label = span());\n        this.button.classList.add(\"tx-button\");\n        this.label.classList.add(\"tx-label\");\n        this.button.onclick = () => {\n            if (this.action)\n                this.action.trigger();\n        };\n        switch (this.getAttribute(\"variant\")) {\n            case \"primary\":\n                this.button.classList.add(\"tx-default\");\n                break;\n            case \"secondary\":\n                break;\n            case \"accent\":\n                this.button.classList.add(\"tx-accent\");\n                break;\n            case \"negative\":\n                this.button.classList.add(\"tx-negative\");\n                break;\n        }\n        switch (init?.variant) {\n            case ButtonVariant.PRIMARY:\n                this.button.classList.add(\"tx-default\");\n                break;\n            case ButtonVariant.SECONDARY:\n                break;\n            case ButtonVariant.ACCENT:\n                this.button.classList.add(\"tx-accent\");\n                break;\n            case ButtonVariant.NEGATIVE:\n                this.button.classList.add(\"tx-negative\");\n                break;\n        }\n        this.attachShadow({ mode: 'open' });\n        this.shadowRoot.adoptedStyleSheets = [txButton];\n        this.shadowRoot.appendChild(this.button);\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        if (this.children.length !== 0) {\n            return;\n        }\n        this._observer = new MutationObserver((record, observer) => {\n            if (this._timer !== undefined)\n                clearTimeout(this._timer);\n            this._timer = window.setTimeout(() => {\n                this._timer = undefined;\n                this.updateView();\n            }, 100);\n        });\n        this._observer.observe(this, {\n            childList: true,\n            subtree: true,\n            characterData: true\n        });\n    }\n    updateView() {\n        if (!this.isConnected)\n            return;\n        if (this.model && this.model.value) {\n            if (this.model instanceof HtmlModel)\n                this.label.innerHTML = this.model.value;\n            else\n                this.label.innerText = this.model.value;\n        }\n        else {\n            this.label.innerHTML = this.innerHTML;\n        }\n        if (this.isEnabled()) {\n            this.removeAttribute(\"disabled\");\n        }\n        else {\n            this.setAttribute(\"disabled\", \"disabled\");\n        }\n    }\n}\nButton.define(\"tx-button\", Button);\n//# sourceMappingURL=Button.js.map","import { BooleanModel } from \"../model/BooleanModel.js\";\nimport { ModelView } from \"./ModelView.js\";\nexport class BooleanView extends ModelView {\n    setModel(model) {\n        if (model !== undefined && !(model instanceof BooleanModel)) {\n            throw Error(`BooleanView.setModel(): model is not of type BooleanModel`);\n        }\n        super.setModel(model);\n    }\n    updateModel() {\n        if (this.model) {\n            this.model.value = this.input.checked;\n        }\n    }\n    updateView() {\n        if (!this.model || !this.model.enabled) {\n            this.input.setAttribute(\"disabled\", \"\");\n        }\n        else {\n            this.input.removeAttribute(\"disabled\");\n        }\n        if (this.model) {\n            this.input.checked = this.model.value;\n        }\n    }\n}\n//# sourceMappingURL=BooleanView.js.map","import { css } from \"../util/lsx.js\";\nexport const style = new CSSStyleSheet();\nstyle.replaceSync(css `\n:host(.tx-checkbox) {\n    display: inline-block;\n    position: relative;\n    box-shadow: none;\n    box-sizing: border-box;\n    padding: 0;\n    margin: 2px; /* leave space for the focus ring */\n    border: none 0;\n    height: 14px;\n    width: 14px;\n}\n\n:host(.tx-checkbox) > input {\n    box-sizing: border-box;\n    width: 14px;\n    height: 14px;\n    outline: none;\n    padding: 0;\n    margin: 0;\n    border: 2px solid;\n    border-radius: 2px;\n    border-color: var(--tx-gray-700);\n    /* border-radius: var(--tx-border-radius); */\n    color: var(--tx-edit-fg-color);\n    background-color: var(--tx-edit-bg-color);\n    -webkit-appearance: none;\n}\n\n/* this is a svg 2 feature, works with firefox, chrome and edge, but not safari */\n/* :host(.tx-checkbox) > svg > path {\n    d: path(\"M3.5 9.5a.999.999 0 01-.774-.368l-2.45-3a1 1 0 111.548-1.264l1.657 2.028 4.68-6.01A1 1 0 019.74 2.114l-5.45 7a1 1 0 01-.777.386z\");\n} */\n\n/* focus ring */\n:host(.tx-checkbox) > input:focus-visible {\n    outline: 2px solid;\n    outline-color: var(--tx-outline-color);\n    outline-offset: 2px;\n}\n\n:host(.tx-checkbox) > svg {\n    position: absolute;\n    left: 2px;\n    top: 2px;\n    stroke: none;\n    fill: var(--tx-edit-bg-color);\n    width: 10px;\n    height: 10px;\n    pointer-events: none;\n}\n\n:host(.tx-checkbox) > input:hover {\n    border-color: var(--tx-gray-800);\n}\n.tx-checkbox > input:focus {\n    border-color: var(--tx-outline-color);\n}\n\n:host(.tx-checkbox) > input:checked {\n    background-color: var(--tx-gray-700);\n}\n:host(.tx-checkbox) > input:hover:checked {\n    background-color: var(--tx-gray-800);\n}\n\n:host(.tx-checkbox) > input:disabled {\n    color: var(--tx-gray-400);\n    border-color: var(--tx-gray-400);\n}\n:host(.tx-checkbox) > input:checked:disabled {\n    background-color: var(--tx-gray-400);\n}\n`);\n//# sourceMappingURL=tx-checkbox.js.map","import { BooleanView } from \"./BooleanView.js\";\nimport { input, svg, path } from \"../util/lsx.js\";\nimport { style as txCheckbox } from \"../style/tx-checkbox.js\";\nexport class Checkbox extends BooleanView {\n    constructor(init) {\n        super(init);\n        this.classList.add(\"tx-checkbox\");\n        this.input = input();\n        this.input.type = \"checkbox\";\n        this.updateModel = this.updateModel.bind(this);\n        this.input.onchange = this.updateModel;\n        const checkmark = svg(path(\"M3.5 9.5a.999.999 0 01-.774-.368l-2.45-3a1 1 0 111.548-1.264l1.657 2.028 4.68-6.01A1 1 0 019.74 2.114l-5.45 7a1 1 0 01-.777.386z\"));\n        this.attachShadow({ mode: 'open', delegatesFocus: true });\n        this.shadowRoot.adoptedStyleSheets = [txCheckbox];\n        this.shadowRoot.replaceChildren(this.input, checkmark);\n    }\n}\nCheckbox.define(\"tx-checkbox\", Checkbox);\n//# sourceMappingURL=Checkbox.js.map","import { css } from \"../util/lsx.js\";\nexport const style = new CSSStyleSheet();\nstyle.replaceSync(css `\n.tx-search {\n    display: inline-block;\n    position: relative;\n}\n.tx-search > div {\n    display: inline-flex;\n    position: relative;\n}\n.tx-search > div > svg {\n    display: block;\n    position: absolute;\n    height: 18px;\n    width: 18px;\n    top: 7px;\n    left: 10px;\n    pointer-events: none;\n    overflow: hidden;\n    fill: var(--tx-gray-700);\n}\n.tx-search > div > input {\n    box-sizing: border-box;\n    padding: 3px 12px 5px 35px;\n    margin: 0;\n    border: 1px solid var(--tx-gray-400);\n    border-radius: 4px;\n    -webkit-appearance: none;\n    outline-offset: -2px;\n    outline: none;\n    width: 100%;\n    height: 32px;\n    overflow: visible;\n    background: var(--tx-gray-50);\n\n    color: var(--tx-gray-900);  \n    font-weight: var(--tx-edit-font-weight);\n    font-size: var(--tx-edit-font-size);\n    line-height: 18px;\n}\n/* the button is transparent so that the border of the input field remains visible */\n.tx-search > button {\n    display: inline-flex;\n    position: absolute;\n    box-sizing: border-box;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    width: 32px;\n    padding: 0;\n    margin: 1px;\n    border: none;\n    align-items: center;\n    justify-content: center;\n    overflow: visible;\n    vertical-align: top;\n    cursor: pointer;\n    border-radius: 0 4px 4px 0;\n    text-align: center;\n    outline: none;\n\n    background-color: var(--tx-gray-50);\n    border-radius: 0 4px 4px 0;\n\n}\n.tx-search > button > svg {\n    display: inline-block;\n    pointer-events: none;\n    height: 10px;\n    width: 10px;\n    padding: 0;\n    margin: 0;\n    border: none;\n    fill: var(--tx-gray-700);\n}\n.tx-search > div > input:hover {\n    border-color: var(--tx-gray-500);\n}\n\n.tx-search > div > input:focus {\n    border-color: var(--tx-outline-color);\n}\n.tx-search > button:focus > svg {\n    fill: var(--tx-outline-color);\n}\n\n.tx-search > div > input:disabled {\n    color: var(--tx-gray-700);\n    background-color: var(--tx-gray-200);\n    border-color: var(--tx-gray-200);\n}\n.tx-search > button:disabled {\n    background-color: var(--tx-gray-200);\n}\n.tx-search > button:disabled > svg {\n    fill: var(--tx-gray-400);\n}`);\n//# sourceMappingURL=tx-search.js.map","import { ModelView } from \"./ModelView.js\";\nimport { form, input, button, svg, path, div } from \"../util/lsx.js\";\nimport { style as txSearch } from \"../style/tx-search.js\";\nexport class Search extends ModelView {\n    constructor(init) {\n        super(init);\n        let s0, s1, b, i, p;\n        const f = form(div(s0 = svg(p = path(\"M33.173 30.215L25.4 22.443a12.826 12.826 0 10-2.957 2.957l7.772 7.772a2.1 2.1 0 002.958-2.958zM6 15a9 9 0 119 9 9 9 0 01-9-9z\")), i = input()), b = button(s1 = svg(path(\"M6.548 5L9.63 1.917A1.094 1.094 0 008.084.371L5.001 3.454 1.917.37A1.094 1.094 0 00.371 1.917L3.454 5 .37 8.085A1.094 1.094 0 101.917 9.63l3.084-3.083L8.084 9.63a1.094 1.094 0 101.547-1.546z\"))));\n        s0.setAttributeNS(null, \"width\", \"100%\");\n        s0.setAttributeNS(null, \"height\", \"100%\");\n        p.setAttributeNS(null, \"transform\", \"scale(0.5, 0.5)\");\n        s1.setAttributeNS(null, \"width\", \"100%\");\n        s1.setAttributeNS(null, \"height\", \"100%\");\n        i.type = \"search\";\n        i.placeholder = \"Search\";\n        i.autocomplete = \"off\";\n        f.classList.add(\"tx-search\");\n        this.attachShadow({ mode: 'open' });\n        this.shadowRoot.adoptedStyleSheets = [txSearch];\n        this.shadowRoot.appendChild(f);\n    }\n}\nSearch.define(\"tx-search\", Search);\n//# sourceMappingURL=Search.js.map","import { css } from \"../util/lsx.js\";\nexport const style = new CSSStyleSheet();\nstyle.replaceSync(css `\n/* a div on top serves as the container for elements used for the switch*/\n:host(.tx-switch) {\n    display: inline-flex;\n    align-items: flex-start;\n    position: relative;\n    vertical-align: top;\n}\n/* an invisible checkbox will overlay everything, handling input and state */\n:host(.tx-switch) > input {\n    display: inline-block;\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    box-sizing: absolute;\n    margin: 0;\n    padding: 0;\n    opacity: 0;\n    z-index: 1;\n}\n/* the span provides the visual appearance */\n:host(.tx-switch) > span {\n    display: block;\n    position: relative;\n    left: 0;\n    top: 0;\n    box-sizing: border-box;\n    flex-grow: 0;\n    flex-shrink: 0;\n\n    border: 0px none;\n    border-radius: 7px;\n\n    width: 26px;\n    height: 14px;\n    background: var(--tx-gray-300);\n}\n\n/* focus ring */\n:host(.tx-switch) > input:focus-visible + span {\n    outline: 2px solid;\n    outline-color: var(--tx-outline-color);\n    outline-offset: 2px;\n}\n\n/* this is the knob on the switch */\n:host(.tx-switch) > span:before {\n    display: block;\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 14px;\n    height: 14px;\n    background: var(--tx-gray-75);\n    border: 2px solid var(--tx-gray-700);\n    border-radius: 7px;\n    content: \"\";\n    box-sizing: border-box;\n\n    /* 'transform' usually can be GPU acclerated while 'left' can not */\n    transition: transform 130ms ease-in-out;\n}\n:host(.tx-switch) > input:hover + span:before {\n    border-color: var(--tx-gray-900);\n}\n\n:host(.tx-switch) > input:checked + span:before {\n    /* border-color: var(--tx-gray-700); */\n    transform: translateX(calc(100% - 2px));\n}\n\n:host(.tx-switch) > input:checked + span {\n    background: var(--tx-gray-700);\n}\n:host(.tx-switch) > input:checked:hover + span {\n    background: var(--tx-gray-900);\n}\n:host(.tx-switch) > input:hover + span + label {\n    color: var(--tx-gray-900);\n}\n\n:host(.tx-switch) > input:checked:disabled + span {\n    background: var(--tx-gray-400);\n}\n:host(.tx-switch) > input:disabled + span:before {\n    border-color: var(--tx-gray-400);\n}\n:host(.tx-switch) > input:disabled + span + label {\n    color: var(--tx-gray-400);\n}`);\n//# sourceMappingURL=tx-switch.js.map","import { BooleanView } from \"./BooleanView.js\";\nimport { style as txSwitch } from \"../style/tx-switch.js\";\nimport { input, span } from \"../util/lsx.js\";\nexport class Switch extends BooleanView {\n    constructor(init) {\n        super(init);\n        this.classList.add(\"tx-switch\");\n        this.input = input();\n        this.input.type = \"checkbox\";\n        this.input.onchange = () => {\n            this.updateModel();\n        };\n        this.attachShadow({ mode: 'open' });\n        this.shadowRoot.adoptedStyleSheets = [txSwitch];\n        this.shadowRoot.appendChild(this.input);\n        this.shadowRoot.appendChild(span());\n    }\n}\nSwitch.define(\"tx-switch\", Switch);\n//# sourceMappingURL=Switch.js.map","import { css } from \"../util/lsx.js\";\nexport const style = new CSSStyleSheet();\nstyle.replaceSync(css `\n:host(.tx-radio) {\n    display: inline-flex;\n    align-items: flex-start;\n    position: relative;\n    vertical-align: top;\n    padding: 2px;\n}\n/* an invisible radiobutton will overlay everything, handling input and state */\n:host(.tx-radio) > input {\n    display: inline-block;\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    box-sizing: absolute;\n    margin: 0;\n    padding: 0;\n    opacity: 0;\n    z-index: 1;\n}\n\n/* the span provides the visual appearance */\n:host(.tx-radio) > span {\n    display: block;\n    position: relative;\n    left: 0;\n    top: 2px;\n    margin-right: 3px;\n    box-sizing: border-box;\n    flex-grow: 0;\n    flex-shrink: 0;\n\n    border: 2px solid var(--tx-gray-700);\n    border-radius: 7px;\n\n    width: 14px;\n    height: 14px;\n    background: none;\n}\n\n/* focus ring */\n:host(.tx-radio) > input:focus-visible + span {\n    outline: 2px solid;\n    outline-color: var(--tx-outline-color);\n    outline-offset: 2px;\n}\n/* this is the knob on the switch */\n:host(.tx-radio) > span:before {\n    display: block;\n    position: absolute;\n    left: 0px;\n    top: 0px;\n    width: 10px;\n    height: 10px;\n    background: var(--tx-gray-75);\n    border: 2px solid var(--tx-gray-75);\n    border-radius: 7px;\n    content: \"\";\n    box-sizing: border-box;\n\n    /* 'transform' usually can be GPU acclerated while 'left' can not */\n    transition: opacity 130ms ease-in-out;\n}\n:host(.tx-radio) > input:checked + span:before {\n    background: var(--tx-gray-700);\n}\n:host(.tx-radio) > input:checked:hover + span:before {\n    background: var(--tx-gray-900);\n}\n:host(.tx-radio) > input:hover + span {\n    border-color: var(--tx-gray-900);\n}\n\n:host(.tx-radio) > input:checked:disabled + span:before {\n    background: var(--tx-gray-500);\n}\n:host(.tx-radio) > input:disabled + span {\n    border-color: var(--tx-gray-500);\n}\n:host(.tx-radio) > input:disabled + span + label {\n    color: var(--tx-gray-500);\n}\n`);\n//# sourceMappingURL=tx-radio.js.map","import { ModelView } from \"./ModelView.js\";\nimport { input, label, slot, span } from \"../util/lsx.js\";\nimport { style as txRadio } from \"../style/tx-radio.js\";\nexport class RadioButton extends ModelView {\n    constructor(init) {\n        super(init);\n        this.value = init?.value;\n        this.updateModel = this.updateModel.bind(this);\n        this.updateView = this.updateView.bind(this);\n        this.classList.add(\"tx-radio\");\n        this.input = input();\n        this.input.type = \"radio\";\n        this.input.onchange = this.updateModel;\n        this.input.disabled = true;\n        this.label = label();\n        this.attachShadow({ mode: 'open', delegatesFocus: true });\n        this.shadowRoot.adoptedStyleSheets = [txRadio];\n        this.shadowRoot.replaceChildren(this.input, span(), this.label);\n    }\n    updateModel() {\n        if (this.input.checked && this.model !== undefined) {\n            this.model.value = this.value;\n        }\n    }\n    updateView() {\n        if (this.model !== undefined) {\n            let radioGroup = RadioButton.radioGroups.get(this.model);\n            if (radioGroup === undefined) {\n                radioGroup = ++RadioButton.radioGroupCounter;\n                RadioButton.radioGroups.set(this.model, radioGroup);\n            }\n            this.input.name = `tx-radio-group-${radioGroup}`;\n            this.input.value = `${this.model.indexOf(this.value)}`;\n            if (this.childNodes.length > 0) {\n                this.label.replaceChildren(slot());\n            }\n            else {\n                this.label.replaceChildren(this.model.labelOf(this.value));\n            }\n        }\n        else {\n            this.input.name = \"\";\n        }\n        if (!this.model || !this.model.enabled || !this.model.isEnabledOf(this.value)) {\n            this.input.setAttribute(\"disabled\", \"\");\n        }\n        else {\n            this.input.removeAttribute(\"disabled\");\n        }\n        if (this.model) {\n            this.input.checked = this.model.value === this.value;\n        }\n    }\n}\nRadioButton.radioGroupCounter = 0;\nRadioButton.radioGroups = new WeakMap();\nRadioButton.define(\"tx-radio\", RadioButton);\n//# sourceMappingURL=RadioButton.js.map","export var MenuState;\n(function (MenuState) {\n    MenuState[MenuState[\"WAIT\"] = 0] = \"WAIT\";\n    MenuState[MenuState[\"DOWN\"] = 1] = \"DOWN\";\n    MenuState[MenuState[\"UP_N_HOLD\"] = 2] = \"UP_N_HOLD\";\n    MenuState[MenuState[\"DOWN_N_HOLD\"] = 3] = \"DOWN_N_HOLD\";\n    MenuState[MenuState[\"DOWN_N_OUTSIDE\"] = 4] = \"DOWN_N_OUTSIDE\";\n    MenuState[MenuState[\"DOWN_N_INSIDE_AGAIN\"] = 5] = \"DOWN_N_INSIDE_AGAIN\";\n})(MenuState || (MenuState = {}));\n//# sourceMappingURL=MenuState.js.map","import { View } from \"../view/View.js\";\nimport { MenuState } from \"./MenuState.js\";\nexport class MenuButtonContainer extends View {\n    constructor(props) {\n        super(props);\n        this.vertical = true;\n        this.closeOnClose = false;\n        this.state = MenuState.WAIT;\n    }\n}\n//# sourceMappingURL=MenuHelper.js.map","import { View } from \"../view/View.js\";\nimport { MenuButtonContainer } from \"./MenuHelper.js\";\nexport class PopupMenu extends MenuButtonContainer {\n    constructor(root, parent) {\n        super();\n        this.vertical = true;\n        this.root = root;\n        this.parentButton = parent;\n        this.popup = document.createElement(\"div\");\n        this.popup.classList.add(\"menu-popup\");\n        let node = root.down;\n        while (node) {\n            if (node.isAvailable()) {\n                node.createWindowAt(this, this.popup);\n            }\n            else {\n                node.deleteWindow();\n            }\n            node = node.next;\n        }\n        this.appendChild(this.popup);\n        this.show();\n    }\n    show() {\n        if (!this.parentButton.master.vertical)\n            placePopupVertical(this.parentButton, this.popup);\n        else\n            placePopupHorizontal(this.parentButton, this.popup);\n        this.style.display = \"\";\n    }\n    hide() {\n        this.style.display = \"none\";\n    }\n}\nexport function placePopupVertical(parent, popup) {\n    let parentBoundary = parent.getBoundingClientRect();\n    popup.style.opacity = \"0\";\n    popup.style.left = parentBoundary.left + \"px\";\n    popup.style.top = parentBoundary.top + parentBoundary.height + \"px\";\n    setTimeout(function () {\n        let popupBoundary = popup.getBoundingClientRect();\n        let popupBottom = parentBoundary.top + parentBoundary.height + popupBoundary.height;\n        if (popupBottom > window.innerHeight) {\n            const top = parentBoundary.top - popupBoundary.height;\n            if (top > 0 || -top < popupBottom - window.innerHeight) {\n                popup.style.top = `${top}px`;\n            }\n        }\n        let popupRight = parentBoundary.left + popupBoundary.width;\n        if (popupRight > window.innerWidth) {\n            popup.style.left = parentBoundary.left + parentBoundary.width - popupBoundary.width + \"px\";\n        }\n        popup.style.opacity = \"1\";\n    }, 0);\n}\nexport function placePopupHorizontal(parent, popup) {\n    let parentBoundary = parent.getBoundingClientRect();\n    popup.style.opacity = \"0\";\n    popup.style.left = parentBoundary.left + parentBoundary.width + \"px\";\n    popup.style.top = parentBoundary.top + \"px\";\n    setTimeout(function () {\n        let popupBoundary = popup.getBoundingClientRect();\n        let popupBottom = parentBoundary.top + popupBoundary.height;\n        if (popupBottom > window.innerHeight) {\n            popup.style.top = parentBoundary.top + parentBoundary.height - popupBoundary.height + \"px\";\n        }\n        let popupRight = parentBoundary.left + parentBoundary.width + popupBoundary.width;\n        if (popupRight > window.innerWidth) {\n            popup.style.left = parentBoundary.left - popupBoundary.width + \"px\";\n        }\n        popup.style.opacity = \"1\";\n    }, 0);\n}\nView.define(\"tx-popupmenu\", PopupMenu);\n//# sourceMappingURL=PopupMenu.js.map","import { css } from \"../util/lsx.js\";\nexport const style = new CSSStyleSheet();\nstyle.replaceSync(css `\n:host(.tx-combobox) {\n    display: inline-flex;\n    align-items: flex-start;\n    position: relative;\n    vertical-align: top;\n}\n:host(.tx-combobox) > :first-child {\n    box-sizing: border-box;\n    width: 100%;\n    height: 32px;\n    line-height: 30px; /* center text vertically */\n    overflow: hidden; /* children shall not overlap our border */\n    margin: 0;\n    padding: 0;\n    vertical-align: top;\n    text-align: left;\n    outline: none;\n    display: inline-block;\n    border: 1px solid var(--tx-gray-400);\n    border-radius: 4px;\n    background-color: var(--tx-gray-50);\n    \n    color: var(--tx-gray-900);  \n    font-weight: var(--tx-edit-font-weight);\n    font-size: var(--tx-edit-font-size);\n}\n:host(.tx-combobox) > input:first-child {\n    padding: 4px 32px 4px 11px;\n}\n:host(.tx-combobox) > :first-child > :first-child {\n    padding-left: 7px;\n}\n:host(.tx-combobox) > :first-child::placeholder {\n    color: var(--tx-placeholder-fg-color);\n    font-style: italic;\n    font-weight: 300;\n}\n:host(.tx-combobox) > button {\n    position: absolute;\n    right: 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    border-style: none;\n    box-sizing: border-box;\n    overflow: visible;\n    margin: 0;\n    text-transform: none;\n\n    width: 32px;\n    height: 32px;\n    background-color: var(--tx-gray-75);\n    border-radius: 0 4px 4px 0;\n    border: 1px solid var(--tx-gray-400);\n}\n:host(.tx-combobox) > button > svg {\n    fill: var(--tx-gray-700);\n    transform: rotate(90deg) translate(5px, 8px);\n}\n\n:host(.tx-combobox) > :first-child:hover {\n    border-color: var(--tx-gray-500);\n}\n:host(.tx-combobox) > button:hover {\n    border-color: var(--tx-gray-500);\n    background-color: var(--tx-gray-50);\n}\n:host(.tx-combobox) > button:hover > svg {\n    fill: var(--tx-gray-900);\n}\n\n:host(.tx-combobox) > :first-child:focus {\n    border-color: var(--tx-outline-color);\n}\n:host(.tx-combobox) > :first-child:focus + button {\n    border-color: var(--tx-outline-color);\n}\n/* spectrum use a 1px focus ring when the focus was set by mouse\n * and a 2px focus ring when the focus was set by keyboard\n * no clue how to do that with css\n *\n/* :host(.tx-combobox) > input:focus-visible {\n    outline: 1px solid var(--tx-outline-color);\n}\n:host(.tx-combobox) > input:focus-visible + button {\n    outline: 1px solid var(--tx-outline-color);\n    border-left: none;\n} */\n\n:host(.tx-combobox) > :first-child.tx-disabled {\n    color: var(--tx-gray-700);\n    background-color: var(--tx-gray-200);\n    border-color: var(--tx-gray-200);\n}\n:host(.tx-combobox) > :first-child.tx-disabled > * {\n    color: var(--tx-gray-500);\n    background-color: var(--tx-gray-200);\n    border-color: var(--tx-gray-200);\n}\n:host(.tx-combobox) > :first-child.tx-disabled + button {\n    background-color: var(--tx-gray-200);\n    border-color: var(--tx-gray-200);\n}\n:host(.tx-combobox) > :first-child.tx-disabled + button > svg {\n    fill: var(--tx-gray-400);\n}\n:host(.tx-combobox) > :first-child.tx-error {\n    color: var(--tx-warning-color);\n    border-color: var(--tx-warning-color)\n}\n:host(.tx-combobox) > :first-child.tx-error + button {\n    border-color: var(--tx-warning-color)\n}\n`);\n//# sourceMappingURL=tx-combobox.js.map","import { css } from \"../util/lsx.js\";\nexport const style = new CSSStyleSheet();\nstyle.replaceSync(css `\n.tx-popover {\n    background-color: var(--tx-gray-50);\n    border: 1px solid var(--tx-gray-400);\n    border-radius: 4px;\n    display: inline-flex;\n    flex-direction: column;\n    filter: drop-shadow(rgba(0, 0, 0, 0.5) 0px 1px 4px);\n}\n.tx-menu {\n    display: inline-block;\n    padding: 0;\n    margin: 2px 0 2px 0;\n}\n.tx-menu > li {\n    cursor: pointer;\n    display: flex;\n    border: none;\n    border-left: 2px solid var(--tx-gray-50);\n    margin-right: 2px;\n    padding: 0;\n    margin: 0;\n    font-weight: 500;\n    outline: none;\n}\n.tx-menu > li:first-child {\n    border-top-right-radius: 4px;\n    overflow: hidden;\n}\n.tx-menu > li:last-child {\n    border-bottom-right-radius: 4px;\n    overflow: hidden;\n}\n.tx-menu > li > :first-child {\n    padding: 7px 11px 7px 10px;\n}\n.tx-menu > li:hover {\n    background-color: var(--tx-gray-100);\n    border-color: var(--tx-gray-100);\n}\n.tx-menu > li.tx-hover {\n    filter: brightness(1.2);\n    backdrop-filter: brightness(1.2);\n    border-color: var(--tx-gray-100);\n}\n.tx-menu > li:focus {\n    border-left-color: var(--tx-outline-color);\n}\n.tx-menu > li[role=separator] {\n    display: block;\n    box-sizing: content-box;\n    overflow: visible;\n    cursor: default;\n    height: 2px;\n    padding: 0px;\n    margin: 1.5px 7px 1.5px 7px;\n    background-color: var(--tx-gray-100);\n    white-space: pre;\n    list-style-type: none;\n}\n.tx-menu > li.tx-disabled {\n    color: var(--tx-gray-500);\n}\n.tx-menu > li.tx-disabled:hover {\n    background-color: var(--tx-gray-50);\n}`);\n//# sourceMappingURL=tx-menu.js.map","import { jsx as _jsx } from \"toad.jsx/lib/jsx-runtime\";\nimport { ModelView } from \"./ModelView.js\";\nimport { input, button, svg, path, div, li } from \"../util/lsx.js\";\nimport { placePopupVertical } from \"../menu/PopupMenu.js\";\nimport { style as txCombobox } from \"../style/tx-combobox.js\";\nimport { style as txMenu } from \"../style/tx-menu.js\";\nexport class SelectBase extends ModelView {\n    constructor(init) {\n        super(init);\n        this.pointerup = this.pointerup.bind(this);\n        this.pointermove = this.pointermove.bind(this);\n        this.pointerdown = this.pointerdown.bind(this);\n        this.wheel = this.wheel.bind(this);\n        this.keydown = this.keydown.bind(this);\n        let s;\n        const b = button((s = svg(path(\"M3 9.95a.875.875 0 01-.615-1.498L5.88 5 2.385 1.547A.875.875 0 013.615.302L7.74 4.377a.876.876 0 010 1.246L3.615 9.698A.872.872 0 013 9.95z\"))));\n        this.button = b;\n        b.tabIndex = -1;\n        b.style.outline = \"none\";\n        s.style.width = \"100%\";\n        s.style.height = \"100%\";\n        b.onpointerdown = this.pointerdown;\n        b.onpointermove = this.pointermove;\n        b.onpointerup = this.pointerup;\n        this.classList.add(\"tx-combobox\");\n        this.attachShadow({ mode: \"open\" });\n        this.shadowRoot.adoptedStyleSheets = [\n            txCombobox,\n            txMenu,\n        ];\n    }\n    finalize() {\n        this.displayElement.onwheel = this.button.onwheel = this.wheel;\n        this.shadowRoot.replaceChildren(this.displayElement, this.button);\n    }\n    keydown(ev) {\n        ev.preventDefault();\n        if (this.model) {\n            switch (ev.key) {\n                case \"ArrowUp\":\n                    this.model.prev();\n                    break;\n                case \"ArrowDown\":\n                    this.model.next();\n                    break;\n                case \"Enter\":\n                    this.togglePopup();\n                    break;\n                case \"Escape\":\n                    if (this.popup !== undefined) {\n                        this.close();\n                    }\n                    break;\n            }\n        }\n    }\n    wheel(ev) {\n        ev.preventDefault();\n        if (this.model === undefined || !this.model.enabled) {\n            return;\n        }\n        this.displayElement.focus();\n        if (ev.deltaY > 0) {\n            this.model.next();\n        }\n        if (ev.deltaY < 0) {\n            this.model.prev();\n        }\n    }\n    pointerdown(ev) {\n        ev.preventDefault();\n        if (this.model === undefined || !this.model.enabled) {\n            return;\n        }\n        if (this.popup) {\n            this.close();\n            return;\n        }\n        this.displayElement.focus();\n        this.open();\n        this.button.setPointerCapture(ev.pointerId);\n    }\n    pointermove(ev) {\n        if (this.popup === undefined) {\n            return;\n        }\n        let newHover = this.findMenuItem(ev);\n        if (this.hover !== newHover) {\n            if (this.hover) {\n                this.hover.classList.remove(\"tx-hover\");\n            }\n            this.hover = newHover;\n            if (this.hover) {\n                this.hover.classList.add(\"tx-hover\");\n            }\n        }\n    }\n    findMenuItem(ev) {\n        let e = this.shadowRoot.elementFromPoint(ev.clientX, ev.clientY);\n        while (e) {\n            if (e.nodeName === \"LI\" &&\n                e.parentElement?.classList.contains(\"tx-menu\") &&\n                e.parentElement?.parentElement?.classList.contains(\"tx-popover\")) {\n                break;\n            }\n            e = e?.parentElement;\n        }\n        return (e ? e : undefined);\n    }\n    pointerup(ev) {\n        if (this.hover) {\n            const idx = parseInt(this.hover.dataset[\"idx\"]);\n            this.close();\n            this.select(idx);\n            return;\n        }\n        const e = this.shadowRoot.elementFromPoint(ev.clientX, ev.clientY);\n        if (this.displayElement.contains(e) || this.button.contains(e)) {\n            return;\n        }\n        this.close();\n    }\n    togglePopup() {\n        if (this.popup) {\n            this.close();\n        }\n        else {\n            this.open();\n        }\n    }\n    open() {\n        this.popup = div();\n        if (this.model) {\n            this.popup.replaceChildren(_jsx(\"ul\", { class: \"tx-menu\", \"aria-roledescription\": \"listbox\", children: this.model.map((value, key, idx) => {\n                    const l = li(this.model.asHtml(key));\n                    l.tabIndex = 0;\n                    l.ariaRoleDescription = \"option\";\n                    l.dataset[\"idx\"] = `${idx}`;\n                    l.onpointerdown = (ev) => {\n                        this.button.setPointerCapture(ev.pointerId);\n                        this.hover = l;\n                        ev.preventDefault();\n                    };\n                    l.onkeydown = this.keydown;\n                    return l;\n                }) }));\n        }\n        this.popup.classList.add(\"tx-popover\");\n        this.popup.style.position = \"fixed\";\n        this.popup.style.zIndex = \"99\";\n        this.shadowRoot.appendChild(this.popup);\n        placePopupVertical(this, this.popup);\n        this.focusToItem();\n    }\n    focusToItem() {\n        if (this.popup && this.model) {\n            const index = this.model.index;\n            if (index !== undefined) {\n                ;\n                this.popup.children[0].children[this.model.index].focus();\n            }\n        }\n    }\n    close() {\n        this.hover = undefined;\n        if (this.popup !== undefined) {\n            this.shadowRoot.removeChild(this.popup);\n            this.popup = undefined;\n            this.displayElement.focus();\n        }\n    }\n    select(index) {\n        if (this.model) {\n            this.model.index = index;\n        }\n    }\n    updateView() {\n        if (!this.model || !this.model.enabled) {\n            this.displayElement.classList.add(\"tx-disabled\");\n            this.displayElement.setAttribute(\"disabled\", \"\");\n            this.button.setAttribute(\"disabled\", \"\");\n        }\n        else {\n            this.displayElement.classList.remove(\"tx-disabled\");\n            this.displayElement.removeAttribute(\"disabled\");\n            this.button.removeAttribute(\"disabled\");\n        }\n        if (this.model?.error !== undefined) {\n            this.displayElement.classList.add(\"tx-error\");\n        }\n        else {\n            this.displayElement.classList.remove(\"tx-error\");\n        }\n    }\n}\nexport class Select extends SelectBase {\n    constructor(init) {\n        super(init);\n        this.displayElement = div();\n        this.displayElement.tabIndex = 0;\n        this.displayElement.style.minWidth = \"200px\";\n        this.displayElement.onpointerdown = this.pointerdown;\n        this.displayElement.onkeydown = this.keydown;\n        this.finalize();\n    }\n    updateView() {\n        super.updateView();\n        if (this.model !== undefined) {\n            this.displayElement.replaceChildren(this.model.html);\n        }\n        this.focusToItem();\n    }\n}\nexport class ComboBox extends SelectBase {\n    constructor(init) {\n        super(init);\n        this.textModel = init?.text;\n        this.displayElement = input();\n        this.displayElement.type = \"text\";\n        this.displayElement.onkeydown = (ev) => {\n            if (ev.key === \"Enter\" || this.popup !== undefined) {\n                this.keydown(ev);\n            }\n        };\n        this.displayElement.oninput = () => {\n            this.updateModel();\n        };\n        this.finalize();\n    }\n    close() {\n        super.close();\n        if (this.popup === undefined) {\n            this.displayElement.focus();\n        }\n    }\n    updateModel() {\n        if (this.model) {\n            if (typeof this.model.value === \"number\") {\n                this.model.value = Number.parseFloat(this.displayElement.value);\n            }\n            else {\n                this.model.value = this.displayElement.value;\n            }\n        }\n        if (this.textModel) {\n            this.textModel.value = this.displayElement.value;\n        }\n    }\n    updateView() {\n        super.updateView();\n        if (this.model !== undefined) {\n            this.displayElement.value = `${this.model.value}`;\n        }\n        this.focusToItem();\n    }\n}\nSelect.define(\"tx-select\", Select);\nComboBox.define(\"tx-combobox\", ComboBox);\n//# sourceMappingURL=Select.js.map","import { css } from \"../util/lsx.js\";\nexport const style = new CSSStyleSheet();\nstyle.replaceSync(css `\n    :host {\n        position: relative;\n        box-sizing: content-box;\n        display: inline-block;\n    }\n\n    :host(:not([orientation=\"vertical\"])) {\n        height: 4px;\n        width: 100%;\n        padding-top: 8px;\n        padding-bottom: 8px;\n    }\n\n    :host([orientation=\"vertical\"]) {\n        width: 4px;\n        height: 100%;\n        padding-left: 8px;\n        padding-right: 8px;\n    }\n\n    .tx-space {\n        position: absolute;\n        box-sizing: content-box;\n        padding: 0;\n        margin: 0;\n        border: 0;\n    }\n\n    :host(:not([orientation=\"vertical\"])) .tx-space {\n        left: 8px;\n        right: 8px;\n        top: 0;\n        bottom: 0;\n    }\n\n    :host([orientation=\"vertical\"]) .tx-space {\n        left: 0;\n        right: 0;\n        top: 8px;\n        bottom: 8px;\n    }\n\n    .tx-rail {\n        background-color: var(--tx-gray-300);\n        position: absolute;\n        display: block;\n        border-radius: 2px;\n    }\n\n    :host(:not([orientation=\"vertical\"])) .tx-rail {\n        top: 50%;\n        width: 100%;\n        height: 2px;\n        transform: translateY(-50%);\n    }\n\n    :host([orientation=\"vertical\"]) .tx-rail {\n        left: 50%;\n        height: 100%;\n        width: 2px;\n        transform: translateX(-50%);\n    }\n\n    :host([disabled]) .tx-rail {\n        background-color: var(--tx-gray-100);\n    }\n    :host([disabled]) .tx-track {\n        background-color: var(--tx-gray-100);\n    }\n    :host([disabled]) .tx-thumb {\n        border-color: var(--tx-gray-500);\n    }\n    .tx-track {\n        background-color: var(--tx-gray-700);\n        position: absolute;\n        display: block;\n        border-radius: 2px;\n    }\n\n    :host(:not([orientation=\"vertical\"])) .tx-track {  \n        top: 50%;\n        height: 2px;\n        transform: translateY(-50%);\n    }\n\n    :host([orientation=\"vertical\"]) .tx-track {  \n        left: 50%;\n        width: 2px;\n        transform: translateX(-50%);\n    }\n\n    .tx-thumb {\n        border: 2px solid var(--tx-gray-700); /* knob border */\n        border-radius: 50%;\n        background: var(--tx-gray-75); /* inside knob */\n        cursor: pointer;\n        position: absolute;\n        display: flex;\n        width: 14px;\n        height: 14px;\n        box-sizing: border-box;\n        outline-width: 0px;\n        border-radius: 50%;\n        transform: translate(-50%, -50%);\n    }\n    .tx-thumb:hover {\n        border-color: var(--tx-gray-800)\n    }\n\n    :host(:not([orientation=\"vertical\"])) .tx-thumb { \n        top: 50%;\n    }\n    :host([orientation=\"vertical\"]) .tx-thumb { \n        left: 50%;\n    }\n\n    .tx-focus {\n        outline: 2px solid;\n        outline-color: var(--tx-outline-color);\n        outline-offset: 1px;\n    }\n\n    .tx-thumb>input {\n        border: 0;\n        clip: rect(0, 0, 0, 0);\n        width: 100%;\n        height: 100%;\n        margin: -1px;\n        /* this hides most of the slider and centers the thumb */\n        overflow: hidden;\n        position: absolute;\n        white-space: nowrap;\n        direction: ltr;\n    }\n`);\n//# sourceMappingURL=tx-slider.js.map","export function hsv2rgb(h, s, v) {\n    const f = (n, k = (n + h / 60) % 6) => v - v * s * Math.max(Math.min(k, 4 - k, 1), 0);\n    return { r: f(5), g: f(3), b: f(1) };\n}\nexport function rgb2hsv(r, g, b) {\n    let v = Math.max(r, g, b), c = v - Math.min(r, g, b);\n    let h = c && (v == r ? (g - b) / c : v == g ? 2 + (b - r) / c : 4 + (r - g) / c);\n    return { h: 60 * (h < 0 ? h + 6 : h), s: v && c / v, v };\n}\nexport function rgb2hsl(rgb) {\n    const hsl = _rgb2hsl(rgb.r / 255, rgb.g / 255, rgb.b / 255);\n    return { h: hsl[0], s: hsl[1], l: hsl[2] };\n}\nfunction _hsl2rgb(h, s, l) {\n    let a = s * Math.min(l, 1 - l);\n    let f = (n, k = (n + h / 30) % 12) => l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);\n    return [f(0), f(8), f(4)];\n}\nfunction _rgb2hsl(r, g, b) {\n    let v = Math.max(r, g, b), c = v - Math.min(r, g, b), f = 1 - Math.abs(v + v - c - 1);\n    let h = c && (v == r ? (g - b) / c : v == g ? 2 + (b - r) / c : 4 + (r - g) / c);\n    return [60 * (h < 0 ? h + 6 : h), f ? c / f : 0, (v + v - c) / 2];\n}\nexport function parseColor(color) {\n    let m, r, g, b, a;\n    color = color.trim();\n    m = color.match(/^#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/);\n    if (m !== null) {\n        r = parseInt(m[1], 16);\n        g = parseInt(m[2], 16);\n        b = parseInt(m[3], 16);\n        r = r * 16 + r;\n        g = g * 16 + g;\n        b = b * 16 + b;\n        a = 1;\n        return { r, g, b, a };\n    }\n    m = color.match(/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/);\n    if (m !== null) {\n        r = parseInt(m[1], 16);\n        g = parseInt(m[2], 16);\n        b = parseInt(m[3], 16);\n        a = 1;\n        return { r, g, b, a };\n    }\n    m = color.match(/^rgb\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)$/);\n    if (m !== null) {\n        r = parseInt(m[1]);\n        g = parseInt(m[2]);\n        b = parseInt(m[3]);\n        a = 1;\n        return { r, g, b, a };\n    }\n    m = color.match(/^rgba\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)$/);\n    if (m !== null) {\n        r = parseInt(m[1]);\n        g = parseInt(m[2]);\n        b = parseInt(m[3]);\n        a = parseInt(m[4]);\n        return { r, g, b, a };\n    }\n    return undefined;\n}\n//# sourceMappingURL=color.js.map","import { ModelView } from \"./ModelView.js\";\nimport { style as txSlider } from \"../style/tx-slider.js\";\nimport { div, input, span } from \"../util/lsx.js\";\nimport { parseColor } from \"../util/color.js\";\nexport class Slider extends ModelView {\n    constructor(init) {\n        super(init);\n        this.vertical = init ? init.orientation === \"vertical\" : this.getAttribute(\"orientation\") === \"vertical\";\n        let container, rail, track, thumb, slider;\n        container =\n            div(rail = span(), track = span(), thumb = span(slider = input()));\n        container.classList.add(\"tx-space\");\n        rail.classList.add('tx-rail');\n        track.classList.add('tx-track');\n        thumb.classList.add('tx-thumb');\n        slider.type = \"range\";\n        this.input = slider;\n        this.rail = rail;\n        this.track = track;\n        this.thumb = thumb;\n        const minColor = init ? init.minColor : this.getAttribute(\"minColor\");\n        const maxColor = init ? init.maxColor : this.getAttribute(\"maxColor\");\n        if (minColor) {\n            this.minColor = parseColor(minColor);\n        }\n        if (maxColor) {\n            this.maxColor = parseColor(maxColor);\n        }\n        this.setGradient();\n        this.updateView();\n        slider.onfocus = () => {\n            thumb.classList.add(\"tx-focus\");\n        };\n        slider.onblur = () => {\n            thumb.classList.remove(\"tx-focus\");\n        };\n        slider.oninput = () => {\n            if (this.model) {\n                this.model.value = parseFloat(slider.value);\n            }\n        };\n        let skew = undefined;\n        thumb.onpointerdown = (ev) => {\n            if (this.model?.enabled !== true) {\n                return;\n            }\n            thumb.setPointerCapture(ev.pointerId);\n            const value = parseFloat(slider.value);\n            const b = this.getBoundingClientRect();\n            const min = parseFloat(slider.min);\n            const max = parseFloat(slider.max);\n            if (this.vertical) {\n                const v = max - (ev.clientY - b.y) / b.height * (max - min);\n                skew = value - v;\n            }\n            else {\n                const v = (ev.clientX - b.x) / b.width * (max - min) + min;\n                skew = value - v;\n            }\n        };\n        thumb.onpointermove = (ev) => {\n            if (skew === undefined) {\n                return;\n            }\n            ev.preventDefault();\n            const b = this.getBoundingClientRect();\n            const min = parseFloat(slider.min);\n            const max = parseFloat(slider.max);\n            let v;\n            if (this.vertical) {\n                v = max - (ev.clientY - b.y) / b.height * (max - min);\n            }\n            else {\n                v = (ev.clientX - b.x) / b.width * (max - min) + min + skew;\n            }\n            if (v < min) {\n                v = min;\n            }\n            if (v > max) {\n                v = max;\n            }\n            if (this.model) {\n                this.model.value = v;\n            }\n        };\n        thumb.onpointerup = (ev) => {\n            if (skew === undefined) {\n                return;\n            }\n            thumb.onpointermove(ev);\n            skew = undefined;\n        };\n        this.attachShadow({ mode: 'open', delegatesFocus: true });\n        this.shadowRoot.adoptedStyleSheets = [txSlider];\n        this.shadowRoot.replaceChildren(container);\n    }\n    setGradient() {\n        if (this.minColor && this.maxColor) {\n            if (this.model?.enabled === true) {\n                const rot = this.vertical ? \"0deg\" : \"90deg\";\n                const a = this.minColor;\n                const b = this.maxColor;\n                this.rail.style.backgroundImage = `linear-gradient(${rot}, rgb(${a.r},${a.g},${a.b}), rgb(${b.r},${b.g},${b.b}))`;\n            }\n            else {\n                this.rail.style.backgroundImage = \"\";\n            }\n            this.track.style.display = \"none\";\n        }\n    }\n    updateModel() {\n        if (this.model) {\n            this.model.value = Number.parseFloat(this.input.value);\n        }\n    }\n    updateView() {\n        this.setGradient();\n        if (!this.model) {\n            this.setAttribute(\"disabled\", \"disabled\");\n            return;\n        }\n        if (this.model.enabled) {\n            this.removeAttribute(\"disabled\");\n        }\n        else {\n            this.setAttribute(\"disabled\", \"disabled\");\n        }\n        if (this.model.step === undefined && this.model.min !== undefined && this.model.max !== undefined) {\n            this.input.step = `${(this.model.max - this.model.min) / 100}`;\n        }\n        else {\n            this.input.step = String(this.model.step);\n        }\n        this.input.min = String(this.model.min);\n        this.input.max = String(this.model.max);\n        this.input.value = String(this.model.value);\n        const min = this.model.min;\n        const max = this.model.max;\n        const value = this.model.value;\n        let v = (value - min) / (max - min);\n        if (this.minColor && this.maxColor) {\n            if (this.model?.enabled !== true) {\n                this.thumb.style.backgroundColor = \"\";\n            }\n            else {\n                const f = `rgb(${(this.maxColor.r - this.minColor.r) * v + this.minColor.r},${(this.maxColor.g - this.minColor.g) * v + this.minColor.g},${(this.maxColor.b - this.minColor.b) * v + this.minColor.b})`;\n                this.thumb.style.backgroundColor = f;\n            }\n        }\n        v *= 100;\n        if (this.vertical) {\n            this.track.style.top = `${100 - v}%`;\n            this.track.style.height = `${v}%`;\n            this.thumb.style.top = `${100 - v}%`;\n        }\n        else {\n            this.track.style.left = `0%`;\n            this.track.style.width = `${v}%`;\n            this.thumb.style.left = `${v}%`;\n        }\n    }\n}\nSlider.define(\"tx-slider\", Slider);\n//# sourceMappingURL=Slider.js.map","import { View } from \"./View.js\";\nexport class GenericTool extends View {\n    static focusIn(view) {\n        const viewParents = new Map();\n        for (let parent = view.parentElement, distance = 0; parent !== null; parent = parent.parentElement, ++distance) {\n            viewParents.set(parent, distance);\n        }\n        let closestToolDistance = Number.MAX_SAFE_INTEGER;\n        let closestParent;\n        let closestToolList = new Array();\n        for (const tool of this.allTools.values()) {\n            if (!tool.canHandle(view))\n                continue;\n            for (let toolParent = tool.parentElement, depth = 0; toolParent !== null; toolParent = toolParent.parentElement, ++depth) {\n                const toolDistance = viewParents.get(toolParent);\n                if (toolDistance === undefined)\n                    continue;\n                if (closestToolDistance < toolDistance)\n                    continue;\n                if (closestToolDistance > toolDistance) {\n                    closestToolList.length = 0;\n                }\n                closestToolDistance = toolDistance;\n                closestParent = toolParent;\n                closestToolList.push(tool);\n            }\n        }\n        if (!closestParent) {\n            return;\n        }\n        let closestTool;\n        const viewIndex = GenericTool.getIndex(view, closestParent);\n        let closestNextSiblingIndex = Number.MIN_SAFE_INTEGER;\n        for (let tool of closestToolList) {\n            const toolIndex = GenericTool.getIndex(tool, closestParent);\n            if (toolIndex < viewIndex && toolIndex > closestNextSiblingIndex) {\n                closestNextSiblingIndex = toolIndex;\n                closestTool = tool;\n            }\n        }\n        this.setActive(closestTool, view);\n    }\n    static getIndex(view, parent) {\n        if (parent === undefined) {\n            console.trace(`GenericTool.getIndex(${view}, ${parent})`);\n        }\n        let element = view;\n        while (element.parentElement !== parent)\n            element = element.parentElement;\n        return Array.from(parent.childNodes).indexOf(element);\n    }\n    static setActive(tool, view) {\n        if (this.activeTool)\n            this.activeTool.deactivate();\n        this.activeTool = tool;\n        this.activeView = view;\n        if (tool)\n            tool.activate();\n    }\n    static focusOut(view) {\n        if (this.activeView === view) {\n            this.setActive(undefined, undefined);\n        }\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        GenericTool.allTools.add(this);\n    }\n    disconnectedCallback() {\n        if (GenericTool.activeTool === this) {\n            GenericTool.setActive(undefined, undefined);\n        }\n        GenericTool.allTools.delete(this);\n        super.disconnectedCallback();\n    }\n}\nGenericTool.allTools = new Set();\nwindow.addEventListener(\"focusin\", (event) => {\n    if (event.target instanceof GenericTool)\n        return;\n    if (event.relatedTarget instanceof View) {\n        GenericTool.focusOut(event.relatedTarget);\n    }\n    if (event.target instanceof View) {\n        GenericTool.focusIn(event.target);\n    }\n});\n//# sourceMappingURL=GenericTool.js.map","import { ModelView } from \"./ModelView.js\";\nimport { css } from \"../util/lsx.js\";\nexport const toolbuttonStyle = new CSSStyleSheet();\ntoolbuttonStyle.replaceSync(css `\n:host {\n    display: inline-block;\n    overflow: hidden;\n    box-sizing: border-box;\n    border: 1px solid var(--tx-gray-400);\n    border-radius: 3px;\n    background: var(--tx-gray-400);\n    color: var(--tx-gray-900);\n    width: 24px;\n    height: 22px;\n    margin: 0;\n    padding: 0;\n}\n\n:host([selected]) {\n    background-color: var(--tx-gray-100);\n    border: 1px solid var(--tx-gray-100);\n}\n\n:host([disabled]) {\n    opacity: 0.5;\n}\n\n:host([disabled]) img {\n    opacity: 0.5;\n}\n`);\nexport class ToolButton extends ModelView {\n    constructor(init) {\n        super(init);\n        if (!init) {\n            init = {\n                value: this.getAttribute(\"value\"),\n            };\n        }\n        else {\n            this.setAttribute(\"value\", `${init.value}`);\n        }\n        this.value = init?.value;\n        this.onpointerdown = (event) => {\n            if (this.hasAttribute(\"disabled\")) {\n                return;\n            }\n            this.focus();\n            event.preventDefault();\n            if (this.model !== undefined) {\n                this.model.value = this.value;\n            }\n        };\n        this.attachShadow({ mode: 'open', delegatesFocus: true });\n        this.shadowRoot.adoptedStyleSheets = [toolbuttonStyle];\n        this.shadowRoot.appendChild(document.createElement(\"slot\"));\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        if (this.model === undefined) {\n            this.setAttribute(\"disabled\", \"\");\n        }\n    }\n    updateView() {\n        if (this.model === undefined) {\n            this.setAttribute(\"disabled\", \"\");\n            this.removeAttribute(\"selected\");\n            return;\n        }\n        if (this.model.enabled && this.model.isEnabledOf(this.value)) {\n            this.removeAttribute(\"disabled\");\n        }\n        else {\n            this.setAttribute(\"disabled\", \"\");\n        }\n        if (this.model.value === this.value) {\n            this.setAttribute(\"selected\", \"\");\n        }\n        else {\n            this.removeAttribute(\"selected\");\n        }\n    }\n}\nToolButton.define(\"tx-toolbutton\", ToolButton);\n//# sourceMappingURL=ToolButton.js.map","import { HtmlModel } from \"../model/HtmlModel.js\";\nimport { ModelView } from \"./ModelView.js\";\nexport class SlotView extends ModelView {\n    constructor(init) {\n        super(init);\n    }\n    updateView() {\n        if (!this.model)\n            return;\n        let value = this.model.value === undefined ? \"\" : this.model.value;\n        if (this.model instanceof HtmlModel)\n            this.innerHTML = value;\n        else\n            this.innerText = value;\n    }\n}\nSlotView.define(\"tx-slot\", SlotView);\n//# sourceMappingURL=SlotView.js.map","import { ModelView } from \"./ModelView.js\";\nexport class ToadIf extends ModelView {\n    constructor(init) {\n        super(init);\n    }\n    updateView() {\n        if (this.model) {\n            this.style.display = this.model.value ? \"\" : \"none\";\n        }\n    }\n}\nToadIf.define(\"tx-if\", ToadIf);\n//# sourceMappingURL=ToadIf.js.map","import { css } from \"../util/lsx.js\";\nexport const style = new CSSStyleSheet();\nstyle.replaceSync(css `\n    /*\n     * tabs, line, content\n     */\n    :host {\n        /* position: relative; */\n        display: grid;\n        /* flex-wrap: nowrap; */\n        /* box-sizing: border-box; */\n        margin: 0;\n        padding: 0;\n    }\n    :host(:not(.tx-vertical)) {\n        /* flex-direction: column; */\n        /* display: grid; */\n        /* height: */\n        grid-template-rows: 0 max-content auto;\n        grid-template-columns: 1;\n        /* https://stackoverflow.com/questions/43311943/prevent-content-from-expanding-grid-items */\n        /* https://www.w3.org/TR/css3-grid-layout/#min-size-auto */\n        min-width: 0;\n    }\n    :host(.tx-vertical) {\n        grid-template-rows: 1;\n        grid-template-columns: 0 max-content auto;\n        min-height: 0;\n    }\n\n    /*\n     * tabs\n     */\n    :host > ul {\n        display: flex;\n        flex-wrap: nowrap;\n        list-style: none;\n        box-sizing: border-box;\n        padding: 0;\n        margin: 0;\n    }\n    :host(:not(.tx-vertical)) > ul {\n        flex-direction: row;\n        border-bottom: 2px solid var(--tx-gray-200);\n    }\n    :host(.tx-vertical) > ul {\n        flex-direction: column;\n         border-left: 2px solid var(--tx-gray-200);\n    }\n    :host > ul > li {\n        box-sizing: border-box;\n        list-style: none;\n    }\n\n    /*\n     * label\n     */\n    :host > ul > li > span {\n        display: block;\n        list-style: none;\n        font-weight: 500;\n        margin: 8px 12px 8px 12px;\n        color: var(--tx-gray-700);\n        cursor: pointer;\n    }\n    :host(.tx-vertical) > ul > li > span {\n        margin: 0;\n        padding: 12px 8px 12px 8px;\n    }\n    :host > ul > li > span.active {\n        color: var(--tx-gray-900);\n    }\n    :host > ul > li > span:hover {\n        color: var(--tx-gray-900);\n    }\n\n    /*\n     * line\n     */\n    .line-container {\n        position: relative;\n        overflow: none;\n    }\n    :host > .line-container > .line {\n        position: absolute;\n        background-color: var(--tx-gray-900);\n        pointer-events: none;\n    }\n    :host(:not(.tx-vertical)) > .line-container > .line {\n        transition: left 0.5s ease-in-out, width 0.5s 0.1s;\n        /* position: relative; below labels */\n        top: 0px;\n        height: 2px;\n        left: 12px;\n        width: 0px;\n    }\n    :host(.tx-vertical) > .line-container > .line {\n        transition: top 0.5s ease-in-out, width 0.5s 0.1s;\n        /* position: absolute; */\n        left: 0; /* before labels */\n        height: 0px;\n        width: 2px;\n    }\n\n    /*\n     * content\n     */\n    .content {\n        overflow: auto;\n    }\n`);\n//# sourceMappingURL=tx-tabs.js.map","import { css } from \"../util/lsx.js\";\nexport const style = new CSSStyleSheet();\nstyle.replaceSync(css `\n    ::-webkit-scrollbar {\n        width: 10px;\n        height: 10px;\n    }\n    ::-webkit-scrollbar-thumb {\n        border-radius: 5px;\n    }\n    ::-webkit-scrollbar-track {\n        background: #1e1e1e;\n    }\n    ::-webkit-scrollbar-corner {\n        background: #1e1e1e;\n    }\n    ::-webkit-scrollbar-thumb {\n        background: var(--tx-gray-500);\n    }\n`);\n//# sourceMappingURL=tx-scrollbar.js.map","import { View } from \"../view/View.js\";\nimport { ul, li, span, text, div, slot } from \"../util/lsx.js\";\nimport { style as txTabs } from \"../style/tx-tabs.js\";\nimport { style as txScrollbar } from \"../style/tx-scrollbar.js\";\nimport { ModelView } from \"./ModelView.js\";\nexport class Tabs extends ModelView {\n    constructor(init) {\n        super(init);\n        this.labelMap = new Map();\n        this.activateTab = this.activateTab.bind(this);\n        this.classList.add(\"tx-tabs\");\n        this.vertical = this.hasAttribute(\"vertical\") || init?.orientation === \"vertical\";\n        if (this.vertical) {\n            this.classList.add(\"tx-vertical\");\n        }\n        let lineContainer, tabContainer;\n        const children = [\n            lineContainer = span(this.markerLine = div()),\n            tabContainer = ul(),\n            this.content = div(slot())\n        ];\n        lineContainer.classList.add(\"line-container\");\n        this.markerLine.classList.add(\"line\");\n        this.content.classList.add(\"content\");\n        let activeLabel = this.activeLabel, activePanel = this.activePanel;\n        for (let i = 0; i < this.children.length; ++i) {\n            const child = this.children[i];\n            if (!(child instanceof Tab)) {\n                console.log(`unexpected <${child.nodeName.toLowerCase()}> within <Tabs>`);\n                continue;\n            }\n            const panel = child;\n            if (typeof panel.value !== typeof this.model?.value) {\n                console.log(`Type error: Tab<${typeof panel.value}>({label=\"${panel.label}\", value=${panel.value}}) differs from Tabs<${typeof this.model?.value}>({model.value=${this.model?.value}})`);\n            }\n            let tabLabel;\n            tabContainer.appendChild(li((tabLabel = span(text(panel.getAttribute(\"label\"))))));\n            tabLabel.onpointerdown = (ev) => {\n                ev.stopPropagation();\n                ev.preventDefault();\n                this.activateTab(tabLabel, panel);\n            };\n            this.labelMap.set(panel, tabLabel);\n            if (activeLabel === undefined && (this.model === undefined || this.model.value === panel.value)) {\n                activeLabel = tabLabel;\n                activePanel = panel;\n            }\n            else {\n                panel.style.display = \"none\";\n            }\n        }\n        this.attachShadow({ mode: \"open\" });\n        this.shadowRoot.adoptedStyleSheets = [txTabs, txScrollbar];\n        this.shadowRoot.replaceChildren(...children);\n        if (activeLabel !== undefined) {\n            this.activateTab(activeLabel, activePanel);\n        }\n    }\n    updateView() {\n        if (!this.model) {\n            return;\n        }\n        for (let i = 0; i < this.children.length; ++i) {\n            const child = this.children[i];\n            if (!(child instanceof Tab)) {\n                console.log(`unexpected <${child.nodeName.toLowerCase()}> within <Tabs>`);\n                continue;\n            }\n            const tab = child;\n            if (this.model.value === tab.value) {\n                this.activateTab(this.labelMap.get(tab), tab);\n                break;\n            }\n        }\n    }\n    activateTab(tabLabel, panel) {\n        if (this.activePanel === panel) {\n            return;\n        }\n        if (this.activeLabel !== undefined && this.activePanel !== undefined) {\n            this.activeLabel.classList.remove(\"active\");\n            this.activePanel.style.display = \"none\";\n            this.activePanel.close();\n        }\n        this.activeLabel = tabLabel;\n        this.activePanel = panel;\n        this.activePanel.open();\n        this.activeLabel.classList.add(\"active\");\n        this.activePanel.style.display = \"\";\n        setTimeout(() => this.adjustLine(), 0);\n        if (this.model && panel.value !== undefined) {\n            this.model.value = panel.value;\n        }\n    }\n    adjustLine() {\n        const line = this.markerLine;\n        const label = this.activeLabel;\n        if (label !== undefined) {\n            if (this.vertical) {\n                line.style.top = `${label.offsetTop - this.offsetTop}px`;\n                line.style.height = `${label.clientHeight}px`;\n            }\n            else {\n                line.style.top = `-2px`;\n                line.style.left = `${label.offsetLeft - this.offsetLeft}px`;\n                line.style.width = `${label.clientWidth}px`;\n            }\n        }\n    }\n}\nTabs.define(\"tx-tabs\", Tabs);\nexport class Tab extends View {\n    constructor(init) {\n        super(init);\n        this.value = init?.value;\n        this.label = init?.label;\n        this.content = init?.content;\n    }\n    open() {\n        if (this.childNodes.length === 0 && this.content !== undefined) {\n            const content = this.content();\n            if (content instanceof Promise) {\n                content.then((module) => {\n                    if (typeof module === \"object\" && \"default\" in module) {\n                        const viewOrViewFunction = module.default;\n                        if (typeof viewOrViewFunction === \"function\") {\n                            const viewOrPromise = viewOrViewFunction();\n                            if (viewOrPromise instanceof Promise) {\n                                viewOrPromise.then((s) => {\n                                    appendChildren(this, s);\n                                });\n                            }\n                            else {\n                                appendChildren(this, viewOrPromise);\n                            }\n                        }\n                        else {\n                            appendChildren(this, viewOrViewFunction);\n                        }\n                    }\n                });\n            }\n            else {\n                appendChildren(this, this.content());\n            }\n        }\n    }\n    close() { }\n}\nView.define(\"tx-tab\", Tab);\nfunction appendChildren(element, children) {\n    for (const child of children) {\n        if (child instanceof Array) {\n            appendChildren(element, child);\n            continue;\n        }\n        if (typeof child === \"string\") {\n            element.appendChild(document.createTextNode(child));\n            continue;\n        }\n        element.appendChild(child);\n    }\n}\n//# sourceMappingURL=Tab.js.map","import { css } from \"../util/lsx.js\";\nexport const menuStyle = new CSSStyleSheet();\nmenuStyle.replaceSync(css `\n  :host(.menu-button) {\n    font-family: var(--tx-font-family);\n    font-size: var(--tx-edit-font-size);\n    font-weight: var(--tx-edit-font-weight);\n    padding: 7px;\n    vertical-align: center;\n  \n    background: var(--tx-gray-200);\n    color: var(--tx-gray-900);\n    cursor: default;\n  }\n  :host(.menu-button:hover) {\n    background: var(--tx-gray-300);\n  }\n  :host(.menu-button.active) {\n    background: var(--tx-gray-400);\n    color: var(--tx-gray-900);\n  }\n  :host(.menu-button.disabled) {\n    color: var(--tx-gray-500);\n  }\n  :host(.menu-button.active.disabled) {\n    color: var(--tx-gray-700);\n  }\n  :host(.menu-button.menu-down) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;base64,${btoa('<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"14\"><path d=\"M 0 4 l 10 0 l -5 5 Z\" fill=\"#fff\" stroke=\"none\"/></svg>')}\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-down) {\n    background-image: url(\"data:image/svg+xml;base64,${btoa('<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"14\"><path d=\"M 0 4 l 10 0 l -5 5 Z\" fill=\"#fff\" stroke=\"none\"/></svg>')}\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.menu-side) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;base64,${btoa('<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"14\"><path d=\"M 0 2 l 0 10 l 5 -5 Z\" fill=\"#fff\" stroke=\"none\"/></svg>')}\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-side) {\n    background-image: url(\"data:image/svg+xml;base64,${btoa('<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"14\"><path d=\"M 0 2 l 0 10 l 5 -5 Z\" fill=\"#fff\" stroke=\"none\"/></svg>')}\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  .menu-bar {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: center;\n    background-color: var(--tx-gray-200);\n  }\n  .menu-popup {\n    position: fixed;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 2px 2px 5px var(--tx-gray-50);\n  }\n`);\n//# sourceMappingURL=menuStyle.js.map","import { Action } from \"../model/Action.js\";\nimport { HtmlModel } from \"../model/HtmlModel.js\";\nimport { TextModel } from \"../model/TextModel.js\";\nimport { ModelView } from \"../view/ModelView.js\";\nimport { globalController } from \"../controller/globalController.js\";\nimport { menuStyle } from \"./menuStyle.js\";\nimport { MenuState } from \"./MenuState.js\";\nimport { PopupMenu } from \"./PopupMenu.js\";\nexport class MenuButton extends ModelView {\n    constructor(master, node) {\n        super();\n        this.master = master;\n        this.node = node;\n        let menuButton = this;\n        this.classList.add(\"menu-button\");\n        if (node.down) {\n            if (master.vertical)\n                this.classList.add(\"menu-side\");\n            else\n                this.classList.add(\"menu-down\");\n        }\n        this.updateView();\n        this.onmousedown = (event) => {\n            event.stopPropagation();\n            let documentMouseUp = function (event) {\n                document.removeEventListener(\"mouseup\", documentMouseUp, { capture: true });\n                event.preventDefault();\n                setTimeout(() => {\n                    if (MenuButton.buttonDown)\n                        menuButton.dispatchEvent(new MouseEvent(\"mouseup\", event));\n                }, 0);\n            };\n            document.addEventListener(\"mouseup\", documentMouseUp, { capture: true });\n            MenuButton.buttonDown = true;\n            if (!this.master)\n                throw Error(\"yikes\");\n            switch (this.master.state) {\n                case MenuState.WAIT:\n                    this.master.state = MenuState.DOWN;\n                    this.activate();\n                    break;\n                case MenuState.UP_N_HOLD:\n                    if (this.master.active !== this) {\n                        this.master.state = MenuState.DOWN;\n                        this.activate();\n                    }\n                    else {\n                        this.master.state = MenuState.DOWN_N_HOLD;\n                    }\n                    break;\n                default:\n                    throw Error(\"unexpected state \" + this.master.state);\n            }\n            return false;\n        };\n        this.onmouseup = (event) => {\n            event.stopPropagation();\n            if (!MenuButton.buttonDown)\n                return;\n            MenuButton.buttonDown = false;\n            if (!this.master)\n                throw Error(\"yikes\");\n            if (!this.node)\n                throw Error(\"yikes\");\n            switch (this.master.state) {\n                case MenuState.DOWN:\n                    if (this.node.isEnabled() && !this.node.down) {\n                        this.trigger();\n                        this.master.state = MenuState.WAIT;\n                    }\n                    else {\n                        this.master.state = MenuState.UP_N_HOLD;\n                        if (MenuButton.documentMouseDown) {\n                            document.removeEventListener(\"mousedown\", MenuButton.documentMouseDown, { capture: false });\n                        }\n                        MenuButton.documentMouseDown = function (event) {\n                            if (MenuButton.documentMouseDown)\n                                document.removeEventListener(\"mousedown\", MenuButton.documentMouseDown, {\n                                    capture: false,\n                                });\n                            MenuButton.documentMouseDown = undefined;\n                            let tagName = event.target.tagName;\n                            if (tagName !== \"TOAD-MENUBUTTON\") {\n                                menuButton.collapse();\n                            }\n                        };\n                        document.addEventListener(\"mousedown\", MenuButton.documentMouseDown, { capture: false });\n                    }\n                    break;\n                case MenuState.DOWN_N_HOLD:\n                case MenuState.DOWN_N_OUTSIDE:\n                    this.master.state = MenuState.WAIT;\n                    this.deactivate();\n                    this.collapse();\n                    if (this.master.closeOnClose) {\n                    }\n                    break;\n                case MenuState.DOWN_N_INSIDE_AGAIN:\n                    this.trigger();\n                    break;\n                default:\n                    throw Error(\"unexpected state \" + this.master.state);\n            }\n            return false;\n        };\n        this.onmouseout = (event) => {\n            event.stopPropagation();\n            if (!this.master)\n                throw Error(\"yikes\");\n            MenuButton.inside = undefined;\n            switch (this.master.state) {\n                case MenuState.WAIT:\n                case MenuState.DOWN_N_OUTSIDE:\n                case MenuState.UP_N_HOLD:\n                case MenuState.DOWN_N_HOLD:\n                    break;\n                case MenuState.DOWN:\n                case MenuState.DOWN_N_INSIDE_AGAIN:\n                    this.master.state = MenuState.DOWN_N_OUTSIDE;\n                    this.updateView();\n                    break;\n                default:\n                    throw Error(\"unexpected state\");\n            }\n            return false;\n        };\n        this.onmouseover = (event) => {\n            event.stopPropagation();\n            if (!menuButton.master)\n                throw Error(\"yikes\");\n            MenuButton.inside = menuButton;\n            switch (menuButton.master.state) {\n                case MenuState.WAIT:\n                case MenuState.UP_N_HOLD:\n                case MenuState.DOWN_N_OUTSIDE:\n                case MenuState.DOWN_N_HOLD:\n                case MenuState.DOWN:\n                case MenuState.DOWN_N_INSIDE_AGAIN:\n                    if (!MenuButton.buttonDown)\n                        break;\n                    if (!this.master)\n                        throw Error(\"yikes\");\n                    if (this.master.active)\n                        this.master.active.deactivate();\n                    this.master.state = MenuState.DOWN_N_INSIDE_AGAIN;\n                    this.activate();\n                    break;\n                default:\n                    throw Error(\"unexpected state \" + menuButton.master.state);\n            }\n            return false;\n        };\n        this.attachShadow({ mode: \"open\" });\n        if (!this.shadowRoot)\n            throw Error(\"yikes\");\n        this.shadowRoot.adoptedStyleSheets = [menuStyle];\n        if (!this.node.modelId) {\n            this.shadowRoot.appendChild(document.createTextNode(node.label));\n        }\n    }\n    connectedCallback() {\n        if (this.controller)\n            return;\n        if (this.node.down === undefined) {\n            let actionId = this.node.title;\n            for (let node = this.node.parent; node; node = node.parent) {\n                if (!node.title.length)\n                    break;\n                actionId = node.title + \"|\" + actionId;\n            }\n            actionId = \"A:\" + actionId;\n            globalController.registerView(actionId, this);\n        }\n        if (this.node.modelId !== undefined) {\n            if (typeof this.node.modelId === \"string\") {\n                let modelId = \"M:\" + this.node.modelId;\n                globalController.registerView(modelId, this);\n            }\n            else {\n                this.setModel(this.node.modelId);\n            }\n        }\n    }\n    disconnectedCallback() {\n        if (this.controller)\n            this.controller.unregisterView(this);\n    }\n    setModel(model) {\n        if (!model) {\n            if (this.action)\n                this.action.modified.remove(this);\n            this.model = undefined;\n            this.action = undefined;\n            this.updateView();\n            return;\n        }\n        if (model instanceof Action) {\n            this.action = model;\n            this.action.modified.add(() => {\n                this.updateView();\n            }, this);\n        }\n        else if (model instanceof TextModel) {\n            this.model = model;\n        }\n        else {\n            if (typeof model === \"object\") {\n                throw Error(`unexpected model of type ${model.constructor.name}`);\n            }\n            else {\n                throw Error(`unexpected model of type ${typeof model}`);\n            }\n        }\n        this.updateView();\n    }\n    updateView() {\n        if (this.model && this.model.value) {\n            if (!this.shadowRoot)\n                throw Error(\"yikes\");\n            let span = document.createElement(\"span\");\n            if (this.model instanceof HtmlModel)\n                span.innerHTML = this.model.value;\n            else\n                span.innerText = this.model.value;\n            if (this.shadowRoot.children.length > 1)\n                this.shadowRoot.removeChild(this.shadowRoot.children[1]);\n            if (this.shadowRoot.children.length > 1)\n                this.shadowRoot.insertBefore(span, this.shadowRoot.children[1]);\n            else\n                this.shadowRoot.appendChild(span);\n        }\n        if (!this.master)\n            throw Error(\"yikes\");\n        let active = false;\n        if (this.master.active == this) {\n            switch (this.master.state) {\n                case MenuState.DOWN:\n                case MenuState.UP_N_HOLD:\n                case MenuState.DOWN_N_HOLD:\n                case MenuState.DOWN_N_INSIDE_AGAIN:\n                    active = true;\n                    break;\n                case MenuState.DOWN_N_OUTSIDE:\n                    if (!this.node)\n                        throw Error(\"yikes\");\n                    active = this.node.down !== undefined && this.node.isEnabled();\n                    break;\n            }\n        }\n        this.classList.toggle(\"active\", active);\n        this.classList.toggle(\"disabled\", !this.isEnabled());\n    }\n    isEnabled() {\n        if (this.node.down !== undefined)\n            return true;\n        return this.action !== undefined && this.action.enabled;\n    }\n    trigger() {\n        this.collapse();\n        if (!this.action)\n            return;\n        this.action.trigger();\n    }\n    collapse() {\n        if (!this.master)\n            throw Error(\"yikes\");\n        if (this.master.parentButton)\n            this.master.parentButton.collapse();\n        else\n            this.deactivate();\n    }\n    openPopup() {\n        if (!this.node)\n            return;\n        if (!this.node.down)\n            return;\n        if (!this.shadowRoot)\n            throw Error(\"yikes\");\n        if (!this.popup) {\n            this.popup = new PopupMenu(this.node, this);\n            this.shadowRoot.appendChild(this.popup);\n        }\n        else {\n            this.popup.show();\n        }\n    }\n    closePopup() {\n        if (!this.popup)\n            return;\n        if (this.popup.active)\n            this.popup.active.deactivate();\n        this.popup.hide();\n    }\n    activate() {\n        if (!this.master)\n            throw Error(\"yikes\");\n        if (!this.node)\n            throw Error(\"yikes\");\n        let oldActive = this.master.active;\n        this.master.active = this;\n        if (oldActive && oldActive !== this) {\n            oldActive.closePopup();\n            oldActive.updateView();\n        }\n        this.updateView();\n        this.openPopup();\n    }\n    deactivate() {\n        if (!this.master)\n            throw Error(\"yikes\");\n        if (this.master.active !== this)\n            return;\n        this.master.active.closePopup();\n        this.master.active = undefined;\n        this.master.state = MenuState.WAIT;\n        this.updateView();\n    }\n}\nMenuButton.define(\"tx-menubutton\", MenuButton);\n//# sourceMappingURL=MenuButton.js.map","import { MenuButton } from \"./MenuButton.js\";\nexport class MenuNode {\n    constructor(title, label, shortcut, type, modelId) {\n        this.title = title;\n        this.label = label;\n        this.shortcut = shortcut;\n        this.type = type ? type : \"entry\";\n        this.modelId = modelId;\n    }\n    isEnabled() {\n        return true;\n    }\n    isAvailable() {\n        return true;\n    }\n    createWindowAt(parent, parentView) {\n        if (this.type == \"spacer\") {\n            let span = document.createElement(\"span\");\n            span.style.flexGrow = \"1\";\n            parentView.appendChild(span);\n            return;\n        }\n        this.view = new MenuButton(parent, this);\n        parentView.appendChild(this.view);\n    }\n    deleteWindow() {\n    }\n}\n//# sourceMappingURL=MenuNode.js.map","import * as dom from \"../util/dom.js\";\nimport { MenuNode } from \"./MenuNode.js\";\nimport { MenuButtonContainer } from \"./MenuHelper.js\";\nimport { menuStyle } from \"./menuStyle.js\";\nexport class Menu extends MenuButtonContainer {\n    constructor(props) {\n        super(props);\n        this.config = props?.config;\n        this.vertical = false;\n        this.root = new MenuNode(\"\", \"\", undefined, undefined);\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        this.tabIndex = 0;\n        if (this.config) {\n            this.config2nodes(this.config, this.root);\n            this.referenceActions();\n            this.createShadowDOM();\n            return;\n        }\n        if (this.children.length === 0) {\n            this._observer = new MutationObserver((record, observer) => {\n                if (this._timer !== undefined)\n                    clearTimeout(this._timer);\n                this._timer = window.setTimeout(() => {\n                    this._timer = undefined;\n                    this.layout2nodes(this.children, this.root);\n                    this.referenceActions();\n                    this.createShadowDOM();\n                }, 100);\n            });\n            this._observer.observe(this, {\n                childList: true,\n                subtree: true\n            });\n        }\n        else {\n            this.layout2nodes(this.children, this.root);\n            this.referenceActions();\n            this.createShadowDOM();\n        }\n    }\n    layout2nodes(children, parent) {\n        let node = parent.down;\n        for (let child of children) {\n            let newnode = undefined;\n            switch (child.nodeName) {\n                case \"TX-MENUSPACER\":\n                    newnode = new MenuNode(\"\", \"\", \"\", \"spacer\");\n                    break;\n                case \"TX-MENUENTRY\":\n                    newnode = new MenuNode(dom.attribute(child, \"name\"), dom.attribute(child, \"label\"), dom.attributeOrUndefined(child, \"shortcut\"), dom.attributeOrUndefined(child, \"type\"), dom.attributeOrUndefined(child, \"model\"));\n                    break;\n            }\n            if (newnode) {\n                newnode.parent = parent;\n                if (!node)\n                    parent.down = newnode;\n                else\n                    node.next = newnode;\n                node = newnode;\n            }\n            if (!node)\n                throw Error(\"yikes\");\n            this.layout2nodes(child.children, node);\n        }\n    }\n    config2nodes(config, parent) {\n        let node = parent.down;\n        for (let child of config) {\n            let newnode = undefined;\n            if (child.space === true) {\n                newnode = new MenuNode(\"\", \"\", \"\", \"spacer\");\n            }\n            else {\n                newnode = new MenuNode(child.name, child.label, child.shortcut, child.type, child.model);\n            }\n            if (newnode) {\n                newnode.parent = parent;\n                if (!node)\n                    parent.down = newnode;\n                else\n                    node.next = newnode;\n                node = newnode;\n            }\n            if (!node)\n                throw Error(\"yikes\");\n            if (child.sub)\n                this.config2nodes(child.sub, node);\n        }\n    }\n    referenceActions() {\n    }\n    findNode(str, parent) {\n        let strpos = str.indexOf(\"|\");\n        let left = strpos == -1 ? str : str.substr(0, strpos);\n        let right = strpos == -1 ? \"\" : str.substr(strpos + 1);\n        if (!parent)\n            parent = this.root;\n        for (let n = parent.down; n; n = n.next) {\n            if (n.title == left) {\n                if (!n.down) {\n                    return n;\n                }\n                return this.findNode(right, n);\n            }\n        }\n        return undefined;\n    }\n    createShadowDOM() {\n        this.view = document.createElement(\"div\");\n        this.view.classList.add(\"menu-bar\");\n        let node = this.root.down;\n        while (node) {\n            if (node.isAvailable()) {\n                node.createWindowAt(this, this.view);\n            }\n            else {\n                node.deleteWindow();\n            }\n            node = node.next;\n        }\n        this.attachShadow({ mode: 'open' });\n        this.shadowRoot.adoptedStyleSheets = [menuStyle];\n        this.shadowRoot.appendChild(this.view);\n    }\n}\nMenu.define(\"tx-menu\", Menu);\n//# sourceMappingURL=Menu.js.map","import { View } from \"../view/View.js\";\nexport class MenuSpacer extends HTMLElement {\n}\nView.define(\"tx-menuspacer\", MenuSpacer);\n//# sourceMappingURL=MenuSpacer.js.map","import { Model } from \"../../model/Model.js\";\nexport class TableModel extends Model {\n    isEmpty() { return this.colCount === 0 && this.rowCount === 0; }\n}\n//# sourceMappingURL=TableModel.js.map","export var TableEditMode;\n(function (TableEditMode) {\n    TableEditMode[TableEditMode[\"EDIT_CELL\"] = 0] = \"EDIT_CELL\";\n    TableEditMode[TableEditMode[\"SELECT_CELL\"] = 1] = \"SELECT_CELL\";\n    TableEditMode[TableEditMode[\"SELECT_ROW\"] = 2] = \"SELECT_ROW\";\n})(TableEditMode || (TableEditMode = {}));\n//# sourceMappingURL=TableEditMode.js.map","import { TypedTableModel } from \"../model/TypedTableModel.js\";\nexport var EditMode;\n(function (EditMode) {\n    EditMode[EditMode[\"EDIT_ON_FOCUS\"] = 0] = \"EDIT_ON_FOCUS\";\n    EditMode[EditMode[\"EDIT_ON_ENTER\"] = 1] = \"EDIT_ON_ENTER\";\n})(EditMode || (EditMode = {}));\nexport class TableAdapterConfig {\n    constructor() {\n        this.editMode = EditMode.EDIT_ON_FOCUS;\n        this.seamless = false;\n        this.expandColumn = false;\n        this.expandRow = false;\n    }\n}\nexport class TableAdapter {\n    constructor(model) {\n        this.config = new TableAdapterConfig();\n        this.model = model;\n    }\n    get colCount() { return this.model === undefined ? 0 : this.model.colCount; }\n    get rowCount() { return this.model === undefined ? 0 : this.model.rowCount; }\n    getColumnHead(col) { return undefined; }\n    getRowHead(row) { return undefined; }\n    showCell(pos, cell) { }\n    saveCell(pos, cell) { }\n    editCell(pos, cell) { }\n    isViewCompact() { return false; }\n    static register(adapter, model, data) {\n        let typeToModel = TableAdapter.modelToAdapter.get(model);\n        if (typeToModel === undefined) {\n            typeToModel = new Map();\n            TableAdapter.modelToAdapter.set(model, typeToModel);\n        }\n        if (data !== undefined) {\n            if (typeToModel.has(data)) {\n                throw Error(`attempt to redefine existing table adapter`);\n            }\n            typeToModel.set(data, adapter);\n        }\n        else {\n            if (typeToModel.has(null)) {\n                throw Error(`attempt to redefine existing table adapter`);\n            }\n            typeToModel.set(null, adapter);\n        }\n    }\n    static unbind() {\n        TableAdapter.modelToAdapter.clear();\n    }\n    static lookup(model) {\n        let dataType;\n        if (model instanceof TypedTableModel) {\n            dataType = model.nodeClass;\n        }\n        else {\n            dataType = null;\n        }\n        const typeToAdapter = TableAdapter.modelToAdapter.get(Object.getPrototypeOf(model).constructor);\n        let adapter = typeToAdapter?.get(dataType);\n        if (adapter === undefined) {\n            for (let baseClass of TableAdapter.modelToAdapter.keys()) {\n                if (model instanceof baseClass) {\n                    adapter = TableAdapter.modelToAdapter.get(baseClass)?.get(dataType);\n                    break;\n                }\n            }\n        }\n        if (adapter === undefined) {\n            let msg = `TableAdapter.lookup(): Did not find an adapter for model of type ${model.constructor.name}`;\n            msg += `\\n    Requested adapter: model=${model.constructor.name}, type=${dataType?.name}\\n    Available adapters:`;\n            if (TableAdapter.modelToAdapter.size === 0) {\n                msg += \" none.\";\n            }\n            else {\n                for (const [modelX, typeToAdapterX] of TableAdapter.modelToAdapter) {\n                    for (const [typeX, adapterX] of typeToAdapterX) {\n                        msg += `\\n        model=${modelX.name}`;\n                        if (typeX !== undefined && typeX !== null) {\n                            msg += `, type=${typeX.name}`;\n                        }\n                    }\n                }\n            }\n            throw Error(msg);\n        }\n        return adapter;\n    }\n}\nTableAdapter.modelToAdapter = new Map();\n//# sourceMappingURL=TableAdapter.js.map","export var TableEventType;\n(function (TableEventType) {\n    TableEventType[TableEventType[\"INSERT_ROW\"] = 0] = \"INSERT_ROW\";\n    TableEventType[TableEventType[\"REMOVE_ROW\"] = 1] = \"REMOVE_ROW\";\n    TableEventType[TableEventType[\"INSERT_COL\"] = 2] = \"INSERT_COL\";\n    TableEventType[TableEventType[\"REMOVE_COL\"] = 3] = \"REMOVE_COL\";\n    TableEventType[TableEventType[\"CELL_CHANGED\"] = 4] = \"CELL_CHANGED\";\n    TableEventType[TableEventType[\"RESIZE_ROW\"] = 5] = \"RESIZE_ROW\";\n    TableEventType[TableEventType[\"RESIZE_COL\"] = 6] = \"RESIZE_COL\";\n    TableEventType[TableEventType[\"CHANGED\"] = 7] = \"CHANGED\";\n})(TableEventType || (TableEventType = {}));\n//# sourceMappingURL=TableEventType.js.map","export class TablePos {\n    constructor(col, row) {\n        this.col = col;\n        this.row = row;\n    }\n    toString() {\n        return `TablePos { col:${this.col}, row:${this.row} }`;\n    }\n}\n//# sourceMappingURL=TablePos.js.map","import { Model } from \"../../model/Model.js\";\nimport { TableEditMode } from \"../TableEditMode.js\";\nimport { TablePos } from \"../TablePos.js\";\nexport class SelectionModel extends Model {\n    constructor(mode = TableEditMode.EDIT_CELL) {\n        super();\n        this.mode = mode;\n        this._value = new TablePos(0, 0);\n    }\n    set col(col) {\n        if (this._value.col === col)\n            return;\n        this._value.col = col;\n        this.modified.trigger();\n    }\n    get col() {\n        return this._value.col;\n    }\n    set row(row) {\n        if (this._value.row === row)\n            return;\n        this._value.row = row;\n        this.modified.trigger();\n    }\n    get row() {\n        return this._value.row;\n    }\n    set value(value) {\n        if (this._value.col === value.col && this._value.row === value.row)\n            return;\n        this._value = value;\n        this.modified.trigger();\n    }\n    get value() {\n        return this._value;\n    }\n    toString() {\n        return `SelectionModel {enabled: ${this.enabled}, mode: ${TableEditMode[this.mode]}, value: ${this._value}}`;\n    }\n}\n//# sourceMappingURL=SelectionModel.js.map","import { TableModel } from \"./TableModel.js\";\nexport class TypedTableModel extends TableModel {\n    constructor(nodeClass, root) {\n        super();\n        this.nodeClass = nodeClass;\n    }\n}\n//# sourceMappingURL=TypedTableModel.js.map","import { TableEventType } from \"./TableEventType.js\";\nexport class TableEvent {\n    constructor(type, index, size) {\n        this.type = type;\n        this.index = index;\n        this.size = size;\n    }\n    get col() {\n        return this.index;\n    }\n    get row() {\n        return this.size;\n    }\n    toString() {\n        return `TableEvent {type: ${TableEventType[this.type]}, index: ${this.index}, size: ${this.size}}`;\n    }\n}\n//# sourceMappingURL=TableEvent.js.map","export class TableFriend {\n    constructor(table) {\n        this.table = table;\n    }\n    get logger() {\n        return this.table.logger;\n    }\n    get adapter() {\n        return this.table.adapter;\n    }\n    get root() {\n        return this.table.root;\n    }\n    get measure() {\n        return this.table.measure;\n    }\n    focus() {\n        this.table.focus();\n    }\n    getStaging() {\n        const animator = this.table.animator;\n        if (animator.current === undefined)\n            return undefined;\n        const animation = animator.current;\n        return animation.bodyStaging;\n    }\n    getHeadStaging() {\n        const animator = this.table.animator;\n        if (animator.current === undefined)\n            return undefined;\n        const animation = animator.current;\n        return animation.headStaging;\n    }\n    get body() {\n        return this.table.body;\n    }\n    get splitBody() {\n        return this.table.splitBody;\n    }\n    get colHeads() {\n        return this.table.colHeads;\n    }\n    set colHeads(div) {\n        this.table.colHeads = div;\n    }\n    get rowHeads() {\n        return this.table.rowHeads;\n    }\n    set rowHeads(div) {\n        this.table.rowHeads = div;\n    }\n    get colResizeHandles() {\n        return this.table.colResizeHandles;\n    }\n    set colResizeHandles(div) {\n        this.table.colResizeHandles = div;\n    }\n    get rowResizeHandles() {\n        return this.table.rowResizeHandles;\n    }\n    set rowResizeHandles(div) {\n        this.table.rowResizeHandles = div;\n    }\n    set animationDone(animationDone) {\n        this.table.animationDone = animationDone;\n    }\n    get selection() {\n        return this.table.selection;\n    }\n    get style() {\n        return this.table.style;\n    }\n    setCellSize(span, x, y, w, h) {\n        this.table.setCellSize(span, x, y, w, h);\n    }\n    clearAnimation() {\n        this.table.animation = undefined;\n    }\n}\n//# sourceMappingURL=TableFriend.js.map","import { Table } from \"../Table.js\";\nimport { TableFriend } from \"./TableFriend.js\";\nimport { div, span } from \"../../util/lsx.js\";\nexport class TableAnimation extends TableFriend {\n    constructor(table) {\n        super(table);\n    }\n    prepareStagingWithRows() {\n        this.prepareBodyStaging();\n        this.prepareRowHeadStaging();\n        this.table.addStaging(this.bodyStaging, this.headStaging);\n        this.scrollStaging();\n    }\n    prepareStagingWithColumns() {\n        this.prepareBodyStaging();\n        this.prepareColHeadStaging();\n        this.table.addStaging(this.bodyStaging, this.headStaging);\n        this.scrollStaging();\n    }\n    prepareBodyStaging() {\n        this.bodyStaging = div();\n        this.bodyStaging.className = \"staging\";\n        this.bodyStaging.style.left = this.body.style.left;\n        this.bodyStaging.style.top = this.body.style.top;\n    }\n    prepareRowHeadStaging() {\n        if (this.rowHeads === undefined) {\n            return;\n        }\n        this.headStaging = div();\n        this.headStaging.classList.add(\"staging\");\n        this.headStaging.style.top = this.rowHeads.style.top;\n        this.headStaging.style.width = this.rowHeads.style.width;\n    }\n    prepareColHeadStaging() {\n        if (this.colHeads === undefined) {\n            return;\n        }\n        this.headStaging = div();\n        this.headStaging.classList.add(\"staging\");\n        this.headStaging.classList.add(\"colHack\");\n        this.headStaging.style.left = this.colHeads.style.left;\n        this.headStaging.style.height = this.colHeads.style.height;\n    }\n    disposeStaging() {\n        this.table.removeStaging(this.bodyStaging, this.headStaging);\n    }\n    scrollStaging() {\n    }\n    makeRowMask(start, size) {\n        const mask = span();\n        mask.style.boxSizing = `content-box`;\n        mask.style.top = `${start}px`;\n        mask.style.height = `${size}px`;\n        mask.style.left = `0`;\n        mask.style.right = `0`;\n        mask.style.border = 'none';\n        mask.style.backgroundColor = Table.maskColor;\n        return mask;\n    }\n    makeColumnMask(start, size) {\n        const mask = span();\n        mask.style.boxSizing = `content-box`;\n        mask.style.left = `${start}px`;\n        mask.style.width = `${size}px`;\n        mask.style.top = `0`;\n        mask.style.bottom = `0`;\n        mask.style.border = 'none';\n        mask.style.backgroundColor = Table.maskColor;\n        return mask;\n    }\n}\n//# sourceMappingURL=TableAnimation.js.map","import { TableAnimation } from \"./TableAnimation.js\";\nexport class InsertAnimation extends TableAnimation {\n    constructor(table, event) {\n        super(table);\n        this.done = false;\n        this.event = event;\n    }\n    prepare() {\n        this.prepareCellsToBeMeasured();\n        this.prepareStaging();\n    }\n    firstFrame() {\n        this.arrangeInStaging();\n        this.split();\n    }\n    animationFrame(n) {\n        this.animate(this.animationStart + n * this.totalSize);\n    }\n    lastFrame() {\n        this.animate(this.animationStart + this.totalSize);\n        this.join();\n        this.disposeStaging();\n    }\n    join() {\n        if (this.done) {\n            return;\n        }\n        this.done = true;\n        this.joinHeader();\n        this.joinBody();\n        if (this.table.animationDone) {\n            this.table.animationDone();\n        }\n    }\n}\n//# sourceMappingURL=InsertAnimation.js.map","import { TablePos } from \"../TablePos.js\";\nimport { px2float } from \"../Table.js\";\nimport { InsertAnimation } from \"./InsertAnimation.js\";\nimport { span, div } from \"../../util/lsx.js\";\nexport class InsertRowAnimation extends InsertAnimation {\n    constructor(table, event) {\n        super(table, event);\n        this.join = this.join.bind(this);\n        this.initialRowCount = this.adapter.rowCount - event.size;\n        InsertRowAnimation.current = this;\n    }\n    prepareStaging() {\n        this.prepareStagingWithRows();\n    }\n    animate(pos) {\n        this.splitBody.style.top = `${pos}px`;\n        this.mask.style.top = `${pos}px`;\n        if (this.rowHeads !== undefined) {\n            this.splitHead.style.top = `${pos}px`;\n            this.headMask.style.top = `${pos}px`;\n        }\n    }\n    prepareCellsToBeMeasured() {\n        this.table.prepareMinCellSize();\n        let rowHeaders = new Array(this.event.size);\n        for (let row = this.event.index; row < this.event.index + this.event.size; ++row) {\n            const content = this.adapter.getRowHead(row);\n            if (this.rowHeads === undefined && content !== undefined) {\n                this.rowHeads = div();\n                this.rowHeads.className = \"rows\";\n                this.root.appendChild(this.rowHeads);\n                this.rowResizeHandles = div();\n                this.rowResizeHandles.className = \"rows\";\n                this.root.appendChild(this.rowResizeHandles);\n            }\n            rowHeaders[row - this.event.index] = content;\n        }\n        if (this.rowHeads !== undefined) {\n            for (let row = 0; row < this.event.size; ++row) {\n                const cell = span(rowHeaders[row]);\n                cell.className = \"head\";\n                this.measure.appendChild(cell);\n            }\n        }\n        if (this.colHeads === undefined && this.adapter.colCount === this.event.size) {\n            let colHeaders = new Array(this.adapter.colCount);\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const content = this.adapter.getColumnHead(col);\n                if (this.colHeads === undefined && content !== undefined) {\n                    this.colHeads = div();\n                    this.colHeads.className = \"cols\";\n                    this.root.appendChild(this.colHeads);\n                    this.colResizeHandles = div();\n                    this.colResizeHandles.className = \"cols\";\n                    this.root.appendChild(this.colResizeHandles);\n                }\n                colHeaders[col] = content;\n            }\n            if (this.colHeads !== undefined) {\n                for (let col = 0; col < this.adapter.colCount; ++col) {\n                    const cell = span(colHeaders[col]);\n                    cell.className = \"head\";\n                    this.measure.appendChild(cell);\n                }\n            }\n        }\n        for (let row = this.event.index; row < this.event.index + this.event.size; ++row) {\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = this.table.createCell();\n                this.table.showCell(new TablePos(col, row), cell);\n                this.measure.appendChild(cell);\n            }\n        }\n    }\n    arrangeInStaging() {\n        this.table.calculateMinCellSize();\n        const overlap = this.adapter.config.seamless ? 0 : 1;\n        let top = 0;\n        let idx = this.event.index * this.adapter.colCount;\n        if (this.body.children.length !== 0) {\n            if (idx < this.body.children.length) {\n                let cell = this.body.children[idx];\n                top = px2float(cell.style.top);\n            }\n            else {\n                let cell = this.body.children[this.body.children.length - 1];\n                let b = cell.getBoundingClientRect();\n                top = px2float(cell.style.top) + b.height - overlap;\n            }\n        }\n        let colWidth = new Array(this.adapter.colCount);\n        if (this.body.children.length > 0) {\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = this.body.children[col];\n                const bounds = cell.getBoundingClientRect();\n                colWidth[col] = bounds.width;\n                if (this.adapter.config.seamless) {\n                    colWidth[col] += 2;\n                }\n            }\n        }\n        else {\n            colWidth.fill(this.table.minCellWidth);\n        }\n        let rowHeadWidth = this.table.minCellWidth;\n        if (this.rowHeads && this.rowHeads.children.length > 0) {\n            const cell = this.rowHeads.children[0];\n            const bounds = cell.getBoundingClientRect();\n            rowHeadWidth = Math.max(rowHeadWidth, bounds.width);\n            if (this.adapter.config.seamless) {\n                rowHeadWidth += 2;\n            }\n        }\n        let rowHeight = new Array(this.event.size);\n        rowHeight.fill(this.table.minCellHeight);\n        this.totalSize = 0;\n        idx = 0;\n        if (this.rowHeads !== undefined) {\n            for (let row = 0; row < this.event.size; ++row) {\n                const cell = this.measure.children[idx++];\n                const bounds = cell.getBoundingClientRect();\n                rowHeight[row] = Math.max(rowHeight[row], bounds.height);\n                rowHeadWidth = Math.max(rowHeadWidth, bounds.width);\n            }\n        }\n        rowHeadWidth = Math.ceil(rowHeadWidth);\n        let colHeadHeight = 0;\n        if (this.colHeads !== undefined && this.colHeads.children.length === 0 && this.adapter.rowCount == this.event.size) {\n            colHeadHeight = this.table.minCellHeight;\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = this.measure.children[idx++];\n                const bounds = cell.getBoundingClientRect();\n                colWidth[col] = Math.max(colWidth[col], bounds.width - this.table.WIDTH_ADJUST);\n                colHeadHeight = Math.max(colHeadHeight, bounds.height - this.table.HEIGHT_ADJUST);\n            }\n        }\n        else {\n            if (this.colHeads !== undefined) {\n                const b = this.colHeads.children[0].getBoundingClientRect();\n                colHeadHeight = b.height - this.table.HEIGHT_ADJUST;\n            }\n        }\n        colHeadHeight = Math.ceil(colHeadHeight);\n        if (this.rowHeads) {\n            if (colHeadHeight === 0) {\n                this.rowHeads.style.top = `0px`;\n            }\n            else {\n                this.rowHeads.style.top = `${colHeadHeight + this.table.HEIGHT_ADJUST - overlap}px`;\n            }\n            this.rowHeads.style.bottom = `0px`;\n            this.rowHeads.style.width = `${rowHeadWidth}px`;\n            this.body.style.left = `${rowHeadWidth - overlap}px`;\n            this.bodyStaging.style.left = `${rowHeadWidth - overlap}px`;\n        }\n        for (let row = 0; row < this.event.size; ++row) {\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = this.measure.children[idx++];\n                const bounds = cell.getBoundingClientRect();\n                rowHeight[row] = Math.max(rowHeight[row], bounds.height);\n                if (this.adapter.config.expandColumn) {\n                    colWidth[col] = Math.ceil(Math.max(colWidth[col], bounds.width));\n                }\n                else {\n                    if (row === 0 && this.body.children.length === 0) {\n                        colWidth[col] = Math.ceil(bounds.width);\n                    }\n                }\n            }\n            this.totalSize += rowHeight[row] - overlap;\n        }\n        if (this.adapter.config.expandColumn) {\n            idx = 0;\n            let x = 0;\n            let col = 0;\n            while (idx < this.body.children.length) {\n                const cell = this.body.children[idx];\n                cell.style.left = `${x}px`;\n                cell.style.width = `${colWidth[col] - this.table.WIDTH_ADJUST}px`;\n                x += colWidth[col] - overlap;\n                if (this.adapter.config.seamless) {\n                    x -= 2;\n                }\n                ++col;\n                ++idx;\n                if (col >= this.adapter.colCount) {\n                    x = 0;\n                    col = 0;\n                }\n            }\n        }\n        this.totalSize += overlap;\n        if (this.adapter.config.seamless) {\n            this.totalSize -= 2 * this.event.size;\n        }\n        let y = top;\n        if (this.rowHeads !== undefined) {\n            for (let row = 0; row < this.event.size; ++row) {\n                const cell = this.measure.children[0];\n                this.setCellSize(cell, 0, y, rowHeadWidth, rowHeight[row]);\n                this.headStaging.appendChild(cell);\n                y += rowHeight[row] - overlap;\n                if (this.adapter.config.seamless) {\n                    y -= 2;\n                }\n            }\n        }\n        if (this.colHeads !== undefined && this.colHeads.children.length === 0 && this.adapter.rowCount == this.event.size) {\n            let x = 0;\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = this.measure.children[0];\n                cell.style.left = `${x}px`;\n                cell.style.width = `${colWidth[col] - this.table.WIDTH_ADJUST}px`;\n                cell.style.height = `${colHeadHeight}px`;\n                this.colHeads.appendChild(cell);\n                x += colWidth[col] - overlap;\n            }\n            colHeadHeight += this.table.HEIGHT_ADJUST;\n            this.body.style.top = `${colHeadHeight - overlap}px`;\n            this.bodyStaging.style.top = `${colHeadHeight - overlap}px`;\n            this.headStaging.style.top = `${colHeadHeight - overlap}px`;\n            this.rowHeads.style.top = `${colHeadHeight - overlap}px`;\n            this.colHeads.style.left = `${rowHeadWidth - overlap}px`;\n            this.colHeads.style.right = `0px`;\n            this.colHeads.style.height = `${colHeadHeight}px`;\n        }\n        y = top;\n        for (let row = 0; row < this.event.size; ++row) {\n            let x = 0;\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = this.measure.children[0];\n                this.setCellSize(cell, x, y, colWidth[col], rowHeight[row]);\n                this.bodyStaging.appendChild(cell);\n                x += colWidth[col] - overlap;\n                if (this.adapter.config.seamless) {\n                    x -= 2;\n                }\n            }\n            y += rowHeight[row] - overlap;\n            if (this.adapter.config.seamless) {\n                y -= 2;\n            }\n        }\n        this.mask = this.makeRowMask(top, this.totalSize);\n        this.bodyStaging.appendChild(this.mask);\n        if (this.rowHeads !== undefined) {\n            this.headMask = this.makeRowMask(top, this.totalSize);\n            this.headStaging.appendChild(this.headMask);\n        }\n        if (this.initialRowCount !== 0) {\n            const overlap = this.adapter.config.seamless ? 0 : 1;\n            this.totalSize -= overlap;\n        }\n    }\n    split() {\n        this.table.splitHorizontalNew(this.event.index);\n        if (this.rowHeads !== undefined) {\n            this.splitHead = this.rowHeads.lastElementChild;\n        }\n        this.animationStart = px2float(this.splitBody.style.top);\n    }\n    joinHeader() {\n        if (this.rowHeads === undefined) {\n            return;\n        }\n        this.headStaging.removeChild(this.headMask);\n        this.rowHeads.removeChild(this.splitHead);\n        while (this.headStaging.children.length > 0) {\n            this.rowHeads.appendChild(this.headStaging.children[0]);\n        }\n        if (this.splitHead.children.length > 0) {\n            let top = px2float(this.splitHead.style.top);\n            while (this.splitHead.children.length > 0) {\n                const cell = this.splitHead.children[0];\n                cell.style.top = `${px2float(cell.style.top) + top}px`;\n                this.rowHeads.appendChild(cell);\n            }\n        }\n    }\n    joinBody() {\n        this.bodyStaging.removeChild(this.mask);\n        this.body.removeChild(this.splitBody);\n        while (this.bodyStaging.children.length > 0) {\n            this.body.appendChild(this.bodyStaging.children[0]);\n        }\n        if (this.splitBody.children.length > 0) {\n            let top = px2float(this.splitBody.style.top);\n            while (this.splitBody.children.length > 0) {\n                const cell = this.splitBody.children[0];\n                cell.style.top = `${px2float(cell.style.top) + top}px`;\n                this.body.appendChild(cell);\n            }\n        }\n    }\n}\n//# sourceMappingURL=InsertRowAnimation.js.map","import { px2float } from \"../Table.js\";\nimport { TableAnimation } from \"./TableAnimation.js\";\nexport class RemoveRowAnimation extends TableAnimation {\n    constructor(table, event) {\n        super(table);\n        this.event = event;\n        this.joinHorizontal = this.joinHorizontal.bind(this);\n        if (this.body.children.length === 0) {\n            this.initialHeight = 0;\n        }\n        else {\n            const bottomCell = this.body.children[this.body.children.length - 1];\n            const top = px2float(bottomCell.style.top);\n            const bounds = bottomCell.getBoundingClientRect();\n            this.initialHeight = top + bounds.height;\n        }\n        this.overlap = this.adapter.config.seamless ? 0 : 1;\n        this.removeAll = this.event.index >= this.adapter.rowCount;\n        RemoveRowAnimation.current = this;\n    }\n    prepare() {\n        this.prepareStagingWithRows();\n        this.arrangeRowsInStaging();\n        this.splitHorizontal();\n    }\n    firstFrame() { }\n    animationFrame(n) {\n        this.splitBody.style.top = `${this.topSplitBody - n * this.animationHeight}px`;\n        this.mask.style.top = `${this.topMask - n * this.animationHeight}px`;\n        if (this.rowHeads !== undefined) {\n            this.splitHead.style.top = `${this.topSplitBody - n * this.animationHeight}px`;\n            this.headMask.style.top = `${this.topMask - n * this.animationHeight}px`;\n        }\n    }\n    lastFrame() {\n        this.joinHorizontal();\n        this.disposeStaging();\n    }\n    arrangeRowsInStaging() {\n        const idx = this.event.index * this.adapter.colCount;\n        const cellCount = this.event.size * this.adapter.colCount;\n        const start = px2float(this.body.children[idx].style.top);\n        for (let i = 0; i < cellCount; ++i) {\n            this.bodyStaging.appendChild(this.body.children[idx]);\n        }\n        let bottomOfStaging;\n        if (idx < this.body.children.length) {\n            bottomOfStaging = px2float(this.body.children[idx].style.top);\n        }\n        else {\n            const cell = this.bodyStaging.children[this.bodyStaging.children.length - 1];\n            bottomOfStaging = px2float(cell.style.top) + px2float(cell.style.height) + this.table.HEIGHT_ADJUST;\n        }\n        this.animationHeight = bottomOfStaging - start;\n        this.mask = this.makeRowMask(bottomOfStaging, this.animationHeight);\n        this.bodyStaging.appendChild(this.mask);\n        if (this.rowHeads === undefined) {\n            return;\n        }\n        for (let i = 0; i < this.event.size; ++i) {\n            this.headStaging.appendChild(this.rowHeads.children[this.event.index]);\n        }\n        this.headMask = this.makeRowMask(bottomOfStaging, this.animationHeight);\n        this.headStaging.appendChild(this.headMask);\n    }\n    splitHorizontal() {\n        this.table.splitHorizontalNew(this.event.index);\n        if (this.rowHeads !== undefined) {\n            this.splitHead = this.rowHeads.lastElementChild;\n        }\n        this.topSplitBody = px2float(this.splitBody.style.top);\n        this.topMask = px2float(this.mask.style.top);\n    }\n    joinHorizontal() {\n        this.bodyStaging.removeChild(this.mask);\n        this.body.removeChild(this.splitBody);\n        this.bodyStaging.replaceChildren();\n        this.moveSplitBodyToBody();\n        if (this.rowHeads) {\n            this.headStaging.removeChild(this.headMask);\n            this.rowHeads.removeChild(this.splitHead);\n            this.headStaging.replaceChildren();\n            this.moveSplitHeadToHead();\n        }\n        if (this.table.animationDone) {\n            this.table.animationDone();\n        }\n    }\n    moveSplitHeadToHead() {\n        if (this.splitHead.children.length === 0) {\n            return;\n        }\n        let top = px2float(this.splitHead.style.top);\n        while (this.splitHead.children.length > 0) {\n            const cell = this.splitHead.children[0];\n            cell.style.top = `${px2float(cell.style.top) + top}px`;\n            this.rowHeads.appendChild(cell);\n        }\n    }\n    moveSplitBodyToBody() {\n        if (this.splitBody.children.length === 0) {\n            return;\n        }\n        let top = px2float(this.splitBody.style.top);\n        while (this.splitBody.children.length > 0) {\n            const cell = this.splitBody.children[0];\n            cell.style.top = `${px2float(cell.style.top) + top}px`;\n            this.body.appendChild(cell);\n        }\n    }\n}\n//# sourceMappingURL=RemoveRowAnimation.js.map","import { TablePos } from \"../TablePos.js\";\nimport { span, div } from \"../../util/lsx.js\";\nimport { px2int, px2float } from \"../Table.js\";\nimport { InsertAnimation } from \"./InsertAnimation.js\";\nexport class InsertColumnAnimation extends InsertAnimation {\n    constructor(table, event) {\n        super(table, event);\n        this.event = event;\n        this.join = this.join.bind(this);\n        this.colCount = this.adapter.colCount;\n        this.rowCount = this.adapter.rowCount;\n        InsertColumnAnimation.current = this;\n    }\n    prepareStaging() {\n        this.prepareStagingWithColumns();\n    }\n    animate(pos) {\n        this.mask.style.left = `${pos}px`;\n        this.splitBody.style.left = `${pos}px`;\n        if (this.colHeads !== undefined) {\n            this.splitHead.style.left = `${pos}px`;\n            this.headMask.style.left = `${pos}px`;\n        }\n    }\n    prepareCellsToBeMeasured() {\n        this.table.prepareMinCellSize();\n        let colHeaders = new Array(this.event.size);\n        for (let col = this.event.index; col < this.event.index + this.event.size; ++col) {\n            const content = this.adapter.getColumnHead(col);\n            if (this.colHeads === undefined && content !== undefined) {\n                this.colHeads = div();\n                this.colHeads.className = \"cols\";\n                this.root.appendChild(this.colHeads);\n                this.colResizeHandles = div();\n                this.colResizeHandles.className = \"cols\";\n                this.root.appendChild(this.colResizeHandles);\n            }\n            colHeaders[col - this.event.index] = content;\n        }\n        if (this.colHeads !== undefined) {\n            for (let row = 0; row < this.event.size; ++row) {\n                const cell = span(colHeaders[row]);\n                cell.className = \"head\";\n                this.measure.appendChild(cell);\n            }\n        }\n        if (this.rowHeads === undefined && this.adapter.rowCount === this.event.size) {\n            let rowHeaders = new Array(this.adapter.rowCount);\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                const content = this.adapter.getRowHead(row);\n                if (this.rowHeads === undefined && content !== undefined) {\n                    this.rowHeads = div();\n                    this.rowHeads.className = \"rows\";\n                    this.root.appendChild(this.rowHeads);\n                    this.rowResizeHandles = div();\n                    this.rowResizeHandles.className = \"rows\";\n                    this.root.appendChild(this.rowResizeHandles);\n                }\n                rowHeaders[row] = content;\n            }\n            if (this.rowHeads !== undefined) {\n                for (let row = 0; row < this.adapter.rowCount; ++row) {\n                    const cell = span(rowHeaders[row]);\n                    cell.className = \"head\";\n                    this.measure.appendChild(cell);\n                }\n            }\n        }\n        for (let col = this.event.index; col < this.event.index + this.event.size; ++col) {\n            for (let row = 0; row < this.rowCount; ++row) {\n                const cell = span();\n                this.table.showCell(new TablePos(col, row), cell);\n                this.measure.appendChild(cell);\n            }\n        }\n    }\n    arrangeInStaging() {\n        this.table.calculateMinCellSize();\n        const previousColCount = this.colCount - this.event.size;\n        const overlap = this.adapter.config.seamless ? 0 : 1;\n        let left;\n        let idx = this.event.index;\n        if (idx < previousColCount) {\n            let cell = this.body.children[idx];\n            left = px2int(cell.style.left);\n        }\n        else {\n            if (this.body.children.length === 0) {\n                left = 0;\n            }\n            else {\n                const cell = this.body.children[previousColCount - 1];\n                left = px2int(cell.style.left) + px2int(cell.style.width) + this.table.WIDTH_ADJUST - overlap;\n            }\n        }\n        this.animationStart = left;\n        let rowHeight = new Array(this.adapter.rowCount);\n        if (this.body.children.length !== 0) {\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                const cell = this.body.children[row * previousColCount];\n                const bounds = cell.getBoundingClientRect();\n                rowHeight[row] = bounds.height;\n                if (this.adapter.config.seamless) {\n                    rowHeight[row] += 2;\n                }\n            }\n        }\n        else {\n            rowHeight.fill(this.table.minCellHeight);\n        }\n        let colHeadHeight = this.table.minCellHeight;\n        if (this.colHeads && this.colHeads.children.length > 0) {\n            const cell = this.colHeads.children[0];\n            const bounds = cell.getBoundingClientRect();\n            colHeadHeight = bounds.height;\n            if (this.adapter.config.seamless) {\n                colHeadHeight += 2;\n            }\n        }\n        let colWidth = new Array(this.event.size);\n        colWidth.fill(this.table.minCellWidth);\n        this.totalSize = 0;\n        idx = 0;\n        if (this.colHeads !== undefined) {\n            for (let col = 0; col < this.event.size; ++col) {\n                const cell = this.measure.children[idx++];\n                const bounds = cell.getBoundingClientRect();\n                colWidth[col] = Math.max(colWidth[col], bounds.width);\n                colHeadHeight = Math.max(colHeadHeight, bounds.height);\n            }\n        }\n        colHeadHeight = Math.ceil(colHeadHeight);\n        let rowHeadWidth = 0;\n        if (this.rowHeads !== undefined && this.rowHeads.children.length === 0 && this.adapter.colCount == this.event.size) {\n            rowHeadWidth = this.table.minCellWidth;\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                const cell = this.measure.children[idx++];\n                const bounds = cell.getBoundingClientRect();\n                rowHeight[row] = Math.max(rowHeight[row], bounds.height - this.table.HEIGHT_ADJUST);\n                rowHeadWidth = Math.max(rowHeadWidth, bounds.width - this.table.WIDTH_ADJUST);\n            }\n        }\n        else {\n            if (this.rowHeads !== undefined) {\n                const b = this.rowHeads.children[0].getBoundingClientRect();\n                rowHeadWidth = b.width - this.table.WIDTH_ADJUST;\n            }\n        }\n        rowHeadWidth = Math.ceil(rowHeadWidth);\n        if (this.colHeads) {\n            if (rowHeadWidth === 0) {\n                this.colHeads.style.left = `0px`;\n            }\n            else {\n                this.colHeads.style.left = `${rowHeadWidth + this.table.WIDTH_ADJUST + 2 - overlap}px`;\n            }\n            this.colHeads.style.right = `0px`;\n            this.colHeads.style.height = `${colHeadHeight}px`;\n            this.body.style.top = `${colHeadHeight - 1}px`;\n            this.bodyStaging.style.top = `${colHeadHeight - 1}px`;\n        }\n        for (let col = 0; col < this.event.size; ++col) {\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                const cell = this.measure.children[idx++];\n                const bounds = cell.getBoundingClientRect();\n                colWidth[col] = Math.ceil(Math.max(colWidth[col], bounds.width) - 2);\n                if (this.adapter.config.expandRow) {\n                    rowHeight[col] = Math.ceil(Math.max(rowHeight[row], bounds.height));\n                }\n                else {\n                    if (col === 0 && this.body.children.length === 0) {\n                        rowHeight[row] = Math.ceil(bounds.height);\n                    }\n                }\n            }\n            this.totalSize += colWidth[col] - overlap;\n        }\n        colWidth.forEach((v, i) => colWidth[i] = v + 4);\n        this.totalSize += overlap;\n        if (this.adapter.config.seamless) {\n            this.totalSize -= 2 * this.event.size;\n        }\n        let x = left;\n        if (this.colHeads !== undefined) {\n            for (let col = 0; col < this.event.size; ++col) {\n                const cell = this.measure.children[0];\n                this.setCellSize(cell, x, 0, colWidth[col], colHeadHeight);\n                this.headStaging.appendChild(cell);\n                x += colWidth[col] - overlap;\n                if (this.adapter.config.seamless) {\n                    x -= 2;\n                }\n            }\n        }\n        if (this.rowHeads !== undefined && this.rowHeads.children.length === 0 && this.adapter.colCount == this.event.size) {\n            let y = 0;\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                const cell = this.measure.children[0];\n                cell.style.top = `${y}px`;\n                cell.style.height = `${rowHeight[row] - this.table.HEIGHT_ADJUST}px`;\n                cell.style.width = `${rowHeadWidth}px`;\n                this.rowHeads.appendChild(cell);\n                y += rowHeight[row] - overlap;\n            }\n            rowHeadWidth += this.table.WIDTH_ADJUST;\n            this.body.style.left = `${rowHeadWidth - overlap}px`;\n            this.bodyStaging.style.left = `${rowHeadWidth - overlap}px`;\n            this.headStaging.style.left = `${rowHeadWidth - overlap}px`;\n            this.colHeads.style.left = `${rowHeadWidth - overlap}px`;\n            this.rowHeads.style.top = `${colHeadHeight - overlap}px`;\n            this.rowHeads.style.bottom = `0px`;\n            this.rowHeads.style.width = `${rowHeadWidth}px`;\n        }\n        let totalWidth = 0;\n        x = left;\n        for (let col = this.event.index; col < this.event.index + this.event.size; ++col) {\n            let columnWidth = colWidth[col - this.event.index];\n            let y = 0;\n            for (let row = 0; row < this.rowCount; ++row) {\n                const cell = this.measure.children[0];\n                this.setCellSize(cell, x, y, columnWidth, rowHeight[row]);\n                this.bodyStaging.appendChild(cell);\n                y += rowHeight[row] - overlap;\n                if (this.adapter.config.seamless) {\n                    y -= 2;\n                }\n            }\n            x += columnWidth - overlap - 2;\n            if (!this.adapter.config.seamless) {\n                x += 2;\n            }\n            totalWidth += columnWidth - 2;\n        }\n        this.totalSize = totalWidth + 2;\n        this.mask = this.makeColumnMask(left, this.totalSize);\n        this.bodyStaging.appendChild(this.mask);\n        if (this.colHeads !== undefined) {\n            this.headMask = this.makeColumnMask(left, this.totalSize);\n            this.headStaging.appendChild(this.headMask);\n        }\n    }\n    split() {\n        this.table.splitVerticalNew(this.event.index);\n        if (this.colHeads !== undefined) {\n            this.splitHead = this.colHeads.lastElementChild;\n        }\n    }\n    joinHeader() {\n        if (this.colHeads === undefined) {\n            return;\n        }\n        this.headStaging.removeChild(this.headMask);\n        this.colHeads.removeChild(this.splitHead);\n        while (this.headStaging.children.length > 0) {\n            this.colHeads.appendChild(this.headStaging.children[0]);\n        }\n        if (this.splitHead.children.length > 0) {\n            let left = px2float(this.splitHead.style.left);\n            while (this.splitHead.children.length > 0) {\n                const cell = this.splitHead.children[0];\n                cell.style.left = `${px2float(cell.style.left) + left}px`;\n                this.colHeads.appendChild(cell);\n            }\n        }\n    }\n    joinBody() {\n        this.bodyStaging.removeChild(this.mask);\n        this.body.removeChild(this.splitBody);\n        const totalWidth = this.adapter.model.colCount;\n        const bodyWidth = this.event.index;\n        const stagingWidth = this.event.size;\n        const splitWidth = totalWidth - stagingWidth - this.event.index;\n        for (let col = 0; col < stagingWidth; ++col) {\n            for (let row = 0; row < this.rowCount; ++row) {\n                const cell = this.bodyStaging.children[0];\n                const idx = row * (bodyWidth + stagingWidth) + bodyWidth + col;\n                this.bodyInsertAt(cell, idx);\n            }\n        }\n        let left = this.totalSize + this.animationStart;\n        for (let row = 0; row < this.rowCount; ++row) {\n            for (let col = 0; col < splitWidth; ++col) {\n                const cell = this.splitBody.children[0];\n                cell.style.left = `${px2float(cell.style.left) + left}px`;\n                const idx = row * totalWidth + bodyWidth + stagingWidth + col;\n                this.bodyInsertAt(cell, idx);\n            }\n        }\n    }\n    bodyInsertAt(node, idx) {\n        let beforeChild;\n        if (idx < this.body.children.length) {\n            beforeChild = this.body.children[idx];\n        }\n        else {\n            beforeChild = null;\n        }\n        this.body.insertBefore(node, beforeChild);\n    }\n}\n//# sourceMappingURL=InsertColumnAnimation.js.map","import { px2float } from \"../Table.js\";\nimport { TableAnimation } from \"./TableAnimation.js\";\nexport class RemoveColumnAnimation extends TableAnimation {\n    constructor(table, event) {\n        super(table);\n        this.done = false;\n        this.colCount = this.adapter.colCount;\n        this.rowCount = this.adapter.rowCount;\n        this.event = event;\n        this.joinVertical = this.joinVertical.bind(this);\n        if (this.body.children.length === 0) {\n            this.initialWidth = 0;\n        }\n        else {\n            const cell = this.body.children[this.body.children.length - 1];\n            const left = px2float(cell.style.left);\n            const bounds = cell.getBoundingClientRect();\n            this.initialWidth = left + bounds.width;\n        }\n        RemoveColumnAnimation.current = this;\n    }\n    prepare() {\n        this.prepareStagingWithColumns();\n        this.arrangeColumnsInStaging();\n        this.splitVertical();\n    }\n    firstFrame() { }\n    animationFrame(n) {\n        let a = 0;\n        if (this.adapter.config.seamless) {\n            a = 1;\n        }\n        this.splitBody.style.left = `${this.leftSplitBody - n * this.animationWidth + a}px`;\n        this.mask.style.left = `${this.leftMask - n * this.animationWidth}px`;\n        if (this.colHeads !== undefined) {\n            this.splitHead.style.left = `${this.leftSplitBody - n * this.animationWidth + a}px`;\n            this.headMask.style.left = `${this.leftMask - n * this.animationWidth}px`;\n        }\n    }\n    lastFrame() {\n        this.joinVertical();\n        this.disposeStaging();\n    }\n    arrangeColumnsInStaging() {\n        let idx = this.event.index;\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            for (let col = 0; col < this.event.size; ++col) {\n                this.bodyStaging.appendChild(this.body.children[idx]);\n            }\n            idx += this.colCount;\n        }\n        const firstCellOfStaging = this.bodyStaging.children[0];\n        const lastCellOfStaging = this.bodyStaging.children[this.bodyStaging.children.length - 1];\n        let rightOfStaging = px2float(lastCellOfStaging.style.left) + px2float(lastCellOfStaging.style.width) + this.table.WIDTH_ADJUST;\n        rightOfStaging -= 1;\n        let w = rightOfStaging - px2float(firstCellOfStaging.style.left);\n        this.animationWidth = w;\n        this.mask = this.makeColumnMask(rightOfStaging, w);\n        this.bodyStaging.appendChild(this.mask);\n        if (this.colHeads === undefined) {\n            return;\n        }\n        for (let i = 0; i < this.event.size; ++i) {\n            this.headStaging.appendChild(this.colHeads.children[this.event.index]);\n        }\n        this.headMask = this.makeColumnMask(rightOfStaging, w);\n        this.headStaging.appendChild(this.headMask);\n    }\n    splitVertical() {\n        this.table.splitVerticalNew(this.event.index);\n        if (this.colHeads !== undefined) {\n            this.splitHead = this.colHeads.lastElementChild;\n        }\n        const left = px2float(this.splitBody.style.left);\n        this.splitBody.style.width = `${this.initialWidth - left - 1}px`;\n        this.leftSplitBody = left;\n        this.leftMask = px2float(this.mask.style.left);\n        if (this.colHeads !== undefined) {\n            this.splitHead.style.left = `${left}px`;\n            this.splitHead.style.width = `${this.initialWidth - left - 1}px`;\n        }\n    }\n    joinVertical() {\n        this.bodyStaging.removeChild(this.mask);\n        this.body.removeChild(this.splitBody);\n        this.bodyStaging.replaceChildren();\n        this.moveSplitBodyToBody();\n        if (this.colHeads) {\n            this.headStaging.removeChild(this.headMask);\n            this.colHeads.removeChild(this.splitHead);\n            this.headStaging.replaceChildren();\n            this.moveSplitHeadToHead();\n        }\n        if (this.table.animationDone) {\n            this.table.animationDone();\n        }\n    }\n    moveSplitHeadToHead() {\n        if (this.splitHead.children.length === 0) {\n            return;\n        }\n        let left = px2float(this.splitHead.style.left);\n        while (this.splitHead.children.length > 0) {\n            const cell = this.splitHead.children[0];\n            cell.style.left = `${px2float(cell.style.left) + left}px`;\n            this.colHeads.appendChild(cell);\n        }\n    }\n    moveSplitBodyToBody() {\n        if (this.splitBody.children.length === 0) {\n            return;\n        }\n        let left = px2float(this.splitBody.style.left);\n        for (let row = 0; row < this.rowCount; ++row) {\n            for (let col = 0; col < this.colCount - this.event.index; ++col) {\n                const cell = this.splitBody.children[0];\n                cell.style.left = `${px2float(cell.style.left) + left}px`;\n                const idx = row * this.adapter.colCount + this.event.index + col;\n                this.bodyInsertAt(cell, idx);\n            }\n        }\n    }\n    bodyInsertAt(node, idx) {\n        let beforeChild;\n        if (idx < this.body.children.length) {\n            beforeChild = this.body.children[idx];\n        }\n        else {\n            beforeChild = null;\n        }\n        this.body.insertBefore(node, beforeChild);\n    }\n}\n//# sourceMappingURL=RemoveColumnAnimation.js.map","let animationFrameCount = 468;\nexport function setAnimationFrameCount(frames) {\n    animationFrameCount = frames;\n}\nexport function scrollIntoView(element) {\n    if (element === undefined)\n        return;\n    const scrollableParent = findScrollableParent(element);\n    if (scrollableParent === undefined)\n        return;\n    const parentRect = scrollableParent.getBoundingClientRect();\n    const clientRect = element.getBoundingClientRect();\n    if (scrollableParent !== document.body) {\n        const { x, y } = calculateScrollGoal(scrollableParent, parentRect, clientRect);\n        smoothScroll(scrollableParent, x, y);\n        if (window.getComputedStyle(scrollableParent).position !== 'fixed') {\n            window.scrollBy({\n                left: parentRect.left,\n                top: parentRect.top,\n                behavior: 'smooth'\n            });\n        }\n    }\n    else {\n        window.scrollBy({\n            left: clientRect.left,\n            top: clientRect.top,\n            behavior: 'smooth'\n        });\n    }\n}\nfunction calculateScrollGoal(scrollableParent, parentRect, clientRect) {\n    const GAP = 16;\n    const clientLeft = clientRect.left + scrollableParent.scrollLeft - parentRect.left - GAP;\n    const clientRight = clientRect.right + scrollableParent.scrollLeft - parentRect.left + GAP;\n    const clientTop = clientRect.top + scrollableParent.scrollTop - parentRect.top - GAP;\n    const clientBottom = clientRect.bottom + scrollableParent.scrollTop - parentRect.top + GAP;\n    const parentWidth = scrollableParent.clientWidth;\n    const parentHeight = scrollableParent.clientHeight;\n    var x = scrollableParent.scrollLeft;\n    var y = scrollableParent.scrollTop;\n    if (clientRight - clientLeft - 2 * GAP > parentWidth)\n        x = clientLeft;\n    else if (clientRight > scrollableParent.scrollLeft + parentWidth)\n        x = clientRight - parentWidth;\n    else if (clientLeft < scrollableParent.scrollLeft)\n        x = clientLeft;\n    if (clientBottom - clientTop - 2 * GAP > parentHeight)\n        y = clientTop;\n    else if (clientBottom > scrollableParent.scrollTop + parentHeight)\n        y = clientBottom - parentHeight;\n    else if (clientTop < scrollableParent.scrollTop)\n        y = clientTop;\n    x = Math.max(0, x);\n    y = Math.max(0, y);\n    return { x, y };\n}\nconst concurrentScroll = new Map();\nfunction smoothScroll(scrollable, x, y) {\n    let activeGoal = concurrentScroll.get(scrollable);\n    if (activeGoal === undefined) {\n        activeGoal = { x: x, y: y };\n        concurrentScroll.set(scrollable, activeGoal);\n    }\n    else {\n        activeGoal.x = x;\n        activeGoal.y = y;\n    }\n    let startX, startY;\n    if (scrollable === document.body) {\n        startX = window.scrollX || window.pageXOffset;\n        startY = window.scrollY || window.pageYOffset;\n    }\n    else {\n        startX = scrollable.scrollLeft;\n        startY = scrollable.scrollTop;\n    }\n    const deltaX = x - startX;\n    const deltaY = y - startY;\n    if (deltaX === 0 && deltaY === 0) {\n        concurrentScroll.delete(scrollable);\n        return;\n    }\n    animate((value) => {\n        if (activeGoal.x !== x || activeGoal.y !== y) {\n            return false;\n        }\n        const nx = startX + value * deltaX;\n        const ny = startY + value * deltaY;\n        if (scrollable === document.body) {\n            window.scrollTo(nx, ny);\n        }\n        else {\n            scrollable.scrollLeft = nx;\n            scrollable.scrollTop = ny;\n        }\n        if (value === 1) {\n            concurrentScroll.delete(scrollable);\n        }\n        return true;\n    });\n}\nlet idSource = 0;\nexport function animate(callback) {\n    setTimeout(() => { window.requestAnimationFrame(animateStep.bind(window, callback, undefined, undefined)); }, 0);\n}\nfunction animateStep(callback, startTime, id) {\n    if (startTime === undefined) {\n        startTime = Date.now();\n        id = ++idSource;\n    }\n    const time = Date.now();\n    let elapsed = animationFrameCount > 0 ? (time - startTime) / animationFrameCount : 1;\n    elapsed = elapsed > 1 ? 1 : elapsed;\n    const value = ease(elapsed);\n    if (callback(value) === false)\n        return;\n    if (value < 1.0) {\n        window.requestAnimationFrame(animateStep.bind(window, callback, startTime, id));\n    }\n}\nfunction ease(k) {\n    return 0.5 * (1 - Math.cos(Math.PI * k));\n}\nvar ROUNDING_TOLERANCE = isMicrosoftBrowser(window.navigator.userAgent) ? 1 : 0;\nfunction isMicrosoftBrowser(userAgent) {\n    const userAgentPatterns = ['MSIE ', 'Trident/', 'Edge/'];\n    return new RegExp(userAgentPatterns.join('|')).test(userAgent);\n}\nexport function findScrollableParent(el) {\n    while (el !== document.body && isScrollable(el) === false) {\n        if (el.parentElement === null)\n            return undefined;\n        el = el.parentElement;\n    }\n    return el;\n}\nexport function isScrollable(el) {\n    const isScrollableY = hasScrollableSpace(el, \"Y\") && canOverflow(el, \"Y\");\n    const isScrollableX = hasScrollableSpace(el, \"X\") && canOverflow(el, \"X\");\n    return isScrollableY || isScrollableX;\n}\nfunction hasScrollableSpace(el, axis) {\n    if (axis === 'X')\n        return el.clientWidth + ROUNDING_TOLERANCE < el.scrollWidth;\n    else\n        return el.clientHeight + ROUNDING_TOLERANCE < el.scrollHeight;\n}\nfunction canOverflow(el, axis) {\n    const style = window.getComputedStyle(el, null);\n    const overflowValue = style['overflow' + axis];\n    return overflowValue === 'auto' || overflowValue === 'scroll';\n}\n//# sourceMappingURL=scrollIntoView.js.map","import { css } from \"../../util/lsx.js\";\nexport const style = new CSSStyleSheet();\nstyle.replaceSync(css `\n:host {\n    position: relative;\n    display: inline-block;\n    border: 1px solid var(--tx-gray-300);\n    border-radius: 3px;\n    /* outline-offset: -2px; */\n    outline: none;\n    font-family: var(--tx-font-family);\n    font-size: var(--tx-font-size);\n    background: #1e1e1e;\n\n    /* not sure about these */\n    /*\n    width: 100%;\n    width: -moz-available;\n    width: -webkit-fill-available;\n    width: fill-available;\n    height: 100%;\n    height: -moz-available;\n    height: -webkit-fill-available;\n    height: fill-available;\n    */\n\n    min-height: 50px;\n    min-width: 50px;\n}\n\n.staging, .body, .splitBody, .cols, .rows {\n    position: absolute;\n}\n\n.cols {\n    right: 0;\n    top: 0;\n}\n\n.rows {\n    left: 0;\n    bottom: 0;\n}\n\n.staging {\n    overflow: hidden;\n    inset: 0;\n}\n\n.body {\n    overflow: auto;\n    inset: 0;\n}\n\n.cols, .rows {\n    overflow: hidden;\n}\n\n.body > span,\n.splitBody > span,\n.cols > span,\n.rows > span,\n.measure > span,\n.staging > span {\n    position: absolute;\n    box-sizing: content-box;\n    white-space: nowrap;\n    outline: none;\n    border: solid 1px var(--tx-gray-200);\n    padding: 0 2px 0 2px;\n    margin: 0;\n    background-color: #080808;\n    font-weight: 400;\n    overflow: hidden;\n    cursor: default;\n    caret-color: transparent;\n}\n\n.seamless > .body > span,\n.seamless > .body > .splitBody > span,\n.seamless > .cols > span,\n.seamless > .rows > span,\n.seamless > .cols > .splitBody > span,\n.seamless > .rows > .splitBody > span,\n.seamless > .measure > span,\n.seamless > .staging > span {\n    border: none 0px;\n}\n\n.body > span:hover {\n    background: #1a1a1a;\n}\n\n.body > span.error, .splitBody > span.error {\n    border-color: var(--tx-global-red-600);\n    z-index: 1;\n}\n\n.body > span:focus, .splitBody > span:focus {\n    background: #0e2035;\n    border-color: #2680eb;\n    z-index: 2;\n}\n\n.body > span:focus:hover {\n    background: #112d4d;\n}\n\n.body > span.error, .splitBody > span.error {\n    background-color: #522426;\n}\n\n.body > span.error:hover {\n    background: #401111;\n}\n\n.cols > span.handle,\n.rows > span.handle {\n    padding: 0;\n    border: 0 none;\n    opacity: 0;\n    background-color: #08f;\n}\n.fill {\n    opacity: 0;\n}\n\n.cols > span.handle {\n    cursor: col-resize;\n}\n.rows > span.handle {\n    cursor: row-resize;\n}\n\n.staging span.head,\n.cols span.head,\n.rows span.head,\n.measure span.head {\n    background: #1e1e1e;\n    font-weight: 600;\n}\n\n.colHack > span,\n.cols > span {\n    text-align: center;\n}\n\n.measure {\n    position: absolute;\n    opacity: 0;\n}\n\n.body > span.edit, .splitBody > span.edit, .body > span.edit:hover, .splitBody > span.edit:hover {\n    caret-color: currentcolor;\n}\n`);\n//# sourceMappingURL=tx-table.js.map","import { View } from \"../view/View.js\";\nimport { TableModel } from \"./model/TableModel.js\";\nimport { SelectionModel } from \"./model/SelectionModel.js\";\nimport { EditMode, TableAdapter } from \"./adapter/TableAdapter.js\";\nimport { TableEvent } from \"./TableEvent.js\";\nimport { TablePos } from \"./TablePos.js\";\nimport { TableEditMode } from \"./TableEditMode.js\";\nimport { TableEventType } from \"./TableEventType.js\";\nimport { Animator } from \"../util/animation.js\";\nimport { TableAnimation } from \"./private/TableAnimation.js\";\nimport { InsertRowAnimation } from \"./private/InsertRowAnimation.js\";\nimport { RemoveRowAnimation } from \"./private/RemoveRowAnimation.js\";\nimport { InsertColumnAnimation } from \"./private/InsertColumnAnimation.js\";\nimport { RemoveColumnAnimation } from \"./private/RemoveColumnAnimation.js\";\nimport { setInitialProperties } from \"toad.jsx\";\nimport { span, div, text } from \"../util/lsx.js\";\nimport { scrollIntoView } from \"../util/scrollIntoView.js\";\nimport { style as txTable } from \"./style/tx-table.js\";\nimport { style as txScrollbar } from \"../style/tx-scrollbar.js\";\nimport { hasFocus } from \"../util/dom.js\";\nexport class NullLogger {\n    log(_) { }\n    print() { }\n}\nexport class MemoryLogger {\n    constructor() {\n        this.logs = [];\n    }\n    log(msg) {\n        this.logs.push(msg);\n    }\n    print() {\n        console.log(`MemoryLogger collected ${this.logs.length} logs`);\n        this.logs.forEach(msg => console.log(msg));\n    }\n}\nexport function px2int(s) {\n    return parseInt(s.substring(0, s.length - 2));\n}\nexport function px2float(s) {\n    return parseFloat(s.substring(0, s.length - 2));\n}\nfunction isVisible(e) {\n    if (e.isConnected === false) {\n        return false;\n    }\n    if (window.getComputedStyle(e).display === \"none\") {\n        return false;\n    }\n    if (e.parentElement) {\n        return isVisible(e.parentElement);\n    }\n    return true;\n}\nexport class Table extends View {\n    constructor(props) {\n        super();\n        this.WIDTH_ADJUST = 6;\n        this.HEIGHT_ADJUST = 2;\n        this.HANDLE_SIZE = 5;\n        this.HANDLE_SKEW = 3;\n        this.visible = false;\n        this.prepareInProgress = false;\n        this.animator = new Animator();\n        this.logger = new Table.loggerType();\n        this.logger.log(\"Table::constructor()\");\n        this.arrangeAllMeasuredInGrid = this.arrangeAllMeasuredInGrid.bind(this);\n        this.hostKeyDown = this.hostKeyDown.bind(this);\n        this.cellKeyDown = this.cellKeyDown.bind(this);\n        this.cellFocus = this.cellFocus.bind(this);\n        this.focusIn = this.focusIn.bind(this);\n        this.focusOut = this.focusOut.bind(this);\n        this.pointerDown = this.pointerDown.bind(this);\n        this.handleDown = this.handleDown.bind(this);\n        this.handleMove = this.handleMove.bind(this);\n        this.handleUp = this.handleUp.bind(this);\n        this.setHeadingFillerSizeToScrollbarSize = this.setHeadingFillerSizeToScrollbarSize.bind(this);\n        this.selectionChanged = this.selectionChanged.bind(this);\n        this.modelChanged = this.modelChanged.bind(this);\n        this.root = div((this.body = div()));\n        this.root.className = \"root\";\n        this.body.className = \"body\";\n        this.measure = div();\n        this.measure.classList.add(\"measure\");\n        this.onkeydown = this.hostKeyDown;\n        this.addEventListener(\"focusin\", this.focusIn);\n        this.addEventListener(\"focusout\", this.focusOut);\n        this.body.onresize = this.setHeadingFillerSizeToScrollbarSize;\n        this.body.onscroll = () => {\n            if (this.animator.current && this.animator.current instanceof TableAnimation) {\n                this.animator.current.scrollStaging();\n            }\n            this.setHeadingFillerSizeToScrollbarSize();\n            if (this.colHeads) {\n                this.colHeads.scrollLeft = this.body.scrollLeft;\n                this.colResizeHandles.scrollLeft = this.body.scrollLeft;\n            }\n            if (this.rowHeads) {\n                this.rowHeads.scrollTop = this.body.scrollTop;\n                this.rowResizeHandles.scrollTop = this.body.scrollTop;\n            }\n        };\n        this.body.onpointerdown = this.pointerDown;\n        this.attachShadow({ mode: \"open\", delegatesFocus: true });\n        this.shadowRoot.adoptedStyleSheets = [txTable, txScrollbar];\n        this.shadowRoot.appendChild(this.root);\n        this.shadowRoot.appendChild(this.measure);\n        if (props) {\n            setInitialProperties(this, props);\n            if (props.selectionModel) {\n                this.setModel(props.selectionModel);\n            }\n        }\n        if (Table.observer === undefined) {\n            Table.observer = new MutationObserver((mutations, observer) => {\n                Table.allTables.forEach((table) => {\n                    if (isVisible(table)) {\n                        this.logger.log(`Table.observer => table became visible => prepareCells()`);\n                        Table.allTables.delete(table);\n                        table.prepareCells();\n                    }\n                });\n            });\n            Table.observer.observe(document.body, {\n                attributes: true,\n                subtree: true,\n            });\n        }\n    }\n    connectedCallback() {\n        this.logger.log(`Table::connectedCallback()`);\n        setTimeout(() => {\n            if (isVisible(this)) {\n                this.logger.log(`Table::connectedCallback() => is visible => prepareCells()`);\n                this.prepareCells();\n            }\n            else {\n                this.logger.log(`Table::connectedCallback() => is not visible => track in Table.allTables`);\n                Table.allTables.add(this);\n            }\n        }, 0);\n        super.connectedCallback();\n        if (this.selection === undefined) {\n            this.selection = new SelectionModel(TableEditMode.SELECT_CELL);\n            this.selection.modified.add(this.selectionChanged, this);\n        }\n    }\n    disconnectedCallback() {\n        this.logger.log(`Table::disconnectedCallback()`);\n        Table.allTables.delete(this);\n    }\n    addStaging(...elements) {\n        for (const element of elements) {\n            if (element === undefined) {\n                continue;\n            }\n            this.root.insertBefore(element, this.root.children[0]);\n        }\n    }\n    removeStaging(...elements) {\n        for (const element of elements) {\n            if (element === undefined) {\n                continue;\n            }\n            this.root.removeChild(element);\n        }\n    }\n    hostKeyDown(ev) {\n        this.logger.log(`Table::hostKeyDown(ev): ${ev.key}, mode: ${TableEditMode[this.selection.mode]}, adapter edit mode ${EditMode[this.adapter.config.editMode]}, editing=${this.editing}`);\n        if (!this.selection)\n            return;\n        switch (this.selection.mode) {\n            case TableEditMode.SELECT_ROW:\n                {\n                    let row = this.selection.value.row;\n                    switch (ev.key) {\n                        case \"ArrowDown\":\n                            if (row + 1 < this.adapter.rowCount)\n                                ++row;\n                            break;\n                        case \"ArrowUp\":\n                            if (row > 0)\n                                --row;\n                            break;\n                    }\n                    this.selection.row = row;\n                }\n                break;\n            case TableEditMode.SELECT_CELL:\n                {\n                    let pos = { col: this.selection.col, row: this.selection.row };\n                    switch (ev.key) {\n                        case \"ArrowRight\":\n                            if (this.editing === undefined && pos.col + 1 < this.adapter.colCount) {\n                                ++pos.col;\n                                ev.preventDefault();\n                                ev.stopPropagation();\n                            }\n                            break;\n                        case \"ArrowLeft\":\n                            if (this.editing === undefined && pos.col > 0) {\n                                --pos.col;\n                                ev.preventDefault();\n                                ev.stopPropagation();\n                            }\n                            break;\n                        case \"ArrowDown\":\n                            if (pos.row + 1 < this.adapter.rowCount) {\n                                ++pos.row;\n                                ev.preventDefault();\n                                ev.stopPropagation();\n                            }\n                            break;\n                        case \"ArrowUp\":\n                            if (pos.row > 0) {\n                                --pos.row;\n                                ev.preventDefault();\n                                ev.stopPropagation();\n                            }\n                            break;\n                        case \"Enter\":\n                            if (this.editing === undefined) {\n                                if (this.adapter?.config.editMode === EditMode.EDIT_ON_ENTER) {\n                                    this.editCell();\n                                }\n                            }\n                            else {\n                                this.saveCell();\n                                if (pos.row + 1 < this.adapter.rowCount) {\n                                    ++pos.row;\n                                    this.selection.value = pos;\n                                    this.editCell();\n                                }\n                            }\n                            ev.preventDefault();\n                            ev.stopPropagation();\n                            break;\n                    }\n                    this.selection.value = pos;\n                }\n                break;\n            case TableEditMode.EDIT_CELL:\n                let pos = { col: this.selection.col, row: this.selection.row };\n                switch (ev.key) {\n                    case \"ArrowDown\":\n                        if (pos.row + 1 < this.adapter.rowCount) {\n                            ++pos.row;\n                            ev.preventDefault();\n                            ev.stopPropagation();\n                        }\n                        break;\n                    case \"ArrowUp\":\n                        if (pos.row > 0) {\n                            --pos.row;\n                            ev.preventDefault();\n                            ev.stopPropagation();\n                        }\n                        break;\n                    case \"Enter\":\n                        if (this.editing === undefined) {\n                            if (this.adapter?.config.editMode === EditMode.EDIT_ON_ENTER) {\n                                this.editCell();\n                            }\n                        }\n                        else {\n                            this.saveCell();\n                            this.editCell();\n                        }\n                        ev.preventDefault();\n                        ev.stopPropagation();\n                        break;\n                }\n                this.selection.value = pos;\n                break;\n        }\n    }\n    cellKeyDown(ev) {\n        this.logger.log(`Table::cellKeyDown()`);\n        const cell = ev.target;\n        if (ev.key === \"Enter\") {\n            this.hostKeyDown(ev);\n            ev.preventDefault();\n            return;\n        }\n        if (!cell.classList.contains(\"edit\") && this.editing === undefined) {\n            switch (ev.key) {\n                case \"ArrowDown\":\n                case \"ArrowUp\":\n                case \"ArrowRight\":\n                case \"ArrowLeft\":\n                case \"Tab\":\n                case \"Enter\":\n                    break;\n                default:\n                    if (this.adapter?.config.editMode === EditMode.EDIT_ON_ENTER) {\n                        ev.preventDefault();\n                    }\n            }\n        }\n        else {\n        }\n    }\n    cellFocus(event) {\n        this.logger.log(\"Table::cellFocus(event)\");\n        const cell = event.target;\n        if (cell instanceof HTMLElement) {\n            const b = cell.getBoundingClientRect();\n            const p = this.clientPosToTablePos(b.x + b.width / 2, b.y + b.height / 2);\n            if (p !== undefined) {\n                this.selection.value = p;\n            }\n            if (this.selection?.mode === TableEditMode.SELECT_CELL &&\n                this.adapter?.config.editMode === EditMode.EDIT_ON_FOCUS) {\n                this.editCell();\n            }\n        }\n    }\n    focusIn(event) {\n    }\n    focusOut(event) {\n    }\n    editCell() {\n        const col = this.selection.value.col;\n        const row = this.selection.value.row;\n        this.logger.log(`Table.editCell(): cell[${col}, ${row}]`);\n        if (this.editing !== undefined) {\n            if (this.editing.col === this.selection.value.col && this.editing.row === this.selection.value.row) {\n                return;\n            }\n        }\n        const cell = this.body.children[col + row * this.adapter.colCount];\n        this.editing = new TablePos(col, row);\n        cell.classList.add(\"edit\");\n        this.adapter.editCell(this.editing, cell);\n    }\n    saveCell() {\n        if (this.editing === undefined) {\n            return;\n        }\n        const col = this.editing.col;\n        const row = this.editing.row;\n        this.logger.log(`Table::saveCell(): cell[${col}, ${row}]`);\n        const cell = this.body.children[col + row * this.adapter.colCount];\n        cell.classList.remove(\"edit\");\n        this.adapter.saveCell(this.editing, cell);\n        this.editing = undefined;\n        this.focus();\n    }\n    pointerDown(ev) {\n    }\n    getModel() {\n        return this.model;\n    }\n    setModel(model) {\n        if (model === undefined) {\n            this.logger.log(`Table::setModel(undefined) => remove all models`);\n            if (this.selection) {\n                this.selection.modified.remove(this);\n            }\n            this.model = undefined;\n            this.selection = new SelectionModel();\n            this.selection.modified.add(this.selectionChanged, this);\n            return;\n        }\n        if (model instanceof SelectionModel) {\n            this.logger.log(`Table::setModel(SelectionModel) => set selection model`);\n            if (this.selection) {\n                this.selection.modified.remove(this);\n            }\n            this.selection = model;\n            this.selection.modified.add(this.selectionChanged, this);\n            return;\n        }\n        if (model instanceof TableModel) {\n            this.logger.log(`Table::setModel(TableModel) => set table model`);\n            this.model = model;\n            this.model.modified.add(this.modelChanged, this);\n            const adapter = TableAdapter.lookup(model);\n            try {\n                this.adapter = new adapter(model);\n            }\n            catch (e) {\n                console.log(`Table.setModel(): failed to instantiate table adapter: ${e}`);\n                console.log(`setting TypeScript's target to 'es6' might help`);\n                throw e;\n            }\n            this.prepareCells();\n            return;\n        }\n        if (model instanceof Object) {\n            this.logger.log(`Table::setModel(TableModel) => unexpected model of type ${model.constructor.name}`);\n            throw Error(`Table.setModel(): unexpected model of type ${model.constructor.name}`);\n        }\n    }\n    selectionChanged() {\n        this.logger.log(`Table::selectionChanged(): ${this.selection?.col}, ${this.selection?.row}, mode=${this.selection ? TableEditMode[this.selection.mode] : \"undefined\"}`);\n        if (this.selection === undefined) {\n            return;\n        }\n        this.saveCell();\n        switch (this.selection.mode) {\n            case TableEditMode.EDIT_CELL:\n                {\n                    if (document.activeElement === this) {\n                        const cell = this.body.children[this.selection.col + this.selection.row * this.adapter.colCount];\n                        if (!hasFocus(cell)) {\n                            cell.focus();\n                        }\n                        scrollIntoView(cell);\n                        if (this.adapter?.config.editMode === EditMode.EDIT_ON_FOCUS) {\n                            this.editCell();\n                        }\n                    }\n                }\n                break;\n            case TableEditMode.SELECT_CELL:\n            case TableEditMode.SELECT_ROW:\n                {\n                    if (document.activeElement === this) {\n                        const cell = this.body.children[this.selection.col + this.selection.row * this.adapter.colCount];\n                        cell.focus();\n                        scrollIntoView(cell);\n                    }\n                }\n                break;\n        }\n    }\n    modelChanged(event) {\n        this.logger.log(`Table::modelChanged(${event})`);\n        if (!this.visible && this.body.children.length === 0) {\n            return;\n        }\n        if (event instanceof TableEvent) {\n            switch (event.type) {\n                case TableEventType.CELL_CHANGED:\n                    {\n                        const index = event.col + event.row * this.adapter.colCount;\n                        const cell = this.body.children[index];\n                        if (cell === undefined) {\n                            console.log(`Table::modelChanged(): failed to find cell ${event.col}, ${event.row} (${index}) (body has ${this.body.children.length} children and table has parent ${this.parentElement})`);\n                            return;\n                        }\n                        if (cell instanceof HTMLSpanElement) {\n                            this.showCell(event, cell);\n                        }\n                    }\n                    break;\n                case TableEventType.INSERT_ROW:\n                    this.animator.run(new InsertRowAnimation(this, event));\n                    break;\n                case TableEventType.REMOVE_ROW:\n                    this.animator.run(new RemoveRowAnimation(this, event));\n                    break;\n                case TableEventType.INSERT_COL:\n                    this.animator.run(new InsertColumnAnimation(this, event));\n                    break;\n                case TableEventType.REMOVE_COL:\n                    this.animator.run(new RemoveColumnAnimation(this, event));\n                    break;\n                default:\n            }\n        }\n    }\n    prepareCells() {\n        if (this.adapter === undefined) {\n            this.logger.log(`Table::prepareCells(): no adapter => abort`);\n            return;\n        }\n        if (this.adapter.colCount === 0 || this.adapter.rowCount === 0) {\n            this.logger.log(`Table::prepareCells(): col and/or row count is zero => abort`);\n            return;\n        }\n        this.visible = isVisible(this);\n        if (!this.visible) {\n            this.logger.log(`Table::prepareCells(): not visible, can not calculate layout => abort`);\n            return;\n        }\n        if (this.prepareInProgress) {\n            this.logger.log(`Table::prepareCells(): prepareInProgress => abort`);\n            return;\n        }\n        this.prepareInProgress = true;\n        this.logger.log(`Table::prepareCells(): start`);\n        if (this.adapter.config.seamless) {\n            this.root.classList.add(\"seamless\");\n        }\n        this.prepareMinCellSize();\n        this.prepareColumnHeads();\n        this.prepareRowHeads();\n        this.prepareBody();\n        this.logger.log(`Table::prepareCells(): finish, schedule arrangeAllMeasuredInGrid()`);\n        setTimeout(this.arrangeAllMeasuredInGrid, 0);\n    }\n    arrangeAllMeasuredInGrid() {\n        this.logger.log(`Table::arrangeAllMeasuredInGrid(): begin`);\n        this.calculateMinCellSize();\n        let { colWidths, colHeadHeight } = this.calculateColumnWidths();\n        let { rowHeights, rowHeadWidth } = this.calculateRowHeights();\n        this.placeColumnHeads(colWidths, colHeadHeight, rowHeadWidth);\n        this.placeRowHeads(rowHeights, colHeadHeight, rowHeadWidth);\n        this.placeBody(rowHeadWidth, colHeadHeight);\n        this.placeBodyCells(colWidths, rowHeights, colHeadHeight, rowHeadWidth);\n        this.setHeadingFillerSizeToScrollbarSize();\n        this.prepareInProgress = false;\n        this.logger.log(`Table::arrangeAllMeasuredInGrid(): finish`);\n    }\n    prepareMinCellSize() {\n        this.logger.log(`Table::prepareMinCellSize()`);\n        if (this.minCellHeight !== undefined) {\n            return;\n        }\n        const measureLineHeight = span(text(\"Tg\"));\n        this.measure.appendChild(measureLineHeight);\n    }\n    calculateMinCellSize() {\n        this.logger.log(`Table::calculateMinCellSize()`);\n        if (this.minCellHeight !== undefined) {\n            return;\n        }\n        const measureLineHeight = this.measure.children[0];\n        const b = measureLineHeight.getBoundingClientRect();\n        this.minCellWidth = Math.ceil(b.width - this.WIDTH_ADJUST);\n        this.minCellHeight = Math.ceil(b.height - this.HEIGHT_ADJUST);\n        this.measure.removeChild(measureLineHeight);\n    }\n    prepareColumnHeads() {\n        this.logger.log(`Table::prepareColumnHeads()`);\n        const columnHeaders = new Array(this.adapter.colCount);\n        for (let col = 0; col < this.adapter.colCount; ++col) {\n            const content = this.adapter.getColumnHead(col);\n            if (this.colHeads === undefined && content !== undefined) {\n                this.colHeads = div();\n                this.colHeads.className = \"cols\";\n                this.root.appendChild(this.colHeads);\n                this.colResizeHandles = div();\n                this.colResizeHandles.className = \"cols\";\n                this.root.appendChild(this.colResizeHandles);\n            }\n            columnHeaders[col] = content;\n        }\n        if (this.colHeads !== undefined) {\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = span(columnHeaders[col]);\n                cell.className = \"head\";\n                this.measure.appendChild(cell);\n            }\n        }\n    }\n    prepareRowHeads() {\n        this.logger.log(`Table::prepareRowHeads()`);\n        let rowHeaders = new Array(this.adapter.rowCount);\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            const content = this.adapter.getRowHead(row);\n            if (this.rowHeads === undefined && content !== undefined) {\n                this.rowHeads = div();\n                this.rowHeads.className = \"rows\";\n                this.root.appendChild(this.rowHeads);\n                this.rowResizeHandles = div();\n                this.rowResizeHandles.className = \"rows\";\n                this.root.appendChild(this.rowResizeHandles);\n            }\n            rowHeaders[row] = content;\n        }\n        if (this.rowHeads) {\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                const cell = span(rowHeaders[row]);\n                cell.className = \"head\";\n                this.measure.appendChild(cell);\n            }\n        }\n    }\n    prepareBody() {\n        this.logger.log(`Table::prepareBody()`);\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const cell = this.createCell();\n                this.showCell(new TablePos(col, row), cell);\n                this.measure.appendChild(cell);\n            }\n        }\n    }\n    createCell() {\n        const cell = span();\n        cell.onfocus = this.cellFocus;\n        cell.onkeydown = this.cellKeyDown;\n        cell.tabIndex = 0;\n        cell.setAttribute(\"contenteditable\", \"\");\n        return cell;\n    }\n    setCellSize(span, x, y, w, h) {\n        span.style.left = `${x}px`;\n        span.style.top = `${y}px`;\n        span.style.width = `${w - this.WIDTH_ADJUST}px`;\n        span.style.height = `${h - this.HEIGHT_ADJUST}px`;\n    }\n    showCell(pos, cell) {\n        this.adapter.showCell(pos, cell);\n        if (cell.children.length !== 0) {\n            cell.style.caretColor = \"currentcolor\";\n        }\n    }\n    calculateRowHeights() {\n        this.logger.log(`Table::calculateRowHeights()`);\n        let idx = this.colHeads ? this.adapter.colCount : 0;\n        let rowHeadWidth = 0;\n        const rowHeights = Array(this.adapter.rowCount);\n        if (this.rowHeads) {\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                const child = this.measure.children[idx++];\n                const bounds = child.getBoundingClientRect();\n                rowHeights[row] = Math.max(bounds.height, this.minCellHeight);\n                rowHeadWidth = Math.max(rowHeadWidth, bounds.width);\n            }\n        }\n        else {\n            rowHeights.fill(this.minCellHeight);\n        }\n        idx = (this.colHeads ? this.adapter.colCount : 0) + (this.rowHeads ? this.adapter.rowCount : 0);\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            let rh = rowHeights[row];\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const child = this.measure.children[idx + col + row * this.adapter.colCount];\n                const bounds = child.getBoundingClientRect();\n                rh = Math.max(rh, bounds.height);\n            }\n            rowHeights[row] = Math.ceil(rh);\n        }\n        rowHeadWidth = Math.ceil(rowHeadWidth);\n        return { rowHeights, rowHeadWidth };\n    }\n    calculateColumnWidths(withinBody = false) {\n        this.logger.log(`Table::calculateColumnWidths(withinBody = ${withinBody})`);\n        let colHeadHeight = 0;\n        const colWidths = Array(this.adapter.colCount);\n        if (this.colHeads) {\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const child = this.measure.children[col];\n                const bounds = child.getBoundingClientRect();\n                colWidths[col] = Math.max(bounds.width, this.minCellWidth);\n                colHeadHeight = Math.max(colHeadHeight, bounds.height);\n            }\n        }\n        else {\n            colWidths.fill(this.minCellWidth);\n        }\n        colHeadHeight = Math.ceil(colHeadHeight);\n        let idxStart;\n        if (withinBody) {\n            idxStart = 0;\n        }\n        else {\n            idxStart = (this.colHeads ? this.adapter.colCount : 0) + (this.rowHeads ? this.adapter.rowCount : 0);\n        }\n        for (let col = 0; col < this.adapter.colCount; ++col) {\n            let cw = colWidths[col];\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                let child;\n                let idx = idxStart + col + row * this.adapter.colCount;\n                if (withinBody) {\n                    child = this.body.children[idx];\n                }\n                else {\n                    child = this.measure.children[idx];\n                }\n                const bounds = child.getBoundingClientRect();\n                cw = Math.max(cw, bounds.width);\n            }\n            colWidths[col] = Math.ceil(cw);\n        }\n        return { colWidths, colHeadHeight };\n    }\n    placeColumnHeads(colWidths, colHeadHeight, rowHeadWidth) {\n        this.logger.log(`Table::placeColumnHeads(...)`);\n        if (this.colHeads === undefined) {\n            return;\n        }\n        const seam = this.adapter.config.seamless ? 0 : 1;\n        let x = 0;\n        for (let col = 0; col < this.adapter.colCount; ++col) {\n            const child = this.measure.children[0];\n            this.setCellSize(child, x, 0, colWidths[col], colHeadHeight);\n            this.colHeads.appendChild(child);\n            x += colWidths[col] - 1 - 1 + seam;\n        }\n        let filler = span();\n        filler.classList.add(\"head\");\n        filler.classList.add(\"fill\");\n        filler.style.left = `${x}px`;\n        filler.style.top = `0`;\n        filler.style.width = `256px`;\n        filler.style.height = `${colHeadHeight}px`;\n        this.colHeads.appendChild(filler);\n        this.colResizeHandles.style.left = `${rowHeadWidth}px`;\n        this.colResizeHandles.style.height = `${colHeadHeight}px`;\n        x = -this.HANDLE_SKEW;\n        for (let col = 0; col < this.adapter.colCount; ++col) {\n            x += colWidths[col] - 1;\n            const handle = this.createHandle(col, x, 0, this.HANDLE_SIZE, colHeadHeight);\n            this.colResizeHandles.appendChild(handle);\n        }\n        x += this.HANDLE_SIZE;\n        filler = span();\n        filler.classList.add(\"head\");\n        filler.classList.add(\"fill\");\n        filler.style.left = `${x}px`;\n        filler.style.top = `0`;\n        filler.style.width = `256px`;\n        filler.style.height = `${colHeadHeight}px`;\n        this.colResizeHandles.appendChild(filler);\n    }\n    placeRowHeads(rowHeights, colHeadHeight, rowHeadWidth) {\n        this.logger.log(`Table::placeRowHeads(...)`);\n        if (this.rowHeads === undefined) {\n            return;\n        }\n        const seam = this.adapter.config.seamless ? 0 : 1;\n        let y = 0;\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            const child = this.measure.children[0];\n            this.setCellSize(child, 0, y, rowHeadWidth, rowHeights[row]);\n            this.rowHeads.appendChild(child);\n            y += rowHeights[row] - 1 - 1 + seam;\n        }\n        let filler = span();\n        filler.classList.add(\"head\");\n        filler.classList.add(\"fill\");\n        filler.style.left = `0`;\n        filler.style.top = `${y}px`;\n        filler.style.width = `${rowHeadWidth}px`;\n        filler.style.height = `256px`;\n        this.rowHeads.appendChild(filler);\n        this.rowResizeHandles.style.top = `${colHeadHeight}px`;\n        this.rowResizeHandles.style.width = `${rowHeadWidth}px`;\n        y = -this.HANDLE_SKEW;\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            y += rowHeights[row] - 1;\n            const rowHandle = this.createHandle(row, 0, y, rowHeadWidth, this.HANDLE_SIZE);\n            this.rowResizeHandles.appendChild(rowHandle);\n        }\n        y += this.HANDLE_SIZE;\n        filler = span();\n        filler.classList.add(\"head\");\n        filler.classList.add(\"fill\");\n        filler.style.left = `0`;\n        filler.style.top = `${y}0px`;\n        filler.style.width = `${rowHeadWidth}px`;\n        filler.style.height = `256px`;\n        this.rowResizeHandles.appendChild(filler);\n    }\n    placeBody(rowHeadWidth, colHeadHeight) {\n        this.logger.log(`Table::placeBody(...)`);\n        if (this.colHeads !== undefined) {\n            if (this.adapter?.config.seamless) {\n                this.colHeads.style.height = `${colHeadHeight - 2}px`;\n                this.colHeads.style.left = `${rowHeadWidth - (this.rowHeads == null ? 0 : 2)}px`;\n            }\n            else {\n                this.colHeads.style.height = `${colHeadHeight}px`;\n                this.colHeads.style.left = `${rowHeadWidth - (this.rowHeads == null ? 0 : 1)}px`;\n            }\n        }\n        if (this.rowHeads !== undefined) {\n            if (this.adapter?.config.seamless) {\n                this.rowHeads.style.width = `${rowHeadWidth - 2}px`;\n                this.rowHeads.style.top = `${colHeadHeight - (this.colHeads == null ? 0 : 2)}px`;\n            }\n            else {\n                this.rowHeads.style.width = `${rowHeadWidth}px`;\n                this.rowHeads.style.top = `${colHeadHeight - (this.colHeads == null ? 0 : 1)}px`;\n            }\n        }\n        --rowHeadWidth;\n        --colHeadHeight;\n        if (this.adapter?.config.seamless) {\n            --rowHeadWidth;\n            --colHeadHeight;\n        }\n        if (rowHeadWidth < 0) {\n            rowHeadWidth = 0;\n        }\n        if (colHeadHeight < 0) {\n            colHeadHeight = 0;\n        }\n        this.body.style.left = `${rowHeadWidth}px`;\n        this.body.style.top = `${colHeadHeight}px`;\n        return { rowHeadWidth, colHeadHeight };\n    }\n    placeBodyCells(colWidths, rowHeights, colHeadHeight, rowHeadWidth) {\n        this.logger.log(`Table::placeBodyCells(...)`);\n        const seam = this.adapter.config.seamless ? 0 : 1;\n        let y = 0;\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            let x = 0;\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                const child = this.measure.children[0];\n                this.setCellSize(child, x, y, colWidths[col], rowHeights[row]);\n                this.body.appendChild(child);\n                x += colWidths[col] - 2 + seam;\n            }\n            y += rowHeights[row] - 2 + seam;\n        }\n    }\n    createHandle(idx, x, y, w, h) {\n        const handle = span();\n        handle.className = \"handle\";\n        handle.style.left = `${x}px`;\n        handle.style.top = `${y}px`;\n        handle.style.width = `${w}px`;\n        handle.style.height = `${h}px`;\n        handle.dataset[\"idx\"] = `${idx}`;\n        handle.onpointerdown = this.handleDown;\n        handle.onpointermove = this.handleMove;\n        handle.onpointerup = this.handleUp;\n        return handle;\n    }\n    handleDown(ev) {\n        ev.preventDefault();\n        this.handle = ev.target;\n        this.handleIndex = parseInt(this.handle.dataset[\"idx\"]) + 1;\n        this.handle.setPointerCapture(ev.pointerId);\n        const isColumn = this.handle.parentElement === this.colResizeHandles;\n        if (isColumn) {\n            this.deltaHandle = ev.clientX - px2int(this.handle.style.left);\n            this.deltaSplitBody = ev.clientX;\n            this.deltaSplitHead = ev.clientX - px2float(this.body.style.left);\n            const cell = this.colHeads.children[this.handleIndex - 1];\n            this.deltaColumn = ev.clientX - px2float(cell.style.width);\n            this.splitVertical(this.handleIndex);\n        }\n        else {\n            this.deltaHandle = ev.clientY - px2float(this.handle.style.top);\n            this.deltaSplitBody = ev.clientY;\n            this.deltaSplitHead = ev.clientY - px2float(this.body.style.top);\n            const cell = this.rowHeads.children[this.handleIndex - 1];\n            this.deltaColumn = ev.clientY - px2float(cell.style.height);\n            this.splitHorizontal(this.handleIndex);\n        }\n    }\n    handleMove(ev) {\n        if (this.handle === undefined) {\n            return;\n        }\n        const isColumn = this.handle.parentElement === this.colResizeHandles;\n        if (isColumn) {\n            let clientX = ev.clientX;\n            const xLimit = this.deltaColumn + 8;\n            if (clientX < xLimit) {\n                clientX = xLimit;\n            }\n            this.handle.style.left = `${clientX - this.deltaHandle}px`;\n            this.splitHead.style.left = `${clientX - this.deltaSplitHead}px`;\n            this.splitBody.style.left = `${clientX - this.deltaSplitBody}px`;\n            const h = this.handleIndex;\n            this.colHeads.children[h - 1].style.width = `${clientX - this.deltaColumn}px`;\n            for (let row = 0; row < this.adapter.rowCount; ++row) {\n                ;\n                this.body.children[h - 1 + row * h].style.width = `${clientX - this.deltaColumn}px`;\n            }\n        }\n        else {\n            let clientY = ev.clientY;\n            const yLimit = this.deltaColumn + 8;\n            if (clientY < yLimit) {\n                clientY = yLimit;\n            }\n            this.handle.style.top = `${clientY - this.deltaHandle}px`;\n            this.splitHead.style.top = `${clientY - this.deltaSplitHead}px`;\n            this.splitBody.style.top = `${clientY - this.deltaSplitBody}px`;\n            const h = this.handleIndex;\n            this.rowHeads.children[h - 1].style.height = `${clientY - this.deltaColumn}px`;\n            let idx = (h - 1) * this.adapter.colCount;\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                ;\n                this.body.children[idx + col].style.height = `${clientY - this.deltaColumn}px`;\n            }\n        }\n    }\n    handleUp(ev) {\n        if (this.handle === undefined) {\n            return;\n        }\n        this.handleMove(ev);\n        const isColumn = this.handle.parentElement === this.colResizeHandles;\n        if (isColumn) {\n            let clientX = ev.clientX;\n            const xLimit = this.deltaColumn + 8;\n            if (clientX < xLimit) {\n                clientX = xLimit;\n            }\n            this.joinVertical(this.handleIndex, clientX - this.deltaSplitBody);\n        }\n        else {\n            let clientY = ev.clientY;\n            const yLimit = this.deltaColumn + 8;\n            if (clientY < yLimit) {\n                clientY = yLimit;\n            }\n            this.joinHorizontal(this.handleIndex, clientY - this.deltaSplitBody);\n        }\n        this.handle = undefined;\n    }\n    splitVerticalNew(splitCol) {\n        this.logger.log(`Table.splitVerticalNew(splitCol = ${splitCol})`);\n        this.splitHeadVertical(splitCol);\n        this.splitBodyVertical(splitCol);\n    }\n    splitHeadVertical(splitCol) {\n        this.logger.log(`Table.splitHeadVertical(splitCol = ${splitCol})`);\n        if (this.colHeads === undefined) {\n            return;\n        }\n        const overlap = this.adapter.config.seamless ? 0 : 1;\n        this.splitHead = div();\n        this.splitHead.className = \"splitBody colHack\";\n        this.splitHead.style.top = `0`;\n        this.splitHead.style.bottom = `0`;\n        this.splitHead.style.backgroundColor = Table.splitColor;\n        const idx = splitCol;\n        if (this.body.children.length === 0) {\n            this.splitHead.style.left = `0px`;\n            this.splitHead.style.width = `1px`;\n        }\n        else {\n            if (idx < this.colHeads.children.length) {\n                let cell = this.colHeads.children[idx];\n                let width = 0;\n                const left = px2float(cell.style.left);\n                while (idx < this.colHeads.children.length) {\n                    cell = this.colHeads.children[idx];\n                    const b = cell.getBoundingClientRect();\n                    width += b.width - overlap;\n                    let x = px2float(cell.style.left);\n                    cell.style.left = `${x - left}px`;\n                    this.splitHead.appendChild(cell);\n                }\n                if (this.adapter.config.seamless) {\n                    width += overlap;\n                }\n                this.splitHead.style.left = `${left}px`;\n                this.splitHead.style.width = `${width}px`;\n            }\n            else {\n                let cell = this.colHeads.children[this.body.children.length - 1];\n                let b = cell.getBoundingClientRect();\n                let left = px2float(cell.style.left) + b.width - overlap;\n                this.splitHead.style.left = `${left}px`;\n                this.splitHead.style.width = `1px`;\n            }\n        }\n        this.colHeads.appendChild(this.splitHead);\n    }\n    splitBodyVertical(splitCol) {\n        this.logger.log(`Table.splitBodyVertical(splitCol=${splitCol})`);\n        const overlap = this.adapter.config.seamless ? 0 : 1;\n        this.splitBody = div();\n        this.splitBody.className = \"splitBody\";\n        this.splitBody.style.top = `0`;\n        this.splitBody.style.bottom = `0`;\n        this.splitBody.style.backgroundColor = Table.splitColor;\n        if (this.body.children.length === 0) {\n            this.splitBody.style.left = `0px`;\n            this.splitBody.style.width = `1px`;\n        }\n        else {\n            const previousColCount = this.body.children.length / this.adapter.rowCount;\n            if (splitCol < previousColCount) {\n                let cell = this.body.children[splitCol];\n                const left = px2float(cell.style.left);\n                let width = 0;\n                const colsInBody = this.body.children.length / this.adapter.rowCount;\n                const colsToSplit = colsInBody - splitCol;\n                let idx = splitCol;\n                for (let row = 0; row < this.adapter.rowCount; ++row) {\n                    for (let col = 0; col < colsToSplit; ++col) {\n                        cell = this.body.children[idx];\n                        if (row === 0) {\n                            const b = cell.getBoundingClientRect();\n                            width += b.width - overlap;\n                        }\n                        cell.style.left = `${px2float(cell.style.left) - left}px`;\n                        this.splitBody.appendChild(cell);\n                    }\n                    idx += splitCol;\n                }\n                this.splitBody.style.left = `${left}px`;\n                this.splitBody.style.width = `${width}px`;\n            }\n            else {\n                let cell = this.body.children[this.body.children.length - 1];\n                let boundary = cell.getBoundingClientRect();\n                let left = px2float(cell.style.left) + boundary.width - overlap;\n                this.splitBody.style.left = `${left}px`;\n                this.splitBody.style.width = `1px`;\n            }\n        }\n        this.body.appendChild(this.splitBody);\n    }\n    splitVertical(splitColumn, extra = 0) {\n        this.logger.log(`Table::splitVertical(splitColumn=${splitColumn}, extra=${extra})`);\n        if (this.colHeads !== undefined) {\n            this.splitHead = div();\n            this.splitHead.className = \"cols\";\n            this.splitHead.style.left = this.colHeads.style.left;\n            this.splitHead.style.height = this.colHeads.style.height;\n            this.root.appendChild(this.splitHead);\n            setTimeout(() => {\n                this.splitHead.scrollTop = this.colHeads.scrollTop;\n                this.splitHead.scrollLeft = this.colHeads.scrollLeft;\n            }, 0);\n        }\n        this.splitBody = div();\n        this.splitBody.className = \"splitBody\";\n        const b = this.body.getBoundingClientRect();\n        this.splitBody.style.width = `${b.width}px`;\n        this.splitBody.style.height = `${b.height}px`;\n        this.body.appendChild(this.splitBody);\n        const bodyWidth = splitColumn;\n        const splitBodyColumns = this.adapter.colCount - splitColumn + extra;\n        if (this.splitHead !== undefined) {\n            for (let i = 0; i < splitBodyColumns; ++i) {\n                this.splitHead.appendChild(this.colHeads.children[splitColumn]);\n            }\n            this.splitHead.appendChild(this.colHeads.children[this.colHeads.children.length - 1].cloneNode());\n        }\n        let idx = splitColumn;\n        for (let row = 0; row < this.adapter.rowCount; ++row) {\n            for (let col = 0; col < splitBodyColumns; ++col) {\n                this.splitBody.appendChild(this.body.children[idx]);\n            }\n            idx += bodyWidth;\n        }\n    }\n    joinVertical(splitCol, delta, extra = 0, colCount, rowCount) {\n        this.logger.log(`Table::joinVertical(splitCol=${splitCol}, delta=${delta}, extra=${extra}, colCount = ${colCount}, rowCount = ${rowCount})`);\n        if (colCount === undefined) {\n            colCount = this.adapter.colCount;\n        }\n        if (rowCount === undefined) {\n            rowCount = this.adapter.rowCount;\n        }\n        const splitBodyColumns = colCount - splitCol + extra;\n        let idx = splitCol - extra;\n        if (this.colHeads !== undefined) {\n            const filler = this.colHeads.children[this.colHeads.children.length - 1];\n            for (let col = 0; col < splitBodyColumns; ++col) {\n                const cell = this.splitHead.children[0];\n                const left = px2float(cell.style.left);\n                cell.style.left = `${left + delta}px`;\n                this.colHeads.insertBefore(cell, filler);\n            }\n            const fillerLeft = filler.style.left;\n            const left = px2float(fillerLeft);\n            filler.style.left = `${left + delta}px`;\n            for (let col = idx; col <= colCount; ++col) {\n                const cell = this.colResizeHandles.children[col];\n                const left = px2float(cell.style.left);\n                cell.style.left = `${left + delta}px`;\n            }\n        }\n        for (let row = 0; row < rowCount; ++row) {\n            let beforeChild = this.body.children[idx];\n            for (let col = 0; col < splitBodyColumns; ++col) {\n                const cell = this.splitBody.children[0];\n                const left = px2float(cell.style.left);\n                cell.style.left = `${left + delta}px`;\n                this.body.insertBefore(cell, beforeChild);\n            }\n            idx += colCount;\n        }\n        if (this.colHeads !== undefined) {\n            this.root.removeChild(this.splitHead);\n            this.splitHead = undefined;\n        }\n        this.body.removeChild(this.splitBody);\n        this.splitBody = undefined;\n    }\n    splitHorizontalNew(splitRow) {\n        this.logger.log(`Table.splitHorizontalNew(splitRow = ${splitRow})`);\n        this.splitHeadHorizontal(splitRow);\n        this.splitBodyHorizontal(splitRow);\n    }\n    splitHeadHorizontal(splitRow) {\n        this.logger.log(`Table.splitHeadHorizontal(splitRow = ${splitRow})`);\n        if (this.rowHeads === undefined) {\n            return;\n        }\n        const overlap = this.adapter.config.seamless ? 0 : 1;\n        this.splitHead = div();\n        this.splitHead.className = \"splitBody\";\n        this.splitHead.style.left = `0`;\n        this.splitHead.style.right = `0`;\n        this.splitHead.style.backgroundColor = Table.splitColor;\n        const idx = splitRow;\n        if (this.body.children.length === 0) {\n            this.splitHead.style.top = `0px`;\n            this.splitHead.style.height = `1px`;\n        }\n        else {\n            if (idx < this.rowHeads.children.length) {\n                let cell = this.rowHeads.children[idx];\n                let height = 0;\n                const top = px2float(cell.style.top);\n                while (idx < this.rowHeads.children.length) {\n                    cell = this.rowHeads.children[idx];\n                    const b = cell.getBoundingClientRect();\n                    height += b.height - overlap;\n                    let y = px2float(cell.style.top);\n                    cell.style.top = `${y - top}px`;\n                    this.splitHead.appendChild(cell);\n                }\n                if (this.adapter.config.seamless) {\n                    height += overlap;\n                }\n                this.splitHead.style.top = `${top}px`;\n                this.splitHead.style.height = `${height}px`;\n            }\n            else {\n                let cell = this.rowHeads.children[this.body.children.length - 1];\n                let b = cell.getBoundingClientRect();\n                let top = px2float(cell.style.top) + b.height - overlap;\n                this.splitHead.style.top = `${top}px`;\n                this.splitHead.style.height = `1px`;\n            }\n        }\n        this.rowHeads.appendChild(this.splitHead);\n    }\n    splitBodyHorizontal(splitRow) {\n        this.logger.log(`Table.splitBodyHorizontal(splitRow = ${splitRow})`);\n        const overlap = this.adapter.config.seamless ? 0 : 1;\n        this.splitBody = div();\n        this.splitBody.className = \"splitBody\";\n        this.splitBody.style.left = `0`;\n        this.splitBody.style.right = `0`;\n        this.splitBody.style.backgroundColor = Table.splitColor;\n        const idx = splitRow * this.adapter.colCount;\n        if (this.body.children.length === 0) {\n            this.splitBody.style.top = `0px`;\n            this.splitBody.style.height = `1px`;\n        }\n        else {\n            if (idx < this.body.children.length) {\n                let cell = this.body.children[idx];\n                let col = this.adapter.colCount;\n                let height = 0;\n                const top = px2float(cell.style.top);\n                while (idx < this.body.children.length) {\n                    cell = this.body.children[idx];\n                    --col;\n                    if (col === 0) {\n                        const b = cell.getBoundingClientRect();\n                        height += b.height - overlap;\n                        col = this.adapter.colCount;\n                    }\n                    let y = px2float(cell.style.top);\n                    cell.style.top = `${y - top}px`;\n                    this.splitBody.appendChild(cell);\n                }\n                height += overlap;\n                this.splitBody.style.top = `${top}px`;\n                this.splitBody.style.height = `${height}px`;\n            }\n            else {\n                let cellAtBottom = this.body.children[this.body.children.length - 1];\n                let b = cellAtBottom.getBoundingClientRect();\n                let top = px2float(cellAtBottom.style.top) + b.height - overlap;\n                this.splitBody.style.top = `${top}px`;\n                this.splitBody.style.height = `1px`;\n            }\n        }\n        this.body.appendChild(this.splitBody);\n    }\n    splitHorizontal(splitRow, extra = 0, event) {\n        this.logger.log(`Table.splitHorizontal(splitRow = ${splitRow}, extra = ${extra}, event = ...)`);\n        if (this.rowHeads !== undefined) {\n            this.splitHead = div();\n            this.splitHead.className = \"rows\";\n            this.splitHead.style.top = this.rowHeads.style.top;\n            this.splitHead.style.width = this.rowHeads.style.width;\n            this.root.appendChild(this.splitHead);\n            setTimeout(() => {\n                this.splitHead.scrollTop = this.rowHeads.scrollTop;\n                this.splitHead.scrollLeft = this.rowHeads.scrollLeft;\n            }, 0);\n        }\n        this.splitBody = div();\n        this.splitBody.className = \"splitBody\";\n        this.splitBody.style.backgroundColor = \"rgba(255,128,0,0.5)\";\n        const b = this.body.getBoundingClientRect();\n        this.splitBody.style.width = `${b.width}px`;\n        this.splitBody.style.height = `${b.height}px`;\n        this.body.appendChild(this.splitBody);\n        const splitBodyRows = this.adapter.rowCount - splitRow + extra;\n        if (this.splitHead !== undefined) {\n            for (let i = 0; i < splitBodyRows; ++i) {\n                this.splitHead.appendChild(this.rowHeads.children[splitRow]);\n            }\n            this.splitHead.appendChild(this.rowHeads.children[this.rowHeads.children.length - 1].cloneNode());\n        }\n        let idx = this.adapter.colCount * splitRow;\n        for (let row = 0; row < splitBodyRows; ++row) {\n            for (let col = 0; col < this.adapter.colCount; ++col) {\n                this.splitBody.appendChild(this.body.children[idx]);\n            }\n        }\n        if (this.splitBody.children.length > 0) {\n            idx = this.splitBody.children.length - 1;\n            const last = this.splitBody.children[idx];\n            const top = px2int(last.style.top);\n            for (let i = 0; i < this.splitBody.children.length; ++i) {\n                const c = this.splitBody.children[i];\n                const y = px2int(c.style.top);\n                c.style.top = `${y - top}px`;\n            }\n            this.splitBody.style.backgroundColor = \"#f80\";\n            this.splitBody.style.top = `${top}px`;\n            this.splitBody.style.height = `${b.height - top}px`;\n        }\n        else if (event !== undefined && this.body.children.length > 0) {\n            idx = event.index * this.adapter.colCount;\n            const last = this.body.children[idx];\n            const top = px2int(last.style.top);\n            this.splitBody.style.top = `${top}px`;\n            this.splitBody.style.height = `${b.height - top}px`;\n        }\n        else if (this.body.children.length > 0) {\n            const filler = span();\n            idx = this.body.children.length - 2;\n            const last = this.body.children[idx];\n            const bf = this.body.children[idx].getBoundingClientRect();\n            filler.style.border = \"none\";\n            filler.style.backgroundColor = \"#1e1e1e\";\n            const top = px2int(last.style.top) + bf.height;\n            filler.style.top = `${top}px`;\n            filler.style.left = `0px`;\n            filler.style.width = `${b.width - 2}px`;\n            filler.style.height = `${b.height - top}px`;\n            this.splitBody.appendChild(filler);\n        }\n        else {\n        }\n    }\n    joinHorizontal(splitRow, delta, extra = 0, colCount, rowCount) {\n        this.logger.log(`Table. joinHorizontal(splitRow = ${splitRow}, delta = ${delta}, extra = ${extra}, colCount = ${colCount}, rowCount = ${rowCount}`);\n        if (colCount === undefined) {\n            colCount = this.adapter.colCount;\n        }\n        if (rowCount === undefined) {\n            rowCount = this.adapter.rowCount;\n        }\n        const splitBodyRows = rowCount - splitRow + extra;\n        if (this.rowHeads !== undefined) {\n            const filler = this.rowHeads.children[this.rowHeads.children.length - 1];\n            for (let row = 0; row < splitBodyRows; ++row) {\n                const cell = this.splitHead.children[0];\n                const top = px2float(cell.style.top);\n                cell.style.top = `${top + delta}px`;\n                this.rowHeads.insertBefore(cell, filler);\n            }\n            const fillerTop = filler.style.top;\n            const top = px2float(fillerTop);\n            filler.style.top = `${top + delta}px`;\n            let idx = splitRow;\n            for (let row = idx; row <= rowCount; ++row) {\n                const cell = this.rowResizeHandles.children[row];\n                const top = px2float(cell.style.top);\n                cell.style.top = `${top + delta}px`;\n            }\n        }\n        for (let row = 0; row < splitBodyRows; ++row) {\n            for (let col = 0; col < colCount; ++col) {\n                const cell = this.splitBody.children[0];\n                const top = px2float(cell.style.top);\n                cell.style.top = `${top + delta}px`;\n                this.body.appendChild(cell);\n            }\n        }\n        if (this.rowHeads !== undefined) {\n            this.root.removeChild(this.splitHead);\n            this.splitHead = undefined;\n        }\n        this.body.removeChild(this.splitBody);\n        this.splitBody = undefined;\n    }\n    setHeadingFillerSizeToScrollbarSize() {\n        this.logger.log(`Table.setHeadingFillerSizeToScrollbarSize()`);\n        const bounds = this.body.getBoundingClientRect();\n        if (this.colHeads !== undefined) {\n            const w = Math.ceil(bounds.width - this.body.clientWidth);\n            this.colHeads.children[this.colHeads.children.length - 1].style.width = `${w}px`;\n            this.colHeads.style.right = `${w}px`;\n        }\n        if (this.rowHeads !== undefined) {\n            const h = Math.ceil(bounds.height - this.body.clientHeight);\n            this.rowHeads.children[this.rowHeads.children.length - 1].style.height = `${h}px`;\n            this.rowHeads.style.bottom = `${h}px`;\n        }\n    }\n    clientPosToTablePos(x, y) {\n        let col, row;\n        for (col = 0; col < this.adapter.colCount; ++col) {\n            const b = this.body.children[col].getBoundingClientRect();\n            if (b.x <= x && x < b.x + b.width)\n                break;\n        }\n        if (col >= this.adapter.colCount) {\n            return undefined;\n        }\n        let idx = 0;\n        for (row = 0; row < this.adapter.rowCount; ++row) {\n            const b = this.body.children[idx].getBoundingClientRect();\n            if (b.y <= y && y < b.y + b.height)\n                break;\n            idx += this.adapter.colCount;\n        }\n        if (row >= this.adapter.rowCount) {\n            return undefined;\n        }\n        return new TablePos(col, row);\n    }\n}\nTable.maskColor = `#1e1e1e`;\nTable.splitColor = `#1e1e1e`;\nTable.allTables = new Set();\nTable.loggerType = NullLogger;\nTable.define(\"tx-table\", Table);\n//# sourceMappingURL=Table.js.map","import { jsx as _jsx, jsxs as _jsxs } from \"toad.jsx/lib/jsx-runtime\";\nimport { View } from \"../view/View.js\";\nimport { GenericTool } from \"../view/GenericTool.js\";\nimport { textAreaStyle } from \"../view/textAreaStyle.js\";\nimport { Table } from \"./Table.js\";\nexport class TableTool extends GenericTool {\n    constructor() {\n        super();\n        this.toolbar = _jsx(\"div\", { class: \"toolbar\" });\n        this.buttonAddRowAbove = _jsx(\"button\", { class: \"left\", title: \"add row above\", children: _jsxs(\"svg\", { style: { display: \"block\" }, viewBox: \"0 0 13 13\", width: \"13\", height: \"13\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"0.5\", width: \"12\", height: \"12\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"0.5\", y1: \"8.5\", x2: \"12.5\", y2: \"8.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4.5\", y1: \"8.5\", x2: \"4.5\", y2: \"13.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"8.5\", x2: \"8.5\", y2: \"13.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"6.5\", y1: \"2\", x2: \"6.5\", y2: \"7\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4\", y1: \"4.5\", x2: \"9\", y2: \"4.5\", class: \"stroke\" })] }) });\n        this.buttonAddRowAbove.onclick = () => {\n            this.lastActiveTable?.focus();\n            const model = this.lastActiveTable?.model;\n            const selection = this.lastActiveTable?.selection;\n            if (selection && isRowEditInterface(model)) {\n                model.insertRow(selection.row);\n            }\n        };\n        this.toolbar.appendChild(this.buttonAddRowAbove);\n        this.buttonAddRowBelow = _jsx(\"button\", { title: \"add row below\", children: _jsxs(\"svg\", { viewBox: \"0 0 13 13\", width: \"13\", height: \"13\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"0.5\", width: \"12\", height: \"12\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"0.5\", y1: \"4.5\", x2: \"12.5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4.5\", y1: \"0.5\", x2: \"4.5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"0.5\", x2: \"8.5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"6.5\", y1: \"6\", x2: \"6.5\", y2: \"11\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4\", y1: \"8.5\", x2: \"9\", y2: \"8.5\", class: \"stroke\" })] }) });\n        this.buttonAddRowBelow.onclick = () => {\n            this.lastActiveTable?.focus();\n            const model = this.lastActiveTable?.model;\n            const selection = this.lastActiveTable?.selection;\n            if (selection && isRowEditInterface(model)) {\n                model.insertRow(selection.row + 1);\n            }\n        };\n        this.toolbar.appendChild(this.buttonAddRowBelow);\n        this.buttonDeleteRow = _jsx(\"button\", { class: \"right\", title: \"delete row\", children: _jsxs(\"svg\", { viewBox: \"0 0 13 13\", width: \"13\", height: \"13\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"0.5\", width: \"12\", height: \"12\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"0.5\", y1: \"4.5\", x2: \"12.5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0.5\", y1: \"8.5\", x2: \"12.5\", y2: \"8.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"5.5\", y1: \"3.5\", x2: \"11.5\", y2: \"9.5\", class: \"stroke\", \"stroke-width\": \"1.5\" }), _jsx(\"line\", { x1: \"11.5\", y1: \"3.5\", x2: \"5.5\", y2: \"9.5\", class: \"stroke\", \"stroke-width\": \"1.5\" })] }) });\n        this.buttonDeleteRow.onclick = () => {\n            this.lastActiveTable?.focus();\n            const model = this.lastActiveTable?.model;\n            const selection = this.lastActiveTable?.selection;\n            if (selection && isRowEditInterface(model)) {\n                model.removeRow(selection.row, 1);\n            }\n        };\n        this.toolbar.appendChild(this.buttonDeleteRow);\n        this.toolbar.appendChild(document.createTextNode(\" \"));\n        this.buttonAddColumnLeft = _jsx(\"button\", { class: \"left\", title: \"add column left\", children: _jsxs(\"svg\", { viewBox: \"0 0 13 13\", width: \"13\", height: \"13\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"0.5\", width: \"12\", height: \"12\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"0.5\", x2: \"8.5\", y2: \"12.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"4.5\", x2: \"12.5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"8.5\", x2: \"12.5\", y2: \"8.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"2\", y1: \"6.5\", x2: \"7\", y2: \"6.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4.5\", y1: \"4\", x2: \"4.5\", y2: \"9\", class: \"stroke\" })] }) });\n        this.buttonAddColumnLeft.onclick = () => {\n            this.lastActiveTable?.focus();\n            const model = this.lastActiveTable?.model;\n            const selection = this.lastActiveTable?.selection;\n            if (selection && isColumnEditInterface(model)) {\n                model.insertColumn(selection.col);\n            }\n        };\n        this.toolbar.appendChild(this.buttonAddColumnLeft);\n        this.buttonAddColumnRight = _jsx(\"button\", { title: \"add column right\", children: _jsxs(\"svg\", { viewBox: \"0 0 13 13\", width: \"13\", height: \"13\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"0.5\", width: \"12\", height: \"12\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"4.5\", y1: \"0.5\", x2: \"4.5\", y2: \"12.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0.5\", y1: \"4.5\", x2: \"4.5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0.5\", y1: \"8.5\", x2: \"4.5\", y2: \"8.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"6\", y1: \"6.5\", x2: \"11\", y2: \"6.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"4\", x2: \"8.5\", y2: \"9\", class: \"stroke\" })] }) });\n        this.buttonAddColumnRight.onclick = () => {\n            this.lastActiveTable?.focus();\n            const model = this.lastActiveTable?.model;\n            const selection = this.lastActiveTable?.selection;\n            if (selection && isColumnEditInterface(model)) {\n                model.insertColumn(selection.col + 1);\n            }\n        };\n        this.toolbar.appendChild(this.buttonAddColumnRight);\n        this.buttonDeleteColumn = _jsx(\"button\", { class: \"right\", title: \"delete column\", children: _jsxs(\"svg\", { viewBox: \"0 0 13 13\", width: \"13\", height: \"13\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"0.5\", width: \"12\", height: \"12\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"4.5\", y1: \"0.5\", x2: \"4.5\", y2: \"12.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"0.5\", x2: \"8.5\", y2: \"12.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"5.5\", x2: \"9.5\", y2: \"11.5\", class: \"stroke\", \"stroke-width\": \"1.5\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"11.5\", x2: \"9.5\", y2: \"5.5\", class: \"stroke\", \"stroke-width\": \"1.5\" })] }) });\n        this.buttonDeleteColumn.onclick = () => {\n            this.lastActiveTable?.focus();\n            const model = this.lastActiveTable?.model;\n            const selection = this.lastActiveTable?.selection;\n            if (selection && isColumnEditInterface(model)) {\n                model.removeColumn(selection.col, 1);\n            }\n        };\n        this.toolbar.appendChild(this.buttonDeleteColumn);\n        this.toolbar.appendChild(document.createTextNode(\" \"));\n        this.buttonAddNodeAbove = _jsx(\"button\", { class: \"left\", title: \"add node above\", children: _jsxs(\"svg\", { style: { display: \"block\", border: \"none\" }, viewBox: \"0 0 8 17\", width: \"8\", height: \"17\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"1.5\", width: \"6\", height: \"6\", class: \"strokeFill\" }), _jsx(\"rect\", { x: \"0.5\", y: \"9.5\", width: \"6\", height: \"6\", class: \"fill\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"3\", x2: \"3.5\", y2: \"6\", class: \"stroke\" }), _jsx(\"line\", { x1: \"2\", y1: \"4.5\", x2: \"5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"0\", x2: \"3.5\", y2: \"1\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"8\", x2: \"3.5\", y2: \"17\", class: \"stroke\" })] }) });\n        this.toolbar.appendChild(this.buttonAddNodeAbove);\n        this.buttonAddNodeBelow = _jsx(\"button\", { title: \"add node below\", children: _jsxs(\"svg\", { style: { display: \"block\", border: \"none\" }, viewBox: \"0 0 8 17\", width: \"8\", height: \"17\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"1.5\", width: \"6\", height: \"6\", class: \"fill\" }), _jsx(\"rect\", { x: \"0.5\", y: \"9.5\", width: \"6\", height: \"6\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"11\", x2: \"3.5\", y2: \"14\", class: \"stroke\" }), _jsx(\"line\", { x1: \"2\", y1: \"12.5\", x2: \"5\", y2: \"12.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"0\", x2: \"3.5\", y2: \"9\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"16\", x2: \"3.5\", y2: \"17\", class: \"stroke\" })] }) });\n        this.toolbar.appendChild(this.buttonAddNodeBelow);\n        this.buttonAddNodeParent = _jsx(\"button\", { title: \"add node parent\", children: _jsxs(\"svg\", { viewBox: \"0 0 13 17\", width: \"13\", height: \"17\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"1.5\", width: \"6\", height: \"6\", class: \"strokeFill\" }), _jsx(\"rect\", { x: \"6.5\", y: \"9.5\", width: \"6\", height: \"6\", class: \"fill\" }), _jsx(\"line\", { x1: \"7\", y1: \"4.5\", x2: \"10\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"9.5\", y1: \"4\", x2: \"9.5\", y2: \"9\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"3\", x2: \"3.5\", y2: \"6\", class: \"stroke\" }), _jsx(\"line\", { x1: \"2\", y1: \"4.5\", x2: \"5\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"0\", x2: \"3.5\", y2: \"1\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"8\", x2: \"3.5\", y2: \"17\", class: \"stroke\" })] }) });\n        this.buttonAddNodeParent.onclick = () => {\n        };\n        this.toolbar.appendChild(this.buttonAddNodeParent);\n        this.buttonAddNodeChild = _jsx(\"button\", { title: \"add node child\", children: _jsxs(\"svg\", { viewBox: \"0 0 13 17\", width: \"13\", height: \"17\", children: [_jsx(\"rect\", { x: \"0.5\", y: \"1.5\", width: \"6\", height: \"6\", class: \"fill\" }), _jsx(\"rect\", { x: \"6.5\", y: \"9.5\", width: \"6\", height: \"6\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"7\", y1: \"4.5\", x2: \"10\", y2: \"4.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"9.5\", y1: \"4\", x2: \"9.5\", y2: \"9\", class: \"stroke\" }), _jsx(\"line\", { x1: \"9.5\", y1: \"11\", x2: \"9.5\", y2: \"14\", class: \"stroke\" }), _jsx(\"line\", { x1: \"8\", y1: \"12.5\", x2: \"11\", y2: \"12.5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"3.5\", y1: \"0\", x2: \"3.5\", y2: \"17\", class: \"stroke\" })] }) });\n        this.toolbar.appendChild(this.buttonAddNodeChild);\n        this.buttonDeleteNode = _jsx(\"button\", { class: \"right\", title: \"delete node\", children: _jsxs(\"svg\", { viewBox: \"0 0 10 17\", width: \"10\", height: \"17\", children: [_jsx(\"rect\", { x: \"1.5\", y: \"5.5\", width: \"6\", height: \"6\", class: \"strokeFill\" }), _jsx(\"line\", { x1: \"4.5\", y1: \"2\", x2: \"4.5\", y2: \"5\", class: \"stroke\" }), _jsx(\"line\", { x1: \"4.5\", y1: \"12\", x2: \"4.5\", y2: \"15\", class: \"stroke\" }), _jsx(\"line\", { x1: \"0.5\", y1: \"4.5\", x2: \"8.5\", y2: \"12.5\", class: \"stroke\", \"stroke-width\": \"1.5\" }), _jsx(\"line\", { x1: \"8.5\", y1: \"4.5\", x2: \"0.5\", y2: \"12.5\", class: \"stroke\", \"stroke-width\": \"1.5\" })] }) });\n        this.toolbar.appendChild(this.buttonDeleteNode);\n        this.attachShadow({ mode: 'open' });\n        this.shadowRoot.adoptedStyleSheets = [textAreaStyle];\n        this.shadowRoot.appendChild(this.toolbar);\n    }\n    canHandle(view) {\n        return view instanceof Table;\n    }\n    activate() {\n        this.lastActiveTable = GenericTool.activeView;\n        this.toolbar.classList.add(\"active\");\n    }\n    deactivate() {\n        this.lastActiveTable = undefined;\n        this.toolbar.classList.remove(\"active\");\n    }\n}\nView.define(\"tx-tabletool\", TableTool);\nfunction isRowEditInterface(model) {\n    return model !== undefined && 'insertRow' in model && \"removeRow\" in model;\n}\nfunction isColumnEditInterface(model) {\n    return model !== undefined && 'insertColumn' in model && \"removeColumn\" in model;\n}\n//# sourceMappingURL=TableTool.js.map","import { Point } from \"animorph/Point\"\n\nexport class Selector {\n    height = 104;\n    width = 192;\n    cursorPos: Point = { x: 96/2, y: 54 };\n    rows: number\n    cols: number\n    maxValue: number\n    cellRatio: number\n    points: Point[] = [];\n    labels: string[]\n    private dists?: number[]\n\n    constructor(rows: number, cols: number, labels: string[]) {\n        this.rows = rows\n        this.cols = cols\n        this.labels = labels\n\n        const cellWidth = this.width / (cols - 1)\n        const cellHeight = this.height / (rows - 1)\n        this.cellRatio = cellWidth / cellHeight\n        this.maxValue = Math.min(cellWidth, cellHeight * this.cellRatio)\n\n        for (let i = 0; i < rows; ++i) {\n            for (let j = 0; j < cols; ++j) {\n                this.points.push({\n                    x: j * cellWidth,\n                    y: i * cellHeight,\n                })\n            }\n        }\n    }\n    setCursorPos(x: number, y: number) {\n        this.dists = undefined\n        x = Math.max(Math.min(x, this.width), 0)\n        y = Math.max(Math.min(y, this.height), 0)\n        this.cursorPos.x = x\n        this.cursorPos.y = y\n    }\n    getDists() {\n        if (this.dists !== undefined) {\n            return this.dists\n        }\n        this.dists = []\n        \n        let x = this.cursorPos.x, y = this.cursorPos.y\n\n        for (const tmp of this.points) {\n            const dist = Math.sqrt(\n                Math.pow(tmp.x - x, 2) + Math.pow((tmp.y - y) * this.cellRatio, 2)\n            )\n            const value = 1 - dist / this.maxValue\n            if (value > 0) {\n                this.dists.push(value)\n            } else {\n                this.dists.push(0)\n            }\n        }\n        return this.dists\n    }\n}\n","import { Selector } from \"animorph/Selector\"\nimport { Mesh } from \"animorph/Mesh\"\n\n// aka. SelectorListener in upstream\nexport class SelectorManager {\n    mesh: Mesh\n\n    age: Selector\n    muscleSize: Selector\n    breast: Selector\n    shape: Selector\n\n    constructor(mesh: Mesh) {\n        this.mesh = mesh\n\n        // prettier-ignore\n        this.age = new Selector(2, 5, [\n            \"female_10\", \"female_30\", \"female_50\", \"female_70\", \"female_90\",\n            \"male_10\", \"male_30\", \"male_50\", \"male_70\", \"male_90\"\n        ])\n        // prettier-ignore\n        this.muscleSize = new Selector(2, 2, [\n            \"skinny_nomuscle\", \"big_nomuscle\",\n            \"skinny_muscle\", \"big_muscle\"\n        ])\n        // prettier-ignore\n        this.breast = new Selector(2, 2, [\n            \"cone_little\", \"cone_big\",\n            \"sphere_little\", \"sphere_big\"\n        ])\n        this.breast.setCursorPos(96, 54)\n        // prettier-ignore\n        this.shape = new Selector(2, 2, [\n            \"brevilinear_vshape\", \"brevilinear_peershape\",\n            \"longilinear_vshape\", \"longilinear_peershape\"\n        ])\n        // this.calcWidgetTargets() // FIXME: when called here, UI stops working\n    }\n\n    doMorph(target_name: string, morph_value: number) {\n        this.mesh.doMorph(target_name, morph_value)\n    }\n\n    calcWidgetTargets() {\n        const ageDists = this.age.getDists()\n        const muscleSizeDists = this.muscleSize.getDists()\n        const breastDists = this.breast.getDists()\n        const shapeDists = this.shape.getDists()\n\n        let i: number, j: number, k: number\n\n        i = 0\n        for (const di_it of ageDists) {\n            if (i < this.age.labels.length) {\n                const tmpTargetName = `ages/${this.age.labels[i++]}.target`\n                this.doMorph(tmpTargetName, di_it)\n            }\n        }\n\n        j = 0\n        for (const ms_it of muscleSizeDists) {\n            i = 0\n            for (const di_it of ageDists) {\n                if (j < this.muscleSize.labels.length && i < this.age.labels.length) {\n                    const tmpTargetName = `muscleSize/${this.age.labels[i]}_${this.muscleSize.labels[j]}.target`\n                    const tmpTargetValue = di_it * ms_it\n                    this.doMorph(tmpTargetName, tmpTargetValue)\n                }\n                k = 0\n                if (i <= 4) {\n                    for (const br_it of breastDists) {\n                        if (k < this.breast.labels.length) {\n                            const tmpTargetName = `breast/${this.age.labels[i]}_${this.muscleSize.labels[j]}_${this.breast.labels[k]}.target`\n                            const tmpTargetValue = di_it * ms_it * br_it\n                            this.doMorph(tmpTargetName, tmpTargetValue)\n                        }\n                        ++k\n                    }\n                }\n                ++i\n            }\n            ++j\n        }\n\n        i = 0\n        for (const sh_it of shapeDists) {\n            if (i < this.shape.labels.length) {\n                const tmpTargetName = `shapes/${this.shape.labels[i++]}.target`\n                this.doMorph(tmpTargetName, sh_it)\n            }\n        }\n    }\n}\n","import { vec3 } from \"gl-matrix\"\n\nexport class VectorArray extends Float32Array {\n    getVec3(idx: number): vec3 {\n        idx *= 3\n        return vec3.fromValues(this[idx], this[idx + 1], this[idx + 2])\n    }\n    setVec3(idx: number, v: vec3) {\n        this.set(v, idx * 3)\n    }\n}\n","import { FaceVector } from \"./FaceVector\"\nimport { VertexVector } from \"./VertexVector\"\nimport { DirectoryList, FileType } from \"./DirectoryList\"\nimport { TargetEntry } from \"./TargetEntry\"\nimport { PoseEntry } from \"./PoseEntry\"\nimport { FaceGroup } from \"./FaceGroup\"\nimport { PoseTarget } from \"./PoseTarget\"\nimport { PoseTranslation } from \"./PoseTranslation\"\nimport { PoseRotation, RotateAxis } from \"./PoseRotation\"\nimport { mat4, vec3 } from \"gl-matrix\"\nimport { Signal } from \"toad.js\"\nimport { Target } from \"./Target\"\nimport { SelectorManager } from \"animorph/SelectorManager\"\nimport { VectorArray } from \"./VectorArray\"\n\nclass TargetMap extends Map<string, TargetEntry> {}\nclass PoseMap extends Map<string, PoseEntry> {}\n\nenum Mode {\n    MORPH,\n    POSE,\n}\n\n// animorph-0.3/src/Mesh.cpp\nexport class Mesh {\n    mgr: SelectorManager\n\n    changed = new Signal()\n    private dirty = false\n    private poseChanged = false\n    private mode = Mode.MORPH\n\n    private vertexBase!: VectorArray // vertices as loaded from file\n    private vertexMorphed!: VectorArray // morphed vertices\n    private vertexPosed!: VectorArray // morphed and posed vertices\n\n    // user settings for posing\n    private poses = new BodySettings()\n    private bodyset = new BodySettings()\n\n    // faces\n    facevector = new FaceVector()\n    facegroup = new FaceGroup()\n    targetmap = new TargetMap()\n    posemap = new PoseMap()\n\n    constructor() {\n        this.loadMeshFactory(\"base.vertices\", \"base.faces\")\n        this.loadGroupsFactory(\"base.parts\")\n        this.loadTargetsFactory(\"targets\")\n        this.loadTargetsFactory(\"selectors\", 1, true, false)\n        this.loadPoseTargetsFactory(\"rotations\")\n        this.mgr = new SelectorManager(this)\n        this.mgr.calcWidgetTargets()\n        this.update()\n    }\n\n    morphMode() {\n        this.mode = Mode.MORPH\n        this.markDirty()\n    }\n    poseMode() {\n        this.initPoses()\n        this.mode = Mode.POSE\n        this.poseChanged = true\n        this.markDirty()\n    }\n    getVertexes(): VectorArray {\n        switch (this.mode) {\n            case Mode.MORPH:\n                return this.vertexMorphed\n            case Mode.POSE:\n                return this.vertexPosed\n        }\n    }\n    clear() {\n        switch (this.mode) {\n            case Mode.MORPH:\n                this.clearMorph()\n                break\n            case Mode.POSE:\n                this.clearPose()\n                break\n        }\n    }\n    clearMorph() {\n        if (this.bodyset.size === 0) {\n            return\n        }\n        this.vertexMorphed.set(this.vertexBase)\n        this.bodyset.clear()\n        this.markDirty()\n    }\n    clearPose() {\n        if (this.poses.size === 0) {\n            return\n        }\n        this.poses.clear()\n        this.poseChanged = true\n        this.markDirty()\n    }\n    private markDirty() {\n        if (this.dirty === false) {\n            this.dirty = true\n            this.changed.trigger()\n        }\n    }\n    update() {\n        this.updatePose()\n        this.dirty = false\n    }\n\n    //\n    // LOAD\n    //\n    private loadMeshFactory(meshFilename: string, facesFilename: string) {\n        const vertex = new VertexVector()\n        vertex.load(meshFilename)\n        this.vertexBase = new VectorArray(vertex.length * 3)\n        let o = 0\n        for(let i=0; i<vertex.length; ++i) {\n            const co = vertex[i].co\n            this.vertexBase[o++] = co[0]\n            this.vertexBase[o++] = co[1]\n            this.vertexBase[o++] = co[2]\n        }\n        this.facevector.loadGeometry(facesFilename)\n        this.vertexMorphed = new VectorArray(this.vertexBase)\n        this.vertexPosed = new VectorArray(this.vertexBase)\n    }\n    private loadGroupsFactory(groups_filename: string) {\n        return this.facegroup.load(groups_filename)\n    }\n    private loadTargetsFactory(targetRootPath: string, recursiveLevel = 1, preload = false, clearmap = true) {\n        if (clearmap) {\n            this.targetmap.clear()\n        }\n\n        // reading all the targets recursively\n        const dir_list = new DirectoryList()\n        dir_list.setRootPath(targetRootPath)\n        dir_list.setRecursive(recursiveLevel)\n        dir_list.setFileFilter(\".target\")\n\n        const files = dir_list.getDirectoryList()\n        for (const file of files) {\n            const target_name = file.substring(targetRootPath.length + 1)\n            const targetEntry = new TargetEntry(file, preload)\n            this.targetmap.set(target_name, targetEntry)\n        }\n        console.log(`${preload ? \"loaded\" : \"referenced\"} ${files.length} morph targets from ${targetRootPath}/`)\n    }\n    private loadPoseTargetsFactory(targetRootPath: string, recursiveLevel = 1) {\n        this.posemap.clear()\n\n        // reading all the targets recursively\n        const dir_list = new DirectoryList()\n        dir_list.setRootPath(targetRootPath)\n        dir_list.setRecursive(recursiveLevel)\n        dir_list.setFileType(FileType.DIRECTORY)\n\n        const files = dir_list.getDirectoryList()\n        let counter = 0\n        for (const file of files) {\n            const target_name = file.substring(targetRootPath.length + 1)\n            if (target_name.indexOf(\"/\") === -1) {\n                continue\n            }\n            this.posemap.set(target_name, new PoseEntry(target_name, file, false))\n            ++counter\n        }\n        console.log(`referenced ${counter} pose targets from ${targetRootPath}/`)\n    }\n\n    //\n    // POSE\n    //\n    private initPoses() {\n        this.vertexPosed.set(this.vertexMorphed)\n        this.posemap.forEach((poseEntry) => {\n            if (!poseEntry.isLoaded()) {\n                return\n            }\n            const tmp = poseEntry.getTarget()!\n            tmp.calcRotationsCenteroids(this.vertexMorphed)\n            tmp.calcTranslationsFormFactors(this.vertexMorphed)\n            tmp.calcNormalizations()\n        })\n\n        // for (std::vector <SkinVertex>::iterator skin_it = skin.begin ();\n        //     skin_it != skin.end ();\n        //     skin_it++)\n        // {\n        //     SkinVertex &skinVertex = (*skin_it);\n\n        //     Vector3f centeroid(calcCenteroid(skinVertex.getLinkedMuscles(), vertexvector_morph));\n\n        //     Vector3f oriDist = vertexvector_morph[skinVertex.getSkinVertex()].co - centeroid;\n        //     skinVertex.setOriginalDist(oriDist.getMagnitude());\n        // }\n    }\n\n    setPose(target_name: string, morph_value: number) {\n        const poseTarget = this.getPoseTargetForName(target_name)\n        if (poseTarget === undefined) {\n            throw Error(`unknown pose target ${target_name}`)\n        }\n        if (morph_value < poseTarget.getMinAngle()) {\n            morph_value = poseTarget.getMinAngle()\n        }\n        if (morph_value > poseTarget.getMaxAngle()) {\n            morph_value = poseTarget.getMaxAngle()\n        }\n        if (!this.posemap.has(target_name)) {\n            throw new Error(`a pose target with name \"${target_name}\" wasn't found in posemap`)\n        }\n\n        if (morph_value === 0) {\n            if (!this.poses.has(target_name)) {\n                return morph_value\n            }\n            this.poses.delete(target_name)\n        } else {\n            if (this.poses.get(target_name) === morph_value) {\n                return morph_value\n            }\n            this.poses.set(target_name, morph_value)\n        }\n\n        if (this.poseChanged === false) {\n            this.poseChanged = true\n            this.markDirty()\n        }\n        return morph_value\n    }\n    getPose(target_name: string): number {\n        const p = this.poses.get(target_name)\n        return p === undefined ? 0 : p\n    }\n    updatePose() {\n        if (this.poseChanged === false) {\n            return\n        }\n        this.poseChanged = false\n\n        this.vertexPosed.set(this.vertexMorphed)\n\n        // Map is not sorted but poses must be applied sorted by target_name\n        ;[...this.poses.keys()].sort().forEach((target_name) => {\n            const poseTarget = this.getPoseTargetForName(target_name)\n            const morph_value = this.poses.get(target_name)!\n            this.doPose(target_name, morph_value, poseTarget!.getModVertex())\n        })\n        // applySkin();\n        // applySmooth(2);\n    }\n\n    getTargetForName(target_name: string): Target | undefined {\n        return this.targetmap.get(target_name)?.getTarget()\n    }\n    getPoseTargetForName(target_name: string): PoseTarget | undefined {\n        const poseEntry = this.posemap.get(target_name)!\n        if (poseEntry === undefined) {\n            return undefined\n        }\n        let target\n        if (!poseEntry.isLoaded()) {\n            target = poseEntry.getTarget()!\n            target.calcRotationsCenteroids(this.vertexMorphed)\n            target.calcTranslationsFormFactors(this.vertexMorphed)\n            target.calcNormalizations()\n        } else {\n            target = poseEntry.getTarget()!\n        }\n        return target\n    }\n\n    doPose(target_name: string, morph_value: number, modVertex: Set<number>) {\n        const cat = \"00\"\n        const poseTarget = this.getPoseTargetForName(target_name)!\n        const rotations = morph_value < 0 ? poseTarget.getNegativeRotations() : poseTarget.getPositiveRotations()\n        const translations =\n            morph_value < 0 ? poseTarget.getNegativeTranslations() : poseTarget.getPositiveTranslations()\n        for (const pt of translations) {\n            if (cat !== pt.getCat()) {\n                throw Error(`not implemented yet`)\n            }\n            this.doPoseTranslation(pt, morph_value, modVertex)\n        }\n        for (const pr of rotations) {\n            this.doPoseRotation(pr, morph_value, modVertex)\n        }\n    }\n    doPoseTranslation(pt: PoseTranslation, morph_value: number, modVertex: Set<number>) {\n        const tmpTarget = pt.getTarget()\n        const formFactor = pt.getFormFactor()\n        let real_value = 0.0\n\n        if (pt.getNormalize()) {\n            if (morph_value < 0) {\n                if (morph_value < pt.getMaxAngle()) {\n                    real_value = Math.max(morph_value, pt.getMinAngle()) - pt.getMaxAngle()\n                }\n            } else {\n                if (morph_value > pt.getMinAngle()) {\n                    real_value = Math.min(morph_value, pt.getMaxAngle()) - pt.getMinAngle()\n                }\n            }\n        } else {\n            real_value = morph_value\n        }\n\n        for (const td of tmpTarget) {\n            if (!modVertex.has(td.vertex_number)) {\n                continue\n            }\n            const co = this.vertexPosed.getVec3(td.vertex_number)\n            vec3.add(\n                co,\n                co,\n                vec3.fromValues(\n                    formFactor[0] * td.morph_vector[0] * real_value,\n                    formFactor[1] * td.morph_vector[1] * real_value,\n                    formFactor[2] * td.morph_vector[2] * real_value\n                )\n            )\n            this.vertexPosed.setVec3(td.vertex_number, co)\n        }\n    }\n    doPoseRotation(pr: PoseRotation, morph_value: number, modVertex: Set<number>) {\n        let real_value = 0\n        let rotMatrix = mat4.create()\n\n        if (pr.getNormalize()) {\n            if (morph_value < 0) {\n                if (morph_value < pr.getMaxAngle()) {\n                    real_value = Math.max(morph_value, pr.getMinAngle()) - pr.getMaxAngle()\n                }\n            } else {\n                if (morph_value > pr.getMinAngle()) {\n                    real_value = Math.min(morph_value, pr.getMaxAngle()) - pr.getMinAngle()\n                }\n            }\n        } else {\n            real_value = morph_value\n        }\n\n        const axis = pr.getAxis()\n        const M_PI_180 = Math.PI / 180.0\n\n        for (const td of pr) {\n            if (!modVertex.has(td.vertex_number)) {\n                continue\n            }\n            const theta = real_value * td.rotation * M_PI_180\n            mat4.identity(rotMatrix)\n            switch (axis) {\n                case RotateAxis.X_AXIS:\n                    mat4.rotateX(rotMatrix, rotMatrix, theta)\n                    break\n                case RotateAxis.Y_AXIS:\n                    mat4.rotateY(rotMatrix, rotMatrix, theta)\n                    break\n                case RotateAxis.Z_AXIS:\n                    mat4.rotateZ(rotMatrix, rotMatrix, theta)\n                    break\n            }\n            const co = this.vertexPosed.getVec3(td.vertex_number)\n            if (co === undefined) {\n                throw Error()\n            }\n            vec3.sub(co, co, pr.getCenter())\n            vec3.transformMat4(co, co, rotMatrix)\n            vec3.add(co, co, pr.getCenter())\n            this.vertexPosed.setVec3(td.vertex_number, co)\n        }\n    }\n\n    //\n    // MORPH\n    //\n\n    doMorph(target_name: string, morph_value: number) {\n        if (morph_value < 0) {\n            morph_value = 0\n        }\n        if (morph_value > 1) {\n            morph_value = 1\n        }\n\n        if (!this.targetmap.has(target_name)) {\n            throw new Error(`a morph target with name \"${target_name}\" wasn't found in targetmap`)\n        }\n\n        let real_morph_value\n        let bs_morph_value = this.getMorph(target_name)\n        if (morph_value === 0) {\n            real_morph_value = -bs_morph_value\n        } else {\n            real_morph_value = morph_value - bs_morph_value\n        }\n\n        const target = this.getTargetForName(target_name)!\n\n        for (const td of target) {\n            const co = this.vertexMorphed.getVec3(td.vertex_number)\n            const mv = vec3.scale(vec3.create(), td.morph_vector, real_morph_value)\n            vec3.add(co, co, mv)\n            this.vertexMorphed.setVec3(td.vertex_number, co)\n        }\n\n        if (morph_value === 0) {\n            if (!this.bodyset.has(target_name)) {\n                return morph_value\n            }\n            this.bodyset.delete(target_name)\n        } else {\n            if (this.bodyset.get(target_name) === morph_value) {\n                return morph_value\n            }\n            this.bodyset.set(target_name, morph_value)\n        }\n\n        this.markDirty()\n        return morph_value\n    }\n    getMorph(target_name: string): number {\n        const p = this.bodyset.get(target_name)\n        return p === undefined ? 0 : p\n    }\n}\n\nclass BodySettings extends Map<string, number> {}\n","import { vec3 } from 'gl-matrix'\n\nexport function calculateNormalsQuads(\n    normals: Float32Array,\n    vertex: Float32Array,\n    indices: number[]): Float32Array {\n\n    function addNormal(index: number, normal: vec3) {\n        normals[index] += normal[0]\n        normals[index + 1] += normal[1]\n        normals[index + 2] += normal[2]\n    }\n    \n    // add vectors\n    for (let i = 0; i < indices.length;) {\n        const i1 = indices[i++] * 3\n        const i2 = indices[i++] * 3\n        const i3 = indices[i++] * 3\n        const i4 = indices[i++] * 3\n    \n\n        const p1 = vec3.fromValues(vertex[i1], vertex[i1 + 1], vertex[i1 + 2])\n        const p2 = vec3.fromValues(vertex[i2], vertex[i2 + 1], vertex[i2 + 2])\n        const p3 = vec3.fromValues(vertex[i3], vertex[i3 + 1], vertex[i3 + 2])\n\n        const u = vec3.create(), v = vec3.create(), n = vec3.create()\n        vec3.subtract(u, p2, p1)\n        vec3.subtract(v, p3, p1)\n        vec3.cross(n, u, v)\n        vec3.normalize(n, n)\n\n        addNormal(i1, n)\n        addNormal(i2, n)\n        addNormal(i3, n)\n        addNormal(i4, n)\n    }\n\n    // normalize\n    for(let normalIndex = 0; normalIndex < vertex.length; normalIndex += 3) {\n        const normal = vec3.fromValues(normals[normalIndex], normals[normalIndex + 1], normals[normalIndex + 2])\n        vec3.normalize(normal, normal)\n        normals[normalIndex] = normal[0]\n        normals[normalIndex + 1] = normal[1]\n        normals[normalIndex + 2] = normal[2]\n    }\n    return normals\n}\n\nexport function calculateNormalsTriangles(\n    normals: Float32Array,\n    vertex: Float32Array,\n    indices: number[]): Float32Array {\n\n    function addNormal(index: number, normal: vec3) {\n        normals[index] += normal[0]\n        normals[index + 1] += normal[1]\n        normals[index + 2] += normal[2]\n    }\n    \n    // add vectors\n    for (let i = 0; i < indices.length;) {\n        const i1 = indices[i++] * 3\n        const i2 = indices[i++] * 3\n        const i3 = indices[i++] * 3\n\n        const p1 = vec3.fromValues(vertex[i1], vertex[i1 + 1], vertex[i1 + 2])\n        const p2 = vec3.fromValues(vertex[i2], vertex[i2 + 1], vertex[i2 + 2])\n        const p3 = vec3.fromValues(vertex[i3], vertex[i3 + 1], vertex[i3 + 2])\n\n        const u = vec3.create(), v = vec3.create(), n = vec3.create()\n        vec3.subtract(u, p2, p1)\n        vec3.subtract(v, p3, p1)\n        vec3.cross(n, u, v)\n        vec3.normalize(n, n)\n\n        addNormal(i1, n)\n        addNormal(i2, n)\n        addNormal(i3, n)\n    }\n\n    // normalize\n    for(let normalIndex = 0; normalIndex < vertex.length; normalIndex += 3) {\n        const normal = vec3.fromValues(normals[normalIndex], normals[normalIndex + 1], normals[normalIndex + 2])\n        vec3.normalize(normal, normal)\n        normals[normalIndex] = normal[0]\n        normals[normalIndex + 1] = normal[1]\n        normals[normalIndex + 2] = normal[2]\n    }\n    return normals\n}\n","import { calculateNormalsQuads, calculateNormalsTriangles } from \"./calculateNormals\"\nimport { AbstractShader } from \"./shader/AbstractShader\"\n\ninterface GLXYZUV {\n    idxExtra: number[]\n    indices: number[]\n    vertex: Float32Array\n    texcoord?: Float32Array\n}\n\n/**\n * I am a mesh which can be rendered by OpenGL.\n * a) convert quads to triangles\n * b) join fxyz and fuv into one list\n * c) calculate normals\n */\nexport class RenderMesh {\n    gl: WebGL2RenderingContext\n    glIndices: WebGLBuffer\n    glVertex: WebGLBuffer\n    glNormal: WebGLBuffer\n    glTexture?: WebGLBuffer\n\n    fvertex: number[]\n    normal: Float32Array\n    glData: GLXYZUV\n    quads: boolean\n\n    constructor(\n        gl: WebGL2RenderingContext,\n        vertex: Float32Array,\n        fvertex: number[],\n        uvs?: Float32Array,\n        fuvs?: number[],\n        quads = true\n    ) {\n        this.gl = gl\n        this.fvertex = fvertex\n        this.quads = quads\n\n        if (quads === false) {\n            this.glIndices = this.createBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.STATIC_DRAW, Uint16Array, fvertex)\n            this.glVertex = this.createBuffer(gl.ARRAY_BUFFER, gl.STATIC_DRAW, Float32Array, vertex)\n            this.normal = new Float32Array(vertex.length)\n            calculateNormalsTriangles(this.normal, vertex, fvertex)\n            this.glNormal = this.createBuffer(gl.ARRAY_BUFFER, gl.STATIC_DRAW, Float32Array, this.normal)\n            this.glData = {\n                indices: fvertex,\n            } as GLXYZUV\n            return\n        }\n\n        const glData = decoupleXYZandUV(vertex, fvertex, uvs, fuvs)\n        this.glData = glData\n        this.glIndices = this.createBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.STATIC_DRAW, Uint16Array, glData.indices)\n        this.glVertex = this.createBuffer(gl.ARRAY_BUFFER, gl.STATIC_DRAW, Float32Array, glData.vertex)\n        if (glData.texcoord) {\n            this.glTexture = this.createBuffer(gl.ARRAY_BUFFER, gl.STATIC_DRAW, Float32Array, glData.texcoord)\n        }\n\n        this.normal = new Float32Array(glData.vertex.length)\n        calculateNormalsQuads(this.normal, vertex, fvertex)\n        this.glData.idxExtra.forEach((v, i) => {\n            this.normal[vertex.length + i * 3] = this.normal[v * 3]\n            this.normal[vertex.length + i * 3 + 1] = this.normal[v * 3 + 1]\n            this.normal[vertex.length + i * 3 + 2] = this.normal[v * 3 + 2]\n        })\n\n        this.glNormal = this.createBuffer(gl.ARRAY_BUFFER, gl.STATIC_DRAW, Float32Array, this.normal)\n    }\n\n    update(vertex: Float32Array) {\n        if (this.quads) {\n            this.glData.vertex.set(vertex)\n            calculateNormalsQuads(this.normal, vertex, this.fvertex)\n\n            this.glData.idxExtra.forEach((v, i) => {\n                this.glData.vertex[vertex.length + i * 3] = vertex[v * 3]\n                this.glData.vertex[vertex.length + i * 3 + 1] = vertex[v * 3 + 1]\n                this.glData.vertex[vertex.length + i * 3 + 2] = vertex[v * 3 + 2]\n\n                this.normal[vertex.length + i * 3] = this.normal[v * 3]\n                this.normal[vertex.length + i * 3 + 1] = this.normal[v * 3 + 1]\n                this.normal[vertex.length + i * 3 + 2] = this.normal[v * 3 + 2]\n            })\n            // prettier-ignore\n            this.updateBuffer(this.glVertex, this.gl.ARRAY_BUFFER, this.gl.STATIC_DRAW, Float32Array, this.glData.vertex)\n            this.updateBuffer(this.glNormal, this.gl.ARRAY_BUFFER, this.gl.STATIC_DRAW, Float32Array, this.normal)\n        } else {\n            this.updateBuffer(this.glVertex, this.gl.ARRAY_BUFFER, this.gl.STATIC_DRAW, Float32Array, vertex)\n            calculateNormalsTriangles(this.normal, vertex, this.fvertex)\n            this.updateBuffer(this.glNormal, this.gl.ARRAY_BUFFER, this.gl.STATIC_DRAW, Float32Array, this.normal)\n        }\n    }\n\n    draw(programInfo: AbstractShader, mode: number) {\n        this.bind(programInfo)\n        this.gl.drawElements(mode, this.glData.indices.length, this.gl.UNSIGNED_SHORT, 0)\n    }\n\n    bind(programInfo: AbstractShader): void {\n        programInfo.bind(this.glIndices, this.glVertex, this.glNormal, this.glTexture)\n    }\n\n    drawSubset(mode: number, offset: number, length: number) {\n        // divide by quad edge count, multiply by triangle edge count, multiply by octets in short\n        // this.gl.drawElements(mode, (length / 4) * 6, this.gl.UNSIGNED_SHORT, (offset / 4) * 6)\n        this.gl.drawElements(mode, length, this.gl.UNSIGNED_SHORT, offset * 2)\n    }\n\n    protected createBuffer(\n        target: GLenum,\n        usage: GLenum,\n        type: Float32ArrayConstructor | Uint16ArrayConstructor,\n        data: number[] | Float32Array\n    ): WebGLBuffer {\n        const buffer = this.gl.createBuffer()\n        if (buffer === null) {\n            throw Error(\"Failed to create new WebGLBuffer\")\n        }\n        this.updateBuffer(buffer, target, usage, type, data)\n        return buffer\n    }\n\n    protected updateBuffer(\n        buffer: WebGLBuffer,\n        target: GLenum,\n        usage: GLenum,\n        type: Float32ArrayConstructor | Uint16ArrayConstructor,\n        data: number[] | Float32Array\n    ) {\n        this.gl.bindBuffer(target, buffer)\n        if (data instanceof Float32Array) {\n            this.gl.bufferData(target, data, usage)\n            return\n        }\n        if (data instanceof Int16Array) {\n            this.gl.bufferData(target, data, usage)\n            return\n        }\n        this.gl.bufferData(target, new type(data), usage)\n    }\n}\n\nexport function decoupleXYZandUV(\n    xyz: Float32Array,\n    fxyz: Uint16Array | number[],\n    uv?: Float32Array | number[],\n    fuv?: Uint16Array | number[]\n): GLXYZUV {\n    if (fuv !== undefined && fxyz.length !== fuv.length) {\n        throw Error(`fvertex and fuv must have the same length, instead it is ${fxyz.length} and ${fuv.length}`)\n    }\n    if (fuv !== undefined && uv === undefined) {\n        throw Error(`uv & fuv must both be defined`)\n    }\n    const indices: number[] = []\n    const uvOut = new Array((xyz.length / 3) * 2) // for each vertex we have texture coordinate\n\n    const idxExtra: number[] = []\n    const xyzOutExtra: number[] = []\n    const uvOutExtra: number[] = []\n\n    function getIndex(i: number) {\n        return fxyz[i]\n    }\n\n    function decoupleXYZandUV(i: number) {\n        const idxXYZ = fxyz[i]\n\n        const xyzIdx = fxyz[i]\n        const uvIdx = fuv![i]\n        const u = uv![uvIdx * 2]\n        const v = uv![uvIdx * 2 + 1]\n\n        if (uvOut[xyzIdx * 2] === undefined) {\n            uvOut[xyzIdx * 2] = u\n            uvOut[xyzIdx * 2 + 1] = v\n            return idxXYZ\n        }\n        if (uvOut[xyzIdx * 2] === u && uvOut[xyzIdx * 2 + 1] === v) {\n            return idxXYZ\n        }\n\n        const newIdxXYZ = (xyz.length + xyzOutExtra.length) / 3\n\n        const idxXYZIn = idxXYZ * 3\n        const x = xyz[idxXYZIn]\n        const y = xyz[idxXYZIn + 1]\n        const z = xyz[idxXYZIn + 2]\n\n        idxExtra.push(idxXYZ)\n        xyzOutExtra.push(x)\n        xyzOutExtra.push(y)\n        xyzOutExtra.push(z)\n        uvOutExtra.push(u)\n        uvOutExtra.push(v)\n\n        return newIdxXYZ\n    }\n\n    let f\n    if (fuv === undefined) {\n        f = getIndex\n    } else {\n        f = decoupleXYZandUV\n    }\n\n    for (let i = 0; i < fxyz.length; i += 4) {\n        const i0 = f(i)\n        indices.push(i0)\n        indices.push(f(i + 1))\n        const i2 = f(i + 2)\n        indices.push(i2)\n        indices.push(f(i + 3))\n        indices.push(i0)\n        indices.push(i2)\n    }\n\n    if (fuv === undefined) {\n        return {\n            idxExtra: [],\n            indices,\n            vertex: xyz,\n            texcoord: undefined,\n        }\n    }\n\n    const vertex = new Float32Array(xyz.length + xyzOutExtra.length)\n    const texcoord = new Float32Array(uvOut.length + uvOutExtra.length)\n\n    vertex.set(xyz)\n    vertex.set(xyzOutExtra, xyz.length)\n    texcoord.set(uvOut)\n    texcoord.set(uvOutExtra, uvOut.length)\n\n    return { indices, vertex, texcoord, idxExtra }\n}\n","import { mat4 } from 'gl-matrix'\n\nexport abstract class AbstractShader {\n    protected gl: WebGL2RenderingContext\n    protected program: WebGLProgram\n\n    protected vertexPosition: number\n    protected vertexNormal: number\n    protected textureCoord?: number\n\n    projectionMatrix: WebGLUniformLocation\n    protected modelViewMatrix: WebGLUniformLocation\n    protected normalMatrix: WebGLUniformLocation\n\n    constructor(gl: WebGL2RenderingContext, vertexShaderSrc: string, fragmentShaderSrc: string) {\n        const program = gl.createProgram()\n        if (program === null) {\n            throw Error('Unable to create WebGLProgram')\n        }\n        const vertexShader = AbstractShader.compileShader(gl, gl.VERTEX_SHADER, vertexShaderSrc)\n        const fragmentShader = AbstractShader.compileShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSrc)\n        gl.attachShader(program, vertexShader)\n        gl.attachShader(program, fragmentShader)\n        gl.linkProgram(program)\n\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n            throw Error(`Unable to initialize WebGLProgram: ${gl.getProgramInfoLog(program)}`)\n        }\n        this.gl = gl\n        this.program = program\n\n        this.vertexPosition = gl.getAttribLocation(this.program, 'aVertexPosition')\n        this.vertexNormal = gl.getAttribLocation(this.program, 'aVertexNormal')\n\n        this.projectionMatrix = AbstractShader.getUniformLocation(gl, this.program, 'uProjectionMatrix')\n        this.modelViewMatrix = AbstractShader.getUniformLocation(gl, this.program, 'uModelViewMatrix')\n        this.normalMatrix = AbstractShader.getUniformLocation(gl, this.program, 'uNormalMatrix')\n    }\n\n    bind(indices: WebGLBuffer, vertices: WebGLBuffer, normales: WebGLBuffer, texture?: WebGLBuffer) {\n        const numComponents = 3, type = this.gl.FLOAT, normalize = false, stride = 0, offset = 0\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, vertices)\n        this.gl.vertexAttribPointer(this.vertexPosition, numComponents, type, normalize, stride, offset)\n        this.gl.enableVertexAttribArray(this.vertexPosition)\n\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, normales)\n        this.gl.vertexAttribPointer(this.vertexNormal, numComponents, type, normalize, stride, offset)\n        this.gl.enableVertexAttribArray(this.vertexNormal)\n\n        this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, indices)\n    }\n\n    init(projectionMatrix: mat4, modelViewMatrix: mat4, normalMatrix: mat4) {\n        this.initProgram()\n        this.initProjectionMatrix(projectionMatrix)\n        this.initModelViewMatrix(modelViewMatrix)\n        this.initNormalMatrix(normalMatrix)\n    }\n\n    initProgram() {\n        this.gl.useProgram(this.program)\n    }\n\n    initProjectionMatrix(projectionMatrix: mat4) {\n        this.gl.uniformMatrix4fv(this.projectionMatrix, false, projectionMatrix)\n    }\n\n    initModelViewMatrix(modelViewMatrix: mat4) {\n        this.gl.uniformMatrix4fv(this.modelViewMatrix, false, modelViewMatrix)\n    }\n\n    initNormalMatrix(normalMatrix: mat4) {\n        this.gl.uniformMatrix4fv(this.normalMatrix, false, normalMatrix)\n    }\n\n    static compileShader(gl: WebGL2RenderingContext, type: GLenum, source: string): WebGLShader {\n        const shader = gl.createShader(type)\n        if (shader === null)\n            throw Error('Unable to create WebGLShader')\n        gl.shaderSource(shader, source)\n        gl.compileShader(shader)\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            gl.deleteShader(shader)\n            throw Error(`An error occurred compiling the ${type} WebGLShader: ${gl.getShaderInfoLog(shader)}`)\n        }\n        return shader\n    }\n\n    static getUniformLocation(gl: WebGL2RenderingContext, program: WebGLProgram, name: string): WebGLUniformLocation {\n        const location = gl.getUniformLocation(program, name)\n        if (location === null)\n            throw Error(`Internal Error: Failed to get uniform location for ${name}`)\n        return location\n    }\n}\n\n\n","import { AbstractShader } from './AbstractShader'\n\nexport class RGBAShader extends AbstractShader {\n    protected _color: WebGLUniformLocation\n    constructor(gl: WebGL2RenderingContext) {\n        super(gl, rgbaVertexShaderSrc, rgbaFragmentShaderSrc)\n        this._color = AbstractShader.getUniformLocation(gl, this.program, 'uColor')\n    }\n    // set RGBA color\n    setColor(rgba: number[]) {\n        this.gl.uniform4fv(this._color, rgba)\n    }\n}\nconst rgbaVertexShaderSrc = `\n// this is our input per vertex\nattribute vec4 aVertexPosition;\nattribute vec3 aVertexNormal;\n\n// input for all vertices (uniform for the whole shader program)\nuniform mat4 uNormalMatrix;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nuniform vec4 uColor;\n\n// data exchanged with other graphic pipeline stages\nvarying lowp vec4 vColor;\nvarying highp vec3 vLighting;\n\nvoid main(void) {\n  gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;\n\n  highp vec3 ambientLight = vec3(0.3, 0.3, 0.3);\n  highp vec3 directionalLightColor = vec3(1, 1, 1);\n  highp vec3 directionalVector = normalize(vec3(0.85, 0.8, 0.75));\n\n  highp vec4 transformedNormal = uNormalMatrix * vec4(aVertexNormal, 1.0);\n\n  highp float directional = max(dot(transformedNormal.xyz, directionalVector), 0.0);\n  vLighting = ambientLight + (directionalLightColor * directional);\n\n  vColor = uColor;\n}`\nconst rgbaFragmentShaderSrc = `\nvarying lowp vec4 vColor;\nvarying highp vec3 vLighting;\nvoid main(void) {\n  gl_FragColor = vec4(vec3(vColor[0],vColor[1],vColor[2]) * vLighting, vColor[3]);\n}`\n","import { RenderMesh } from \"gl/RenderMesh\"\nimport { Mesh } from \"./animorph/Mesh\"\nimport { RGBAShader } from \"gl/shader/RGBAShader\"\nimport {\n    createModelViewMatrix,\n    createNormalMatrix,\n    createProjectionMatrix,\n    adjustCanvasSize,\n    prepareViewport,\n} from \"gl/util\"\n\ninterface FG {\n    offset: number\n    length: number\n}\n\nenum Projection {\n    PERSPECTIVE,\n    ORTHOGONAL,\n}\n\ninterface RenderContext {\n    canvas: HTMLCanvasElement\n    gl: WebGL2RenderingContext\n    programRGBA: RGBAShader\n    renderMesh: RenderMesh\n    faceGroups: Map<string, FG>\n    rotateY: number\n    rotateX: number\n    projection: Projection\n}\n\nexport function renderMesh(canvas: HTMLCanvasElement, mesh: Mesh) {\n    const gl = (canvas.getContext(\"webgl2\") || canvas.getContext(\"experimental-webgl\")) as WebGL2RenderingContext\n    if (gl == null) {\n        throw Error(\"Unable to initialize WebGL. Your browser or machine may not support it.\")\n    }\n    // flip image pixels into the bottom-to-top order that WebGL expects.\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true)\n    gl.enable(gl.CULL_FACE)\n    gl.cullFace(gl.BACK)\n\n    const programRGBA = new RGBAShader(gl)\n    programRGBA.initProgram()\n\n    mesh.update()\n    const { fvertex, faceGroups } = triangles(mesh)\n    const vertex = mesh.getVertexes()\n    const renderMesh = new RenderMesh(gl, new Float32Array(vertex), fvertex, undefined, undefined, false)\n    renderMesh.bind(programRGBA)\n\n    const ctx: RenderContext = {\n        canvas,\n        gl,\n        programRGBA,\n        renderMesh,\n        faceGroups,\n        rotateY: 0,\n        rotateX: 0,\n        projection: Projection.PERSPECTIVE,\n    }\n\n    mesh.changed.add(() => {\n        requestAnimationFrame(() => {\n            mesh.update()\n            renderMesh.update(mesh.getVertexes())\n            paint(ctx)\n        })\n    })\n    new ResizeObserver(() => paint(ctx)).observe(canvas)\n    paint(ctx)\n\n    let downX = 0,\n        downY = 0,\n        buttonDown = false\n    canvas.onpointerdown = (ev: PointerEvent) => {\n        canvas.setPointerCapture(ev.pointerId)\n        buttonDown = true\n        downX = ev.x\n        downY = ev.y\n    }\n    canvas.onpointerup = (ev: PointerEvent) => {\n        buttonDown = false\n    }\n    canvas.onpointermove = (ev: PointerEvent) => {\n        if (buttonDown) {\n            const x = ev.x - downX\n            const y = ev.y - downY\n            if (x !== 0 || y !== 0) {\n                ctx.rotateY += x\n                ctx.rotateX += y\n                downX = ev.x\n                downY = ev.y\n                requestAnimationFrame(() => paint(ctx))\n            }\n        }\n    }\n    window.onkeydown = (ev: KeyboardEvent) => {\n        switch (ev.code) {\n            case \"Numpad1\": // front orthographic\n                if (ev.ctrlKey) {\n                    // back\n                    ctx.rotateX = 0\n                    ctx.rotateY = 180\n                } else {\n                    // front\n                    ctx.rotateY = 0\n                    ctx.rotateX = 0\n                }\n                ctx.projection = Projection.ORTHOGONAL\n                requestAnimationFrame(() => paint(ctx))\n                break\n            case \"Numpad7\": // top orthographic\n                if (ev.ctrlKey) {\n                    // bottom\n                    ctx.rotateX = -90\n                    ctx.rotateY = 0\n                } else {\n                    // top\n                    ctx.rotateX = 90\n                    ctx.rotateY = 0\n                }\n                ctx.projection = Projection.ORTHOGONAL\n                requestAnimationFrame(() => paint(ctx))\n                break\n            case \"Numpad3\": // right orthographic\n                if (ev.ctrlKey) {\n                    // left\n                    ctx.rotateX = 0\n                    ctx.rotateY = -90\n                } else {\n                    // right\n                    ctx.rotateX = 0\n                    ctx.rotateY = 90\n                }\n                ctx.projection = Projection.ORTHOGONAL\n                requestAnimationFrame(() => paint(ctx))\n                break\n            case \"Numpad4\":\n                ctx.rotateY -= 11.25\n                requestAnimationFrame(() => paint(ctx))\n                break\n            case \"Numpad6\":\n                ctx.rotateY += 11.25\n                requestAnimationFrame(() => paint(ctx))\n                break\n            case \"Numpad8\":\n                ctx.rotateX -= 11.25\n                requestAnimationFrame(() => paint(ctx))\n                break\n            case \"Numpad2\":\n                ctx.rotateX += 11.25\n                requestAnimationFrame(() => paint(ctx))\n                break\n            case \"Numpad5\": // toggle orthographic/perspective\n                if (ctx.projection === Projection.ORTHOGONAL) {\n                    ctx.projection = Projection.PERSPECTIVE\n                } else {\n                    ctx.projection = Projection.ORTHOGONAL\n                }\n                requestAnimationFrame(() => paint(ctx))\n                break\n        }\n    }\n    canvas.tabIndex = 0\n}\n\nfunction triangles(mesh: Mesh) {\n    const fvertex: number[] = []\n    const faceGroups = new Map<string, FG>()\n    mesh.facegroup.forEach((group, name) => {\n        const offset = fvertex.length\n        for (const faceIdx of group.facesIndexes) {\n            const foo = mesh.facevector[faceIdx]\n            if (foo === undefined) {\n                // FIXME: load creates bogus last entry\n                continue\n            }\n            const face = mesh.facevector[faceIdx].vertices\n            switch (face.length) {\n                case 3:\n                    fvertex.push(...face)\n                    break\n                case 4:\n                    fvertex.push(face[0], face[1], face[2], face[0], face[2], face[3])\n                    break\n                default:\n                    console.log(`skipping face with ${face.length} edges`)\n            }\n        }\n        const length = fvertex.length - offset\n        faceGroups.set(name, { offset: offset, length: length })\n    })\n    return { fvertex, faceGroups }\n}\n\nfunction paint(ctx: RenderContext) {\n    adjustCanvasSize(ctx.canvas)\n    const projectionMatrix = createProjectionMatrix(ctx.canvas, ctx.projection === Projection.PERSPECTIVE)\n    const modelViewMatrix = createModelViewMatrix(ctx.rotateY, ctx.rotateX)\n    const normalMatrix = createNormalMatrix(modelViewMatrix)\n    ctx.programRGBA.initModelViewMatrix(modelViewMatrix)\n    ctx.programRGBA.initNormalMatrix(normalMatrix)\n    ctx.programRGBA.initProjectionMatrix(projectionMatrix)\n    prepareViewport(ctx.gl, ctx.canvas)\n\n    ctx.faceGroups.forEach((group, name) => {\n        switch (name) {\n            case \"body\":\n            case \"head\":\n                ctx.programRGBA.setColor([1, 0.8, 0.7, 1])\n                break\n            case \"teeth\":\n                ctx.programRGBA.setColor([1, 1, 1, 1])\n                break\n            case \"tongue\":\n            case \"gums\":\n                ctx.programRGBA.setColor([1, 0, 0, 1])\n                break\n            case \"eyes\": // the white in the eyes\n                ctx.programRGBA.setColor([1, 1, 1, 1])\n                break\n            case \"zcornea\": // the cornea in the eyes\n                ctx.programRGBA.setColor([0, 0, 0, 1])\n                break\n            case \"zeyebrows\":\n            case \"zeyelashes\":\n                ctx.programRGBA.setColor([0, 0, 0, 1])\n                break\n            default:\n                console.log(name)\n                ctx.programRGBA.setColor([1, 0, 0, 1])\n        }\n        ctx.renderMesh.drawSubset(ctx.gl.TRIANGLES, group.offset, group.length)\n    })\n}\n","import { mat4 } from \"gl-matrix\"\n\nexport function adjustCanvasSize(canvas: HTMLCanvasElement) {\n    if (canvas.width !== canvas.clientWidth || canvas.height !== canvas.clientHeight) {\n        canvas.width = canvas.clientWidth\n        canvas.height = canvas.clientHeight\n    }\n}\n\nexport function prepareViewport(gl: WebGL2RenderingContext, canvas: HTMLCanvasElement) {\n    gl.viewport(0, 0, canvas.width, canvas.height)\n    gl.clearColor(0, 0, 0, 1)\n    gl.clearDepth(1)\n    gl.enable(gl.DEPTH_TEST)\n    gl.depthFunc(gl.LEQUAL)\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)\n    gl.depthMask(true)\n}\n\nexport function createModelViewMatrix(x: number, y: number) {\n    const D = 180 / Math.PI\n    const modelViewMatrix = mat4.create()\n    mat4.translate(modelViewMatrix, modelViewMatrix, [0, 0, -25])\n    mat4.rotateX(modelViewMatrix, modelViewMatrix, y / D)\n    mat4.rotateY(modelViewMatrix, modelViewMatrix, x / D)\n    return modelViewMatrix\n}\n\nexport function createProjectionMatrix(canvas: HTMLCanvasElement, perspective: boolean) {\n    const fieldOfView = (45 * Math.PI) / 180 // in radians\n    const aspect = canvas.width / canvas.height\n    const zNear = 0.1\n    const zFar = 100\n    const projectionMatrix = mat4.create()\n    if (perspective) {\n    mat4.perspective(projectionMatrix, fieldOfView, aspect, zNear, zFar)\n    } else {\n        mat4.ortho(projectionMatrix, -10*aspect, 10*aspect,  -10, 10, zNear, zFar)\n    }\n    return projectionMatrix\n}\n\nexport function createNormalMatrix(modelViewMatrix: mat4) {\n    const normalMatrix = mat4.create()\n    mat4.invert(normalMatrix, modelViewMatrix)\n    mat4.transpose(normalMatrix, normalMatrix)\n    return normalMatrix\n}\n//\n// Initialize a texture and load an image.\n// When the image finished loading copy it into the texture.\n//\nexport function loadTexture(gl: WebGLRenderingContext, url: string) {\n    const texture = gl.createTexture()\n    gl.bindTexture(gl.TEXTURE_2D, texture)\n\n    // Because images have to be downloaded over the internet\n    // they might take a moment until they are ready.\n    // Until then put a single pixel in the texture so we can\n    // use it immediately. When the image has finished downloading\n    // we'll update the texture with the contents of the image.\n    const level = 0\n    const internalFormat = gl.RGBA\n    const width = 1\n    const height = 1\n    const border = 0\n    const srcFormat = gl.RGBA\n    const srcType = gl.UNSIGNED_BYTE\n    const pixel = new Uint8Array([0, 0, 255, 255]) // opaque blue\n    gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, width, height, border, srcFormat, srcType, pixel)\n\n    const image = new Image()\n    image.onload = () => {\n        console.log(`texture \"${url}\" has been loaded`)\n        gl.bindTexture(gl.TEXTURE_2D, texture)\n        gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, srcFormat, srcType, image)\n\n        // WebGL1 has different requirements for power of 2 images\n        // vs non power of 2 images so check if the image is a\n        // power of 2 in both dimensions.\n        if (isPowerOf2(image.width) && isPowerOf2(image.height)) {\n            // Yes, it's a power of 2. Generate mips.\n            gl.generateMipmap(gl.TEXTURE_2D)\n        } else {\n            // No, it's not a power of 2. Turn off mips and set\n            // wrapping to clamp to edge\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR)\n        }\n    }\n    image.src = url\n\n    return texture\n}\nfunction isPowerOf2(value: number) {\n    return (value & (value - 1)) === 0\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2023 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\nexport class Reference {\n    constructor(object, attribute) {\n        this.object = object;\n        this.attribute = attribute.toString();\n    }\n    get() {\n        return this.object[this.attribute];\n    }\n    set(value) {\n        Object.defineProperty(this.object, this.attribute, { value: value, writable: true });\n    }\n    toString() {\n        return `${this.object[this.attribute]}`;\n    }\n    fromString(value) {\n        const type = typeof this.object[this.attribute];\n        let outValue;\n        switch (type) {\n            case \"string\":\n                outValue = value;\n                break;\n            case \"number\":\n                outValue = Number.parseFloat(value);\n                break;\n            default:\n                throw Error(`Reference.fromString() isn't yet supported for type ${type}`);\n        }\n        Object.defineProperty(this.object, this.attribute, { value: outValue, writable: true });\n    }\n}\nexport function ref(object, attribute) {\n    return new Reference(object, attribute);\n}\nexport function refs(object, ...attributes) {\n    return attributes.map((a) => new Reference(object, a));\n}\nexport class Fragment extends Array {\n    constructor(props) {\n        super(...props?.children);\n        for (let i = 0; i < this.length; ++i) {\n            const e = this[i];\n            if (typeof e === \"string\") {\n                this[i] = document.createTextNode(e);\n            }\n        }\n    }\n    replaceIn(element) {\n        element.replaceChildren(...this);\n    }\n    appendTo(element) {\n        for (let child of this) {\n            element.appendChild(child);\n        }\n    }\n}\n// https://reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html\nexport function jsx(nameOrConstructor, props, key) {\n    if (props !== undefined && props.children !== undefined) {\n        props.children = [props.children];\n    }\n    return jsxs(nameOrConstructor, props);\n}\nexport function jsxs(nameOrConstructor, props, key) {\n    let namespace;\n    if (typeof nameOrConstructor !== \"string\") {\n        return new nameOrConstructor(props);\n    }\n    const name = nameOrConstructor;\n    switch (name) {\n        case \"svg\":\n        case \"line\":\n        case \"rect\":\n        case \"circle\":\n        case \"path\":\n        case \"text\":\n            namespace = \"http://www.w3.org/2000/svg\";\n            break;\n        default:\n            namespace = \"http://www.w3.org/1999/xhtml\";\n    }\n    const tag = document.createElementNS(namespace, name);\n    setInitialProperties(tag, props, namespace);\n    return tag;\n}\nexport function setInitialProperties(element, props, namespace) {\n    if (props === null || props === undefined)\n        return;\n    for (let [key, value] of Object.entries(props)) {\n        switch (key) {\n            case \"children\":\n                break;\n            case \"action\":\n                ;\n                element.setAction(value);\n                break;\n            case \"model\":\n                ;\n                element.setModel(value);\n                break;\n            case \"class\":\n                element.classList.add(value); // FIXME: value is whitespace separated list\n                break;\n            case \"style\":\n                for (let [skey, svalue] of Object.entries(value)) {\n                    const regex = /[A-Z]/g;\n                    skey = skey.replace(regex, (upperCase) => \"-\" + upperCase.toLowerCase());\n                    if (typeof svalue === \"number\") {\n                        svalue = `${svalue}`;\n                    }\n                    element.style.setProperty(skey, svalue);\n                }\n                break;\n            case \"set\":\n                Object.defineProperty(props.set.object, props.set.attribute, { value: element, writable: true });\n                break;\n            default:\n                if (key.substring(0, 2) === \"on\") {\n                    element.addEventListener(key.substring(2), value);\n                }\n                else {\n                    if (typeof value === \"string\" || typeof value === \"number\" || typeof value === \"boolean\") {\n                        if (namespace === \"http://www.w3.org/2000/svg\") {\n                            const regex = /[A-Z]/g;\n                            key = key.replace(regex, (upperCase) => \"-\" + upperCase.toLowerCase());\n                        }\n                        element.setAttributeNS(null, key, `${value}`);\n                    }\n                }\n        }\n    }\n    if (props.children !== undefined) {\n        appendChildren(element, props.children);\n    }\n}\nfunction appendChildren(element, children) {\n    for (const child of children) {\n        if (child instanceof Array) {\n            appendChildren(element, child);\n            continue;\n        }\n        if (typeof child === \"string\") {\n            element.appendChild(document.createTextNode(child));\n            continue;\n        }\n        element.appendChild(child);\n    }\n}\n// the FunctionConstructor is a hack for <></>\n// actually it would be nice if we could support value objects too, eg. <TableView> instead of <toad-table>\n// export function createElement(name: string, props: JSX.HTMLElementProps, ...children: any): Element\n// export function createElement(name: FunctionConstructor, props: JSX.HTMLElementProps, ...children: any): Fragment\n// export function createElement(name: string | FunctionConstructor, props: JSX.HTMLElementProps, ...children: any): Element | Fragment {\n// }\n// backward compability\nexport function createElement(nameOrConstructor, props, ...children) {\n    // console.log(`createElement(${nameOrConstructor}, ${JSON.stringify(props)}, ${children}`)\n    // props: remove 'key', add 'children'\n    let key;\n    if (props !== null) {\n        if (\"key\" in props) {\n            key = props.key;\n            delete props.key;\n        }\n        if (children !== undefined) {\n            props.children = children;\n        }\n    }\n    else {\n        if (children !== undefined)\n            props = { children };\n    }\n    return jsxs(nameOrConstructor, props, key);\n}\n//# sourceMappingURL=jsx-runtime.js.map","import { Mesh } from \"animorph/Mesh\"\nimport { Reference } from \"toad.jsx/lib/jsx-runtime\"\n\ninterface RefTypes {\n    details: HTMLElement\n}\nconst refs: RefTypes = {} as any\n\ninterface Tile {\n    targetName?: string\n    img?: HTMLImageElement\n}\nlet tiles: Tile[]\n\nlet selectedJoint: number | undefined = undefined\n\nexport function posesBodyPanel(mesh: Mesh) {\n    mesh.poseMode()\n    const panel: HTMLElement[] = []\n    tiles = new Array<Tile>(poseTargets.length)\n    for (let jointIdx = 1; jointIdx < poseTargets.length; ++jointIdx) {\n        panel.push(createTile(mesh, jointIdx))\n    }\n    return (\n        <>\n            <div style={{ padding: \"5px\", fontWeight: \"bold\" }}>Poses</div>\n            <div id=\"panel\" style={{ lineHeight: \"0\" }}>\n                {...panel}\n            </div>\n            <div id=\"details\" set={new Reference(refs, \"details\")}></div>\n        </>\n    )\n}\n\nfunction createTile(mesh: Mesh, jointIdx: number): HTMLElement {\n    const target = poseTargets[jointIdx]\n    tiles[jointIdx] = { targetName: target }\n\n    const tileImg = (\n        <img src={`images/ui/rotations_${jointIdx.toString().padStart(2, \"0\")}.png`} />\n    ) as HTMLImageElement\n    tiles[jointIdx].img = tileImg\n\n    if (target === undefined) {\n        return tileImg\n    }\n    const title = target.at(4)!.toUpperCase() + target.substring(5).replaceAll(\"_\", \" \")\n    tileImg.title = title\n    tileImg.onpointerenter = () => {\n        tileImg.src = `images/ui/rotations_${jointIdx.toString().padStart(2, \"0\")}_over.png`\n    }\n    tileImg.onpointerleave = () => {\n        if (selectedJoint !== jointIdx) {\n            tileImg.src = `images/ui/rotations_${jointIdx.toString().padStart(2, \"0\")}.png`\n        }\n    }\n    tileImg.onpointerdown = () => {\n        if (jointIdx < tiles.length) {\n            const details = (\n                <>\n                    <div style={{ padding: \"5px\", fontWeight: \"bold\" }}>{title}</div>\n                </>\n            )\n            mesh.posemap.forEach((poseEntry, name) => {\n                if (name.startsWith(`${tiles[jointIdx].targetName}/`)) {\n                    details.push(createKnob(mesh, name))\n                }\n            })\n            refs.details.replaceChildren(...details)\n            if (selectedJoint !== undefined && selectedJoint !== jointIdx) {\n                tiles[selectedJoint].img!.src = `images/ui/rotations_${selectedJoint.toString().padStart(2, \"0\")}.png`\n            }\n            selectedJoint = jointIdx\n        }\n    }\n    return tileImg\n}\n\n// value changes on: drag left & right / wheel\n// white: default, red: changed\nfunction createKnob(mesh: Mesh, name: string) {\n    const img0 = `images/rot/${name}.png`\n    const img1 = `images/rot/${name}_over.png`\n\n    const detail = (\n        <div style={{ display: \"inline-block\", textAlign: \"center\" }}>\n            <img width=\"64\" height=\"64\" title={name} src={img0} />\n            <div></div>\n        </div>\n    ) as HTMLElement\n\n    let lastValue = 0,\n        downX: number | undefined\n\n    const img = detail.children[0] as HTMLImageElement\n    const txt = detail.children[1] as HTMLDivElement\n    const setValue = (value: number) => {\n        const v = mesh.setPose(name, value)\n        txt.innerText = Math.round(v).toString()\n        if (value !== 0) {\n            txt.style.color = \"#f00\"\n        } else {\n            txt.style.color = \"\"\n        }\n    }\n    setValue(mesh.getPose(name))\n\n    img.onpointerenter = (ev: PointerEvent) => {\n        ev.preventDefault()\n        img.src = img1\n    }\n    img.onpointerleave = (ev: PointerEvent) => {\n        ev.preventDefault()\n        img.src = img0\n    }\n    img.oncontextmenu = (ev: MouseEvent) => {\n        ev.preventDefault()\n    }\n    img.onpointerdown = (ev: PointerEvent) => {\n        ev.preventDefault()\n        img.setPointerCapture(ev.pointerId)\n        switch (ev.button) {\n            case 0:\n                downX = ev.x\n                lastValue = mesh.getPose(name)\n                break\n            case 2:\n                setValue(0)\n                break\n        }\n    }\n    img.onpointerup = (ev: PointerEvent) => {\n        ev.preventDefault()\n        downX = undefined\n    }\n    img.onpointermove = (ev: PointerEvent) => {\n        ev.preventDefault()\n        if (downX !== undefined) {\n            setValue(lastValue! + ev.x - downX)\n        }\n    }\n\n    return detail\n}\n\n// the body pose panel consists of 6x14 tiles\nconst poseTargets: (string | undefined)[] = [\n    undefined,\n    \"260_right_collar\",\n    \"300_head\",\n    \"280_left_collar\",\n    \"070_left_ringfinger_3\",\n    \"067_left_middlefinger_3\",\n    \"064_left_forefinger_3\",\n\n    \"220_right_upper_arm\",\n    \"320_neck\",\n    \"240_left_upper_arm\",\n    \"071_left_ringfinger_2\",\n    \"068_left_middlefinger_2\",\n    \"065_left_forefinger_2\",\n\n    undefined,\n    \"360_torso\",\n    undefined,\n    \"073_left_littlefinger_3\",\n    \"069_left_middlefinger_1\",\n    \"066_left_forefinger_1\",\n\n    \"140_right_lower_arm\",\n    \"380_pivot\",\n    \"160_left_lower_arm\",\n    \"074_left_littlefinger_2\",\n    \"072_left_ringfinger_1\",\n    \"061_left_pollex_3\",\n\n    \"060_right_hand\",\n    undefined,\n    \"080_left_hand\",\n    \"075_left_littlefinger_1\",\n    \"063_left_pollex_1\",\n    \"062_left_pollex_2\",\n\n    \"180_right_upper_leg\",\n    undefined,\n    \"200_left_upper_leg\",\n    \"044_right_forefinger_3\",\n    \"047_right_middlefinger_3\",\n    \"050_right_ringfinger_3\",\n\n    \"100_right_lower_leg\",\n    undefined,\n    \"120_left_lower_leg\",\n    \"045_right_forefinger_2\",\n    \"048_right_middlefinger_2\",\n    \"051_right_ringfinger_2\",\n\n    undefined,\n    undefined,\n    undefined,\n    \"046_right_forefinger_1\",\n    \"049_right_middlefinger_1\",\n    \"053_right_littlefinger_3\",\n\n    \"020_right_foot\",\n    undefined,\n    \"040_left_foot\",\n    \"041_right_pollex_3\",\n    \"052_right_ringfinger_1\",\n    \"054_right_littlefinger_2\",\n\n    undefined,\n    undefined,\n    undefined,\n    \"042_right_pollex_2\",\n    \"043_right_pollex_1\",\n    \"055_right_littlefinger_1\",\n\n    \"002_right_footfinger_4_2\",\n    \"000_right_footfinger_5_2\",\n    \"001_right_footfinger_5_1\",\n    \"022_left_footfinger_5_1\",\n    \"021_left_footfinger_5_2\",\n    \"023_left_footfinger_4_2\",\n\n    \"004_right_footfinger_3_2\",\n    \"005_right_footfinger_3_1\",\n    \"003_right_footfinger_4_1\",\n    \"024_left_footfinger_4_1\",\n    \"026_left_footfinger_3_1\",\n    \"025_left_footfinger_3_2\",\n\n    \"006_right_footfinger_2_2\",\n    \"007_right_footfinger_2_1\",\n    \"009_right_footfinger_1_1\",\n    \"030_left_footfinger_1_1\",\n    \"028_left_footfinger_2_1\",\n    \"027_left_footfinger_2_2\",\n\n    \"008_right_footfinger_1_2\",\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    \"029_left_footfinger_1_2\",\n]\n","import { Mesh } from \"animorph/Mesh\"\nimport { Reference } from \"toad.jsx/lib/jsx-runtime\"\n\ninterface RefTypes {\n    details: HTMLElement\n}\nexport const refs: RefTypes = {} as any\n\ninterface Tile {\n    // title: string\n    targetName?: string\n    img?: HTMLImageElement\n    imgSrc?: string\n    imgSrcOver?: string\n}\nlet tiles: Tile[]\n\nlet selectedTile: number | undefined = undefined\n\nexport function bodyDetailsPanel(mesh: Mesh) {\n    mesh.morphMode()\n    const panel: HTMLElement[] = []\n    tiles = new Array<Tile>(detailTargets.length)\n    for (let tileIdx = 0; tileIdx < detailTargets.length; ++tileIdx) {\n        panel.push(createTile(mesh, tileIdx))\n    }\n    return (\n        <>\n            <div style={{ padding: \"5px\", fontWeight: \"bold\" }}>Body Details</div>\n            <div id=\"panel\" style={{ lineHeight: \"0\" }}>\n                {...panel}\n            </div>\n            <div id=\"details\" set={new Reference(refs, \"details\")}></div>\n        </>\n    )\n}\n\nfunction createTile(mesh: Mesh, tileIdx: number): HTMLElement {\n    const target = detailTargets[tileIdx]\n    tiles[tileIdx] = { targetName: target }\n    const row = Math.floor(tileIdx / 6)\n    const col = tileIdx % 6\n    let src: string\n    let num\n    if (col < 2) {\n        src = \"body\"\n        num = 1 + col + row * 2\n    } else {\n        if (row < 6) {\n            src = \"face\"\n            num = 1 + col - 2 + row * 4\n        } else {\n            src = \"hands\"\n            num = 1 + col - 2 + (row - 6) * 4\n        }\n    }\n    src = `${src}_${num.toString().padStart(2, \"0\")}`\n    tiles[tileIdx].imgSrc = `images/ui/${src}.png`\n    tiles[tileIdx].imgSrcOver = `images/ui/${src}_over.png`\n\n    const tileImg = (<img src={tiles[tileIdx].imgSrc} />) as HTMLImageElement\n    const name = detailTargets[tileIdx]\n    if (name !== undefined) {\n        const title = name.at(0)!.toUpperCase() + name.substring(1).replace(\"_\", \" \")\n        tileImg.title = title\n        tileImg.onpointerenter = () => {\n            tileImg.src = tiles[tileIdx].imgSrcOver!\n        }\n        tileImg.onpointerleave = () => {\n            if (selectedTile !== tileIdx) {\n                tileImg.src = tiles[tileIdx].imgSrc!\n            }\n        }\n        tileImg.onpointerdown = () => {\n            const details = (\n                <>\n                    <div style={{ padding: \"5px\", fontWeight: \"bold\" }}>{title}</div>\n                </>\n            )\n            mesh.targetmap.forEach((targetEntry, name) => {\n                if (name.startsWith(`${tiles[tileIdx].targetName}/`)) {\n                    details.push(createKnob(mesh, name))\n                }\n            })\n            refs.details.replaceChildren(...details)\n\n            if (selectedTile !== undefined && selectedTile !== tileIdx) {\n                tiles[selectedTile].img!.src = tiles[selectedTile].imgSrc!\n            }\n            selectedTile = tileIdx\n        }\n    }\n    tiles[tileIdx].img = tileImg\n    return tileImg\n}\n\nfunction createKnob(mesh: Mesh, name: string) {\n    const imgSrc = `images/target/${name.substring(0, name.length - 7)}.png`\n\n    const detail = (\n        <div style={{ display: \"inline-block\", textAlign: \"center\" }}>\n            <img width=\"64\" height=\"64\" title={name} src={imgSrc} />\n            <div></div>\n        </div>\n    ) as HTMLElement\n\n    let lastValue = 0,\n        downX: number | undefined\n\n    const img = detail.children[0] as HTMLImageElement\n    const txt = detail.children[1] as HTMLDivElement\n    const setValue = (value: number) => {\n        value /= 100.0\n        const v = mesh.doMorph(name, value)\n        txt.innerText = v.toPrecision(2)\n        if (isZero(value)) {\n            value = 0\n        }\n        if (isEqual(value, 1)) {\n            value = 1\n        }\n        if (v !== 0) {\n            txt.style.color = \"#f00\"\n        } else {\n            txt.style.color = \"\"\n        }\n    }\n    setValue(mesh.getMorph(name) * 100)\n\n    img.onpointerenter = (ev: PointerEvent) => {\n        ev.preventDefault()\n    }\n    img.onpointerleave = (ev: PointerEvent) => {\n        ev.preventDefault()\n    }\n    img.oncontextmenu = (ev: MouseEvent) => {\n        ev.preventDefault()\n    }\n    img.onpointerdown = (ev: PointerEvent) => {\n        ev.preventDefault()\n        img.setPointerCapture(ev.pointerId)\n        switch (ev.button) {\n            case 0:\n                lastValue = mesh.getMorph(name) * 100\n                downX = ev.x\n                break\n            case 2:\n                setValue(0)\n                break\n        }\n    }\n    img.onpointerup = (ev: PointerEvent) => {\n        ev.preventDefault()\n        downX = undefined\n    }\n    img.onpointermove = (ev: PointerEvent) => {\n        ev.preventDefault()\n        if (downX !== undefined) {\n            setValue(lastValue! + ev.x - downX)\n        }\n    }\n\n    return detail\n}\n\nconst epsilon = 0.00001\n\nfunction isZero(a: number): boolean {\n    return Math.abs(a) <= epsilon\n}\nfunction isEqual(a: number, b: number) {\n    return isZero(a - b)\n}\n\n// prettier-ignore\nconst detailTargets: (string | undefined)[] = [\n    \"torso\", \"head\", undefined, undefined, undefined, undefined, \n    \"shoulders\", \"neck\", undefined, \"forehead\", undefined, undefined,\n    \"upper_arms\", undefined, undefined, \"eyes\", undefined, undefined,\n    \"lower_arms\", \"abdomen\", \"nose\", \"cheek\", \"ears\", undefined,\n    \"hands\", \"pelvis\", \"mouth\", undefined, undefined, undefined,\n    \"upper_legs\", undefined, \"chin_jaw\", undefined, undefined, undefined,\n    undefined, undefined, \"forefinger\", \"middlefinger\", \"ringfinger\", undefined,\n    \"lower_legs\", undefined, \"pollex\", undefined, \"littlefinger\", undefined,\n    \"feet\", undefined, undefined, undefined, undefined, undefined\n]\n","import { Mesh } from \"animorph/Mesh\"\nimport { SelectorManager } from \"animorph/SelectorManager\"\nimport { Selector } from \"animorph/Selector\"\n\nfunction createSelectorView(listener: SelectorManager, selector: Selector, name: string) {\n    const view = (\n        <div style={{ position: \"relative\" }}>\n            <div\n                style={{\n                    pointerEvents: \"none\",\n                    position: \"absolute\",\n                    left: `${selector.cursorPos.x - 3}px`,\n                    top: `${104 - selector.cursorPos.y - 3}px`,\n                    width: \"6px\",\n                    height: \"6px\",\n                    border: \"0\",\n                    background: \"#f00\",\n                }}\n            ></div>\n            <img src={`images/ui/${name}_selector.png`} />\n        </div>\n    ) as HTMLDivElement\n    const caret = view.children[0] as HTMLDivElement\n    const set = (ev: PointerEvent) => {\n        selector.setCursorPos(ev.offsetX, 104 - ev.offsetY)\n        caret.style.left = `${selector.cursorPos.x - 3}px`\n        caret.style.top = `${104 - selector.cursorPos.y - 3}px`\n        listener.calcWidgetTargets()\n    }\n    view.onpointerdown = (ev: PointerEvent) => {\n        ev.preventDefault()\n        view.setPointerCapture(ev.pointerId)\n        set(ev)\n    }\n    view.onpointermove = (ev: PointerEvent) => {\n        if (ev.buttons !== 0) {\n            set(ev)\n        }\n    }\n    return view\n}\n\nexport function characterPanel(mesh: Mesh) {\n    const mgr = mesh.mgr\n    mesh.morphMode()\n    return (\n        <>\n            <div style={{ padding: \"5px\", fontWeight: \"bold\" }}>Character</div>\n            {createSelectorView(mgr, mgr.age, \"age\")}\n            {createSelectorView(mgr, mgr.muscleSize, \"muscle_size\")}\n            {createSelectorView(mgr, mgr.breast, \"breast\")}\n            {createSelectorView(mgr, mgr.shape, \"shape\")}\n        </>\n    )\n}\n","import { posesBodyPanel } from \"./PosePanel\"\nimport { bodyDetailsPanel } from \"./DetailPanel\"\nimport { characterPanel } from \"./CharacterPanel\"\nimport { Mesh } from \"../animorph/Mesh\"\nimport { Fragment, Reference } from \"toad.jsx/lib/jsx-runtime\"\n\ninterface RefTypes {\n    panel: HTMLDivElement\n}\nconst refs: RefTypes = {} as any\n\nenum TAB {\n    LOAD,\n    SAVE,\n    CHARACTER,\n    DETAILS,\n    POSE,\n}\n\ninterface ToolDef {\n    id: TAB\n    icon: string\n    desc: string\n    img?: HTMLImageElement\n    render?: (mesh: Mesh) => Fragment\n}\n\nconst toolbarDefinition: ToolDef[] = [\n    { id: TAB.LOAD, icon: \"load\", desc: \"Load body setting\" },\n    { id: TAB.SAVE, icon: \"save\", desc: \"Save body setting\" },\n    {\n        id: TAB.CHARACTER,\n        icon: \"charac_sett\",\n        desc: \"Character setting (somatypes, shapes, age, etc...)\",\n        render: (mesh: Mesh) => characterPanel(mesh),\n    },\n    {\n        id: TAB.DETAILS,\n        icon: \"body_det_real\",\n        desc: \"Body details (realistic morphings)\",\n        render: (mesh: Mesh) => bodyDetailsPanel(mesh),\n    },\n    { id: TAB.POSE, icon: \"poses\", desc: \"Reset mesh\", render: (mesh: Mesh) => posesBodyPanel(mesh) },\n]\n\nlet activeTab: ToolDef | undefined\nfunction setTab(mesh: Mesh, tab: ToolDef) {\n    if (activeTab) {\n        activeTab.img!.src = `images/ui/toolbar_${activeTab.icon}.png`\n    }\n    activeTab = tab\n    activeTab.img!.src = `images/ui/toolbar_${activeTab.icon}_over.png`\n    if (tab.render !== undefined) {\n        refs.panel.replaceChildren(...tab.render(mesh))\n    } else {\n        refs.panel.replaceChildren()\n    }\n}\n\nfunction toolbarPanel(mesh: Mesh): HTMLElement[] {\n    return toolbarDefinition.map((it) => {\n        const img = (<img src={`images/ui/toolbar_${it.icon}.png`} title={it.desc} />) as HTMLImageElement\n        it.img = img\n        img.onpointerenter = () => {\n            img.src = `images/ui/toolbar_${it.icon}_over.png`\n        }\n        img.onpointerleave = () => {\n            if (it !== activeTab) {\n                img.src = `images/ui/toolbar_${it.icon}.png`\n            }\n        }\n        img.onpointerdown = () => {\n            setTab(mesh, it)\n        }\n        return img\n    })\n}\n\nexport default (mesh: Mesh) => {\n    const page = (\n        <>\n            <div\n                style={{\n                    position: \"absolute\",\n                    display: \"block\",\n                    left: \"0\",\n                    top: \"0\",\n                    bottom: \"0\",\n                    width: \"192px\",\n                }}\n            >\n                <div id=\"toolbar\" style={{ lineHeight: \"0\" }}>\n                    {...toolbarPanel(mesh)}\n                    <img src=\"images/ui/toolbar_reset.png\" title=\"Reset mesh\" onpointerdown={() => mesh.clear()} />\n                </div>\n                <div set={new Reference(refs, \"panel\")}></div>\n            </div>\n            <div\n                style={{\n                    position: \"absolute\",\n                    left: \"192px\",\n                    top: \"0px\",\n                    bottom: \"0px\",\n                    right: \"0px\",\n                }}\n            >\n                <canvas\n                    style={{\n                        width: \"100%\",\n                        height: \"100%\",\n                    }}\n                />\n            </div>\n        </>\n    ) as Fragment\n\n    setTab(mesh, toolbarDefinition[2])\n\n    return page\n}\n","import { FileSystemAdapter } from \"./filesystem/FileSystemAdapter\"\nimport { HTTPFSAdapter } from \"./filesystem/HTTPFSAdapter\"\nimport { Mesh } from \"./animorph/Mesh\"\nimport { renderMesh } from \"renderMesh\"\nimport screen from \"./ui/screen\"\n\nexport function main() {\n    console.log(`mh091rc1a (Makehuman 0.9.1-rc1a clone)`)\n    FileSystemAdapter.setInstance(new HTTPFSAdapter())\n    const mesh = new Mesh()\n    document.body.replaceChildren(...screen(mesh))\n    const canvas = document.body.querySelector(\"canvas\") as HTMLCanvasElement\n    renderMesh(canvas, mesh)\n}\n\ntry {\n    main()\n} catch (e) {\n    console.log(e)\n}\n"],"names":["FileSystemAdapter","setInstance","instance","readFile","pathname","exists","isFile","isDir","listDir","realPath","joinPath","pathname1","pathname2","u8","Uint8Array","u16","Uint16Array","i32","Int32Array","fleb","fdeb","clim","freb","eb","start","b","i","r","j","_a","fl","revfl","fd","rev","x","hMap","cd","mb","s","length","l","co","le","rvb","sv","r_1","v","m","flt","fdt","flrm","fdrm","max","a","bits","d","p","o","bits16","ec","err","ind","msg","nt","e","Error","code","captureStackTrace","inflt","dat","st","buf","dict","sl","dl","f","noBuf","resize","noSt","cbuf","bl","nbuf","Math","set","final","pos","bt","lm","dm","lbt","dbt","n","tbts","type","t","subarray","hLit","hcLen","tl","ldt","clt","clb","clbmsk","clm","c","lt","dt","lms","dms","lpos","sym","add","dsym","end","shift","dend","min","slc","et","unzlibSync","data","opts","dictionary","out","td","TextDecoder","decode","stream","HTTPFSAdapter","debug","console","log","endsWith","req","XMLHttpRequest","overrideMimeType","open","send","status","statusText","ab","ArrayBuffer","responseText","ua","charCodeAt","this","info","directoryCache","get","undefined","slash","lastIndexOf","substring","dir","includes","file","JSON","parse","fullfile","push","Map","ARRAY_TYPE","Float32Array","Array","create","glMatrix.ARRAY_TYPE","rotateX","rad","sin","cos","a10","a11","a12","a13","a20","a21","a22","a23","rotateY","a00","a01","a02","a03","rotateZ","hypot","y","arguments","sqrt","perspective","fovy","aspect","near","far","nf","tan","Infinity","ortho","left","right","bottom","top","lr","fromValues","z","subtract","scale","normalize","len","cross","ax","ay","az","bx","by","bz","transformMat4","w","RecursiveLevel","FileType","RotateAxis","sub","Face","size","vertices","constructor","v0","v1","v2","v3","material_index","no","vec3.create","StringToLineIterator","index","next","value","done","nextIndex","indexOf","result","substr","StringToLine","Symbol","iterator","FaceVector","loadGeometry","filename","reader","triangles","quads","line","trim","tokens","split","parseFloat","Vertex","xOrVertex","vec3.fromValues","VertexVector","load","clone","setFrom","src","DirectoryList","file_list","file_filter","path","recursive_level","recursive_counter","file_type","REGULAR_FILE","setFileFilter","setRecursive","setRootPath","setFileType","getDirectoryList","readDirRecursive","dir_str","dname","charAt","dir_file","DIRECTORY","NO_LIMIT","hasFileFilterEnding","UnsortedUsedVertex","Target","modVertex","vertex_number","parseInt","morph_vector","getModVertex","TargetEntry","preload","mTarget","mTargetLoadTry","mFilename","loadFromFile","getTarget","PoseRotation","hasCenter","minAngle","maxAngle","cat","clear","map","it","str","minMax","rotation","axis","X_AXIS","Y_AXIS","Z_AXIS","centerVertexNumbers","getCenterVertexNumbers","getCenter","center","setCenter","getAxis","getHasCenter","setHasCenter","getMinAngle","getMaxAngle","getNormalize","setNormalize","inNormalize","getCat","setCat","inCat","setLimb","limb","mbLimb","getLimb","MultiSet","order","array","entries","last","eraseLast","first","eraseFirst","splice","insert","k","firstIndex","lastIndex","middleIndex","floor","PoseTranslation","target","formFactor","inFilename","originalSize","calcFormFactor","vertexvector","minXSet","maxXSet","minYSet","maxYSet","minZSet","maxZSet","counter","n_vertex","tmpTarget","FF_VERTEX_N","getVec3","minX","maxX","minY","maxY","minZ","maxZ","xsize","ysize","zsize","getFormFactor","getFilename","calcCenteroid","vertexNumbers","vn","vec3.add","vec3.scale","PoseTarget","targetName","fullpath","positiveTranslations","negativeTranslations","positiveRotations","negativeRotations","negative","positive","normalizationInited","Set","fullPath","dir_list","files","target_name","tmpRotation","forEach","idx","tmpTranslation","calcRotationsCenteroids","rotations","rotations_it","calcTranslationsFormFactors","translations","translations_it","calcNormalizations","hasNegative","hasPositive","getPositiveTranslations","getNegativeTranslations","getPositiveRotations","getNegativeRotations","PoseEntry","mFullPath","isLoaded","FaceGroup","loaded","vertexes","fgroup_indent","content","ch","visible","facesIndexes","jsx","nameOrConstructor","props","key","children","jsxs","namespace","name","tag","document","createElementNS","setInitialProperties","element","Object","setAction","setModel","classList","skey","svalue","regex","replace","upperCase","toLowerCase","style","setProperty","defineProperty","object","attribute","addEventListener","setAttributeNS","appendChildren","child","appendChild","createTextNode","css","strings","values","concat","createElement","text","div","span","slot","input","button","ul","li","ns","svg","SignalLink","callback","id","Signal","locked","busy","callbacks","remove","count","lock","unlock","triggered","trigger","withLock","closure","error","ModelReason","ValueModelReason","NumberModelReason","Model","options","modified","enabled","ENABLED","color","COLOR","label","LABEL","description","DESCRIPTION","ERROR","applyStyle","removeAttribute","setAttribute","fontStyle","fontWeight","AbstractValueModel","aDefault","default","DEFAULT","resetToDefault","ValueModel","super","_value","VALUE","BooleanModel","BigDecimal","_n","ints","decis","String","BigInt","padEnd","DECIMALS","slice","ROUNDED","fromBigInt","bigint","assign","prototype","num","_divRound","dividend","divisor","mul","SHIFT","toString","padStart","repeat","ExpressionNode","eval","model","getCell","_calculatedValue","down","append","node","dependencies","deps","_toString","indent","Lexer","stack","isspace","isnumber","isalpha","isalnum","unlex","lex","pop","col","row","state","at","additive_expression","lexer","n0","multiplicative_expression","n1","n2","unary_expression","NumberModel","increment","step","clip","decrement","number","ex","autocorrect","check","MIN","MAX","STEP","AUTOCORRECT","TextModel","promise","trace","HtmlModel","Action","signal","_","getAttribute","nodeName","attributeOrUndefined","globalController","modelId2Models","modelId2Views","view2ModelIds","sigChanged","registerAction","actionId","action","_registerModel","registerModel","modelId","modelsForModelId","viewsForModelId","view","registerView","controller","modelIdsForView","modelsForView","unregisterView","modelIds","views","delete","entry","bind","html","boolean","AnimationBase","_stop","_firstFrame","_animationFrame","prepare","requestAnimationFrame","stop","animator","current","clearCurrent","animation","animationFrame","lastFrame","firstFrame","window","time","startTime","elapsed","animationFrameCount","ease","_current","PI","AnimationWrapper","Animator","run","animationBase","previousAnimation","halt","View","HTMLElement","define","customElements","getModelId","hasAttribute","getActionId","connectedCallback","disconnectedCallback","ModelView","init","updateModel","updateView","reason","isConnected","ALL","ActionView","Function","isEnabled","CSSStyleSheet","replaceSync","TextField","onkeydown","onblur","oninput","wheel","onwheel","ondblclick","attachShadow","mode","delegatesFocus","shadowRoot","adoptedStyleSheets","txText","preventDefault","deltaY","focus","blur","observedAttributes","attributeChangedCallback","oldValue","newValue","strValue","textAreaStyle","TextTool","texttool","toolbar","_jsx","class","buttonH1","onclick","execCommand","update","buttonH2","buttonH3","buttonH4","buttonBold","buttonItalic","buttonUnderline","buttonStrikeThrough","buttonSubscript","buttonSuperscript","buttonJustifyLeft","_jsxs","viewBox","width","height","x1","y1","x2","y2","buttonJustifyCenter","buttonJustifyRight","toggle","queryCommandValue","queryCommandState","TextArea","contentEditable","event","firstChild","nodeType","innerHTML","metaKey","updateTextTool","shiftKey","onkeyup","onmouseup","innerText","Display","ButtonVariant","Button","variant","PRIMARY","SECONDARY","ACCENT","NEGATIVE","txButton","_observer","MutationObserver","record","observer","_timer","clearTimeout","setTimeout","observe","childList","subtree","characterData","BooleanView","checked","Checkbox","onchange","checkmark","txCheckbox","replaceChildren","Search","s0","s1","form","placeholder","autocomplete","txSearch","Switch","txSwitch","RadioButton","disabled","txRadio","radioGroup","radioGroups","radioGroupCounter","childNodes","labelOf","isEnabledOf","MenuState","WeakMap","MenuButtonContainer","vertical","closeOnClose","WAIT","PopupMenu","root","parent","parentButton","popup","isAvailable","createWindowAt","deleteWindow","show","master","parentBoundary","getBoundingClientRect","opacity","popupBoundary","innerHeight","innerWidth","placePopupHorizontal","placePopupVertical","display","hide","popupBottom","SelectBase","pointerup","pointermove","pointerdown","keydown","tabIndex","outline","onpointerdown","onpointermove","onpointerup","txCombobox","txMenu","finalize","displayElement","ev","prev","togglePopup","close","setPointerCapture","pointerId","newHover","findMenuItem","hover","elementFromPoint","clientX","clientY","parentElement","contains","dataset","select","asHtml","ariaRoleDescription","position","zIndex","focusToItem","removeChild","Select","minWidth","ComboBox","textModel","Number","parseColor","g","match","Slider","container","rail","track","thumb","slider","orientation","minColor","maxColor","skew","setGradient","onfocus","txSlider","rot","backgroundImage","backgroundColor","GenericTool","focusIn","viewParents","distance","closestParent","closestTool","closestToolDistance","MAX_SAFE_INTEGER","closestToolList","tool","allTools","canHandle","toolParent","depth","toolDistance","viewIndex","getIndex","closestNextSiblingIndex","MIN_SAFE_INTEGER","toolIndex","setActive","from","activeTool","deactivate","activeView","activate","focusOut","relatedTarget","toolbuttonStyle","ToolButton","SlotView","ToadIf","Tabs","lineContainer","tabContainer","labelMap","activateTab","markerLine","activeLabel","activePanel","Tab","panel","tabLabel","stopPropagation","txTabs","txScrollbar","tab","adjustLine","offsetTop","clientHeight","offsetLeft","clientWidth","Promise","then","module","viewOrViewFunction","viewOrPromise","menuStyle","btoa","MenuButton","menuButton","onmousedown","documentMouseUp","removeEventListener","capture","buttonDown","dispatchEvent","MouseEvent","DOWN","UP_N_HOLD","active","DOWN_N_HOLD","documentMouseDown","tagName","collapse","DOWN_N_OUTSIDE","DOWN_N_INSIDE_AGAIN","onmouseout","inside","onmouseover","title","insertBefore","openPopup","closePopup","oldActive","MenuNode","shortcut","parentView","flexGrow","Menu","config","config2nodes","referenceActions","createShadowDOM","layout2nodes","newnode","dom.attribute","dom.attributeOrUndefined","space","findNode","strpos","MenuSpacer","TableModel","isEmpty","colCount","rowCount","TableEditMode","EditMode","TableEventType","TablePos","SelectionModel","EDIT_CELL","TypedTableModel","nodeClass","TableAdapterConfig","editMode","EDIT_ON_FOCUS","seamless","expandColumn","expandRow","TableAdapter","getColumnHead","getRowHead","showCell","cell","saveCell","editCell","isViewCompact","register","adapter","typeToModel","modelToAdapter","has","unbind","lookup","dataType","typeToAdapter","getPrototypeOf","baseClass","keys","modelX","typeToAdapterX","typeX","adapterX","TableEvent","TableFriend","table","logger","measure","getStaging","bodyStaging","getHeadStaging","headStaging","body","splitBody","colHeads","rowHeads","colResizeHandles","rowResizeHandles","animationDone","selection","setCellSize","h","clearAnimation","TableAnimation","prepareStagingWithRows","prepareBodyStaging","prepareRowHeadStaging","addStaging","scrollStaging","prepareStagingWithColumns","prepareColHeadStaging","className","disposeStaging","removeStaging","makeRowMask","mask","boxSizing","border","Table","maskColor","makeColumnMask","InsertAnimation","prepareCellsToBeMeasured","prepareStaging","arrangeInStaging","animate","animationStart","totalSize","join","joinHeader","joinBody","InsertRowAnimation","initialRowCount","splitHead","headMask","prepareMinCellSize","rowHeaders","colHeaders","createCell","calculateMinCellSize","overlap","px2float","colWidth","bounds","fill","minCellWidth","rowHeadWidth","rowHeight","minCellHeight","ceil","colHeadHeight","WIDTH_ADJUST","HEIGHT_ADJUST","splitHorizontalNew","lastElementChild","RemoveRowAnimation","joinHorizontal","initialHeight","bottomCell","removeAll","arrangeRowsInStaging","splitHorizontal","topSplitBody","animationHeight","topMask","cellCount","bottomOfStaging","moveSplitBodyToBody","moveSplitHeadToHead","InsertColumnAnimation","previousColCount","px2int","totalWidth","columnWidth","splitVerticalNew","bodyWidth","stagingWidth","splitWidth","bodyInsertAt","beforeChild","RemoveColumnAnimation","joinVertical","initialWidth","arrangeColumnsInStaging","splitVertical","leftSplitBody","animationWidth","leftMask","firstCellOfStaging","lastCellOfStaging","rightOfStaging","scrollIntoView","scrollableParent","el","isScrollable","findScrollableParent","parentRect","clientRect","GAP","clientLeft","scrollLeft","clientRight","clientTop","scrollTop","clientBottom","parentWidth","parentHeight","calculateScrollGoal","scrollable","startX","startY","activeGoal","concurrentScroll","scrollX","pageXOffset","scrollY","pageYOffset","deltaX","nx","ny","scrollTo","animateStep","smoothScroll","getComputedStyle","scrollBy","behavior","idSource","Date","now","userAgent","ROUNDING_TOLERANCE","navigator","RegExp","test","isScrollableY","hasScrollableSpace","canOverflow","isScrollableX","scrollWidth","scrollHeight","overflowValue","isVisible","HANDLE_SIZE","HANDLE_SKEW","prepareInProgress","loggerType","arrangeAllMeasuredInGrid","hostKeyDown","cellKeyDown","cellFocus","pointerDown","handleDown","handleMove","handleUp","setHeadingFillerSizeToScrollbarSize","selectionChanged","modelChanged","onresize","onscroll","txTable","selectionModel","mutations","allTables","prepareCells","attributes","SELECT_CELL","elements","editing","SELECT_ROW","EDIT_ON_ENTER","clientPosToTablePos","getModel","activeElement","hasFocus","CELL_CHANGED","HTMLSpanElement","INSERT_ROW","REMOVE_ROW","INSERT_COL","REMOVE_COL","prepareColumnHeads","prepareRowHeads","prepareBody","colWidths","calculateColumnWidths","rowHeights","calculateRowHeights","placeColumnHeads","placeRowHeads","placeBody","placeBodyCells","measureLineHeight","columnHeaders","caretColor","rh","withinBody","idxStart","cw","seam","filler","handle","createHandle","rowHandle","handleIndex","deltaHandle","deltaSplitBody","deltaSplitHead","deltaColumn","xLimit","yLimit","splitCol","splitHeadVertical","splitBodyVertical","splitColor","colsToSplit","boundary","splitColumn","extra","splitBodyColumns","cloneNode","delta","splitRow","splitHeadHorizontal","splitBodyHorizontal","cellAtBottom","splitBodyRows","bf","print","isRowEditInterface","isColumnEditInterface","buttonAddRowAbove","lastActiveTable","insertRow","buttonAddRowBelow","buttonDeleteRow","removeRow","buttonAddColumnLeft","insertColumn","buttonAddColumnRight","buttonDeleteColumn","removeColumn","buttonAddNodeAbove","buttonAddNodeBelow","buttonAddNodeParent","buttonAddNodeChild","buttonDeleteNode","Selector","rows","cols","labels","cursorPos","points","cellWidth","cellHeight","cellRatio","maxValue","setCursorPos","dists","getDists","tmp","pow","SelectorManager","mesh","age","muscleSize","breast","shape","doMorph","morph_value","calcWidgetTargets","ageDists","muscleSizeDists","breastDists","shapeDists","di_it","tmpTargetName","ms_it","tmpTargetValue","br_it","sh_it","VectorArray","setVec3","TargetMap","PoseMap","Mode","Mesh","changed","dirty","poseChanged","MORPH","poses","BodySettings","bodyset","facevector","facegroup","targetmap","posemap","loadMeshFactory","loadGroupsFactory","loadTargetsFactory","loadPoseTargetsFactory","mgr","morphMode","markDirty","poseMode","initPoses","POSE","getVertexes","vertexMorphed","vertexPosed","clearMorph","clearPose","vertexBase","updatePose","meshFilename","facesFilename","vertex","groups_filename","targetRootPath","recursiveLevel","clearmap","targetEntry","poseEntry","setPose","poseTarget","getPoseTargetForName","getPose","sort","doPose","getTargetForName","pt","doPoseTranslation","pr","doPoseRotation","real_value","rotMatrix","mat4.create","M_PI_180","theta","mat4.rotateX","mat4.rotateY","mat4.rotateZ","vec3.sub","vec3.transformMat4","real_morph_value","bs_morph_value","getMorph","calculateNormalsQuads","normals","indices","addNormal","normal","i1","i2","i3","i4","p1","p2","p3","u","vec3.subtract","vec3.cross","vec3.normalize","normalIndex","calculateNormalsTriangles","RenderMesh","gl","fvertex","uvs","fuvs","glIndices","createBuffer","ELEMENT_ARRAY_BUFFER","STATIC_DRAW","glVertex","ARRAY_BUFFER","glNormal","glData","xyz","fxyz","uv","fuv","uvOut","idxExtra","xyzOutExtra","uvOutExtra","decoupleXYZandUV","idxXYZ","xyzIdx","uvIdx","newIdxXYZ","idxXYZIn","i0","texcoord","glTexture","updateBuffer","draw","programInfo","drawElements","UNSIGNED_SHORT","drawSubset","offset","usage","buffer","bindBuffer","Int16Array","bufferData","AbstractShader","vertexShaderSrc","fragmentShaderSrc","program","createProgram","vertexShader","compileShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","vertexPosition","getAttribLocation","vertexNormal","projectionMatrix","getUniformLocation","modelViewMatrix","normalMatrix","normales","texture","FLOAT","vertexAttribPointer","enableVertexAttribArray","initProgram","initProjectionMatrix","initModelViewMatrix","initNormalMatrix","useProgram","uniformMatrix4fv","source","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","deleteShader","getShaderInfoLog","location","RGBAShader","rgbaVertexShaderSrc","rgbaFragmentShaderSrc","_color","setColor","rgba","uniform4fv","Projection","renderMesh","canvas","getContext","pixelStorei","UNPACK_FLIP_Y_WEBGL","enable","CULL_FACE","cullFace","BACK","programRGBA","faceGroups","group","faceIdx","face","ctx","projection","PERSPECTIVE","paint","ResizeObserver","downX","downY","ctrlKey","ORTHOGONAL","fieldOfView","mat4.perspective","mat4.ortho","createProjectionMatrix","D","mat4.translate","createModelViewMatrix","a30","a31","a32","a33","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","b11","det","mat4.transpose","createNormalMatrix","viewport","clearColor","clearDepth","DEPTH_TEST","depthFunc","LEQUAL","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","depthMask","prepareViewport","TRIANGLES","Reference","writable","fromString","outValue","Fragment","replaceIn","appendTo","refs","tiles","selectedJoint","createTile","jointIdx","poseTargets","tileImg","img","toUpperCase","replaceAll","onpointerenter","onpointerleave","details","_Fragment","padding","startsWith","img0","img1","detail","textAlign","lastValue","txt","setValue","round","oncontextmenu","createKnob","selectedTile","tileIdx","detailTargets","imgSrc","imgSrcOver","toPrecision","isZero","epsilon","abs","createSelectorView","listener","selector","pointerEvents","background","caret","offsetX","offsetY","buttons","TAB","toolbarDefinition","LOAD","icon","desc","SAVE","CHARACTER","render","characterPanel","DETAILS","lineHeight","bodyDetailsPanel","posesBodyPanel","activeTab","setTab","toolbarPanel","main","page","screen","querySelector"],"mappings":"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","x_google_ignoreList":[1,3,4,5,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,110]}